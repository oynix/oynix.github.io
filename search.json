[{"title":"æŠŠä»£ç è—åˆ°pngé‡Œ","url":"/2022/04/cbb587a9b5cc/","content":"\nä¹‹å‰æœ‰æåˆ°ï¼Œæœ€è¿‘å› éœ€æ±‚ç‰¹æ®Šï¼Œæ‰€ä»¥éœ€è¦æŠŠä»£ç è—èµ·æ¥ï¼Œæƒ³ç€æƒ³ç€å°±ç›¯ä¸Šäº†èµ„æºå›¾ã€‚ä¸ºäº†æŠŠä»£ç è—åˆ°pngé‡Œï¼Œæ‰€ä»¥ä¸“é—¨ç ”ç©¶äº†pngçš„æ–‡ä»¶æ ¼å¼ã€‚\n<!--more-->\nå®è§‚æ¥çœ‹ï¼Œæ–‡ä»¶éƒ½æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½å­˜å‚¨åœ¨ä»‹è´¨ä¸Šï¼Œå¦‚ç”µè„‘ç¡¬ç›˜ï¼Œæ‰‹æœºROMï¼Œè€Œå­—èŠ‚æ— éå°±æ˜¯010101çš„å½¢å¼ï¼Œé‚£ä¹ˆæ—¢ç„¶éƒ½æ˜¯010101çš„æ ¼å¼ï¼Œä¸ºä»€ä¹ˆæœ‰çš„æ–‡ä»¶æ˜¯pngï¼Œæœ‰çš„æ–‡ä»¶æ˜¯jpgï¼Œè¿˜æœ‰çš„æ–‡ä»¶æ˜¯webpå‘¢ï¼Ÿè¿™é‡Œé¢ï¼Œä¸€å®šæœ‰ç€ä»€ä¹ˆè§„åˆ™ï¼Œå°±åƒæ˜¯ç½‘ç»œé‡Œçš„å„ç§åè®®ï¼Œæ˜¯åŒæ ·çš„é“ç†ã€‚\n\nè¦æŸ¥çœ‹è¿™äº›ï¼Œé¦–å…ˆå°±è¦æŠŠæ–‡ä»¶ä»¥äºŒè¿›åˆ¶çš„å½¢å¼æ‰“å¼€ï¼Œæˆ‘ç”¨çš„æ˜¯UltraEditï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„ã€‚\n\n### 1. pngæ–‡ä»¶ç»“æ„\nå…³äºpngæ–‡ä»¶ç»“æ„ï¼Œç™½çš®ä¹¦æœ‰ç€è¯¦ç»†ä»‹ç»ï¼Œ[è¿™é‡Œæ˜¯å®˜æ–¹æ–‡æ¡£](https://www.w3.org/TR/PNG/)ã€‚è¿™ä¸ªæ–‡æ¡£é‡Œé¢å¯¹pngè¿›è¡Œäº†ååˆ†è¯¦å°½çš„ä»‹ç»ã€‚æ€»çš„æ¥è¯´ï¼Œpngæ–‡ä»¶çš„ç»“æ„å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤´ï¼ŒåŠ ä¸Šè‹¥å¹²äº†chunkå—ç»„æˆï¼Œ\n```\n[æ–‡ä»¶å¤´][chunk][chunk][chunk][chunk][chunk]\n```\n\n### 2. æ–‡ä»¶å¤´\næ­£å¦‚ç™½çš®ä¹¦ä¸­æ‰€è¯´ï¼Œpngæ–‡ä»¶å¤´æ˜¯å›ºå®šçš„\n```\n89 50 4E 47 0D 0A 1A 0A\n```\nè¿™æ˜¯16è¿›åˆ¶æ ¼å¼ï¼Œæ¯ä¸ªæ•°å­—ä»£è¡¨4ä¸ªbitï¼Œæ‰€ä»¥æ¯ä¸¤ä¸ªæ•°å­—ä»£è¡¨ä¸€ä¸ªbyteï¼Œæ–‡ä»¶å¤´çš„é•¿åº¦æ˜¯8ä¸ªå­—èŠ‚ã€‚ç¬¬ä¸€ä¸ªå­—èŠ‚0x89æ˜¯è§„å®šçš„ï¼Œç”¨ä¸€ä¸ªè¶…è¿‡ASCIIå­—ç¬¦èŒƒå›´çš„å€¼ï¼Œä¸ºçš„å°±æ˜¯é˜²æ­¢è¢«å½“ä½œæ–‡æœ¬æ–‡ä»¶å¤„ç†ã€‚ç´§æ¥ç€çš„3ä¸ªå­—èŠ‚ï¼ŒæŸ¥ä¸€ä¸‹ASCIIè¡¨å°±çŸ¥é“äº†ï¼Œ50=Pï¼Œ4E=Nï¼Œ47=Gï¼Œå‰©ä¸‹çš„0D 0A 1A 0Aæ˜¯ä»€ä¹ˆæ²¡è¯´ï¼Œæ–‡æ¡£ä¸Šå°±ä¸€å¥è¯ï¼Œè¿™ä¸ªç­¾åè¡¨æ˜æ˜¯pngå›¾ç‰‡\n> 5.2 PNG signature\n> The first eight bytes of a PNG datastream always contain the following (decimal) values:\n>\n>   137 80 78 71 13 10 26 10\n> This signature indicates that the remainder of the datastream contains a single PNG image, consisting of a series of chunks beginning with an IHDR chunk and ending with an IEND chunk.\n\n### 3. chunkç»“æ„\nç»“æ„å¦‚ä¸‹\n```\n[LENGTH][CHUNK TYPE][CHUNK DATA][CRC]\n```\nå½“chunk dataçš„é•¿åº¦æ˜¯0æ—¶ï¼Œchunkçš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼Œå°±æ˜¯å»æ‰äº†DATAéƒ¨åˆ†\n```\n[LENGTH][CHUNK TYPE][CRC]\n```\nå…¶ä¸­ï¼ŒLENGHTçš„é•¿åº¦æ˜¯4ä¸ªå­—èŠ‚ï¼ŒTYPEçš„é•¿åº¦ä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ï¼ŒDATAçš„é•¿åº¦å¯¹äºä¸åŒçš„TYPEæ˜¯ä¸åŒçš„ï¼ŒLENGTHçš„å€¼å°±æ˜¯DATAçš„é•¿åº¦ï¼ŒCRCçš„é•¿åº¦ä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ï¼Œä¸‹é¢ä¸€ä¸€è‡ªæŠ¥å®¶é—¨ã€‚\n\n### 4. chunk type\ntypeè¡¨æ˜äº†chunkå—çš„ç±»å‹ï¼Œç›®å‰pngä¸€å…±å®šä¹‰äº†18ä¸ªç±»å‹ï¼Œç„¶ååˆæŠŠè¿™18ä¸ªç±»å‹åˆ†ä¸ºä¸¤å¤§ç§ï¼Œä¸€ä¸ªæ˜¯å…³é”®chunksï¼Œå¦ä¸ªæ˜¯è¾…åŠ©chunksã€‚å…³é”®chunksä¸€å…±æœ‰4ä¸ªï¼Œå‰©ä¸‹çš„éƒ½æ˜¯è¾…åŠ©ç±»å‹ï¼Œæœ‰äº›ç±»å‹çš„ä½ç½®æ˜¯å›ºå®šçš„ï¼Œè¿™äº›éƒ½å†™åœ¨ç™½çš®ä¹¦çš„5.6å°èŠ‚ã€‚\n\nå…³é”®chunksï¼Œ\n\nchunk name|multiple allowed|optinal|order constraint\n:|:|:|:\nIHDR|No|No|Shall be first\nPLTE|No|Yes|Before first IDAT\nIDAT|Yes|No|Multiple IDAT chunks shall be consecutive\nIEND|No|No|Shall be last\n\nè¾…åŠ©chunksï¼Œæ‰€æœ‰è¾…åŠ©chunkéƒ½æ˜¯å¯é€‰çš„ï¼Œæ„æ€å³ä½¿pngæ–‡ä»¶é‡Œå¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰\n\nchunk name|multiple allowed|order constraint\n:|:|:\ncHRM|No|Before PLTE and IDAT\ngAMA|No|Before PLTE and IDAT\niCCP|No|Before PLTE and IDAT. If the iCCP chunk is present, the sRGB chunk should not be present.\nsBIT|No|Before PLTE and IDAT\nsRGB|No|Before PLTE and IDAT. If the sRGB chunk is present, the iCCP chunk should not be present.\nbKGD|No|After PLTE; before IDAT\nhIST|No|After PLTE; before IDAT\ntRNS|No|After PLTE; before IDAT\npHYs|No|Before IDAT\nsPLT|Yes|Before IDAT\ntIME|No|None\niTXt|Yes|None\ntEXt|Yes|None\nzTXt|Yes|None\n\n### 5. chunk data\nchunkçš„æ•°æ®éƒ½å­˜æ”¾åœ¨dataé‡Œï¼Œdataçš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚æ•°é‡ï¼Œç­‰äºLENGTHçš„å€¼ã€‚\n\n### 6. chunk crc\ncrcå­˜æ”¾çš„æ˜¯è¯¥chunkå—çš„æ ¡éªŒç ï¼Œé‡‡ç”¨çš„æ˜¯crc32çš„è®¡ç®—æ–¹å¼ï¼Œå°†typeå’Œdataè¾“å…¥ï¼Œè¾“å‡ºçš„ç»“æœå°±æ˜¯crc\n```\nchunk crc = crc32([CHUNK TYPE][CHUNK DATA])\n```\nç™½çš®ä¹¦é‡Œæ˜¯è¿™ä¹ˆä»‹ç»çš„ï¼Œå¦å¤–[è¿™ä¸ªæ–‡æ¡£é‡Œæœ‰ä»‹ç»pngæ‰€ä½¿ç”¨çš„crcç®—æ³•](http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html#CRC-algorithm)\n```\n5.5 Cyclic Redundancy Code algorithm\nCRC fields are calculated using standardized CRC methods with pre and post conditioning, as defined by ISO 3309 [ISO-3309] and ITU-T V.42 [ITU-T-V42]. The CRC polynomial employed is\n\nx32 + x26 + x23 + x22 + x16 + x12 + x11 + x10 + x8 + x7 + x5 + x4 + x2 + x + 1\n\nIn PNG, the 32-bit CRC is initialized to all 1's, and then the data from each byte is processed from the least significant bit (1) to the most significant bit (128). After all the data bytes are processed, the CRC is inverted (its ones complement is taken). This value is transmitted (stored in the datastream) MSB first. For the purpose of separating into bytes and ordering, the least significant bit of the 32-bit CRC is defined to be the coefficient of the x31 term.\n\nPractical calculation of the CRC often employs a precalculated table to accelerate the computation. See Annex D: Sample Cyclic Redundancy Code implementation.\n```\nçœ‹å®Œäº†è®¡ç®—åŸç†ä¹‹åï¼Œä¾¿å¼€å§‹è‡ªå·±å®ç°ç®—æ³•ï¼Œå†™ç€å†™ç€å‘ç°pythonæœ‰ç°æˆçš„libæä¾›crc32çš„ç®—æ³•ï¼Œå¸¦å…¥äº†å‡ ç»„æ•°æ®ä¹‹åå‘ç°ï¼Œç»“æœç«Ÿç„¶éƒ½æ­£ç¡®ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘è¿˜å­å“§å­å“§çš„å®ç°ä»€ä¹ˆå‘¢ã€‚\n\n### 7. å…³é”®chunkå—ï¼ŒIHDR\nIHDRå—ä¸€èˆ¬éƒ½ç´§è·Ÿåœ¨æ–‡ä»¶å¤´é‚£8ä¸ªå­—èŠ‚åé¢ï¼Œå…¶ä¸­chunk dataéƒ¨åˆ†æ¯ä¸ªå­—èŠ‚å­˜å‚¨çš„æ•°æ®è¡¨ç¤ºçš„å«ä¹‰éƒ½æ˜¯å›ºå®šçš„ï¼Œå¦‚ä¸‹\n\nName|Bytes Length|Description\n:|:|:\nwidth|4 bytes|å®½åº¦ï¼Œå•ä½åƒç´ \nheight|4 bytes|é«˜åº¦ï¼Œå•ä½åƒç´ \nbit depth|1 byte|å›¾åƒæ·±åº¦\ncolor type|1 byte|é¢œè‰²ç±»å‹\ncompression method|1 byte|å‹ç¼©æ–¹æ³•\nfilter metho|1 byte|æ»¤æ³¢å™¨æ–¹æ³•\ninterlace method|1 byte|éš”è¡Œæ‰«æ\n\næˆ‘æ‰¾äº†ä¸ªä¸€ä¸ªpngå›¾ç‰‡çš„å‰å‡ ä¸ªå­—èŠ‚ï¼Œä¸€èµ·å¯¹ç€æ¥çœ‹çœ‹\n```\n89 50 4E 47 0D 0A 1A 0A \n00 00 00 0D \n49 48 44 52 \n00 00 02 D0 00 00 05 00 08 06 00 00 00 \n6E CE 65 3D\n```\nä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œæˆ‘ç»™å®ƒæ–­æˆäº†å‡ è¡Œï¼Œç¬¬ä¸€è¡Œå°±ä¸ç”¨å¤šè¯´äº†ï¼Œæ˜¯pngæ–‡ä»¶å¤´ï¼Œåé¢çš„éƒ½æ˜¯IHDR chunkå—ã€‚å‰4ä¸ªå­—èŠ‚00 00 00 0Dä»£è¡¨ç€chunk lengthï¼Œè®¡ç®—å‡ºæ¥æ˜¯13ï¼Œæ¥ä¸‹æ¥çš„ä¸ª4ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯ASCIIç ï¼Œ49=Iï¼Œ48=Hï¼Œ44=Dï¼Œ52=Rã€‚ç„¶åå°±æ˜¯æœ€é•¿çš„ä¸€è¡Œï¼Œæ•°ä¸€æ•°å¯ä»¥å‘ç°ï¼Œæ­£å¥½æ˜¯13ä¸ªbyteï¼Œå’Œchunk lengthçš„å€¼æ˜¯ä¸€è‡´çš„ï¼Œæ ¹æ®ä¸Šè¡¨å¯çŸ¥ï¼Œ00 00 02 D0ä¸ºå›¾ç‰‡å®½åº¦ï¼Œç®—å‡ºæ¥æ˜¯720åƒç´ ï¼Œ00 00 05 00æ˜¯é«˜åº¦1280åƒç´ ï¼Œåé¢çš„å›¾åƒæ·±åº¦ã€é¢œè‰²ç±»å‹ä»€ä¹ˆçš„ï¼Œå°±ä¸çœ‹äº†ï¼Œç›´æ¥çœ‹chunk crcéƒ¨åˆ†çš„6E CE 65 3Dï¼Œè®¡ç®—ä¸€ä¸‹\n```python\nimport zlib\nif __name__ == '__main__':\n    data = [0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x02, 0xD0, 0x00, 0x00, 0x05, 0x00, 0x08, 0x06, 0x00, 0x00, 0x00]\n    crc = zlib.crc32(bytearray(data))\n    print(hex(crc))\n```\nè¿è¡Œç»“æœï¼š0x6ece653dã€‚å¯è§ï¼Œæˆªæ­¢è‡³æ­¤ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ˜¯æ­£å¸¸çš„ã€‚\n\n### 7. å…³é”®chunkå—ï¼ŒIDATã€IEND\nè¿™ä¸¤ä¸ªçš„chunkå—å’ŒIHDRæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœèƒ½æ˜ç™½ä¸Šé¢çš„IHDRï¼Œè¿™ä¸¤ä¸ªå°±ä¹Ÿèƒ½æ˜ç™½ã€‚è¿™é‡Œå•ç‹¬è¯´ä¸€å¥IENDï¼Œå› ä¸ºè¿™ä¸ªchunkå—æ²¡æœ‰chunk dataéƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰pngçš„IENDå—éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸€æ ·çš„lengthï¼Œä¸€æ ·çš„typeï¼Œä»¥åŠä¸€æ ·çš„crcã€‚\n\n### 8. æ’å…¥ä»£ç \nå¥½äº†ï¼Œæœ‰äº†ä¸Šé¢çš„åŸºç¡€çŸ¥è¯†å‡†å¤‡ï¼Œå¼€å§‹å¹²ç‚¹æ­£äº‹ã€‚\n\npngä¸­ï¼Œåƒç´ çš„æ•°æ®å­˜åœ¨è¿ç»­çš„IDAT chunkä¸­ï¼Œä¸€é•¿ä¸²çš„IDATæ•°æ®ï¼Œæ ¹æ®IHDRä¸­widthå’Œheightå‚æ•°ï¼Œå†è§£æå‡ºæ¥ã€‚\n\næˆ‘å¼€å§‹çš„æƒ³æ³•ï¼Œæ˜¯æŠŠä»£ç è—åœ¨è¾…åŠ©chunkä¸­ï¼Œé‚£ä¹ˆå¤šå¯é€‰çš„è¾…åŠ©ç±»å‹ï¼Œç…§ç‰‡çš„åœ°ç†ä½ç½®ã€é•œå¤´ã€å…‰åœˆç­‰ä¿¡æ¯ï¼Œéƒ½æ˜¯å­˜æ”¾åœ¨è¿™äº›è¾…åŠ©chunké‡Œï¼Œéšä¾¿é€‰å‡ ä¸ªï¼ŒæŠŠæ•°æ®æ’å…¥åˆ°dataéƒ¨åˆ†ï¼Œç„¶åå†è®¡ç®—ä¸€ä¸‹crcä¸å°±å®Œç¾äº†å—ï¼Ÿå†·é™ä¸‹æ¥åï¼Œè§‰å¾—æ­¤æ³•å°šæœ‰ä¸å¦¥ä¹‹å¤„ï¼Œä½ æƒ³å•Šï¼Œä¸€ä¸ªpngå›¾ç‰‡ï¼Œè¾…åŠ©ä¿¡æ¯å äº†å¥½å¤§ä¸€ä¸ªæ¯”ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªè¾…åŠ©ä¿¡æ¯åˆä¸æ˜¯æ­£å¸¸çš„æ–‡æœ¬ï¼Œæˆ–æ˜¯æ•°å­—ï¼Œé™¤äº†è‡ªå·±çŸ¥é“æ€ä¹ˆè§£æï¼Œåˆ«äººéƒ½çœ‹ä¸æ‡‚ï¼Œè®©äººæ˜“ç”Ÿç–‘å¿ƒï¼šä½ è¿™é‡Œé¢æ˜¯ä¸æ˜¯è—äº†ä»€ä¹ˆä¸èƒ½è§äººçš„ä¸œè¥¿ï¼Ÿè¿™æµ‘èº«æ˜¯å˜´ä¹Ÿè¯´ä¸æ¸…æ¥šã€‚\n\næœ‰ä¸ªåŒäº‹æ˜¯æŠŠä»£ç ç›´æ¥æ‹¼åœ¨äº†æ–‡ä»¶çš„æœ«å°¾ï¼Œå› ä¸ºwidthå’Œheightæ²¡å˜ï¼Œä¸­é—´çš„IDATä¹Ÿæ²¡å˜ï¼Œæ‰€ä»¥å®Œå…¨ä¸å½±å“pngæ–‡ä»¶çš„è¯»å–ï¼Œé‡åˆ°IEDNå°±åœäº†ï¼Œå³ä¾¿ä½ åé¢è¿˜æœ‰æ•°æ®ä¹Ÿä¸å¦¨äº‹ã€‚å½“ä»£ç å¾ˆå°‘æ—¶ï¼Œéš¾ä»¥çœ‹å‡ºç«¯å€ªï¼Œä½†æ˜¯ä»£ç ä¸€æ—¦å¾ˆå¤šï¼Œç”»é£å°±ä¼šå¾ˆè¯¡å¼‚ï¼šä¸€ä¸ªå‡ ååƒç´ ä¹˜å‡ ååƒç´ çš„å›¾ç‰‡ï¼Œæ–‡ä»¶å¤§å°å´è¶³è¶³æœ‰ä¸Šç™¾kBï¼Œè¿™å°±å¥½æ¯”ï¼Œä½ Eç›˜å­˜å‚¨è¿›åº¦æ¡éƒ½å˜çº¢äº†ï¼Œç‚¹è¿›å»ä¸€çœ‹ï¼Œå‘ç°é‡Œé¢åªæœ‰ä¸€é›†èœ¡ç¬”å°æ–°çš„åŠ¨ç”»ï¼Œè¿˜æ˜¯æ¸£ç”»è´¨ï¼Œå¤§å°ä¸º20MBï¼Œä½ å¯ä»¥è¯´è¿™é‡Œä¸€åˆ‡æ­£å¸¸ï¼Œä½†è¦æ˜¯æœ‰äººä¿¡äº†ï¼Œå°±å½“ä½ æ²¡è¯´ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåªè¦ä¸€æ‰“å¼€pngæ–‡ä»¶ï¼Œå°±ä¼šçœ‹åˆ°åé¢è·Ÿç€çš„é‚£æ¡é•¿é•¿çš„å°¾å·´ã€‚\n\næ€ç´¢å†ä¸‰ï¼Œæˆ‘è¿˜æ˜¯å†³å®šæŠŠä»£ç ä¼ªè£…æˆIDATå—ï¼Œæ’å…¥åˆ°æœ€åä¸€ä¸ªIDATå’ŒIENDä¹‹é—´ï¼Œä¸”ï¼Œå¦‚æœä»£ç å¾ˆå¤§ï¼Œå°±åˆ‡æˆç‰‡æ®µï¼Œæ’å…¥åˆ°å¤šä¸ªpngå›¾ç‰‡ä¸­ï¼Œä»¥ä¿è¯èµ·ç çœ‹ä¸Šå»æ˜¾å¾—å¾ˆå’Œè°ã€‚æ¯”å¦‚IHDRä¸­widthæ˜¯720ï¼Œheightæ˜¯1280ï¼Œæ‰€ä»¥IDATä¸­ï¼Œåªæœ‰720x1280=921,600ä¸ªåƒç´ ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œåé¢çš„IDATæ˜¯ä¸ä¼šå½±å“pngè§£æçš„ã€‚ä½†æ˜¯ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œåœ¨æ’å…¥ä¹‹å‰ï¼Œæ˜¯éœ€è¦æŠŠä»£ç åŠ å¯†çš„ï¼Œä¸€èˆ¬æ˜¯å’Œä¸€ä¸ªæ•°å­—åšå¼‚æˆ–æ“ä½œï¼Œç­‰åˆ°è§£ææ—¶ï¼Œä»pngä¸­å–å‡ºä»£ç ï¼Œå†ä¸åŒä¸€ä¸ªæ•°å­—åšå¼‚æˆ–æ“ä½œå³å¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä¾¿æ˜¯è¢«ä¸€äº›å°æœºçµé¬¼å‘ç°ç«¯å€ªï¼Œæ‰¾åˆ°éšè—çš„ç§˜å¯†ï¼Œä¹Ÿä¸è‡³äºé€ æˆä»£ç æ³„æ¼ã€‚\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç®€å•çš„æ–¹å¼ï¼Œæ¯”å¦‚ç›´æ¥æŠŠä»£ç çš„.jaræ”¹æˆ.ttfï¼Œä¼ªè£…æˆå­—ä½“æ–‡ä»¶ï¼Œæ”¾åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘è§‰å¾—è¿™ç§æ–¹å¼å°±æ˜¯åœ¨é å¤©åƒé¥­ï¼Œçœ‹å‘½ï¼Œä½†å‡¡é‡åˆ°ä¸ªå‹¤åŠ³çš„äººï¼Œå°±ä¼šå‘ç°è¿™ä¸ªttfå¹¶ä¸ç®€å•ï¼Œå†é¡ºç€è¿™ä¸ªttfæ‰¾å¼•ç”¨ï¼Œé¡ºè—¤æ‘¸ç“œï¼Œå°±è®©äººæŠ„äº†è€å·¢ã€‚\n\n### é™„å½•\nhttps://www.cnblogs.com/esestt/archive/2007/08/09/848856.html\nä¸€ä¸ªä»‹ç»crcç®—æ³•åŸç†çš„æ–‡ç« ï¼Œå†™çš„éå¸¸è¯¦ç»†ï¼Œæ‰çœ‹äº†ä¸€éæˆ‘å°±çœ‹æ˜ç™½äº†ï¼Œè™½ç„¶ä¹Ÿæ²¡ç®—å‡ºæ¥ï¼Œä½†æˆ‘è§‰å¾—è¿™å’Œæ–‡ç« æ²¡æœ‰å…³ç³»ï¼Œä¸€å®šæ˜¯æˆ‘çš„é—®é¢˜ï¼Œé‡åˆ°é—®é¢˜è¦å¤šåæ€è‡ªå·±ã€‚\n\næœ€åï¼Œå†æ¨èä¸€ä¸ªç½‘ç«™ï¼Œç”¨æ¥å‹ç¼©pngå›¾ç‰‡ï¼Œæ— æŸæˆ–æ¥è¿‘æ— æŸï¼Œ[TinyPng](https://tinypng.com/)ã€‚ä½†æ˜¯ï¼Œæ¯æ¬¡ä¸Šä¼ ä¸‹è½½æ•ˆç‡å¾ˆå·®ï¼Œæ‰€ä»¥æœ‰ä¸æ„¿é€éœ²å§“åçš„çƒ­å¿ƒå¸‚æ°‘å†™äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæ•ˆç‡æŒ‡æ•°åŠ å€ï¼Œ[åœ¨è¿™é‡Œ](https://github.com/kyleduo/TinyPNG4Mac)ã€‚","tags":["Python"],"categories":["Python"]},{"title":"AndroidStudio logcatè¿‡æ»¤å™¨","url":"/2022/04/f58f06543ab2/","content":"\næœ€è¿‘åœ¨ç”¨ä¸€ä¸ªçº¢ç±³çš„æ‰‹æœºæµ‹è¯•ï¼Œç®€ç›´å°±æ˜¯ä¸ªlogè½°ç‚¸æœºï¼Œæœç„¶ä¸ºå‘çƒ­è€Œç”Ÿã€‚\n<!--more-->\n\nä¸€èˆ¬æ¥è¯´ï¼Œå¸¸è§„æ–¹å¼å¯ä»¥åœ¨logcaté‡Œé™å®šè¿›ç¨‹ï¼Œåªæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„logï¼Œå¤§å¤šæ˜¯æ—¶å€™è¿™æ ·æ˜¯å¯ä»¥æ‹¦ä½ä¸éœ€è¦çš„logä¿¡æ¯çš„ï¼Œä½†ä¹Ÿä¸æ˜¯æ¯ä¸ªæ—¶å€™éƒ½å¥½ä½¿ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ‰‹åŠ¨æ·»åŠ ä¸€äº›è¿‡æ»¤å™¨ï¼Œæ‹¦ä½é‚£äº›æ¼ç½‘ä¹‹é±¼ã€‚\n\nåœ¨logcatå³è¾¹çš„è¿‡æ»¤å™¨é€‰æ‹©èœå•é‡Œï¼Œç‚¹å‡»Edit Filter Configurationï¼Œå°±å¯ä»¥å¢åŠ /åˆ é™¤è¿‡æ»¤å™¨äº†ã€‚å®ƒæ”¯æŒå¤šä¸ªç»´åº¦è¿‡æ»¤ï¼Œæ¯”å¦‚Log Tagï¼ŒLog Messageï¼ŒPackage Nameï¼ŒPIDï¼ŒLog Levelï¼Œå‰ä¸‰è€…è¿˜å¯ä»¥æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚\n\næˆ‘ç”¨çš„æ˜¯Log Tagå’ŒLog Messageçš„æ­£åˆ™è¿‡æ»¤ï¼ŒäºŒè€…é…åˆæ•ˆæœæ›´ä½³ï¼Œæ€»ç»“ä¸‹æ¥ï¼Œå°±æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œé…ä¸Šå¤šä¸ªå…³é”®è¯ã€‚æ¥çœ‹çœ‹æ­£åˆ™çš„ç¼–å†™è¿‡ç¨‹ï¼Œ\n\né¦–å…ˆï¼Œæ˜¯å¼€å¤´ç»“å°¾çš„æ ‡è®°\n```regex\n^$\n```\nç„¶åï¼Œæ–‡æœ¬å†…å®¹\n```regex\n^.*$\n```\næ¥ç€ï¼Œä»å¼€å¤´è¿‡æ»¤ï¼Œè¦æ±‚ä¸èƒ½æ˜¯æŸä¸ªè¯ï¼Œæ¯”å¦‚miui\n```regex\n^(?!(miui)).*$\n```\næƒ³åˆ°ï¼Œmiuiå¯èƒ½ä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªä½ç½®å‡ºç°ï¼Œå†å¤„ç†ä¸€ä¸‹\n```regex\n^(?!.*(miui)).*$\n```\nç»§ç»­ï¼Œå†å¤šåŠ å‡ ä¸ªå…³é”®è¯\n```regex\n^(?!.*(miui|Battery|HBM)).*$\n```\næœ€åï¼Œå®Œæˆã€‚\n\nç»è¿‡æˆ‘é•¿è¾¾å‡ åˆ†é’Ÿèšç²¾ä¼šç¥ç›¯ç€ï¼Œæ€»å…±æ‰¾åˆ°äº†è¿™ä¹ˆå¤šä¸éœ€è¦çš„å…³é”®è¯ï¼Œè¿˜æˆ‘ä¸€ä¸ªæ¸…å‡€çš„logcat\n```regex\n^(?!.*(subsystem_ramdump|NsdService|MDnsDS|system/bin/netd|subsystem_ramdu|CloudMusicNativePlayer|QSTile|MiuiNetworkPolicy|IDM-BonjourGovernor|NtpTrustedTime|netd|MI_STAT|chatty|OemNetd|Bluetooth|Battery|IdProviderImpl|ui-mini|PowerCheckerService|QtiCarrierConfigHelper|qdlights|CompatibilityInfo|MicroMsg|KeyguardUpdateMonitor|Miui|Audio|Matrix|xiaomi|libc|KeyguardIndication|PowerChecker|tycenter|hwservicemanager|CloudControlHelper|Launcher|ScreenView|HwcComposer|SDM|Ethernet|Traffic|PushService|MiBridge|StatusBar|miui|HotPool|ACDB|msm|Zeus|TeaLog|WifiService|Dhcp|Power|HBM|light|QSControl|SharedPreferences|ResolverController|cnss|systemui|mars|Track|PackageManager|Connectivity|Perf|kloadclassifie|HwBinder|Gesture|MiShare|tftp_server|SplashConfigModel|EventBus|ForceDarkHelper|Looper|ls|AggregateListener|octvm)).*$\n```","tags":["Android"],"categories":["Android"]},{"title":"è·å–æ–‡ä»¶çš„md5/sha1/sha256","url":"/2022/04/f52cc498815a/","content":"\nåœ¨ç½‘ç«™ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œç»å¸¸ä¼šçœ‹åˆ°åé¢è·Ÿç€ä¸€ä¸ªæ ¡éªŒç ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨æ¥æ ¡éªŒä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œæ–¹å¼æ˜¯åœ¨æœ¬åœ°å¯¹æ–‡ä»¶ç”¨ç›¸åŒçš„ç®—æ³•è®¡ç®—æ•ˆéªŒç ï¼Œå¦‚æœå’Œæä¾›çš„ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ–‡ä»¶å®Œæ•´ä¸”æ­£ç¡®ã€‚\n\n<!--more-->\n\næ ¡éªŒç çš„ç®—æ³•æœ‰å¤šç§ï¼Œå¸¸ç”¨çš„æœ‰md5ã€sha1ã€sha256ç­‰ï¼ŒMacOSä¸Šè‡ªå¸¦äº†å‡ ä¸ªå‘½ä»¤å¯ä»¥è®¡ç®—å‡ºè¿™äº›å€¼ã€‚æ–°å»ºä¸ªæ–‡æœ¬æ–‡ä»¶a.txtï¼Œå°†å­—ç¬¦ä¸²abcå†™å…¥ï¼Œç”¨è¿™ä¸ªæ–‡ä»¶æ¥æµ‹è¯•ã€‚\n\n### 1. md5\n- md5å‘½ä»¤\n```sh\n$ md5 a.txt\nMD5 (a.txt) = 900150983cd24fb0d6963f7d28e17f72\n```\n- opensslå‘½ä»¤\n```sh\n$ openssl md5 a.txt\nMD5(a.txt)= 900150983cd24fb0d6963f7d28e17f72\n```\nç»™a.txtæ”¹ä¸ªåå­—ï¼Œä½ ä¼šå‘ç°ç»“æœè¿˜æ˜¯ä¸€æ ·çš„ï¼Œç”šè‡³ï¼Œç›´æ¥è®¡ç®—å­—ç¬¦ä¸²abcçš„md5ï¼Œä½ ä¼šå‘ç°ç»“æœè¿˜æ˜¯ä¸€æ ·çš„\n```sh\n$ mv a.txt ab\n$ md5 ab\nMD5 (ab) = 900150983cd24fb0d6963f7d28e17f72\n\n$ md5 -s 'abc'\nMD5 (\"abc\") = 900150983cd24fb0d6963f7d28e17f72\n```\nç”±æ­¤å¯ä»¥éªŒè¯ï¼Œmd5è®¡ç®—çš„æ˜¯æ–‡ä»¶å†…å®¹çš„æ ¡éªŒå€¼ï¼Œåªè¦å†…å®¹ä¸å˜ï¼Œä¸ç®¡ä»¥ä½•ç§å½¢å¼ï¼Œæœ€ç»ˆç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚\n\n### 2. sha\nSecure Hash Algorithmï¼Œå®‰å…¨å“ˆå¸Œç®—æ³•ï¼Œæœ¬è´¨ä¸Šå’Œmd5ç±»ä¼¼ã€‚å®ƒæœ‰å¤šç§ç±»å‹SHA-1ã€SHA-224ã€SHA-256ï¼Œç­‰ã€‚æŸ¥ä¸€æŸ¥ç™¾ç§‘ï¼Œå¯ä»¥çŸ¥é“ï¼Œåè€…å‡ºç°çš„åŸå› ï¼Œæ˜¯å› ä¸ºå‰è€…å¯ä»¥è¢«ç ´è§£ï¼Œè™½å¤šæ˜¯ç¢°æ’æ–¹å¼ï¼Œä½†ä¹Ÿæ˜¯èƒ½ç ´è§£ï¼Œæ‰€ä»¥ä¸€ä¸ªè¢«ç ´è§£ï¼Œå°±è®¾è®¡æ›´å¤æ‚çš„ç®—æ³•ï¼Œä¹…è€Œä¹…ä¹‹å°±æœ‰äº†è¿™ä¹ˆå¤šç§ï¼Œç›¸ä¿¡éšç€æ—¶é—´å‘å±•ï¼Œç§‘æŠ€è¿›æ­¥ï¼Œåç»­ä¼šæœ‰æ›´å¤šçš„ç±»å‹å‡ºç°ã€‚\n- shasumå‘½ä»¤\n```sh\n$ shasum -a 1 a.txt\na9993e364706816aba3e25717850c26c9cd0d89d  ab\n\n$ shasum -a 256 a.txt\nba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad  ab\n```\nå‚æ•°-aï¼ŒæŒ‡å®šç®—æ³•ç±»å‹ï¼Œé»˜è®¤æ˜¯SHA-1ï¼Œå¯é€‰å€¼æœ‰1ï¼Œ224ï¼Œ256ï¼Œ384ï¼Œ512ï¼Œ512224ï¼Œ512256ï¼Œå¯ä»¥é€šè¿‡`shasum -h`å‘½ä»¤æŸ¥çœ‹\n- opensslå‘½ä»¤\n```sh\n$ openssl sha1 a.txt\nSHA1(ab)= a9993e364706816aba3e25717850c26c9cd0d89d\n\n$ openssl sha256 a.txt\nSHA256(ab)= ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad\n```\nç¬¬äºŒä¸ªå‚æ•°sha1ï¼Œå°±æ˜¯ç”¨æ¥æŒ‡å®šç®—æ³•ï¼Œopensslæ¯•ç«Ÿæ˜¯è€å¤§ï¼Œæ”¯æŒçš„æ¯”shasumå¤šäº†å¾ˆå¤šï¼Œå¯ä»¥é€šè¿‡`openssl sha1 -h`æŸ¥çœ‹\n\n### 3. å…¶ä»–\nè¿™é‡Œå¤šè¯´ä¸€å¥ï¼Œè¿™å‡ ä¸ªå‘½ä»¤éƒ½æ”¯æŒç®¡é“æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¯¹ä¸Šä¸€ä¸ªå‘½ä»¤çš„ç»“æœï¼Œç›´æ¥è®¡ç®—ç›®æ ‡å€¼\n```sh\n$ cat a.txt | md5\n900150983cd24fb0d6963f7d28e17f72\n\n$ cat a.txt | openssl md5\n900150983cd24fb0d6963f7d28e17f72\n\n$ cat a.txt | shasum -a 256\na9993e364706816aba3e25717850c26c9cd0d89d  -\n\n$ cat a.txt | openssl sha256\na9993e364706816aba3e25717850c26c9cd0d89d\n```","tags":["Linux","MacOS"],"categories":["MaxOS"]},{"title":"keytoolå‘½ä»¤ä½¿ç”¨","url":"/2022/04/283f20eed8de/","content":"\nä¹‹å‰ç”Ÿæˆç­¾åæ—¶ï¼Œéƒ½æ˜¯åœ¨Android Studioé‡Œç‚¹ï¼Œç‚¹å‡ ä¸‹ä¸€ä¸ªç­¾åå°±å‡ºæ¥äº†ï¼Œä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œå­¦ä¼šä½¿ç”¨keytoolå·¥å…·ï¼Œæ‰‹åŠ¨è¿›è¡Œä¸€äº›ç­¾åç›¸å…³çš„æ“ä½œï¼Œå¦‚ç”Ÿæˆã€æŸ¥çœ‹ã€å¯¼å‡ºç­‰ï¼Œè¿˜æ˜¯å¾ˆèƒ½æä¾›å¾ˆå¤šæ–¹ä¾¿çš„ã€‚\n<!--more-->\njava key storeçš„ç®¡ç†æ–¹å¼ä¸ºï¼Œç­¾åä¸€ä¸ªåº”ç”¨éœ€è¦ä¸€ä¸ªkeyï¼Œä¸€ä¸ªkeyå­˜åœ¨äºä¸€ä¸ªkeystoreä¸­ï¼Œä¸€ä¸ªkeystoreä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªkeyã€‚keystoreæ‹¥æœ‰å¯†ç ï¼ŒåŒæ—¶ï¼Œkeyä¹Ÿæ‹¥æœ‰å¯†ç ã€‚äºŒè€…ä¹‹é—´çš„å…³ç³»å¯ä»¥è¿™æ ·ç†è§£ï¼Œkeystoreç›¸å½“äºä¸€ä¸ªå¤§æˆ¿å­ï¼Œkeyåˆ™ç›¸å½“äºæˆ¿å­é‡Œçš„ä¸€ä¸ªæˆ¿é—´ï¼Œæˆ¿å­é‡Œå¯ä»¥æœ‰å¤šä¸ªæˆ¿é—´ï¼Œè¿›å…¥æˆ¿å­éœ€è¦é’¥åŒ™ï¼Œä¹Ÿå°±æ˜¯å¯†ç ï¼Œå†æƒ³è¿›å…¥åˆ°æŸä¸ªæˆ¿é—´ï¼Œä¹Ÿéœ€è¦è¿™ä¸ªæˆ¿é—´çš„é’¥åŒ™ï¼Œä¹Ÿå°±æ˜¯å¯†ç ã€‚ä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œä¸€èˆ¬å¸¸ç”¨çš„æ–¹å¼ï¼Œéƒ½æ˜¯ä¸€å¯¹ä¸€çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªkeystoreåªå­˜å‚¨ä¸€ä¸ªkeyï¼Œè¿™ä¸ªkeyåªç”¨æ¥ç­¾åä¸€ä¸ªåº”ç”¨ï¼Œæ²¡æœ‰å°†keystoreä¸­çš„storeçš„ä»·å€¼ä½“ç°å‡ºæ¥ã€‚\n\n### 1. æ”¯æŒçš„å‘½ä»¤\nkeytoolæä¾›äº†å¾ˆå¤šçš„å‘½ä»¤ï¼Œé€šè¿‡helpå¯ä»¥æŸ¥çœ‹ï¼Œå…¶ä¸­ï¼Œå¸¸ç”¨çš„åªæœ‰ç”Ÿæˆã€æŸ¥çœ‹ã€å¯¼å…¥å¯¼å‡ºï¼Œå…¶ä»–çš„å°±ä¸è¯´äº†\n```sh\n$ keytool help\nIllegal option:  help\nKey and Certificate Management Tool\n\nCommands:\n\n -certreq            Generates a certificate request\n -changealias        Changes an entry's alias\n -delete             Deletes an entry\n -exportcert         Exports certificate\n -genkeypair         Generates a key pair\n -genseckey          Generates a secret key\n -gencert            Generates certificate from a certificate request\n -importcert         Imports a certificate or a certificate chain\n -importpass         Imports a password\n -importkeystore     Imports one or all entries from another keystore\n -keypasswd          Changes the key password of an entry\n -list               Lists entries in a keystore\n -printcert          Prints the content of a certificate\n -printcertreq       Prints the content of a certificate request\n -printcrl           Prints the content of a CRL file\n -storepasswd        Changes the store password of a keystore\n\nUse \"keytool -command_name -help\" for usage of command_name\n```\n\n### 2. ç”Ÿæˆ\nä½¿ç”¨genkeypairå‘½ä»¤\n```sh\nkeytool -genkeypair -alias key0 -keystore test.jks -storepass 1234 -keyalg RSA -validity 2000 -keysize 2048 -dname \"CN=abc,OU=def\"\n```\nå‚æ•°è¯´æ˜\n- aliasï¼šç»™keyèµ·ä¸ªåå­—ï¼Œä¸€ä¸ªkeystoreä¸­keyçš„åå­—ä¸å…è®¸é‡å¤\n- keystoreï¼šç”Ÿæˆçš„keyè¦å­˜æ”¾çš„ç›®æ ‡keystoreï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šåˆ›å»º\n- storepassï¼škeystoreçš„å¯†ç ï¼Œè®¿é—®keystoreå°±éœ€è¦å¯†ç \n- keyalgï¼šç”Ÿæˆä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤æ˜¯DSAï¼Œå¸¸ç”¨RSA\n- validityï¼škeyçš„æœ‰æ•ˆæœŸï¼Œå•ä½æ˜¯å¤©\n- keysizeï¼škeyçš„é•¿åº¦ï¼ŒRSA2048ï¼ŒDSA2014ï¼ŒEC256ï¼ŒDES56ï¼ŒAES128\n- dnameï¼škeyçš„è¯¦ç»†ä¿¡æ¯ï¼Œå®Œæ•´çš„æ˜¯ï¼šCN=åå­—ä¸å§“æ°,OU=ç»„ç»‡å•ä½åç§°,O=ç»„ç»‡åç§°,L=åŸå¸‚æˆ–åŒºåŸŸåç§°,ST=å·æˆ–çœä»½åç§°,C=å•ä½\n\n### 3. æŸ¥çœ‹\nä½¿ç”¨listå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæŠŠkeystoreä¸­æ‰€åŒ…å«çš„æ‰€æœ‰keyéƒ½å±•ç¤ºå‡ºæ¥\n```sh\nkeytool -list -keystore test.jks -storepass 123456 -v\n```\nå‚æ•°è¯´æ˜\n- keystoreï¼šè¦æŸ¥çœ‹çš„keystore\n- storepassï¼škeystoreçš„å¯†ç \n- vï¼šverbose å±•ç¤ºæ‰€æœ‰ä¿¡æ¯\n- rfcï¼šä»¥rfcçš„æ ¼å¼å±•ç¤ºï¼Œå’Œ-vä¸èƒ½åŒæ—¶ä½¿ç”¨\n\n### 4. å¯¼å‡º\nä½¿ç”¨exportcertå‘½ä»¤ï¼Œå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªè¯ä¹¦æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯key\n```sh\nkeytool -exportcert -alias key0 -keystore test.jks -storepass 123456 -file key0.crt\n```\nå‚æ•°è¯´æ˜\n- aliasï¼šè¦å¯¼å‡ºçš„keyçš„åå­—\n- keystoreï¼šåŒä¸Š\n- storepassï¼šåŒä¸Š\n- fileï¼šå¯¼å‡ºçš„æ–‡ä»¶\n\n### 5. å¯¼å…¥\nä½¿ç”¨importcertå‘½ä»¤ï¼Œå°†ä¸€ä¸ªcrtæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯keyï¼Œå¯¼å…¥åˆ°keystoreä¸­\n```sh\nkeytool -importcert -alias key0 -keypass 123456 -file key.crt -keystore test.jks -storepass 123456\n```\nå‚æ•°è¯´æ˜\n- aliasï¼šç»™å¯¼å…¥çš„keyèµ·ä¸ªåå­—ï¼Œä¸èƒ½å’Œå·²å­˜åœ¨çš„é‡å¤\n- keypassï¼šç»™å¯¼å…¥çš„keyè®¾ç½®ä¸ªå¯†ç \n- fileï¼šå¾…å¯¼å…¥çš„keyçš„è¯ä¹¦\n- keystoreï¼šç›®æ ‡keystore\n- storepassï¼šå¯†ç \n\n### å…¶ä»–\ngenkeypairé€‚ç”¨éå¯¹ç§°åŠ å¯†ï¼ŒåŒ…æ‹¬ç§é’¥å’Œå…¬é’¥ã€‚genseckeyé€‚ç”¨äºå¯¹ç§°åŠ å¯†ï¼Œåªæœ‰ä¸€ä¸ªå¯†é’¥ã€‚jksæ–‡ä»¶åªèƒ½å­˜å‚¨éå¯¹ç§°åŠ å¯†ã€‚","tags":["Android","Java"],"categories":["Android"]},{"title":"shellå¸¸ç”¨è¯­æ³•","url":"/2022/04/8be3dad076cd/","content":"å¹³å¸¸ç»å¸¸å†™ä¸€äº›shellè„šæœ¬ï¼Œæ¥æ‰§è¡Œä¸€äº›è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œæ¯”å¦‚æ‰“åŒ…ã€è¿æ¥ç­‰ï¼Œè®°å½•ä¸‹å¸¸ç”¨åˆ°çš„è¯­æ³•å’Œå‘½ä»¤ã€‚\n<!--more-->\n\n### 1. æ ¼å¼å’Œè¿è¡Œ\næ ¼å¼æ˜¯æŒ‡å¼€å¤´ç¬¬ä¸€è¡Œ\n```sh\n#! /bin/bash\n```\nå…¶ä¸­çš„#!å«shebangï¼Œä¹Ÿå«hashbangï¼Œåé¢è·Ÿç€çš„è¿™ä¸ªè„šæœ¬è§£é‡Šå™¨çš„ç»å¯¹è·¯å¾„ï¼Œæˆ‘çš„ç”µè„‘ä¸Šç”¨çš„æ˜¯bashã€‚è¿è¡Œçš„æ—¶å€™ç›´æ¥ä½¿ç”¨shåé¢è·Ÿä¸Šè„šæœ¬çš„åå­—å³å¯ï¼Œå¦‚æœç»™è„šæœ¬æ–‡ä»¶åŠ ä¸Šå¯æ‰§è¡Œçš„æƒé™ï¼Œç”¨./ä¹Ÿå¯æ‰§è¡Œï¼Œå¦‚æœä¸å†™ç¬¬ä¸€è¡Œçš„è¯ï¼Œä½ ä¼šå‘ç°ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œå¦‚æœä¸å…‰æ˜¯ç»™è‡ªå·±ç”¨ï¼Œå»ºè®®è¿˜æ˜¯è¦å†™ä¸Šçš„ã€‚\n\n### 2. è·å–å‚æ•°\næœ‰æ—¶ä¸€äº›å‚æ•°æ˜¯ä¸å›ºå®šçš„ï¼Œéœ€è¦æ¯æ¬¡è¿è¡Œçš„æ—¶å€™ä¼ å…¥ã€‚æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨åé¢å†™å‚æ•°çš„å€¼ï¼Œå¦‚\n```sh\nsh command.sh arg1 arg2 arg3\n```\nè¿™ç§æ–¹å¼åœ¨è¯»å–æ—¶ï¼Œæ˜¯å‡­å€Ÿå‚æ•°çš„ä½ç½®é¡ºåºè¯»å–çš„ï¼Œ$0ä¸ºcommand.shï¼Œ$1ä¸ºå‚æ•°ä¸€arg1ï¼Œ$2ä¸ºå‚æ•°äºŒarg2ï¼Œä¾æ¬¡ç±»æ¨ã€‚è¿™ç§æ–¹å¼æ–¹ä¾¿ä¼ å…¥å’Œè¯»å–ï¼Œä½†æ˜¯å—åˆ°ä½ç½®çš„é™åˆ¶ï¼Œæœ‰æ—¶å¯èƒ½åªéœ€è¦ä¼ å…¥å‚æ•°äºŒï¼Œè€Œå‚æ•°ä¸€ä½¿ç”¨ç¼ºçœå€¼ä¾¿å¯ï¼Œè¿™æ—¶ä½¿ç”¨-argNameçš„æ–¹å¼ä¼šæ›´æ–¹ä¾¿ï¼ŒæŒ‰éœ€æŒ‡å®šå¹¶ä¼ å…¥ï¼Œå¦‚\n```sh\nsh command.sh -a argA -b argB -c argC\n```\nè¯»å–æ—¶ï¼Œè¦è¿™æ ·ï¼Œgetoptsï¼Œå³get optionsï¼Œè·å–æ‰€æœ‰çš„å¯é€‰å‚æ•°ï¼Œé€šè¿‡å¾ªç¯è¯»å–æ¯ä¸ªå‚æ•°çš„å€¼\n```sh\nwhile getopts \"a:b:c:\" opt\ndo\n    case $opt in\n        a ) argA=$OPTARG ;;\n        b ) argB=$OPTARG ;;\n        c ) argC=$OPTARG ;;\n    esac\ndone\n```\n\n### 3. æ¡ä»¶åˆ¤æ–­\nåˆ¤æ–­æ˜¯è„šæœ¬ä¸­æœ€å¸¸è§çš„å‘½ä»¤è¯­å¥äº†ï¼ŒåŸºæœ¬è¯­æ³•ä¸º\n```sh\nif [ command ]; then\n    # do something\nelif [ command ]; then\n    # do something\nelse\n    # do something\nfi\n```\nå…¶ä¸­çš„commandæœ‰å¾ˆå¤šï¼ŒæŒ‰ç±»å‹å¯ä»¥åˆ†ä¸ºï¼šåˆ¤æ–­æ–‡ä»¶/ç›®å½•ã€åˆ¤æ–­å­—ç¬¦ä¸²å’Œåˆ¤æ–­æ•°å€¼å¤§å°ï¼Œä¸¾å‡ ä¸ªå¸¸ç”¨çš„\n```sh\n# æ–‡ä»¶/ç›®å½•\n[ -e FILE ] æ–‡ä»¶å­˜åœ¨ \n[ -f FILE ] æ™®é€šæ–‡ä»¶å­˜åœ¨ -bï¼šäºŒè¿›åˆ¶æ–‡ä»¶ -cï¼šå­—ç¬¦æ–‡ä»¶ -rï¼šå¯è¯»æ–‡ä»¶ -xï¼šå¯æ‰§è¡Œæ–‡ä»¶\n[ -d DIR ] ç›®å½•å­˜åœ¨\n[ FILE1 -nt FILE2 ] newer thanï¼Œä¹Ÿå°±æ˜¯1æ¯”2æ›´æ–° åŒç†ï¼Œ-otï¼šolder than\n\n# å­—ç¬¦ä¸²\n[ -z STRING ] zeroé•¿åº¦ä¸º0\n[ -n STRING ] not zeroé•¿åº¦ä¸ä¸º0ï¼Œ-nä¹Ÿå¯ä»¥çœç•¥ï¼Œå³ç­‰åŒäº [ STRING ]\n[ S1 = S2 ] ç›¸åŒï¼ŒåŒç† !=ä¸ºä¸åŒ\n\n# æ•°å€¼\n[ INT1 -eq INT2 ] equalsï¼Œç›¸ç­‰ï¼ŒåŒç† -neï¼šnot equals\n[ INT1 -gt INT2 ] greater than,å¤§äºï¼Œä¹Ÿå¯ä»¥å†™æˆå¤§äºå·: >ï¼ŒåŒç† -ltï¼šless than\n[ INT1 -ge INT2 ] greater or equals, å³ä¸º>=ï¼ŒåŒç† -leï¼š<= å°äºç­‰äº\n\n# å¤šä¸ªæ¡ä»¶\n[ (æ¡ä»¶1) -a (æ¡ä»¶2) ] allï¼Œä¸ï¼Œä¹Ÿå¯ä»¥å†™æˆ &&\n[ () -o () ] orï¼Œæˆ–ï¼Œä¹Ÿå¯ä»¥å†™æˆ ||\n[ ! () ] notï¼Œé\n```\n\n### 4. æœåŠ¡å™¨\nsshè¿æ¥æœåŠ¡å™¨ï¼Œå¦‚æœå·²ç»æŠŠè‡ªå·±çš„å…¬é’¥id_rsa.pubæ·»åŠ åˆ°äº†æœåŠ¡å™¨çš„authorized_keysé‡Œï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¿æ¥ï¼Œå°±å¯ä»¥äº†\n```sh\nssh username@server-ip\n```\nå¦‚æœæ²¡æœ‰æ·»åŠ ï¼Œåˆ™éœ€è¦æŒ‡å®šæœåŠ¡å™¨çš„ç§é’¥çš„pemæ–‡ä»¶ä½œä¸ºå‚æ•°\n```sh\nssh -i identification.pem username@server-ip\n```\nåŸç†å¾ˆç®€å•ï¼Œä¸€æ˜¯æœåŠ¡å™¨ä¿¡ä»»äº†è‡ªå·±çš„å…¬é’¥ï¼ŒäºŒæ˜¯æ‹¿ç€æœåŠ¡å™¨çš„ç§é’¥çš„pemï¼Œpemçš„è·å–æ–¹å¼ä¸º\n```sh\n# æœåŠ¡å™¨ç”Ÿæˆå…¬é’¥åŒ™ç§é’¥å¯¹ï¼Œè¿™ä¼šå¾—åˆ°ä¸€ä¸ªç§é’¥privateï¼Œå’Œå…¬é’¥private.pub\nssh-keygen\n# è½¬æ¢ç§é’¥ï¼Œä¼ å…¥ç§é’¥ï¼Œå¾—åˆ°pemæ ¼å¼ï¼Œå‡¡æ˜¯æ‹¿ç€è¿™ä¸ªpemçš„å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥\nopenssl rsa -in private -outform pem > private.pem\n```\nå½“ç„¶ï¼Œå…‰è¿ä¸ŠæœåŠ¡å™¨ä¸æ˜¯ç›®çš„ï¼Œè¿™äº›å¦‚æœå†™åˆ°shellè„šæœ¬é‡Œä¼šä¸­æ–­æ‰§è¡Œï¼Œè€Œæˆ‘çš„ç›®çš„æ˜¯åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œè¿åˆ°æœåŠ¡å™¨åªæ˜¯å‰æï¼Œè‹¥æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚ä¸‹\n```sh\nssh username@server-ip \"[command]\"\n# e.gã€‚\nssh user@server-ip \"cd documents && ls -la\"\n```\næœ‰æ—¶è¿˜ä¼šéœ€è¦åœ¨æœ¬åœ°å’Œè¿œç¨‹ä¹‹é—´ä¼ é€’æ–‡ä»¶å‘½ä»¤ï¼Œä»æœ¬åœ°åˆ°è¿œç¨‹å¦‚ä¸‹ï¼ˆè¿œç¨‹åˆ°æœ¬åœ°å°±åè¿‡æ¥ï¼‰ï¼Œæ³¨æ„server-ipåé¢çš„å†’å·ï¼Œ\n```sh\nscp [options] /local/source/file/path user@server-ip:/path/to/destination\n-C è¦å¤§å†™ï¼Œå‹ç¼©\n-P è¦å¤§å†™ï¼Œç«¯å£å·ï¼Œé»˜è®¤22\n-r recursiveé€’å½’\n-p ä¿ç•™è®¿é—®ä¿®æ”¹æ—¶é—´\n```\n\n### 5. ç¼–è¯‘shellè„šæœ¬\næœ‰æ—¶å†™å®Œä¸€ä¸ªshellè„šæœ¬ï¼Œéœ€è¦ç»™åˆ«äººä½¿ç”¨ï¼Œä½†æ˜¯åˆä¸æƒ³è®©åˆ«äººçœ‹åˆ°é‡Œé¢çš„ä»£ç ï¼Œå¯èƒ½å› ä¸ºé‡Œé¢æœ‰é‡è¦æ•°æ®ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ä¸ºä»€ä¹ˆï¼Œå°±æ˜¯ä¸æƒ³ï¼Œè¿™æ—¶å¯ä»¥æŠŠshellè„šæœ¬ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ—¢å¯ä»¥æ‰§è¡Œï¼Œä½†åˆæ— æ³•æŸ¥çœ‹äº†ã€‚ä¸€å…±æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„gzexeï¼ŒäºŒæ˜¯ä½¿ç”¨shcå‘½ä»¤ï¼Œ\n```sh\ngzexe command.sh\n```\nè¿™ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯command.shï¼Œå¦ä¸ªæ˜¯command.sh~ï¼Œå‰è€…æ˜¯å‹ç¼©ä¹‹åçš„ï¼Œå¸¦ï½çš„æ˜¯åŸæ–‡ä»¶ï¼Œæ‰“å¼€å‹ç¼©ä¹‹åçš„æ–‡ä»¶ï¼Œå¯ä»¥å‘ç°é‡Œé¢æœ‰ä¸å°‘å†…å®¹è¿˜æ˜¯å¯ä»¥çœ‹æ‡‚çš„ï¼Œå°½ç®¡å¤šæ•°éƒ½ä¸æ²¾è¾¹äº†ã€‚\n```sh\nshc -f command.sh\n```\nè¿™ä¹Ÿä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯command.sh.xï¼Œè¿™æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦ä¸ªæ˜¯command.sh.x.cï¼Œè¿™æ˜¯ä¸ªcæ–‡ä»¶ï¼Œæ‰“å¼€å¯æ‰§è¡Œæ–‡ä»¶åï¼Œä¼šå‘ç°å®Œå…¨çœ‹ä¸æ‡‚ï¼Œéƒ½æ˜¯ä¹±ç ï¼Œæ¨æµ‹å¯èƒ½å…ˆç”Ÿæˆäº†cæ–‡ä»¶ï¼Œç„¶åå†å°†cç¼–è¯‘æˆäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚[è¿™æ˜¯shcçš„githubåœ°å€](https://github.com/neurobin/shc)","tags":["shell"],"categories":["Linux"]},{"title":"JNIä½¿ç”¨æ€»ç»“","url":"/2022/03/4cd01e062b9d/","content":"\nç”±äºä¸šåŠ¡ç‰¹æ®Šï¼Œæœ€è¿‘çš„éœ€æ±‚éƒ½æ˜¯è—ä»£ç ï¼ŒæŠŠä¸šåŠ¡é€»è¾‘ä»£ç è—åˆ°å·¥ç¨‹é‡Œçš„å„ä¸ªå±‚é¢ï¼Œè¿™å°±ç¦»ä¸å¼€JNIå¼€å‘äº†ï¼Œè¿™ç¯‡æ¥å…·ä½“è¯´ä¸€è¯´ã€‚\n\n<!--more-->\n\nJNIï¼ˆJava Native Interfaceï¼‰ï¼Œæ˜¯Androidå¼€å‘ä¸­åœ¨åŸç”Ÿjavaå±‚è°ƒç”¨c/c++ nativeæ–¹æ³•çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿå¯ä»¥åœ¨nativeå±‚è°ƒç”¨javaå±‚çš„æ–¹æ³•ã€‚JNIåº“ä¸€èˆ¬æ˜¯ä»¥æ‰©å±•åä¸ºsoï¼ˆshared objectï¼‰çš„æ–‡ä»¶å­˜åœ¨ï¼Œé€šè¿‡`System.load`å°±å¯ä»¥å°†å…¶åŠ è½½åˆ°åº”ç”¨è¿›ç¨‹ä¸­ï¼Œä¹‹åjavaå±‚å’Œnativeå±‚ä¾¿å¯ä»¥ç›¸äº’è°ƒç”¨ã€‚\n\n### 1. åŸºç¡€æ•°æ®ç±»å‹\n\næ—¢ç„¶å¯ä»¥äº’ç›¸è°ƒç”¨ï¼Œé‚£ä¹ˆäºŒè€…åœ¨æ•°æ®ç»“æ„ä¸Šçš„å°±æœ‰ç€å¯¹åº”å…³ç³»ï¼Œå…·ä½“å¦‚ä¸‹ï¼š\n\n| Java    | JNI      | Desc           |\n| ------- | -------- | -------------- |\n| boolean | jboolean | usigned 8 bit  |\n| byte    | jbyte    | unsigned 8 bit |\n| char    | jchar    | unsigned 8 bit |\n| short   | jshort   | signed 16 bit  |\n| int     | jint     | signed 32 bit  |\n| long    | jlong    | signed 64 bit  |\n| float   | jfloat   | signed 32 bit  |\n| double  | jdouble  | signed 64 bit  |\n\n### 2. javahæ–¹å¼\nåœ¨javaæ–‡ä»¶NativeLib.javaä¸­ï¼Œå£°æ˜ä¸€ä¸ªnativeä¿®é¥°çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å£°æ˜å¤šä¸ªï¼Œç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œ\n```sh\njavac -h . NativeLib.java\n```\näºæ˜¯ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹å°±ä¼šç”ŸæˆNativeLib.classæ–‡ä»¶ï¼Œå’Œä¸€ä¸ª.hçš„headeræ–‡ä»¶ï¼Œä½ ä¼šå‘ç°é‡Œé¢éƒ½æ˜¯äº›åˆè‡­åˆé•¿çš„å‡½æ•°å£°æ˜ï¼Œç„¶ååœ¨cppæ–‡ä»¶ä¸­å®ç°headeræ–‡ä»¶é‡Œçš„å‡½æ•°ï¼Œå°†å…¶æ‰“åŒ…æˆsoæ–‡ä»¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œjvmä¾¿å¯ä»¥æ ¹æ®åå­—æ‰¾åˆ°nativeä¿®é¥°çš„æ–¹æ³•å¯¹åº”çš„jniä¸­çš„å‡½æ•°ï¼Œè¿™æ˜¯å†™åœ¨jvmä»‹ç»é‡Œé¢çš„ï¼Œå…·ä½“çš„[è¿™ä¸ªOracleæ–‡æ¡£](https://docs.oracle.com/javase/6/docs/technotes/guides/jni/spec/design.html#wp615)é‡Œæœ‰ä»‹ç»ã€‚\n\n### 3. JNI_OnLoadæ–¹å¼\nè¿™æ˜¯ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œåœ¨è°ƒç”¨System.loadæ–¹æ³•åŠ è½½soåº“æ–‡ä»¶åï¼Œæœ€ç»ˆä¼šè°ƒç”¨åº“æ–‡ä»¶é‡Œçš„JNI_OnLoadæ–¹æ³•ï¼Œå‰ææ˜¯å·²å®šä¹‰äº†è¿™ä¸ªæ–¹æ³•\n```java\nSystem.load -> Runtime.loadLibrary -> nativeLoad(java_lang_Runtime.cpp) -> \nDalvik_java_lang_Runtime_nativeLoad -> dvmLoadNativeCode(dalvik/vm/Native.cpp) ->\n- dlopen(pathName, RTLD_LAZY) (æŠŠso mmapåˆ°è¿›ç¨‹ç©ºé—´ï¼Œå¹¶æŠŠfuncç­‰ç›¸å…³ä¿¡æ¯å¡«å……åˆ°soinfoä¸­)\n- dlsym(handle, \"JNI_OnLoad\") (æŸ¥æ‰¾JNI_InLoad) æ–¹æ³•ï¼Œæ‰¾åˆ°åˆ™è°ƒç”¨\n- JNI_OnLoad\n```\næ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ³¨å†Œå‡½æ•°ï¼ŒJNIä¹Ÿæä¾›äº†æ³¨å†Œå‡½æ•°çš„æ–¹æ³•RegisterNativesã€‚è¿™ç§æ–¹å¼éœ€è¦ä¸¤æ­¥ï¼Œé¦–å…ˆæ‰¾åˆ°ç›®æ ‡Classï¼Œç„¶åå†è°ƒç”¨Registeræ–¹æ³•å³å¯ï¼Œä»¥ä¸‹æ˜¯Androidå®˜ç½‘[ç¤ºä¾‹ä»£ç ](https://developer.android.com/training/articles/perf-jni#native-libraries)\n```cpp\nJNIEXPORT \njint JNI_OnLoad(JavaVM* vm, void* reserved) {\n    JNIEnv* env;\n    if (vm->GetEnv(reinterpret_cast<void**>(&env), JNI_VERSION_1_6) != JNI_OK) {\n        return JNI_ERR;\n    }\n\n    // Find your class. JNI_OnLoad is called from the correct class loader context for this to work.\n    jclass c = env->FindClass(\"com/example/app/package/MyClass\");\n    if (c == nullptr) return JNI_ERR;\n\n    // Register your class' native methods.\n    static const JNINativeMethod methods[] = {\n            {\"nativeFoo\", \"()V\", reinterpret_cast<void*>(nativeFoo)},\n            {\"nativeBar\", \"(Ljava/lang/String;I)Z\", reinterpret_cast<void*>(nativeBar)},\n    };\n    int rc = env->RegisterNatives(c, methods, sizeof(methods)/sizeof(JNINativeMethod));\n    if (rc != JNI_OK) return rc;\n\n    return JNI_VERSION_1_6;\n}\n```\næ³¨æ„ï¼ŒRegisterNativesåšçš„äº‹æ˜¯æŠŠæœ¬åœ°å‡½æ•°å’Œä¸€ä¸ªjavaç±»æ–¹æ³•å…³è”èµ·æ¥ï¼Œä¸ç®¡ä¹‹å‰æ˜¯å¦å…³è”è¿‡ï¼Œä¸€å¾‹ä¼šæŠŠä¹‹å‰çš„æ›¿æ¢æ‰ï¼Œä¹Ÿå°±æ˜¯å¤šæ¬¡ç»™ä¸€ä¸ªjavaç±»å…³è”æœ¬åœ°å‡½æ•°æ—¶ï¼Œåªæœ‰æœ€åä¸€æ¬¡å…³è”çš„æ˜¯æœ‰æ•ˆçš„ã€‚\n\n### 4. ä¸¤ç§æ–¹å¼å¯¹æ¯”\nå¦‚æœæ²¡æœ‰è°ƒç”¨Registeræ–¹æ³•æå‰æ³¨å†Œï¼Œåˆ™æ— æ³•æŠŠsoä¸­å®ç°çš„å‡½æ•°åœ¨è¿›ç¨‹ä¸­çš„åœ°å€å¢åŠ åˆ°ClassObjectä¸­çš„directMethodsä¸­ï¼Œé‚£ä¹ˆåªæœ‰åˆ°äº†è°ƒç”¨nativeæ–¹æ³•æ—¶ï¼Œæ‰ä¼šè§£æè¿™äº›åˆè‡­åˆé•¿çš„javahé£æ ¼çš„å‡½æ•°ï¼Œè¿™ä¸ªäº‹åœ¨dumResolveNativeMethod(dalvik/vm/Native.cpp)ä¸­è¿›è¡Œï¼Œæ ¹æ®nativeæ–¹æ³•ç­¾åï¼Œåœ¨æ‰€æœ‰æ‰“å¼€çš„soä¸­å¯»æ‰¾å‡½æ•°å®ç°ï¼Œæ‰¾åˆ°åå¹¶è°ƒç”¨ï¼Œæ‰€ä»¥ä»è°ƒç”¨æ•ˆç‡ä¸Šæ¥çœ‹ï¼ŒRegisteræ›´é«˜æ•ˆã€‚\n\n### 5. æ–¹æ³•ç­¾å\nä¸Šé¢æäº†å¥½å‡ æ¬¡çš„æ–¹æ³•ç­¾åï¼Œè¿™æ¥è¯´ä¸€è¯´ã€‚ç®€å•è¯´ï¼Œæ–¹æ³•ç­¾åå°±æ˜¯ç”±æ–¹æ³•è¿”å›å€¼ç±»å‹å’Œå‚æ•°ç±»å‹ç»„æˆçš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šâ€(å‚æ•°åˆ—è¡¨)è¿”å›å€¼â€œï¼Œæ¯ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è®°ï¼Œå¦‚ä¸‹\n\nå­—ç¬¦|æ•°æ®ç±»å‹|è¯´æ˜\n:|:|:\nV|void|æ–¹æ³•è¿”å›å€¼\nZ|boolean|\nB|byte|\nC|char|\nS|short|\nI|int|\nJ|long|\nF|float|\nD|double|\n[|æ•°ç»„|ä»¥[å¼€å¤´ï¼Œé…åˆå…¶ä»–çš„ç‰¹æ®Šå­—ç¬¦ï¼Œè¡¨ç¤ºå¯¹åº”æ•°æ®ç±»å‹çš„æ•°ç»„ï¼Œå‡ ä¸ª[è¡¨ç¤ºå‡ ç»´æ•°ç»„\nLå…¨ç±»å|å¼•ç”¨ç±»å‹|ä»¥Lå¼€å¤´ã€;ç»“å°¾ï¼Œä¸­é—´æ˜¯å¼•ç”¨ç±»å‹çš„å…¨ç±»å\n\nå¦‚æœæ‡’å¾—å†™ï¼Œè¿˜å¯ä»¥ç”¨javapå‘½ä»¤ï¼Œæ³¨æ„è¿™é‡Œä¼ å…¥çš„æ˜¯classæ–‡ä»¶ï¼Œæ‰€ä»¥è¦å…ˆç”¨javacç¼–è¯‘ä¸€ä¸‹\n```sh\njavap -p -s NativeLib.class\n```\n\n### 6. CMakeLists.txt\nç”¨Android Studioåˆ›å»ºNativeLibraryæ—¶ï¼Œä¼šè‡ªåŠ¨ç”ŸæˆCMakeæ–‡ä»¶ã€‚æ ¹æ®å®˜ç½‘è¯´ï¼ŒNDKæ„å»ºä¸€å…±æœ‰ä¸‰ç§æ–¹å¼ï¼šåŸºäºMakeçš„ndk-buildã€CMakeå’Œå·²ç»å¼ƒç”¨çš„ç‹¬ç«‹å·¥å…·é“¾ï¼Œ[åŸæ–‡åœ¨è¿™](https://developer.android.com/ndk/guides/build)ã€‚å¯è§ASé»˜è®¤ä½¿ç”¨çš„CMakeæ–¹å¼ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„CMakeLists.txtæ–‡ä»¶é‡Œå†™äº†å¾ˆè¯¦ç»†çš„ä»‹ç»ï¼Œè¿™é‡Œç›´æ¥æ‹¿è¿‡æ¥çœ‹ä¸€çœ‹\n```cmake\n# For more information about using CMake with Android Studio, read the\n# documentation: https://d.android.com/studio/projects/add-native-code.html\n\n# Sets the minimum version of CMake required to build the native library.\n\ncmake_minimum_required(VERSION 3.18.1)\n\n# Declares and names the project.\n\nproject(\"nativelib\")\n\n# Creates and names a library, sets it as either STATIC\n# or SHARED, and provides the relative paths to its source code.\n# You can define multiple libraries, and CMake builds them for you.\n# Gradle automatically packages shared libraries with your APK.\n\nadd_library( # Sets the name of the library.\n             nativelib\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             nativelib.cpp )\n\n# Searches for a specified prebuilt library and stores the path as a\n# variable. Because CMake includes system libraries in the search path by\n# default, you only need to specify the name of the public NDK library\n# you want to add. CMake verifies that the library exists before\n# completing its build.\n\nfind_library( # Sets the name of the path variable.\n              log-lib\n\n              # Specifies the name of the NDK library that\n              # you want CMake to locate.\n              log )\n\n# Specifies libraries CMake should link to your target library. You\n# can link multiple libraries, such as libraries you define in this\n# build script, prebuilt third-party libraries, or system libraries.\n\ntarget_link_libraries( # Specifies the target library.\n                       nativelib\n\n                       # Links the target library to the log library\n                       # included in the NDK.\n                       ${log-lib} )\n```\nfind_libraryå°±æ˜¯ä»ndké‡Œæ‰¾ï¼Œå…·ä½“ä½ç½®åœ¨\n```sh\n~/Library/Android/sdk/ndk/21.4.7075529/platforms/android-30/arch-x86_64/usr/lib64\n```\nåå­—æå¤´å»å°¾ï¼Œæ‰€ä»¥logåº“å¯¹åº”çš„å°±æ˜¯è¿™ä¸ªç›®å½•ä¸‹çš„liblog.soæ–‡ä»¶ã€‚åŒæ—¶ï¼Œbuild.gradeé‡Œä¹Ÿå¤šäº†ä¸¤ä¸ªå—ï¼Œåˆ†åˆ«åœ¨androidé‡Œï¼ŒæŒ‡å®šäº†ç‰ˆæœ¬å’Œè·¯å¾„ï¼Œå’Œandroidçš„defaultConfigé‡Œï¼Œå¯ä»¥æ·»åŠ ç¼–è¯‘æ—¶çš„é…ç½®\n```gradle\nandroid {\n    defaultConfig {\n        externalNativeBuild {\n            cmake {\n                cppFlags \"\"\n            }\n        }\n    }\n\n    externalNativeBuild {\n        cmake {\n            path \"src/main/cpp/CMakeLists.txt\"\n            version \"3.18.1\"\n        }\n    }\n}\n```\n\n### 7. å‡ ä¸ªå…³é”®å­— JNIEXPORT JNICALL extern\n- JNIEXPORTå’ŒJNICALL\nè¿™æ˜¯ä¸¤ä¸ªå®å®šä¹‰ï¼Œåœ¨ä¸åŒå¹³å°å¯¹åº”ä¸åŒçš„å®šä¹‰ã€‚JNIEXPORTçš„ä½œç”¨æ˜¯ä¿è¯åœ¨æœ¬åº“ä¸­å£°æ˜çš„å‡½æ•°èƒ½å¤Ÿåœ¨å…¶ä»–é¡¹ç›®ä¸­å¯ä»¥è°ƒç”¨ï¼Œä¸€èˆ¬exportçš„ä½œç”¨éƒ½æ˜¯å¦‚æ­¤ï¼Œè€ŒJNICALLåˆ™æ˜¯ç”¨äºå®šä¹‰å‡½æ•°å…¥æ ˆè§„åˆ™å’Œå †æ ˆæ¸…ç†è§„åˆ™ï¼Œ[è¿™ç¯‡æ–‡ç« æœ‰è¯¦ç»†è¯´æ˜](https://blog.csdn.net/shulianghan/article/details/104072587)ã€‚\n\n- extern\nå®ƒæœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥ä¿®é¥°å˜é‡æˆ–æ˜¯å‡½æ•°ï¼Œè¿™æ—¶å®ƒçš„ä½œç”¨å°±æ˜¯å£°æ˜å‡½æ•°æˆ–å…¨å±€å˜é‡çš„ä½œç”¨èŒƒå›´çš„å…³é”®å­—ï¼Œå…¶å£°æ˜çš„å‡½æ•°å’Œå˜é‡å¯ä»¥åœ¨æœ¬æ¨¡å—æˆ–æ˜¯å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ã€‚è™½ç„¶å®ƒåªæ˜¯å£°æ˜ï¼Œä½†åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ‰¾ä¸åˆ°å®šä¹‰ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿æ¥å™¨åœ¨è¿æ¥é˜¶æ®µä¼šåœ¨ç”Ÿæˆçš„ç›®æ ‡ä»£ç ä¸­æ‰¾åˆ°å®šä¹‰ã€‚å¦ä¸ªä½œç”¨æ˜¯å’Œâ€œCâ€ä¸€èµ·è¿ç”¨ï¼Œæ­¤æ—¶å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ç”¨Cçš„è§„åˆ™ç¼–è¯‘è€Œä¸æ˜¯C++çš„è§„åˆ™ï¼Œå› ä¸ºC++æ”¯æŒé‡è½½ï¼Œæ‰€ä»¥ç¼–è¯‘åçš„åå­—æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚ï¼Œvoid foo(int x, int y);ï¼ŒCç¼–è¯‘å™¨ç¼–è¯‘ååœ¨ç¬¦å·åº“ä¸­çš„åå­—ä¸º_fooï¼Œè€ŒC++ç¼–è¯‘åçš„ç»“æœæ˜¯_foo_int_intä¹‹ç±»çš„åå­—ï¼Œå…·ä½“å–å†³äºç¼–è¯‘å™¨çš„ç±»å‹ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæŠŠä¸€ä¸ªç”¨Cç¼–è¯‘çš„ç›®æ ‡ä»£ç å’Œä¸€ä¸ªç”¨C++ç¼–è¯‘å™¨ç¼–è¯‘çš„ç›®æ ‡ä»£ç è¿›è¡Œé“¾æ¥ï¼Œå°±ä¼šå‡ºç°è¿æ¥å¤±è´¥çš„é”™è¯¯ã€‚åŒæ—¶ï¼Œåªæœ‰C++ç¼–è¯‘å™¨è®¤è¯†extern \"C\"ï¼Œå¸¸ç”¨å†™æ³•ä¸º\n```cpp\n#ifdef __cplusplus\nextern \"C\"\n{\n#endif\n// code here\n#ifdef __cplusplus\n}\n#endif\n```\n\n### 8. æŒ‡é’ˆvoid*\næŒ‡é’ˆæ˜¯ç§å¸¸ç”¨çš„å½¢å¼ï¼Œæä¾›äº†å¾ˆå¤šä¾¿åˆ©ï¼Œå¦‚`int*`ä¸ºintå‹æŒ‡é’ˆï¼Œ`char*`ä¸ºå­—ç¬¦å‹æŒ‡é’ˆï¼Œç»å¸¸è¿˜ä¼šé‡åˆ°ä¸€ç§æŒ‡é’ˆï¼Œ`void*`ã€‚æŒ‡é’ˆå­˜å‚¨çš„æ˜¯åœ°å€ï¼Œå®ƒæœ¬èº«çš„å¤§å°å°±æ˜¯ç³»ç»Ÿå¯»å€çš„å¤§å°ï¼Œä¸åŒç±»å‹çš„æŒ‡é’ˆçš„æ‰€å ç”¨çš„å†…å­˜å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦åŒºåˆ†ç±»å‹å‘¢ï¼Ÿä»æŸä¸ªè§’åº¦æ¥çœ‹ï¼ŒæŒ‡é’ˆçš„ç±»å‹å¯ä»¥ç†è§£ä¸ºå®ƒçš„è·³è·ƒèƒ½åŠ›ï¼Œæ¯”å¦‚ä¸€ä¸ªintç±»å‹çš„æŒ‡é’ˆåœ¨åŠ 1åï¼Œä¼šæŒ‡å‘ç´§é‚»çš„ä¸‹ä¸€ä¸ªintï¼Œä¸€ä¸ªintæŒ‰ç…§å ç”¨4ä¸ªå­—èŠ‚æ¥è®¡ç®—çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„è·³è·ƒèƒ½åŠ›å°±æ˜¯4ä¸ªå­—èŠ‚ï¼ŒåŒç†ï¼Œä¸€ä¸ªlongå‹çš„æŒ‡é’ˆåœ¨åŠ 1åï¼Œä¹Ÿä¼šæŒ‡å‘ç´§é‚»çš„ä¸‹ä¸€ä¸ªlongï¼Œä¸€ä¸ªlongå ç”¨8ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒçš„è·³è·ƒèƒ½åŠ›å°±æ˜¯8ä¸ªå­—èŠ‚ã€‚è¿™æ ·æ¥çœ‹çš„è¯ï¼Œvoidç±»å‹çš„æŒ‡é’ˆå°±æ˜¯è·³è·ƒèƒ½åŠ›æœªçŸ¥çš„æŒ‡é’ˆï¼Œå®ƒéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼ºè½¬ä¹‹åï¼Œæ‰å…·æœ‰è·³è·ƒèƒ½åŠ›ï¼Œå¼ºè½¬ä¸ºintå‹æŒ‡é’ˆåï¼Œè·³è·ƒèƒ½åŠ›ä¸º4å­—èŠ‚ï¼Œè½¬ä¸ºlongåˆ™ä¸º8å­—èŠ‚ã€‚å¤šç”¨äºé€šç”¨å‡½æ•°çš„å‚æ•°ï¼Œæ¯”å¦‚memcpyï¼Œä¸å…³å¿ƒä¼ å…¥æ˜¯ä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆï¼Œæˆ‘åªç®¡æŠŠsrcä½ç½®çš„ğŸˆ¯ï¸æ•°é‡çš„å­—èŠ‚å¤åˆ¶åˆ°dstï¼Œå³å¯ã€‚`void*`å°±æ˜¯ä¸ªè¿™æ ·çš„å­˜åœ¨ã€‚\n\n### 9. åå°„è°ƒç”¨\nåœ¨JNIé‡Œè°ƒç”¨javaçš„æ–¹æ³•ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡åå°„çš„æ–¹å¼ã€‚å…ˆè·å–jclassï¼Œé€šè¿‡jclassè·å–jmethodæˆ–è€…jfieldï¼Œç„¶åå†è°ƒç”¨æ–¹æ³•æˆ–å­—æ®µ\n```cpp\n// è·å–classï¼ŒJNIæä¾›ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡æ–¹æ³•åï¼Œæˆ–è€…é€šè¿‡jobject\njclass jc = env->FindClass(\"java/lang/String\");\njclass jc = env->GetObjectClass(jo);\n\n// è·å–method\njmethodID jm = env->GetMethodID(jc, \"method name\", \"method signature\");\njmethodID jm = env->GetStaticMethodID(jc, \"method name\", \"method signature\");\n\n// è·å–å­—æ®µ\njfieldID jf = env->GetFieldID(jc, \"field name\", \"field signature\");\njfieldID jf = env->GetStaticFieldID(jc, \"field name\", \"field signature\");\n\n// æ–¹æ³•è°ƒç”¨ æ¯ç§è¿”å›å€¼ç±»å‹JNIéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ–¹æ³•\nenv->CallVoidMethod(jo, jm);\njobject jo = env->CallObjectMethod(jo, jm, methodArg);\n// åŒæ—¶ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•å¯¹åº”çš„æ–¹æ³•\nenv->CallStaticObjectMethod(jc, jm, methodArg);\n\n// å­—æ®µè°ƒç”¨ï¼ŒåŒæ–¹æ³•\njint i = env->GetIntField(jo, jf);\n// é™æ€å­—æ®µåŒç†\njint i = env->GetStaticIntField(jc, jf);\n\n```\n\n\n### é™„å½•\n- https://blog.csdn.net/fireroll/article/details/50102009\n- https://blog.csdn.net/kgdwbb/article/details/72810251\n- https://www.jianshu.com/p/1229580b2356\n- https://www.jianshu.com/p/6cbdda111570\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Android","JNI"],"categories":["Android"]},{"title":"AndroidåŸºç¡€ä¹‹Service","url":"/2022/03/324ae03bb52e/","content":"\nServiceçš„ä½¿ç”¨ã€‚\n\n<!--more-->\n### 1. å¯åŠ¨æ–¹å¼\nServiceæœ‰ä¸¤ç§å¯åŠ¨æ–¹å¼ï¼ŒstartServiceå’ŒbindServiceã€‚\n\n### 2. ç”Ÿå‘½å‘¨æœŸ\nè¿™é‡Œåº”è¯¥æ”¾ä¸€å¼ å®˜ç½‘çš„å›¾ï¼Œä½†æ˜¯åŠ å›¾æœ‰äº›éº»çƒ¦ï¼Œè¿˜æ˜¯ç”¨æ–‡å­—ä»£æ›¿å§ã€‚\n\nServiceåœ¨é€šè¿‡startServiceå¯åŠ¨æ—¶ï¼šonCreate -> onStartCommandã€‚ä¸€ä¸ªServiceç³»ç»Ÿåªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå¤šæ¬¡è°ƒç”¨startæ–¹æ³•æ—¶ï¼ŒonCreateä¸ä¼šé‡å¤è°ƒç”¨ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œè€ŒonStartCommandä¼šè¢«å¤šæ¬¡è°ƒç”¨ã€‚åœæ­¢æ—¶è°ƒç”¨stopServiceï¼Œæ­¤æ—¶ä¼šè°ƒç”¨onDestroy\n\nServiceåœ¨é€šè¿‡bindServiceå¯åŠ¨æ—¶ï¼šonCreate -> onBindï¼ŒonCreateåœ¨åˆ›å»ºæ—¶è°ƒç”¨ï¼ŒServiceæ˜¯ç”¨æ¥é€šè¿‡æœåŠ¡çš„serverï¼Œæƒ³è¦bind Serviceçš„æ˜¯clientã€‚ä¸€ä¸ªserverå¯ä»¥åŒæ—¶ç»™å¤šä¸ªclientæä¾›æœåŠ¡ã€‚åªæœ‰åœ¨clientç¬¬ä¸€æ¬¡è°ƒç”¨bindServiceæ—¶ï¼Œæ‰ä¼šå›è°ƒonBindæ–¹æ³•ã€‚å½“clientè°ƒç”¨unbindServiceæ—¶ï¼Œæ­¤æ—¶ä¼šå›è°ƒServiceçš„onUnbindæ–¹æ³•ï¼Œå½“æ­¤serverçš„clientæ•°é‡ä¸º0æ—¶ï¼Œä¼šè°ƒç”¨onDestroyè¿›è¡Œé”€æ¯ã€‚\n\næ··åˆè°ƒç”¨æ—¶ï¼Œå³åˆ›å»ºä¸€ä¸ªServiceå®ä¾‹åï¼Œæ—¢è°ƒç”¨è¿‡startServiceï¼Œä¹Ÿè°ƒç”¨è¿‡bindServiceï¼Œé‚£ä¹ˆè¿™æ—¶å³ä¾¿bindçš„clientä¸º0æ—¶ï¼ŒServiceä¹Ÿä¸ä¼šåœæ­¢ï¼Œåªæœ‰é€šè¿‡stopServiceæ‰èƒ½åœæ­¢è¯¥Serviceï¼Œå¯ä»¥ç†è§£ä¸ºstartçš„ç­‰çº§æ›´é«˜äº›ã€‚\n\n### 3. onStartCommand(intent: Intent?, flags: Int, startId: Int): Int\nè¿™ä¸ªæ–¹æ³•æœ‰3ä¸ªå‚æ•°1ä¸ªè¿”å›å€¼ï¼Œæ‘˜ç‚¹å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»\n- intentï¼šå¯åŠ¨æ—¶ï¼Œå¯åŠ¨ç»„ä»¶ä¼ é€’è¿‡æ¥çš„Intentï¼Œå¦‚Activityå¯åˆ©ç”¨Intentå°è£…æ‰€éœ€è¦çš„å‚æ•°å¹¶ä¼ é€’ç»™Service\n- flags: è¡¨ç¤ºå¯åŠ¨è¯·æ±‚æ—¶æ˜¯å¦æœ‰é¢å¤–æ•°æ®ï¼Œå¯é€‰å€¼æœ‰ 0ï¼ŒSTART_FLAG_REDELIVERYï¼ŒSTART_FLAG_RETRYï¼Œ0ä»£è¡¨æ²¡æœ‰ï¼Œå®ƒä»¬å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š\n  - START_FLAG_REDELIVERY: è¿™ä¸ªå€¼ä»£è¡¨äº†onStartCommandæ–¹æ³•çš„è¿”å›å€¼ä¸ºSTART_REDELIVER_INTENTï¼Œè€Œä¸”åœ¨ä¸Šä¸€æ¬¡æœåŠ¡è¢«æ€æ­»å‰ä¼šå»è°ƒç”¨stopSelfæ–¹æ³•åœæ­¢æœåŠ¡ã€‚å…¶ä¸­START_REDELIVER_INTENTæ„å‘³ç€å½“Serviceå› å†…å­˜ä¸è¶³è€Œè¢«ç³»ç»Ÿkillåï¼Œåˆ™ä¼šé‡å»ºæœåŠ¡ï¼Œå¹¶é€šè¿‡ä¼ é€’ç»™æœåŠ¡çš„æœ€åä¸€ä¸ª Intent è°ƒç”¨ onStartCommand()ï¼Œæ­¤æ—¶Intentæ—¶æœ‰å€¼çš„ã€‚\n  - START_FLAG_RETRY: è¯¥flagä»£è¡¨å½“onStartCommandè°ƒç”¨åä¸€ç›´æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œä¼šå°è¯•é‡æ–°å»è°ƒç”¨onStartCommand()ã€‚\n- startId: æŒ‡æ˜å½“å‰æœåŠ¡çš„å”¯ä¸€IDï¼Œä¸stopSelfResult (int startId)é…åˆä½¿ç”¨ï¼ŒstopSelfResult å¯ä»¥æ›´å®‰å…¨åœ°æ ¹æ®IDåœæ­¢æœåŠ¡ã€‚\n\nonStartCommandçš„è¿”å›å€¼intç±»å‹ï¼Œå®ƒæœ‰ä¸‰ç§å¯é€‰å€¼ï¼Œ START_STICKYï¼ŒSTART_NOT_STICKYï¼ŒSTART_REDELIVER_INTENTï¼Œå®ƒä»¬å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š\n- START_STICKY: å½“Serviceå› å†…å­˜ä¸è¶³è€Œè¢«ç³»ç»Ÿkillåï¼Œä¸€æ®µæ—¶é—´åå†…å­˜å†æ¬¡ç©ºé—²æ—¶ï¼Œç³»ç»Ÿå°†ä¼šå°è¯•é‡æ–°åˆ›å»ºæ­¤Serviceï¼Œä¸€æ—¦åˆ›å»ºæˆåŠŸåå°†å›è°ƒonStartCommandæ–¹æ³•ï¼Œä½†å…¶ä¸­çš„Intentå°†æ˜¯nullï¼Œé™¤éæœ‰æŒ‚èµ·çš„Intentï¼Œå¦‚pendingintentï¼Œè¿™ä¸ªçŠ¶æ€ä¸‹æ¯”è¾ƒé€‚ç”¨äºä¸æ‰§è¡Œå‘½ä»¤ã€ä½†æ— é™æœŸè¿è¡Œå¹¶ç­‰å¾…ä½œä¸šçš„åª’ä½“æ’­æ”¾å™¨æˆ–ç±»ä¼¼æœåŠ¡ã€‚\n- START_NOT_STICKY: å½“Serviceå› å†…å­˜ä¸è¶³è€Œè¢«ç³»ç»Ÿkillåï¼Œå³ä½¿ç³»ç»Ÿå†…å­˜å†æ¬¡ç©ºé—²æ—¶ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šå°è¯•é‡æ–°åˆ›å»ºæ­¤Serviceã€‚é™¤éç¨‹åºä¸­å†æ¬¡è°ƒç”¨startServiceå¯åŠ¨æ­¤Serviceï¼Œè¿™æ˜¯æœ€å®‰å…¨çš„é€‰é¡¹ï¼Œå¯ä»¥é¿å…åœ¨ä¸å¿…è¦æ—¶ä»¥åŠåº”ç”¨èƒ½å¤Ÿè½»æ¾é‡å¯æ‰€æœ‰æœªå®Œæˆçš„ä½œä¸šæ—¶è¿è¡ŒæœåŠ¡ã€‚\n- START_REDELIVER_INTENT: å½“Serviceå› å†…å­˜ä¸è¶³è€Œè¢«ç³»ç»Ÿkillåï¼Œåˆ™ä¼šé‡å»ºæœåŠ¡ï¼Œå¹¶é€šè¿‡ä¼ é€’ç»™æœåŠ¡çš„æœ€åä¸€ä¸ª Intent è°ƒç”¨ onStartCommand()ï¼Œä»»ä½•æŒ‚èµ· Intentå‡ä¾æ¬¡ä¼ é€’ã€‚ä¸START_STICKYä¸åŒçš„æ˜¯ï¼Œå…¶ä¸­çš„ä¼ é€’çš„Intentå°†æ˜¯éç©ºï¼Œæ˜¯æœ€åä¸€æ¬¡è°ƒç”¨startServiceä¸­çš„intentã€‚è¿™ä¸ªå€¼é€‚ç”¨äºä¸»åŠ¨æ‰§è¡Œåº”è¯¥ç«‹å³æ¢å¤çš„ä½œä¸šï¼ˆä¾‹å¦‚ä¸‹è½½æ–‡ä»¶ï¼‰çš„æœåŠ¡ã€‚\n\né¦–æ¬¡startServiceæ—¶ï¼Œflagsçš„å€¼æ˜¯0ï¼Œå…¶ä»–æƒ…å†µå¯åŠ¨æ—¶ï¼Œflagsçš„å€¼æ ¹æ®å…¶è¿”å›å€¼å†³å®šã€‚\n\n### 4. startServiceç¤ºä¾‹\n```kotlin\n// Seviceï¼Œä½œä¸ºå››å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œéœ€è¦åœ¨AndroidManifestä¸­å£°æ˜\nclass SampleService : Service() {\n\n    val TAG = SampleService::class.java.canonicalName\n\n    override fun onCreate() {\n        super.onCreate()\n        Log.d(TAG, \"on create invoked\")\n    }\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n        Log.d(TAG, \"on start command invoked, flag:${flags}\")\n        return super.onStartCommand(intent, flags, startId)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(TAG, \"on destroy invoked\")\n    }\n}\n\n// åœ¨Activityä¸­å¯åŠ¨\nval intent = Intent(this, SampleService::class.java)\nstartService(intent)\n\n// åœ¨Activityä¸­åœæ­¢\nvar intent = Intent(this, SampleService::class.java)\nstopService(intent)\n```\n\n### 5. bindServiceç¤ºä¾‹ï¼ŒåŒä¸€è¿›ç¨‹\n```kotlin\n// BindService\nclass BindService : Service() {\n\n    val TAG = BindService::class.java.canonicalName\n\n    private lateinit var runner: Thread\n\n    // å†™ä¸€ä¸ªBinderçš„å­ç±»ï¼Œç”¨æ¥è¿”å›ç»™client\n    inner class ServerBinder : Binder() {\n\n    \t// åœ¨Binderä¸­å†™ä¸€ä¸ªè·å–serverçš„æ–¹æ³•ï¼Œå½“clientæ‹¿åˆ°Binderæ—¶ï¼Œé€šè¿‡\n    \t// è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è·å–åˆ°serverå®ä¾‹\n        fun getService() : BindService {\n            return this@BindService\n        }\n    }\n\n    override fun onCreate() {\n        super.onCreate()\n        Log.d(TAG, \"on create invoked\")\n    }\n\n    override fun onBind(intent: Intent?): IBinder? {\n        Log.d(TAG, \"on bind invoked\")\n        return ServerBinder()\n    }\n\n    fun getData() : Int = 4\n\n    override fun onUnbind(intent: Intent?): Boolean {\n        Log.d(TAG, \"on unbind invoked\")\n        return super.onUnbind(intent)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(TAG, \"on destroy invoked\")\n        runner.interrupt()\n    }\n}\n\n// åœ¨Activityä¸­ï¼Œåˆ›å»ºä¸€ä¸ªServiceConnectionï¼Œç”¨æ¥å“åº”è¿æ¥åˆ°Serviceçš„å›è°ƒ\nprivate val conn = object : ServiceConnection {\n\n    // è¿æ¥æˆåŠŸåå›è°ƒï¼Œè¿”å›çš„Binderå°±æ˜¯Serviceä¸­onBinderçš„è¿”å›å€¼\n    override fun onServiceConnected(name: ComponentName?, service: IBinder?) {\n        Log.d(TAG, \"on service connected\")\n        val binder = service as BindService.ServerBinder\n        val server = binder.getService()\n        val data = server.getData()\n    }\n\n    // Android ç³»ç»Ÿä¼šåœ¨ä¸æœåŠ¡çš„è¿æ¥æ„å¤–ä¸­æ–­æ—¶ï¼ˆä¾‹å¦‚å½“æœåŠ¡å´©æºƒæˆ–è¢«ç»ˆæ­¢æ—¶ï¼‰è°ƒç”¨è¯¥æ–¹æ³•ã€‚æ³¨æ„:å½“å®¢æˆ·ç«¯å–æ¶ˆç»‘å®šæ—¶ï¼Œç³»ç»Ÿâ€œç»å¯¹ä¸ä¼šâ€è°ƒç”¨è¯¥æ–¹æ³•ã€‚\n    override fun onServiceDisconnected(name: ComponentName?) {\n        Log.d(TAG, \"on service disconnected\")\n    }\n}\n\n// ç»‘å®š\nval intent = Intent(this, BindService::class.java)\nbindService(intent, conn, BIND_AUTO_CREATE)\n\n// è§£é™¤ç»‘å®š\nval intent = Intent(this, BindService::class.java)\nunbindService(conn)\n```\n\n### 6. bindServiceç¤ºä¾‹ï¼Œä¸åŒè¿›ç¨‹\næƒ³è¦å®ç°clientå’Œserverçš„åŒå‘é€šä¿¡ï¼Œé‚£ä¹ˆå°±éœ€è¦åŒæ–¹éƒ½æœ‰å‘é€/æ¥æ”¶æ¶ˆæ¯ï¼Œå³Handler+Messenger\n```kotlin\n// MessengerServiceï¼ŒåŒæ ·éœ€è¦åœ¨AndroidManifestä¸­å£°æ˜ï¼ŒåŒæ—¶å¢åŠ process=\":process\"å±æ€§æ¥æŒ‡å®šè¿›ç¨‹\nclass MessengerService : Service() {\n\n    val TAG = MessengerService::class.java.canonicalName\n\n    // Handlerç”¨æ¥å¤„ç†clientå‘é€è¿‡æ¥çš„æ¶ˆæ¯\n    private val handler =  object : Handler(Looper.myLooper()!!) {\n\n        override fun handleMessage(msg: Message) {\n            Log.d(TAG, \"service handle message:${msg.what}\")\n            val reply = Message.obtain()\n            reply.what = 45456\n            msg.replyTo.send(reply)\n        }\n    }\n\n    // Messengerç”¨æ¥å‘é€æ¶ˆæ¯ç»™client\n    private val messenger = Messenger(handler)\n\n    override fun onCreate() {\n        super.onCreate()\n        Log.d(TAG, \"messenger service on create\")\n    }\n\n    override fun onBind(intent: Intent?): IBinder? {\n        Log.d(TAG, \"messenger service on bind\")\n        return messenger.binder\n    }\n\n    override fun onUnbind(intent: Intent?): Boolean {\n        Log.d(TAG, \"messenger service on unbind\")\n        return super.onUnbind(intent)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(TAG, \"messenger service on destroy\")\n    }\n}\n\n// Activityä¸­ï¼ŒåŒä¸Šï¼ŒHandlerç”¨æ¥å¤„ç†serverå‘é€çš„æ¶ˆæ¯ï¼ŒMessengerç”¨æ¥å‘æ¶ˆæ¯ç»™server\nprivate val handler = object : Handler(Looper.getMainLooper()) {\n    override fun handleMessage(msg: Message) {\n        Log.d(TAG, \"client handle message:${msg.what}\")\n    }\n}\n\nprivate val messenger = Messenger(handler)\n\nprivate val ipcConn = object : ServiceConnection {\n\n    override fun onServiceConnected(name: ComponentName?, service: IBinder?) {\n        val server = Messenger(service)\n        val msg = Message.obtain()\n        msg.what = 12123\n        msg.replyTo = messenger\n        server.send(msg)\n    }\n\n    override fun onServiceDisconnected(name: ComponentName?) {\n    }\n}\n\n// ç»‘å®šService\nval intent = Intent(this, MessengerService::class.java)\nbindService(intent, ipcConn, BIND_AUTO_CREATE)\n\n// è§£é™¤ç»‘å®š\nval intent = Intent(this, MessengerService::class.java)\nunbindService(ipcConn)\n```\n\n### 7. ForegroundServiceå‰å°æœåŠ¡\né€šä¿—ç†è§£ï¼Œåå°ä»»åŠ¡å¤šæ˜¯ç”¨æ¥åšä¸€äº›ä¸éœ€è¦ç”¨æˆ·çœ‹åˆ°çš„ä»»åŠ¡ï¼Œæ¯”å¦‚é™é»˜ä¸‹è½½ï¼Œè€Œå‰å°ä»»åŠ¡åˆ™æ˜¯åšäº›éœ€è¦ç»™ç”¨æˆ·å±•ç¤ºä¸€äº›æç¤ºçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ä¸‹è½½æ–‡ä»¶çš„è¿›åº¦æ¡ã€æ’­æ”¾éŸ³ä¹çš„è¿›åº¦æ¡ï¼Œç­‰ã€‚æ‘˜ä¸€æ®µå®˜æ–¹çš„è¯´æ˜ï¼š\n> å‰å°æœåŠ¡è¢«è®¤ä¸ºæ˜¯ç”¨æˆ·ä¸»åŠ¨æ„è¯†åˆ°çš„ä¸€ç§æœåŠ¡ï¼Œå› æ­¤åœ¨å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šè€ƒè™‘å°†å…¶ç»ˆæ­¢ã€‚ å‰å°æœåŠ¡å¿…é¡»ä¸ºçŠ¶æ€æ æä¾›é€šçŸ¥ï¼ŒçŠ¶æ€æ ä½äºâ€œæ­£åœ¨è¿›è¡Œâ€æ ‡é¢˜ä¸‹æ–¹ï¼Œè¿™æ„å‘³ç€é™¤éæœåŠ¡åœæ­¢æˆ–ä»å‰å°åˆ é™¤ï¼Œå¦åˆ™ä¸èƒ½æ¸…é™¤é€šçŸ¥ã€‚ä¾‹å¦‚å°†ä»æœåŠ¡æ’­æ”¾éŸ³ä¹çš„éŸ³ä¹æ’­æ”¾å™¨è®¾ç½®ä¸ºåœ¨å‰å°è¿è¡Œï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·æ˜ç¡®æ„è¯†åˆ°å…¶æ“ä½œã€‚ çŠ¶æ€æ ä¸­çš„é€šçŸ¥å¯èƒ½è¡¨ç¤ºæ­£åœ¨æ’­æ”¾çš„æ­Œæ›²ï¼Œå¹¶å…è®¸ç”¨æˆ·å¯åŠ¨ Activity æ¥ä¸éŸ³ä¹æ’­æ”¾å™¨è¿›è¡Œäº¤äº’ã€‚å¦‚æœéœ€è¦è®¾ç½®æœåŠ¡è¿è¡Œäºå‰å°ï¼Œ æˆ‘ä»¬è¯¥å¦‚ä½•æ‰èƒ½å®ç°å‘¢ï¼ŸAndroidå®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯startForeground()å’ŒstopForeground()ã€‚\n\nå¯ä»¥é€šè¿‡onStartzCommandæ–¹æ³•ä¼ é€’å‘½ä»¤ï¼Œæ¥å›åˆ‡æ¢æ§åˆ¶æœåŠ¡æ˜¯å¦ç½®äºå‰å°ï¼Œè¿™é‡Œåªæ¼”ç¤ºäº†å¦‚ä½•åˆ‡æ¢ã€‚\n```kotlin\n// ForegroundService\nclass ForegroundService : Service() {\n\n    val TAG = ForegroundService::class.java.canonicalName\n\n    override fun onCreate() {\n        super.onCreate()\n        Log.d(TAG, \"on service create\")\n        // 8.0å‡ºäº†NotificationChannelï¼Œä¸è®¾ç½®å°±ä¼šæŠ¥é”™ï¼šbad notification\n        val builder = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            // make channel\n            val channelId = \"default\"\n            val channel = NotificationChannel(channelId, channelId, NotificationManager.IMPORTANCE_DEFAULT)\n            val nm = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n            if (nm.getNotificationChannel(channelId) == null) {\n                nm.createNotificationChannel(channel)\n            }\n            NotificationCompat.Builder(this, channelId)\n        } else {\n            NotificationCompat.Builder(this)\n        }\n        // make notification\n        builder.setSmallIcon(R.mipmap.ic_launcher)\n            .setLargeIcon(BitmapFactory.decodeResource(resources, R.mipmap.ic_launcher))\n            .setOngoing(true)\n            .setAutoCancel(false)\n            .setShowWhen(true)\n            .setContentTitle(\"Foreground Service\")\n        val notification = builder.build()\n        startForeground(1, notification)\n    }\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n        Log.d(TAG, \"on service start command\")\n        return super.onStartCommand(intent, flags, startId)\n    }\n\n    override fun onBind(intent: Intent?): IBinder? {\n        return null\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(TAG, \"on service destroy\")\n        stopForeground(true)\n    }\n}\n\n// å¯åŠ¨Serviceï¼Œå¯åŠ¨æœ‰ä¸¤ç§æ”¾ï¼Œç¬¬ä¸€ç§å°±å’Œæ­£å¸¸å¯åŠ¨æ— å¼‚ï¼ŒstartServiceï¼Œè¿™æ ·å¯åŠ¨çš„å°±æ˜¯çš„æ­£å¸¸çš„Serviceï¼Œåªæœ‰åœ¨Serviceä¸­è°ƒç”¨startForegroundåæ–¹ä¸ºå‰å°æœåŠ¡ï¼›\n// ç¬¬äºŒç§æ–¹å¼æ˜¯API26ï¼Œä¹Ÿå°±æ˜¯8.0 Oreoæ–°åŠ çš„ï¼šstartForegroundServiceï¼Œå®ƒå’ŒstartServiceçš„åŒºåˆ«å°±æ˜¯ï¼Œå¯åŠ¨ä¹‹å5ç§’å†…è‹¥æ˜¯æ²¡æœ‰è°ƒç”¨startFroegroundï¼Œåˆ™crash\nval intent = Intent(this, ForegroundService::class.java)\nstartForegroundService(intent) // å¿…é¡»åœ¨Serviceä¸­è°ƒç”¨startForeground\nstartService(intent)\n\n// åœæ­¢Serviceï¼ŒåŒæ­£å¸¸åœæ­¢\nval intent = Intent(this, ForegroundService::class.java)\nstopService(intent)\n```\n\n### 8. IntentService\nå’ŒServiceç›¸æ¯”ï¼Œç‰¹ç‚¹æ˜¯è‡ªå¸¦ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¯ä»¥ç”¨æ¥åšä¸€äº›é˜»å¡çº¿ç¨‹çš„ä»»åŠ¡ï¼Œé˜»å¡ä»»åŠ¡éœ€è¦å†™åœ¨onHandleIntenté‡Œã€‚ç°åœ¨å·²ç»æ˜¾ç¤ºå¼ƒç”¨äº†ï¼Œæ¨èä½¿ç”¨androidxé‡Œçš„WorkManager\n```kotlin\n// æ„é€ æ–¹æ³•é‡Œé¢ä¼ å…¥çš„æ˜¯å­çº¿ç¨‹çš„åå­—\nclass DIntentService : IntentService(\"download\") {\n    \n    override fun onHandleIntent(intent: Intent?) {\n        // do something\n    }\n}\n```\n\n### 9. æ˜¾ç¤ºå¯åŠ¨å’Œéšå¼å¯åŠ¨\nä»¥ä¸Šé€šè¿‡æŒ‡å®šServiceç±»çš„å¯åŠ¨æ–¹å¼ï¼Œå‡ä¸ºæ˜¾ç¤ºå¯åŠ¨ã€‚éšå¼å¯åŠ¨æŒ‡å®šIntentçš„actionä¸ºå…¨ç±»åå³å¯ï¼Œæ­¤æ—¶éœ€è¦serviceåœ¨Manifestä¸­çš„exportedå±æ€§ä¸ºtrueã€‚åŒä¸€åº”ç”¨ä¸­ä¸¤ç§æ–¹å¼å‡å¯ï¼Œä¸åŒçš„åº”ç”¨åªèƒ½ç”¨éšå¼ã€‚\n```kotlin\nval intent = Intent(ForegroundService::class.java.canonicalName)\nstartService(intent)\n```\n5.0ä¹‹å‰éšå¼å¯åŠ¨åªä¼šå‘é€ä¸€ä¸ªè­¦å‘Šï¼Œ5.0ä¹‹åå®˜æ–¹å‡ºäºå®‰å…¨è€ƒè™‘ç¦æ­¢äº†éšå¼å¯åŠ¨ï¼Œç›´æ¥æŠ¥é”™ï¼šService Intent must be explicitï¼Œæ„æ€å°±æ˜¯æŒ‡å®šçš„Serviceå¿…é¡»ç²¾ç¡®\n```java\nprivate validateServiceIntent(Intent service) {\n\tif (service.getComponent() == null && service.getPackage() == null) {\n\t\tif (getApplicationInfo().targetSdkVersion >= Build.VERSION_CODES.LOLLIPOP) {\n\t\t\tIllegalArgumentException ex = new IllegalArgumentException(\"Service Intent must be explicit: \" + service);\n\t\t\tthrow ex;\n\t\t} else {\n\t\t\tLog.w(TAG, \"Implicit intents with startService are not safe: \" + service + \" \" + Debug.getCallers(2, 3));\n\t\t}\n\t}\n}\n```\nè§£å†³æ–¹å¼ï¼Œå¾ˆç®€å•ï¼Œç»™IntentæŒ‡å®šcomponentï¼Œæˆ–è€…packageï¼Œæˆ–è€…ä¸¤è€…éƒ½æŒ‡å®šï¼Œä¾¿å¯é€šè¿‡æ£€æŸ¥ã€‚\n```kotlin\n// æŒ‡å®špackage\nval intent = Intent(ForegroundService::class.java.canonicalName)\nintent.setPackage(getPackageName())\nstartService(intent)\n\n// æŒ‡å®šcomponent\nfun getExplicitServiceIntent(context: Context, intent: Intent) : Intent? {\n\tval pm = context.packageManager\n\tval resolveInfo = pm.queryIntentServices(intent, 0)\n\tif (resolveInfo == null || resolveInfo.size != 1) {\n\t\treturn null\n\t}\n\tval serviceInfo = resolveInfo[0]\n\tval packageName = serviceInfo.serviceInfo.packageName\n\tval className = serviceInfo.serviceInfo.name\n\tval component = ComponentName(packageName, className)\n\tval explicitIntent = Intent(intent);\n\texplicitIntent.component = component\n\treturn explicitIntent;\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Android","Service"],"categories":["Android"]},{"title":"Java volatileå…³é”®å­—","url":"/2022/03/30197999d29a/","content":"\nvolatileæ˜¯Javaçš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨æ¥ä¿®é¥°å˜é‡ï¼Œè¢«volatileä¿®é¥°çš„å˜é‡ï¼Œåœ¨æ¯æ¬¡æ›´æ–°ä¹‹åä¼šç«‹åˆ»åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¤ç¼“å­˜è¡Œæ— æ•ˆï¼Œå…¶ä»–çº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–çš„ä¼šæ˜¯æœ€æ–°å€¼ï¼Œä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œå¸¸ç”¨äºå¹¶å‘ç¼–ç¨‹ä¸­ã€‚\n\nè¿™ä¹ˆä¸€è¯´æœ‰äº›æŠ½è±¡ï¼Œè¦æƒ³è¯´æ˜ç™½è¿™å…¶ä¸­åŸç†ï¼Œè¿˜è¦ä»Javaå†…å­˜æ¨¡å‹è¯´èµ·ã€‚\n\n<!--more-->\n\n### 1. CPUã€å†…å­˜å’Œé«˜é€Ÿç¼“å­˜\næˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨è®¡ç®—æœºä¸­æŒ‡ä»¤ç”±CPUæ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åŒ…æ‹¬è¯»å–æ•°æ®ã€æ“ä½œæ•°æ®å’Œå†™å‡ºæ•°æ®ã€‚ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œæ•°æ®æ˜¯å­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯å¹³æ—¶è¯´çš„å†…å­˜æ¡ã€‚CPUåœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œå°†æ•°æ®ä»å†…å­˜è¯»å…¥ï¼Œæ“ä½œä¹‹åï¼Œå†å°†æ•°æ®å†™å‡ºåˆ°å†…å­˜ï¼Œè€ŒCPUè¯»å†™é€Ÿåº¦ä¹‹å¿«ï¼Œè¿œè¿œè¶…è¿‡å†…å­˜çš„è¯»å†™é€Ÿåº¦ï¼Œè¿™åŠ¿å¿…ä¼šå¤§å¤§æ‹‰ä½CPUçš„é€Ÿåº¦ï¼Œæ‰€ä»¥é«˜é€Ÿç¼“å­˜åº”è¿è€Œç”Ÿã€‚\n\nç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå…ˆå°†éœ€è¦çš„æ•°æ®å¤åˆ¶ä¸€ä»½åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç­‰åˆ°CPUæ‰§è¡ŒæŒ‡ä»¤æ—¶ä»é«˜é€Ÿç¼“å­˜ä¸­è¯»å…¥æ•°æ®ï¼Œæ“ä½œå®Œä¹‹åå†™å‡ºåˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç¨‹åºæ‰§è¡Œå®Œæˆåï¼Œå†å°†é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·ä¸€æ¥æ›´å¥½çš„åˆ©ç”¨äº†CPUçš„æ€§èƒ½ï¼Œæé«˜äº†æ•´ä½“çš„è¿è¡Œé€Ÿåº¦ã€‚\n\nè¿™ç§è®¾è®¡ï¼Œåœ¨å•çº¿ç¨‹ç¼–ç¨‹ä¸­æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯åˆ°äº†å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ—¶ï¼Œå°±ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æ¯”å¦‚ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå€¼ä¸º0çš„å˜é‡ï¼ŒåŒæ—¶å°†å…¶è¯»å…¥åˆ°å„è‡ªçš„é«˜é€Ÿç¼“å­˜ä¸­ï¼ŒCPUå…ˆå°†çº¿ç¨‹ä¸€çš„å˜é‡åŠ 1ï¼Œç»“æœä¸º0+1=1ï¼Œç„¶ååˆ·æ–°åˆ°å†…å­˜ä¸­ï¼›ç„¶åå†å°†çº¿ç¨‹äºŒçš„å˜é‡åŠ 1ï¼Œç”±äºåœ¨è¿™ä¸ªçº¿ç¨‹è¯»å…¥å˜é‡æ—¶å¹¶æ²¡æœ‰åŠ 1ï¼Œæ‰€ä»¥è¯»è¿›æ¥çš„å€¼ä¹Ÿæ˜¯0ï¼ŒåŠ 1åä¸º1ï¼Œç„¶åå†å†™å…¥åˆ°å†…å­˜ä¸­ï¼Œä¸¤ä¸ªçº¿ç¨‹å„è‡ªæ‰§è¡Œäº†ä¸€æ¬¡åŠ 1ï¼Œä½†æœ€åç»“æœå´æ˜¯1ï¼Œé—®é¢˜å°±æ¥äº†ã€‚\n\n### 2. å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ\nåŸå­æ€§ï¼šåŸå­ä¸å¯åˆ†å‰²ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå°±å…¨éƒ¨ä¸æ‰§è¡Œã€‚åœ¨Javaä¸­ï¼Œå¯¹åŸå§‹ç±»å‹å˜é‡çš„è¯»å–å’Œèµ‹å€¼æ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„åŸå­æ“ä½œï¼Œè¿™é‡Œçš„èµ‹å€¼æ˜¯æŒ‡å°†ä¸€ä¸ªç¡®å®šçš„å€¼èµ‹ç»™å˜é‡ï¼Œå¦‚a=1ï¼Œè€Œä¸æ˜¯å°†å¦ä¸€ä¸ªå˜é‡çš„å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œå¦‚a=bï¼Œè¿™é‡Œé¢åŒ…å«ä¸¤æ­¥æ“ä½œï¼Œéœ€è¦å…ˆè¯»å–bçš„å€¼ï¼Œç„¶åå†å°†å€¼èµ‹ç»™aã€‚æ¯”å¦‚ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡æ—¶ï¼Œéœ€è¦å…ˆè¯·æ±‚åˆ†é…åœ°å€ç©ºé—´ï¼Œç„¶åå†ç»™åœ°å€ç©ºé—´äº†æ¯ä¸€ä¸ªå˜é‡èµ‹é»˜è®¤å€¼\n\nå¯è§æ€§ï¼šå¦‚åŒä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸€ä¸ªå˜é‡æ—¶ï¼Œä¹‹æ‰€ä»¥ä¼šå‡ºç°é”™è¯¯çš„ç»“æœï¼Œæ˜¯å› ä¸ºå½“çº¿ç¨‹ä¸€ä¿®æ”¹å®Œå˜é‡çš„å€¼æ—¶ï¼Œçº¿ç¨‹äºŒå¹¶ä¸çŸ¥é“ï¼Œä»¥è‡³äºåœ¨ä¸€ä¸ªæ—§çš„å€¼ä¸Šç»§ç»­æ“ä½œã€‚å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå˜é‡ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å®ƒçš„å€¼åï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè¯»åˆ°æœ€æ–°çš„å€¼ï¼Œè¿™å°±æ˜¯å¯è§æ€§ï¼Œè¢«volatileä¿®é¥°çš„å˜é‡ï¼Œå°±å…·æœ‰è¿™ç§å¯è§æ€§ã€‚\n\næœ‰åºæ€§ï¼šä¸ºäº†è¿›ä¸€æ­¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼ŒJVMè™šæ‹Ÿæœºä¼šå¯¹æŒ‡ä»¤çš„é¡ºè®¯é‡ç°æ’åˆ—ï¼Œæ‰€ä»¥ä»£ç å¯èƒ½å¹¶ä¸ä¼šæŒ‰ç…§å®šå¥½å…ˆåé¡ºåºæ¥æ‰§è¡Œä»£ç ã€‚ä½†è¿™å…¶ä¸­ä¹Ÿæœ‰ä¸€äº›è§„å®šï¼Œå¦‚æœè¯­å¥2ä¸ä¾èµ–äºè¯­å¥1çš„ç»“æœï¼Œé‚£ä¹ˆæœ¬ä½äºåé¢çš„è¯­å¥2å¯èƒ½ä¼šå…ˆäºè¯­å¥1æ‰§è¡Œï¼Œå¦‚æœè¯­å¥2ä¾èµ–äºè¯­å¥1ï¼Œåˆ™ä¸ä¼šå‰ç½®æ‰§è¡Œã€‚ä¸¾ä¸€ä¸ªæŒ‡ä»¤é‡æ’åœ¨å¹¶å‘ç¼–ç¨‹ä¸­çš„é—®é¢˜ï¼šçº¿ç¨‹ä¸€ç§æ‰§è¡Œä¸¤ä¸ªè¯­å¥ï¼Œè¯­å¥1æ˜¯åˆå§‹åŒ–èµ„æºï¼Œè¯­å¥2æ˜¯å°†æ˜¯å¦åˆå§‹åŒ–æ ‡å¿—ä½ç½®ä¸ºtrueï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå½“æ‰§è¡Œåˆ°è¯­å¥2ï¼Œä¹Ÿå°±æ˜¯æ ‡å¿—ä½ä¸ºtrueæ—¶ï¼Œå°±å¯ä»¥è®¤ä¸ºè¯­å¥1å·²ç»æ‰§è¡Œè¿‡ï¼Œèµ„æºå·²ç»åˆå§‹åŒ–å®Œæˆï¼›çº¿ç¨‹2åˆ™æ˜¯ä¸€ç›´ç­‰å¾…æ ‡å¿—ä½ï¼Œç›´åˆ°ä¸ºtrueæ—¶ï¼Œå¼€å§‹è¿›è¡Œåç»­çš„æ“ä½œã€‚çº¿ç¨‹ä¸€ä¸­ï¼Œç”±äºåªä¿®æ”¹æ ‡å¿—ä½ä¸ä¾èµ–åˆå§‹åŒ–æ“ä½œï¼Œæ‰€ä»¥å¯èƒ½ä¼šå…ˆäºåˆå§‹åŒ–æ‰§è¡Œï¼Œè¿™æ—¶çº¿ç¨‹äºŒåˆ¤æ–­å·²ç»åˆå§‹åŒ–ï¼Œå°±ä¼šå¼€å§‹åé¢çš„æ“ä½œï¼Œè€Œå®é™…ä¸Šå¹¶æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ï¼Œç¨‹åºå°±ä¸ä¼šæŒ‰ç…§è®¾è®¡çš„æ‰§è¡Œã€‚\n\nå› æ­¤ï¼Œè¦æƒ³å¤šçº¿ç¨‹å¹¶å‘æ—¶èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œï¼Œå°±å¿…é¡»ä¿è¯è¿™ä¸‰ä¸ªç‰¹æ€§ã€‚\n\n### 3. Javaå†…å­˜æ¨¡å‹JMMï¼ˆJava Memory Modelï¼‰\nJavaè™šæ‹ŸæœºJVMè§„èŒƒä¸­å®šä¹‰äº†ä¸€ç§å†…å­˜æ¨¡å‹ï¼Œç”¨ä»¥æ¥å±è”½ä¸åŒç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿé—´çš„å·®å¼‚ï¼Œä»è€Œå®ç°å…¶è·¨å¹³å°çš„ç‰¹æ€§ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒJavaå†…å­˜æ¨¡å‹è§„å®šæ‰€æœ‰çš„å˜é‡éƒ½æ˜¯å­˜åœ¨ä¸»å†…å­˜å½“ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥å¯¹ä¸»å†…å­˜è¿›è¡Œæ“ä½œï¼ŒåŒæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸å¯è®¿é—®å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ã€‚\n\nä¸»å†…å­˜å¯ä»¥çœ‹ä½œæ˜¯ä¸Šé¢æåˆ°çš„ç‰©ç†å†…å­˜ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜å¯ä»¥çœ‹ä½œæ˜¯é«˜é€Ÿç¼“å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œéœ€è¦å…ˆå°†æ•°æ®ä»ä¸»å†…å­˜å¤åˆ¶ä¸€ä»½åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œç­‰å¾…CPUå¤„ç†å®Œä¹‹åï¼Œå†å°†å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®åˆ·å›åˆ°ä¸»å­˜ä¸­ï¼Œåˆ°æ­¤æ‰§è¡Œå®Œæˆã€‚\n\n### 4. volatileåœ¨å¹¶å‘ç¼–ç¨‹ä¸­\nç¬¬ä¸€ç‚¹ï¼ŒåŸå­æ€§ã€‚volatileæ— æ³•ä¿è¯åŸå­æ€§ã€‚\n```\npublic volatile int inc = 0;\n```\nçº¿ç¨‹ä¸€å’Œçº¿ç¨‹äºŒåŒæ—¶å¯¹å˜é‡incæ‰§è¡Œè‡ªå¢æ“ä½œ100æ¬¡ï¼Œèƒ½ä¿è¯æœ€åçš„ç»“æœæ˜¯200å—ï¼Ÿä¸èƒ½ã€‚å¯èƒ½è§‰å¾—ä¸å¯¹ï¼Œåˆšåˆšä¸æ˜¯æ‰è¯´è¿‡ï¼Œè¢«volatileä¿®é¥°çš„å˜é‡åœ¨ä¿®æ”¹ä¹‹åä¼šç«‹åˆ»åˆ·æ–°å›ä¸»å­˜ï¼ŒåŒæ—¶è®©å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­çš„ç¼“å­˜æ— æ•ˆï¼Œé‚£ä¸ºä»€ä¹ˆæ‰§è¡Œ200æ¬¡ç»“æœå´ä¸æ˜¯200å‘¢ï¼Ÿè¿™ä¾¿æ˜¯volatileæ— æ³•ä¿è¯åŸå­æ€§ã€‚\n\nç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹ä¸€ä»ä¸»å­˜ä¸­æŠŠincçš„å€¼å¤åˆ¶åˆ°ä¸€ä»½åˆ°å…¶å·¥ä½œå†…å­˜ä¸­ï¼Œæ­¤æ—¶çº¿ç¨‹ä¸€è¢«æŒ‚èµ·ã€‚ä¸ºä»€ä¹ˆæœ‰å¯èƒ½ä¼šè¢«æŒ‚èµ·å‘¢ï¼Œå› ä¸ºåœ¨å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œåˆ†åˆ°CPUæ—¶é—´ç‰‡çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œæ“ä½œï¼Œæ²¡æœ‰åˆ†åˆ°æ—¶é—´ç‰‡æ—¶å°±è¦æŒ‚èµ·ç­‰å¾…ï¼Œè€ŒCPUæ—¶é—´ç‰‡çš„åˆ†é…æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ã€‚è¿™æ—¶ï¼Œçº¿ç¨‹äºŒå¼€å§‹æ‰§è¡Œï¼Œæ ¹æ®JMMåŒæ ·éœ€è¦å°†ä¸»å­˜ä¸­incçš„å€¼å¤åˆ¶ä¸€ä»½åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œç”±äºæ­¤æ—¶çº¿ç¨‹ä¸€è¿˜æ²¡æœ‰ä¿®æ”¹incçš„å€¼ï¼Œæ‰€ä»¥è¯»åˆ°çš„è¿˜æ˜¯0ï¼Œç„¶åç»§ç»­æ‰§è¡Œè‡ªå¢æ“ä½œï¼Œæœ€åå†å°†incçš„æœ€æ–°å€¼1åˆ·å›åˆ°ä¸»å­˜ä¸­ã€‚æ­¤æ—¶çº¿ç¨‹ä¸€é‡Šæ”¾ï¼Œç»§ç»­æ‰§è¡Œï¼Œå› ä¸ºå·²ç»å°†incåŠ è½½è¿›æ¥ï¼Œä¾¿ä¸ä¼šå†å»åŠ è½½ï¼Œè€Œæ˜¯æ‰§è¡Œå¢åŠ æ“ä½œï¼Œå¾—åˆ°1ï¼Œæœ€åå°†1åˆ·æ–°å›ä¸»å­˜ä¸­ã€‚\n\nå› ä¸ºè‡ªå¢æ“ä½œåŒ…å«è¯»å–ã€æ“ä½œã€å†èµ‹å€¼å¤šä¸ªæ“ä½œï¼Œè¢«æˆ–ä¸è¢«volatileä¿®é¥°çš„åŒºåˆ«åœ¨äºï¼Œè¢«ä¿®é¥°çš„å˜é‡åœ¨æ“ä½œåä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å­˜ä¸­ï¼Œæ²¡æœ‰è¢«ä¿®é¥°çš„å˜é‡åœ¨ä¿®é¥°ååˆ·å›åˆ°ä¸»å­˜çš„æ—¶æœºä¸ç¡®å®šã€‚æ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±çš„å·¥ä½œçº¿ç¨‹è€Œä¸èƒ½æ“ä½œå…¶ä»–çº¿ç¨‹çš„ï¼Œæ•…è€Œä¸»å­˜æ˜¯å®ƒä»¬çš„äº¤äº’é€šé“ï¼Œvolatileåªèƒ½ä¿è¯ä¸»å­˜ä¸­çš„å€¼ä¸€å®šæ˜¯æœ€æ–°çš„ï¼Œå´ä¸èƒ½ä¿è¯å…¶ä»–çº¿ç¨‹çš„å€¼æ˜¯æœ€æ–°ï¼Œå¦‚æœåœ¨ä¸­é—´çš„æŸä¸ªæ­¥éª¤è¢«é˜»å¡æŒ‚èµ·ï¼Œå°±æ— æ³•ä¿è¯æœ€ç»ˆç»“æœçš„å‡†ç¡®æ€§ã€‚\n\nè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰å¤šé‡æ–¹å¼ï¼Œæ¯”å¦‚synchronizedã€Lockç­‰ï¼Œå¦è‡ªå¢æ“ä½œåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œä¾¿å¯ã€‚\n\nç¬¬äºŒç‚¹ï¼Œå¯è§æ€§ã€‚è¿™ä¸€ç‚¹åœ¨ä¸Šé¢ä¹Ÿå·²åŸºæœ¬ä¸Šè¯´æ˜ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ã€‚\n\nç¬¬ä¸‰ç‚¹ï¼Œæœ‰åºæ€§ã€‚volatileèƒ½å¤Ÿç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå®ƒä¼šå½¢æˆä¸€ä¸ªå†…å­˜å±éšœï¼Œä¹Ÿç§°å†…å­˜æ …æ ã€‚åœ¨volatileå˜é‡è¯»å†™æ“ä½œå‰çš„æŒ‡ä»¤ï¼Œä¸€å®šä¼šå…ˆæ‰§è¡Œï¼Œåœ¨å…¶åé¢çš„æŒ‡ä»¤ä¸€å®šä¼šåæ‰§è¡Œã€‚å±éšœå‰çš„æŒ‡ä»¤å¯èƒ½ä¼šé‡æ’ï¼Œä½†æ˜¯ä¸ä¼šè¶Šè¿‡å±éšœï¼ŒåŒæ ·ï¼Œå±éšœåé¢çš„æŒ‡ä»¤ä¹Ÿå¯èƒ½ä¼šé‡æ’ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šè¶Šè¿‡å±éšœã€‚\n\n### 5. volatileçš„åŸç†å’Œå®ç°æœºåˆ¶\nè§‚å¯ŸåŠ å…¥vlatileå…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥volatileå…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼ŒåŠ å…¥volatileå…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€æŒ‡ä»¤ï¼Œlockå‰ç¼€å³ä½å†…å­˜å±éšœï¼Œæœ‰3ä¸ªåŠŸèƒ½ï¼š\n- å®ƒç¡®ä¿å±éšœå‰åçš„æŒ‡ä»¤ä¸ä¼šè·¨è¶Šå±éšœ\n- å®ƒå¼ºåˆ¶å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼ˆç¼“å­˜å³ä¸ºçº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼‰\n- å¦‚æœæ˜¯å†™æ“ä½œï¼Œä¼šå¯¼è‡´å…¶ä»–CPUä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆï¼ˆç¼“å­˜è¡Œæ— æ•ˆåä¾¿ä¼šä»ä¸»å­˜è¯»å–ï¼Œä¿è¯å¯è§æ€§ï¼‰\n","tags":["Android","Java"],"categories":["Java"]},{"title":"Androidå¸¸ç”¨åº“å™è¿°","url":"/2022/02/25900530192f/","content":"\nåˆ—ä¸¾ä¸€äº›Androidé¡¹ç›®ä¸­å¸¸ç”¨çš„ä¸‰æ–¹ä¾èµ–åº“ã€‚\n<!--more-->\n\n### ä¸€. EventBus\nç®—æ˜¯å¾ˆå¸¸è§äº†ï¼Œäº‹ä»¶æ€»çº¿åº“ï¼Œé‡‡ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼ï¼Œç”¨äºè§£è€¦ç»„ä»¶é€šä¿¡ã€‚è¿™é‡Œä¸»è¦ä»‹ç»3ç‚¹ï¼šæ³¨å†Œã€äº‹ä»¶å’Œçº¿ç¨‹ã€‚\n\n1. æ³¨å†Œ\nEventBusæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œé‡‡ç”¨æ³¨è§£çš„æ–¹å¼ï¼Œæ¥æ”¶äº‹ä»¶çš„æ–¹æ³•éœ€è¦ç”¨@Subscribeæ³¨è§£æ ‡è®°ï¼Œç„¶åé€šè¿‡å•ä¾‹é‡Œçš„æ–¹æ³•registerå°†è‡ªå·±ä»¥åŠéœ€è¦è®¢é˜…çš„äº‹ä»¶æ³¨å†Œåˆ°å…¶ä¸­ï¼Œæœ‰äº‹ä»¶åˆ°æ¥æ—¶EventBusä¾¿ä¼šé€šè¿‡åå°„è°ƒç”¨è®¢é˜…è€…ã€‚\nåœ¨è°ƒç”¨registeræ—¶ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼šJITå’ŒAOTã€‚å¦‚æœä½¿ç”¨äº†APT(Annotation Processor Tool)ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µæ‰€æœ‰è¢«@Subscribeä¿®é¥°çš„æ–¹æ³•éƒ½ä¼šè¢«å•ç‹¬å¤„ç†ç”Ÿæˆå¯¹åº”çš„ä»£ç ï¼Œåœ¨è°ƒç”¨registeræ—¶ç›´æ¥å°†è®¢é˜…è€…çš„æ–¹æ³•æ·»åŠ åˆ°é›†åˆä¸­ï¼›å¦‚æœæ²¡æœ‰ä½¿ç”¨APTï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨registeræ—¶ï¼Œä¾¿ä¼šé€šè¿‡åå°„éå†è®¢é˜…è€…åŠå…¶çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰¾åˆ°è¢«@Subscribeä¿®é¥°çš„æ–¹æ³•ï¼Œç„¶åå°†è¿™äº›æ–¹æ³•æ·»åŠ åˆ°é›†åˆä¸­ã€‚\nå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œçœ‹åˆ°JITå’ŒAOTå…¶å®å°±å¾ˆæ˜æ˜¾äº†ï¼Œæ—¶é—´æ¢ç©ºé—´ã€‚ä½¿ç”¨APTçš„ä¼šæ›´å¿«ä¸€äº›ï¼Œå› ä¸ºçœå»äº†è€—æ—¶çš„åå°„æ“ä½œï¼Œä½†æ˜¯å¯èƒ½ä¼šæŠŠç”¨ä¸åˆ°çš„è®¢é˜…è€…ä¹Ÿæ·»åŠ åˆ°é›†åˆä¸­ï¼›è‹¥ä¸ä½¿ç”¨APTåˆ™æ˜¯æŒ‰éœ€æ·»åŠ ï¼Œä½†æ˜¯é€Ÿåº¦ä¸Šå°±æ…¢äº†ä¸€äº›ã€‚\n\n2. äº‹ä»¶\nåˆ†ä¸ºä¸¤ç§ï¼šæ™®é€šäº‹ä»¶å’Œç²˜æ€§äº‹ä»¶ã€‚æ™®é€šäº‹ä»¶éœ€è¦å…ˆæ³¨å†Œåæ‰èƒ½æ¥æ”¶ï¼Œè€Œç²˜æ€§äº‹ä»¶åœ¨å‘é€æ—¶ä¼šè¢«ä¿å­˜æœ€åä¸€æ¬¡çš„äº‹ä»¶ï¼Œæ‰€ä»¥å¦‚æœ‰æœ‰äººæ³¨å†Œè®¢é˜…ç²˜æ€§äº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨registeræ—¶ï¼Œä¼šä½¿å…¶æ¥æ”¶ä¸€æ¬¡ä¸Šä¸€æ¬¡çš„ç²˜æ€§äº‹ä»¶ã€‚\n\n3. çº¿ç¨‹\nåœ¨è®¢é˜…æ—¶å¯åœ¨@Subscribeä¸­æŒ‡å®šæ¥æ”¶çº¿ç¨‹ï¼Œåœ¨å‘é€äº‹ä»¶çš„çº¿ç¨‹ã€åœ¨ä¸»çº¿ç¨‹ã€åœ¨åå°çº¿ç¨‹ã€åœ¨å¼‚æ­¥çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å’Œåå°çº¿ç¨‹çš„äº‹ä»¶éƒ½æ˜¯é¡ºåºè¢«å¤„ç†çš„ï¼Œè€Œå¼‚æ­¥çº¿ç¨‹ä¸­ç»´æŠ¤äº†ä¸€ä¸ªçº¿ç¨‹æ± Executors.newCachedThreadPool()ï¼Œæ¯æ¬¡æ¥æ”¶åˆ°æ–°äº‹ä»¶éƒ½ä¼šäº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œå› æ­¤æ— æ³•ä¿è¯æœ‰åºæ€§ï¼Œä½†æ˜¯å®æ•ˆæ€§ç›¸å¯¹æ›´é«˜ï¼Œæœ‰å¾—æœ‰å¤±ã€‚\n\n4. æ€»ç»“\nEventBusç®€å•ã€æ˜“ç”¨ï¼Œæ— å»¶è¿Ÿï¼Œå¯æ»¡è¶³å¤§éƒ¨åˆ†å¼€å‘éœ€æ±‚ï¼Œä½†æ˜¯åªé™äºå•è¿›ç¨‹ï¼Œä¸”æ¶ˆæ¯ä¸å¯æŒä¹…åŒ–ï¼Œåªé™å­˜åœ¨äºå†…å­˜ä¹‹ä¸­ã€‚\n\n\n\n\n","tags":["Android"]},{"title":"Androidé€šä¿¡æœºåˆ¶Binderå®è§‚ä»‹ç»","url":"/2022/02/ba3c10e704f8/","content":"\nBinderç®€ä»‹ï¼Œæ‘˜é€‰è‡ªã€ŠAndroidç³»ç»Ÿæºä»£ç æƒ…æ™¯åˆ†æã€‹\n\n<!--more-->\n\n### 1. æ•´ä½“å…³ç³»\nLinuxå†…æ ¸çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼šç®¡é“Pipeï¼Œä¿¡å·Signalï¼Œæ¶ˆæ¯é˜Ÿåˆ—Messageï¼Œå…±äº«å†…å­˜ShareMemoryï¼Œæ’å£Socketç­‰ã€‚\n\nAndroidç‹¬ç‰¹çš„IPCï¼ŒBinderï¼ŒåŸºäºCSæ¶æ„ï¼Œä¼˜åŠ¿ï¼šè¿›ç¨‹é—´ä¼ è¾“æ•°æ®æ—¶ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å¤åˆ¶æ“ä½œï¼Œæé«˜æ•ˆç‡ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚\n\næä¾›æœåŠ¡çš„æ˜¯Serverè¿›ç¨‹ï¼Œè®¿é—®æœåŠ¡çš„è¿›ç¨‹æ˜¯Clientè¿›ç¨‹ï¼Œä¸€ä¸ªServerè¿›ç¨‹å¯ä»¥è¿è¡Œå¤šä¸ªç»„ä»¶æ¥ï¼ˆServiceç»„ä»¶ï¼‰ç»™Clientè¿›ç¨‹æä¾›æœåŠ¡ï¼Œä¸€ä¸ªClientè¿›ç¨‹å¯ä»¥è¿è¡Œå¤šä¸ªç»„ä»¶ï¼ˆClientç»„ä»¶ï¼‰æ¥è¯·æ±‚æœåŠ¡ã€‚Serverè¿›ç¨‹å’ŒClientè¿›ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªBinderçº¿ç¨‹æ± ï¼Œç”¨æ¥å¤„ç†è¿›ç¨‹é—´é€šä¿¡è¯·æ±‚ï¼Œå¯å¹¶å‘æ“ä½œã€‚\n\nServerè¿›ç¨‹å’ŒClientè¿›ç¨‹é—´çš„é€šä¿¡ä¾é è¿è¡Œåœ¨å†…æ ¸ç©ºé—´çš„Binderé©±åŠ¨ç¨‹åºæ¥è¿›è¡Œã€‚Binderé©±åŠ¨ç¨‹åºå‘ç”¨æˆ·ç©ºé—´æš´éœ²äº†ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶/dev/binderï¼Œä½¿å¾—åº”ç”¨ç¨‹åºè¿›ç¨‹å¯ä»¥é—´æ¥åœ°é€šè¿‡å®ƒæ¥å»ºç«‹é€šä¿¡é€šé“ã€‚\n\nServiceç»„ä»¶åœ¨å¯åŠ¨æ—¶ï¼Œä¼šå°†è‡ªå·±æ³¨å†Œåˆ°ä¸€ä¸ªServiceManagerç»„ä»¶ä¸­ï¼Œå·²ä¾¿Clientç»„ä»¶å¯ä»¥è¯¥ç»„ä»¶æ‰¾åˆ°å®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ServiceManagerç»„ä»¶ç§°ä¸ºBinderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶çš„ä¸Šä¸‹æ–‡ç®¡ç†è€…ï¼ŒåŒæ—¶ç”±äºå®ƒä¹Ÿéœ€è¦ä¸æ™®é€šçš„Serverè¿›ç¨‹å’ŒClientè¿›ç¨‹é€šä¿¡ï¼Œæˆ‘ä»¬ä¹Ÿå°†å®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªServiceç»„ä»¶ï¼Œåªä¸è¿‡å®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Serviceç»„ä»¶ã€‚\n\nClientã€Serviceå’ŒServiceManagerè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼ŒBinderé©±åŠ¨ç¨‹åºè¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œå…¶ä¸­ï¼ŒServiceManagerå’ŒBinderé©±åŠ¨ç¨‹åºç”±ç³»ç»Ÿè´Ÿè´£æä¾›ï¼ŒClientå’ŒServiceç»„ä»¶ç”±åº”ç”¨ç¨‹åºæ¥å®ç°ã€‚\n\nClientã€Serviceå’ŒServiceManagerå‡æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨openã€mmapå’Œioctlæ¥è®¿é—®è®¾å¤‡æ–‡ä»¶/dev/binderï¼Œä»è€Œå®ç°ä¸Binderé©±åŠ¨ç¨‹åºçš„äº¤äº’ï¼Œä»è€Œè¾¾åˆ°é—´æ¥åœ°æ‰§è¡Œè¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„ã€‚\n\næ¯ä¸€ä¸ªServiceç»„ä»¶åœ¨Binderé©±åŠ¨ç¨‹åºä¸­éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Binderå®ä½“å¯¹è±¡binder_nodeï¼Œç”¨æ¥æè¿°å®ƒåœ¨å†…æ ¸ä¸­çš„çŠ¶æ€ã€‚\n\n### 2. Service Manager\nService Manageræ˜¯Binderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒæ‰®æ¼”ç€Binderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ä¸Šä¸‹æ–‡ç®¡ç†è€…çš„è§’è‰²ï¼ŒåŒæ—¶è´Ÿè´£ç®¡ç†ç³»ç»Ÿä¸­çš„Serviceç»„ä»¶ï¼Œå¹¶ä¸”å‘Clientç»„ä»¶æä¾›è·å–Serviceä»£ç†æœåŠ¡å¯¹è±¡çš„æœåŠ¡ã€‚\n\nService Managerè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œå› æ­¤ï¼ŒServiceç»„ä»¶å’ŒClientç»„ä»¶ä¹Ÿéœ€è¦é€šè¿‡è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æ¥å’Œå®ƒäº¤äº’ï¼Œä¹Ÿå°±æ˜¯Binderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œæ‰€ä»¥ï¼ŒService Managerä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Serviceç»„ä»¶ã€‚\n\nService Manageræ˜¯ç”±initè¿›ç¨‹è´Ÿè´£å¯åŠ¨çš„ï¼Œè€Œinitè¿›ç¨‹æ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨çš„ï¼Œå› æ­¤ï¼ŒService Managerä¹Ÿæ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨çš„ã€‚å¯åŠ¨è¿‡ç¨‹ç”±ä¸‰ä¸ªæ­¥éª¤ç»„æˆï¼šç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨å‡½æ•°binder_openæ‰“å¼€è®¾å¤‡æ–‡ä»¶/dev/binderï¼Œä»¥åŠå°†å®ƒæ˜ å°„åˆ°æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼›ç¬¬äºŒæ­¥æ˜¯è°ƒç”¨å‡½æ•°binder_become_context_managerå°†è‡ªå·±æ³¨å†Œä¸ºBinderè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶çš„ä¸Šä¸‹æ–‡ç®¡ç†è€…ï¼›ç¬¬ä¸‰æ­¥æ˜¯è°ƒç”¨å‡½æ•°binder_loopæ¥å¾ªç¯ç­‰å¾…å’Œå¤„ç†Clientè¿›ç¨‹çš„é€šä¿¡è¯·æ±‚ã€‚\n\n### 3. Serviceä»£ç†å¯¹è±¡çš„è·å–è¿‡ç¨‹\nServiceç»„ä»¶å°†è‡ªå·±æ³¨å†Œåˆ°Service Managerä¸­ä¹‹åï¼Œå®ƒå°±åœ¨Serverè¿›ç¨‹ä¸­ç­‰å¾…Clientè¿›ç¨‹å°†è¿›ç¨‹é—´é€šä¿¡è¯·æ±‚å‘é€è¿‡æ¥ã€‚Clientè¿›ç¨‹ä¸ºäº†å’Œè¿è¡Œåœ¨Serverè¿›ç¨‹ä¸­çš„Serviceç»„ä»¶é€šä¿¡ï¼Œé¦–å…ˆè¦è·å¾—å®ƒçš„ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¿™æ˜¯é€šè¿‡Service Manageræä¾›çš„Serviceç»„ä»¶æŸ¥è¯¢æœåŠ¡æ¥å®ç°çš„\n","tags":["Android","Binder"],"categories":["Android"]},{"title":"Androidç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹","url":"/2022/01/f6c3174008b0/","content":"ä»æŒ‰ä¸‹å¼€æœºé”®ï¼Œåˆ°æ‰‹æœºå®Œå…¨å¯åŠ¨ï¼Œç³»ç»Ÿåšäº†å“ªäº›äº‹ã€‚\n\n<!--more-->\n\n> æ‘˜å½•è‡ªã€ŒAndroidè¿›é˜¶è§£å¯†ã€ã€‚\n\n### ç³»ç»Ÿæ¶æ„ç®€ä»‹\nè¯´åˆ°ç³»ç»Ÿæ¶æ„ï¼Œå°±ç¦»ä¸å¼€å®˜æ–¹çš„é‚£å¼ å›¾ï¼Œè¿™é‡Œå°±ä¸è´´äº†ã€‚Androidç³»ç»Ÿæ¶æ„åˆ†ä¸ºäº”å±‚ï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯\n- åº”ç”¨å±‚(System Apps)ã€\n- åº”ç”¨æ¡†æ¶å±‚(Java API Framework)ã€\n- ç³»ç»Ÿè¿è¡Œåº“å±‚(Android Runtime, Native C/C++ Libraries)ã€\n- ç¡¬ä»¶æŠ½è±¡å±‚(Hardware Abstraction Layer, HAL)ã€\n- Linuxå†…æ ¸å±‚(Linux Kernel)\n\n### ç³»ç»Ÿå¯åŠ¨æµç¨‹\n1. å¯åŠ¨ç”µæºä»¥åŠç³»ç»Ÿ\nå½“ç”µæºæŒ‰ä¸‹æ—¶ï¼Œå°†å¼•å¯¼èŠ¯ç‰‡ä»£ç ä»é¢„å®šä¹‰çš„åœ°æ–¹ï¼ˆå›ºåŒ–åœ¨ROMï¼‰å¼€å§‹æ‰§è¡Œã€‚åŠ è½½å¼•å¯¼ç¨‹åºBootLoaderåˆ°RAMï¼Œç„¶åæ‰§è¡Œã€‚\n\n2. å¼•å¯¼ç¨‹åºBootLoader\nå¼•å¯¼ç¨‹åºBootLoaderæ˜¯åœ¨Androidæ“ä½œç³»ç»Ÿå¼€å§‹è¿è¡Œå‰çš„ä¸€ä¸ªå°ç¨‹åºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯æŠŠç³»ç»ŸOSæ‹‰èµ·æ¥å¹¶è¿è¡Œã€‚\n\n3. Linuxå†…æ ¸å¯åŠ¨\nå½“å†…æ ¸å¯åŠ¨æ—¶ï¼Œè®¾ç½®ç¼“å­˜ã€è¢«ä¿æŠ¤å­˜å‚¨å™¨ã€è®¡åˆ’åˆ—è¡¨ã€åŠ è½½é©±åŠ¨ã€‚å½“å†…æ ¸å®Œæˆè¥¿æˆè®¾ç½®æ—¶ï¼Œå®ƒé¦–å…ˆåœ¨ç³»ç»Ÿæ–‡ä»¶ä¸­å¯»æ‰¾init.rcæ–‡ä»¶ï¼Œå¹¶å¯åŠ¨initè¿›ç¨‹ã€‚\n\n4. initè¿›ç¨‹å¯åŠ¨\nåˆå§‹åŒ–å’Œå¯åŠ¨å±æ€§æœåŠ¡ï¼Œå¹¶ä¸”å¯åŠ¨Zygoteè¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å­µåŒ–è¿›ç¨‹\n\n5. Zygoteè¿›ç¨‹å¯åŠ¨\nåˆ›å»ºJavaè™šæ‹Ÿæœºå¹¶ä¸ºJavaè™šæ‹Ÿæœºæ³¨å†ŒJNIæ–¹æ³•ï¼Œåˆ›å»ºæœåŠ¡å™¨Socketï¼Œå¯åŠ¨SystemServerè¿›ç¨‹ã€‚\n\n6. SystemServerè¿›ç¨‹å¯åŠ¨\nå¯åŠ¨Binderçº¿ç¨‹æ± å’ŒSystemServiceManagerï¼Œå¹¶ä¸”å¯åŠ¨å„ç§ç³»ç»ŸæœåŠ¡ã€‚è¿™å…¶ä¸­åŒ…æ‹¬WindowManagerServiceã€PackageManagerServiceã€CameraServiceã€SensorServiceï¼Œä»¥åŠActivityManagerServiceç­‰ã€‚\n\n7. Launcherå¯åŠ¨\nè¢«SystemServerè¿›ç¨‹å¯åŠ¨çš„AMSä¼šå¯åŠ¨Launcherï¼ŒLauncherå¯åŠ¨åä¼šå°†å·²å®‰è£…åº”ç”¨çš„å¿«æ·å›¾æ ‡æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚","tags":["è¯»ä¹¦ç¬”è®°"],"categories":["Android"]},{"title":"Linuxå‘½ä»¤--cat","url":"/2021/12/4c4e081a5efb/","content":"\nè¿æ¥å¤šä¸ªæ–‡ä»¶å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡º\n\n<!--more-->\n\n### ä¸‰å¤§åŠŸèƒ½\n- æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶æˆ–è€…æ–‡ä»¶ä¸º-åˆ™è¯»å–æ ‡å‡†è¾“å…¥ã€‚\n- ä»é”®ç›˜åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚\n- å°†å¤šä¸ªæ–‡ä»¶çš„å†…å®¹è¿›è¡Œè¿æ¥å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚\n\n### è¯»å–å†…å®¹\n1. è¯»å–åˆ°æ ‡å‡†è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ç»ˆç«¯çª—å£\n```sh\n# è¯»å–file1.txtæ–‡ä»¶\n$ cat file1.txt\n\n# è¯»å–å¤šä¸ªæ–‡ä»¶\n$ cat file1.txt file2.txt\n```\n\n2. è¯»å–åˆ°å…¶ä»–è¾“å‡ºæµï¼Œå¦‚æ–‡ä»¶\n```sh\n# å•ä¸ªæ–‡ä»¶\n$ cat f1.txt > sum.txt\n\n# å¤šä¸ªæ–‡ä»¶\n$ cat f1.txt f2.txt f3.txt > sum.txt\n```\n\n\n### åˆ›å»º/è¿½åŠ \n1. åˆ›å»ºä½¿ç”¨ `>`\n```sh\n$ cat > file1.txt << EOF\nline1\nline2\nEOF\n```\n\n2. è¿½åŠ ä½¿ç”¨ `>>`\n```sh\n$ cat >> file1.txt << EOF\nline3\nline4\nEOF\n```\n3. EOFï¼Œend of fileï¼Œç»“æŸæ ‡è®°ï¼Œæ¢æˆå…¶ä»–çš„ä¹Ÿå¯ä»¥\n\n4. ç»“æŸæ ‡è®°å’Œæ–‡ä»¶åçš„ä½ç½®æ— æ‰€è°“å‰åï¼Œè¿™æ ·ä¹Ÿå¯ä»¥\n```sh\n$ cat << EOF >> file1.txt\nline3\nline4\nEOF\n```\n\n### å…¶ä»–å¸¸ç”¨é€‰é¡¹\n```sh\n# -n --number åŠ è¡Œå·\n$ cat -n f1.txt\n\n# -b --number-noblank åŠ è¡Œå·ï¼Œä½†ç©ºç™½è¡Œä¸ç¼–å·\n$ cat -b f1.txt\n\n# -s --squeeze-blank å½“æœ‰ä¸¤è¡Œä»¥ä¸Šçš„ç©ºç™½è¡Œï¼Œå˜æˆä¸€è¡Œç©ºç™½è¡Œ\n$ cat -s f1.txt\n```","tags":["Linux"],"categories":["Linux"]},{"title":"iPhoneæ•°æ®å¤‡ä»½åˆ°ç§»åŠ¨ç¡¬ç›˜","url":"/2021/12/43f9db48ed86/","content":"\niPhoneå¤‡ä»½æ–¹å¼ä¸­ï¼Œç®—æ˜¯æœ€çœé’±çš„æ–¹å¼äº†ã€‚\n\n<!--more-->\n\n### å‰è¨€\né¦–å…ˆæ˜ç¡®çš„æ˜¯ï¼Œå¤‡ä»½è¿˜æ˜¯å¾ˆæœ‰å¿…è¦æ€§çš„ï¼Œåœ¨è®¾å¤‡ä¸¢å¤±ï¼Œæˆ–æ˜¯åæ‰çš„æ—¶å€™ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤æ•°æ®è€Œä¸å½±å“ä½¿ç”¨ã€‚\n\niPhoneé‡Œè‹¹æœå®˜æ–¹æ¨èçš„æ˜¯æŠŠæ•°æ®å¤‡ä»½åˆ°iCloudä¸­ï¼Œä½†æ˜¯åŒºåŒº5GBçš„å…è´¹ç©ºé—´æ¢äº†è°éƒ½ä¸å¤Ÿç”¨ï¼Œé™¤éèŠ±é’±ä¹°ã€‚é€€ä¸€æ­¥çš„æ–¹å¼ï¼Œå°±æ˜¯æŠŠæ•°æ®å¤‡ä»½åˆ°ç”µè„‘ä¸Šï¼Œä¸ç”¨èŠ±é’±ï¼Œä½†æ˜¯äºæˆ‘æ¥è®²ï¼Œæœ¬å°±ä¸å¤Ÿç”¨çš„ç”µè„‘å­˜å‚¨å·²ç»æ˜¯å¯¸åœŸå¯¸é‡‘ï¼Œæ²¡æœ‰å¤ªå¤šç©ºé—´åˆ†ç»™æ‰‹æœºå¤‡ä»½ã€‚æœ€çœé’±çš„æ–¹å¼ï¼Œå°±æ˜¯å•ç‹¬ä¹°å—ç§»åŠ¨ç¡¬ç›˜ï¼Œç°åœ¨çš„å¸‚åœºä»·ï¼Œ1TBçš„åœ¨300å—é’±ä¸Šä¸‹ï¼Œç›¸æ¯”ä¹‹ä¸‹å¾ˆåˆ’ç®—äº†ã€‚\n\n### åˆ†åŒº\nä¹Ÿå¯ä»¥ä¸åˆ†ã€‚\n\nåœ¨ç¡¬ç›˜ä¸Šåˆ†ä¸€å—å’Œæ‰‹æœºå¤§å°ç›¸å½“çš„åˆ†åŒºç”¨æ¥å¤‡ä»½æ‰‹æœºæ•°æ®ï¼Œå•ç‹¬ä¸€å—å‡ºæ¥çš„å¥½å¤„æ˜¯ï¼Œæ–¹ä¾¿æŠ¹é™¤æ•°æ®ï¼Œæ¯”æ‰‹åŠ¨åˆ é™¤ä¸çŸ¥é“å¿«äº†å¤šå°‘å€ã€‚\n\n### åˆ¶ä½œæ›¿èº«\nèƒ½æŠŠæ•°æ®å¤‡ä»½åˆ°å¤–æ¥è®¾å¤‡çš„åŸç†å°±æ˜¯ï¼ŒæŠŠé»˜è®¤çš„ç³»ç»Ÿç›®æ ‡ä½ç½®æ˜ å°„åˆ°ç§»åŠ¨ç¡¬ç›˜ä¸Šï¼Œå°±è¿™ä¹ˆä¸€ä¸ªæ“ä½œã€‚ç³»ç»Ÿé»˜è®¤çš„å¤‡ä»½ä½ç½®åœ¨\n```\n~/Library/Application\\ Support/MobileSync/Backup\n```\næŠŠè¿™ä¸ªBackupç›®å½•åˆ æ‰ï¼Œç„¶ååœ¨æ­¤åˆ¶ä½œä¸€ä¸ªåŒåçš„æ›¿èº«ï¼Œæ˜ å°„åˆ°ç§»åŠ¨ç¡¬ç›˜ã€‚åœ¨ç§»åŠ¨ç¡¬ç›˜ä¸Šåˆ›å»ºåŒåç›®å½•å³å¯ï¼š`MobileSync/Backup`ï¼Œç„¶åé“¾æ¥\n```\n$ ln -s /Volumes/{name_of_dish}/MobileSync/Backup ~/Library/Application\\ Support/MobileSync/Backup\n```\næ“ä½œå®Œæˆä¹‹åï¼Œç”µè„‘é‡Œçš„MobileSyncä¸‹å°±ä¼šå‡ºç°ä¸€ä¸ªæ›¿èº«Backupï¼ŒæŒ‡å‘å¤–æ¥ç¡¬ç›˜çš„Backupã€‚\n\nè¿™ä¸€æ­¥æ“ä½œå¯èƒ½éœ€è¦ç»™ç»ˆç«¯Appå¢åŠ è®¿é—®ç³»ç»Ÿå…¨ç›˜çš„æƒé™ï¼Œåœ¨ç³»ç»Ÿåå¥½è®¾ç½®ä¸­ã€å®‰å…¨æ€§ä¸éšç§çš„éšç§é‡Œï¼Œä¸ç„¶å¯èƒ½æ— æƒé™åœ¨MobileSyncä¸‹åˆ›å»ºæ›¿èº«\n\n### å¤‡ä»½\nè€ç‰ˆæœ¬çš„MacOSè¿˜æœ‰ä¸ªiTunesç”¨æ¥ç®¡ç†æ‰‹æœºçš„æ•°æ®ï¼Œå‡çº§åˆ°æœ€è¿‘çš„å‡ ä¸ªç‰ˆæœ¬åå°±å’ŒFinderåˆå¹¶äº†ï¼Œç›®å‰æœ€æ–°çš„æ˜¯Montereyã€‚æ’ä¸Šæ‰‹æœºï¼Œåœ¨Finderä¸­å°±èƒ½çœ‹åˆ°ï¼Œç„¶åå°±å¯ä»¥å¤‡ä»½äº†ã€‚\n","tags":["iPhone"],"categories":["MacOS"]},{"title":"Androidä¹‹äº‹ä»¶ä¼ é€’","url":"/2021/10/b897ec3baf06/","content":"\nè§¦æ‘¸äº‹ä»¶ï¼Œä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼ŒACTION_DOWNã€ACTION_MOVEå’ŒACTION_UPï¼Œåˆ†åˆ«æŒ‡ç‚¹å‡»ã€ç§»åŠ¨å’ŒæŠ¬èµ·ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ¥è¯´ä¸€è¯´ä¸€ä¸ªäº‹ä»¶äº§ç”Ÿä¹‹åï¼Œåœ¨æ§ä»¶é—´çš„ä¼ é€’ã€‚\n\n<!--more-->\nä¸å…¶è¯´æ˜¯äº‹ä»¶ä¼ é€’ï¼Œä¸å¦‚è¯´æ˜¯äº‹ä»¶åºåˆ—çš„ä¼ é€’ã€‚ä¸€ä¸ªäº‹ä»¶åºåˆ—ï¼Œæ˜¯ç”±ä¸€ä¸ªACTION_DOWNå’Œä¸€ä¸ªACTION_UPç»„æˆï¼Œä¸­é—´å¯èƒ½åŒ…å«0ä¸ªè‡³å¤šä¸ªACTION_MOVEäº‹ä»¶ã€‚æ‰‹æŒ‡æŒ‰ä¸‹æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªACTION_DOWNäº‹ä»¶ï¼Œæ‰‹æŒ‡æŠ¬èµ·æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªACTION_UPäº‹ä»¶ï¼Œå¦‚æœæŒ‰ä¸‹å’ŒæŠ¬èµ·çš„ä½ç½®åç§»è¶…è¿‡ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼ï¼Œä¾¿ä¼šäº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªACTION_MOVEäº‹ä»¶ï¼Œè¿™ä¾¿æ˜¯ä¸€ä¸ªäº‹ä»¶åºåˆ—ã€‚\n\näº‹ä»¶åºåˆ—ï¼Œæ˜¯æŒ‰ç…§è§†å›¾æ ‘ç”±æ ¹åˆ°æå¶çš„é¡ºåºä¼ é€’çš„ï¼Œæ„æ€å°±æ˜¯è¯´ï¼Œæœ€å¤–å±‚çš„Viewæˆ–ViewGroupæœ€å…ˆæ¥æ”¶åˆ°äº‹ä»¶ï¼Œç„¶åå‘å†…ä¼ é€’ã€‚å…¶ä¸­äº‹ä»¶æµç»çš„æ§ä»¶ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼šViewGroupå’ŒViewã€‚\n\n### ViewGroup\nViewGroupæ˜¯Viewçš„å­ç±»ï¼Œå…¶ä¸­æœ‰3ä¸ªå’Œäº‹ä»¶ç›¸å…³çš„æ–¹æ³•ï¼šdispatchTouchEventã€onInterceptTouchEventå’ŒonTouchEventï¼Œåˆ†åˆ«æ˜¯åˆ†å‘äº‹ä»¶ã€æ‹¦æˆªäº‹ä»¶å’Œå¤„ç†äº‹ä»¶ã€‚\n\nç®€å•æ¥è¯´å°±æ˜¯ï¼Œç³»ç»Ÿé€šè¿‡dispatchTouchEventæ–¹æ³•å°†äº‹ä»¶ä¼ å…¥ï¼Œåœ¨dispatchTouchEventå†…æ ¹æ®onInterceptTouchEventæ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªè¯¥äº‹ä»¶ï¼Œå¦‚æœæ‹¦æˆªäº†ï¼Œåˆ™ä¸å†å°†å…¶æ²¿ç€è§†å›¾æ ‘å‘å†…ä¼ é€’ï¼›å¦‚æœæ‹¦æˆªï¼Œåˆ™æ ¹æ®onTouchEventæ–¹æ³•æ¥åˆ¤è¯»æ˜¯å¦å¤„ç†ï¼Œå¦‚æœå¤„ç†äº†ï¼Œåˆ™è¡¨ç¤ºæ¶ˆè´¹äº†è¯¥äº‹ä»¶ã€‚\n\n### View\nViewæ²¡æœ‰onInterceptTouchEventï¼Œå› ä¸ºViewæ— å­Viewï¼Œæ˜¯åœ¨è§†å›¾æ ‘çš„æœ€å†…å±‚äº†ï¼Œä¸éœ€è¦æ‹¦æˆªã€‚å½“äº‹ä»¶é€šè¿‡dispatchTouchEventä¼ å…¥ï¼Œæ ¹æ®onTouchEventæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ¶ˆè´¹ã€‚\n\n### äº‹ä»¶æµè½¬\nå› ä¸ºäº‹ä»¶éƒ½æ˜¯ä»¥äº‹ä»¶åºåˆ—çš„å½¢å¼ä¼ é€’çš„ï¼Œå•ç‹¬çœ‹æŸä¸ªäº‹ä»¶æ„ä¹‰ä¸å¤§ï¼Œè¿™é‡Œåˆ†æäº‹ä»¶åºåˆ—ï¼Œå…ˆçœ‹ACTION_DOWNäº‹ä»¶ï¼Œè¿™é‡Œçš„å‘å†…å’Œå‘å¤–éƒ½æ˜¯é’ˆå¯¹è§†å›¾æ ‘çš„ç»“æ„è€Œè¨€çš„ã€‚\n```shell\n// è§†å›¾æ ‘\nDecorView\n|-FrameLayout\n|-TextView\n|-LinearLayout\n  |-ImageView\n  |-FrameLayout\n```\n\n1. å‘å†…åˆ†å‘ACTION_DOWN\n- ViewGroupæ¥æ”¶åˆ°äº‹ä»¶åï¼Œä¼šæ ¹æ®onInterceptTouchEventæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªï¼Œå¦‚æœæ‹¦æˆªï¼Œåˆ™æ ¹æ®onTouchEventæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ¶ˆè´¹äº‹ä»¶ã€‚\n- Viewæ¥æ”¶åˆ°äº‹ä»¶åï¼Œæ ¹æ®onTouchEventæ–¹æ³•åˆ¤æ–­æ˜¯å¦æ¶ˆè´¹äº‹ä»¶ã€‚\n- å¦‚æœViewGroupæ²¡æœ‰æ‹¦æˆªäº‹ä»¶ï¼Œåˆ™æ ¹æ®åæ ‡ï¼Œä¾æ¬¡éå†è¯¥äº‹ä»¶å‘½ä¸­çš„å­View/ViewGroupï¼Œé‡å¤ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹\n- å½“äº‹ä»¶è¢«æ‹¦æˆªï¼Œæˆ–è€…ä¼ é€’åˆ°è§†å›¾æ ‘æœ€å†…å±‚æ—¶ï¼Œä¾¿ä¸ä¼šç»§ç»­å‘å†…ä¼ é€’ï¼Œè½¬è€Œå¼€å§‹å›ä¼ ã€‚\n\n2. å‘å¤–å›ä¼ ACTION_DOWN\n- äº‹ä»¶å›ä¼ ï¼Œä¼ é€’çš„æ˜¯dispatchTouchEventæ–¹æ³•çš„è¿”å›å€¼ï¼Œtrue/false\n- å¦‚æœå›ä¼ çš„falseï¼Œçˆ¶ViewGroupçš„onTouchEventæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå¯ç†è§£ä¸ºæœ¬ç€äº‹ä»¶ä¸æµªè´¹çš„åŸåˆ™ï¼Œæ—¢ç„¶å­è§†å›¾éƒ½æ²¡æ¶ˆè´¹ï¼Œé‚£ä¹ˆå°±çœ‹çœ‹è‡ªå·±æ˜¯å¦å¯ä»¥æ¶ˆè´¹æ‰\n- å¦‚æœå›ä¼ åˆ°è§†å›¾æ ¹æ—¶ï¼Œä¾ç„¶æ˜¯falseï¼Œè¡¨ç¤ºæ²¡æœ‰å­è§†å›¾æ¶ˆè´¹ACTION_DOWNäº‹ä»¶ï¼Œåˆ™è¯¥åºåˆ—çš„åç»­äº‹ä»¶ä¸å†å‘å†…ä¼ é€’ï¼Œéƒ½ç”±æ ¹è§†å›¾å¤„ç†\n\n3. äº‹ä»¶åºåˆ—çš„åç»­äº‹ä»¶\n- ç³»ç»Ÿæœ¬ç€ä¸€ä¸ªäº‹ä»¶åºåˆ—åªç”±ä¸€ä¸ªè§†å›¾å¤„ç†çš„åŸåˆ™\n- åç»­äº‹ä»¶éƒ½å°†ä¼ é€’è‡³æ¶ˆè´¹æ‰ACTION_DOWNäº‹ä»¶çš„ViewGroup/Viewï¼Œä¸”åœ¨dispatchTouchEventå†…ç›´æ¥è°ƒç”¨onTouchEventï¼Œä¸ç»è¿‡onInterceptTouchEventæ–¹æ³•ï¼Œå¦‚æœæœ‰çš„è¯\n- å½“ç„¶ï¼Œåç»­äº‹ä»¶åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥è¢«æ‹¦æˆªå’Œæ¶ˆè´¹ï¼Œä½†ä¸å»ºè®®è¿™ä¹ˆåšï¼Œæ¯”å¦‚ä¸€ä¸ªæŒ‰é’®åªæ¥æ”¶äº†ä¸€ä¸ªæŒ‰ä¸‹äº‹ä»¶ï¼Œåˆ™åœ¨é€»è¾‘ä¸Šå¯èƒ½ä¼šä¸å®Œæ•´\n- åç»­äº‹ä»¶åœ¨å›ä¼ æ—¶ï¼Œå³ä¾¿æ˜¯falseï¼Œçˆ¶ViewGroupçš„onTouchEventä¹Ÿä¸ä¼šè¢«è°ƒç”¨ï¼Œå› è¿™ä¸ç¬¬ä¸€ç‚¹ç›¸æ‚–\n\n### æ ¹è§†å›¾\næ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼ŒDecorViewæ˜¯æˆ‘ä»¬çœ‹åˆ°çš„è§†å›¾çš„æ ¹ï¼Œå®ƒç»§æ‰¿è‡ªFrameLayoutï¼Œæ˜¯ä¸€ä¸ªViewGroupï¼Œæ‰€ä»¥å®ƒæœ‰3ä¸ªå’Œäº‹ä»¶ç›¸å…³çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼ŒActivityå¯¹åº”ä¸€ä¸ªPhoneWindowï¼ŒPhoneWindowå¯¹åº”ä¸€ä¸ªDecorViewï¼Œæ‰€ä»¥åœ¨äº‹ä»¶åºåˆ—äº§ç”Ÿçš„æ—¶å€™ï¼Œæœ€æ–°æ¥æ”¶åˆ°çš„æ˜¯DecorViewã€‚\n\næ ¹æ®æºç ï¼ŒDecorViewå°†äº‹ä»¶è½¬ç»™äº†Window.Callbackï¼Œè¿™ä¸ªCallbackæ˜¯Windowåœ¨Activityä¸­åˆå§‹åŒ–æ—¶ä¼ å…¥çš„ï¼Œå°±æ˜¯Activityæœ¬èº«ï¼ŒActivityå®ç°äº†Callbackæ¥å£ï¼Œå³ï¼Œåœ¨DecorViewä¸­è°ƒç”¨äº†Activityçš„dispatchTouchEventã€‚\n\nActivityçš„dispatchTouchEventæ–¹æ³•ä¸­ï¼Œå…ˆå°†äº‹ä»¶ä¼ ç»™äº†Windowçš„superDispatchTouchEventæ–¹æ³•ï¼Œè‹¥æ²¡æ¶ˆè´¹ï¼Œå†è°ƒç”¨è‡ªå·±çš„onTouchEventã€‚è€ŒWindowçš„superDispatchTouchEventå¾ˆç®€å•ï¼Œå°±æ˜¯ç›´æ¥è°ƒç”¨äº†DecorViewçš„superDispatchTouchEventï¼Œæœ€ç»ˆè°ƒç”¨äº†ViewGroupçš„dispatchTouchEventæ–¹æ³•ã€‚\n\næ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼ŒDecorViewå°†äº‹ä»¶è½¬ç»™äº†Activityï¼Œåœ¨Activityçš„dispatchTouchEventæ–¹æ³•ä¸­åˆ¤æ–­ï¼Œè‹¥DecorViewæ²¡æœ‰æ¶ˆè´¹ï¼Œåˆ™äº¤ç»™Activityçš„onTouchEventã€‚\n\næ‰€ä»¥ï¼Œä»å¤„ç†äº‹ä»¶é¡ºåºæ¥çœ‹ï¼ŒçœŸå®çš„äº‹ä»¶æµè½¬é¡ºåºåº”è¯¥æ˜¯ï¼šActivity -> DecorView -> ... -> DecorView -> Activityã€‚\n\n```java\n// DecorView.java\n@Override\npublic boolean dispatchTouchEvent(MotionEvent ev) {\n    final Window.Callback cb = mWindow.getCallback();\n    return cb != null && !mWindow.isDestroyed() && mFeatureId < 0\n            ? cb.dispatchTouchEvent(ev) : super.dispatchTouchEvent(ev);\n}\n\n// Activity.java\nfinal void attach(Context context, ActivityThread aThread,\n            Instrumentation instr, IBinder token, int ident,\n            Application application, Intent intent, ActivityInfo info,\n            CharSequence title, Activity parent, String id,\n            NonConfigurationInstances lastNonConfigurationInstances,\n            Configuration config, String referrer, IVoiceInteractor voiceInteractor,\n            Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) {\n\tmWindow = new PhoneWindow(this, window, activityConfigCallback);\n    mWindow.setWindowControllerCallback(mWindowControllerCallback);\n    mWindow.setCallback(this);\n}\n\npublic boolean dispatchTouchEvent(MotionEvent ev) {\n    if (ev.getAction() == MotionEvent.ACTION_DOWN) {\n    \t// åœ¨Activityä¸­å¯ä»¥é‡å†™è¯¥æ–¹æ³•ï¼Œæ¥ç›‘å¬ç”¨æˆ·çš„æ“ä½œ\n        onUserInteraction();\n    }\n    if (getWindow().superDispatchTouchEvent(ev)) {\n        return true;\n    }\n    return onTouchEvent(ev);\n}\n\n// PhoneWindow.java\npublic boolean superDispatchTouchEvent(MotionEvent event) {\n    return mDecor.superDispatchTouchEvent(event);\n}\n```\n\n### æ€»ç»“\n1. å°†äº‹ä»¶ä¼ é€’åˆ†ä¸ºå‘å†…åˆ†å‘å’Œå‘å¤–å›ä¼ ä¸¤ä¸ªè¿‡ç¨‹æ›´ä¾¿äºç†è§£ï¼Œè¿™é‡Œçš„å‘å†…å’Œå‘å¤–éƒ½æ˜¯é’ˆå¯¹è§†å›¾æ ‘çš„ç»“æ„è€Œè¨€çš„ã€‚\n2. å‘å†…åˆ†å‘è¿‡ç¨‹ä¸­ï¼Œäº‹ä»¶ä¸€æ—¦è¢«æ‹¦æˆªï¼Œæˆ–è€…ä¼ åˆ°äº†æœ€å†…å±‚ï¼Œä¾¿ä¼šå¼€å§‹å›ä¼ äº‹ä»¶çš„æ¶ˆè´¹ç»“æœï¼Œä¹Ÿå°±æ˜¯å…¥å£dispatchTouchEventæ–¹æ³•çš„ç»“æœ\n3. å½“å›ä¼ ç»“æœæ˜¯falseï¼Œä¸”äº‹ä»¶æ˜¯åºåˆ—äº‹ä»¶çš„å¤´äº‹ä»¶ACTION_DOWNæ—¶ï¼Œä¼šè°ƒç”¨çˆ¶ViewGroupçš„onTouchEventæ¥å°è¯•æ¶ˆè´¹äº‹ä»¶\n4. ç³»ç»Ÿæœ¬ç€ä¸€ä¸ªäº‹ä»¶åºåˆ—åªäº¤ç»™ä¸€ä¸ªView/ViewGroupæ¥å¤„ç†çš„åŸåˆ™\n\n### æ‰©å±•ä¹‹æ»‘åŠ¨å†²çª\nå½“åœ¨åˆ—è¡¨å†…éƒ¨å†…åµŒå¯æ»‘åŠ¨è§†å›¾æ—¶ï¼Œå†…éƒ¨çš„å¯æ»‘åŠ¨è§†å›¾å¸¸å¸¸ç›‘å¬ä¸åˆ°æ»‘åŠ¨äº‹ä»¶ï¼Œè¿™æ˜¯å› ä¸ºåˆ—è¡¨ä½œä¸ºå†…åµŒè§†å›¾çš„çˆ¶ViewGroupä¼šæ‹¦æˆªæ»‘åŠ¨äº‹ä»¶ï¼Œæ‰€ä»¥å†…éƒ¨è‡ªç„¶æ„ŸçŸ¥ä¸åˆ°ã€‚æ¯”è¾ƒå¥½çš„ä½“éªŒæ˜¯ï¼Œå†…éƒ¨å¯æ»‘åŠ¨è§†å›¾å‘ä¸Šæ»‘åŠ¨åˆ°é¡¶æ—¶ï¼Œåç»­çš„æ»‘åŠ¨äº‹ä»¶äº¤ç»™çˆ¶åˆ—è¡¨å¤„ç†ï¼Œè®©çˆ¶åˆ—è¡¨æ»‘åŠ¨æ¥å“åº”ç”¨æˆ·çš„æ»‘åŠ¨æ“ä½œï¼›å½“å†…éƒ¨è§†å›¾å‘ä¸‹æ»‘åŠ¨åˆ°åº•æ—¶ï¼Œåç»­çš„æ»‘åŠ¨äº‹ä»¶ä¹Ÿæ˜¯äº¤ç»™çˆ¶åˆ—è¡¨å¤„ç†ï¼Œè®©çˆ¶åˆ—è¡¨æ»‘åŠ¨ä¸ªæ¥å“åº”ç”¨æˆ·æ€¼æ»‘åŠ¨æ“ä½œã€‚\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¿…é¡»è¦è®©äº‹ä»¶åºåˆ—ä¼ åˆ°æœ€å†…å±‚ï¼Œæ ¹æ®ä¸Šé¢å†…å®¹å¯ä»¥çŸ¥é“ï¼Œè¦æƒ³è®©äº‹ä»¶åºåˆ—ä¼ åˆ°å†…éƒ¨ï¼Œé‚£ä¹ˆACTION_DOWNäº‹ä»¶å°±è¦äº¤ç»™å†…éƒ¨è§†å›¾æ¥å¤„ç†ã€‚\n\nå†çœ‹åç»­äº‹ä»¶ï¼Œä½œä¸ºå†…éƒ¨è§†å›¾çš„çˆ¶è§†å›¾ï¼Œåç»­çš„æ¯ä¸€ä¸ªäº‹ä»¶åœ¨ä¼ åˆ°å†…éƒ¨è§†å›¾ä¹‹å‰ï¼Œéƒ½ä¼šæµç»å¤–éƒ¨çš„åˆ—è¡¨ï¼Œå› æ­¤ï¼Œå°±æœ‰ä¸¤ç§æ–¹å¼æ¥å¤„ç†åç»­äº‹ä»¶\n- ç”±çˆ¶è§†å›¾æ¥åˆ¤æ–­å½“å‰äº‹ä»¶æ˜¯ç”±è‡ªå·±æ¶ˆè´¹ï¼Œè¿˜æ˜¯äº¤ç»™å†…éƒ¨è§†å›¾æ¶ˆè´¹\n- ç”±å†…éƒ¨è¯•å›¾æ¥åˆ¤æ–­å½“å‰äº‹ä»¶æ˜¯ç”±è‡ªå·±æ¶ˆè´¹ï¼Œè¿˜æ˜¯è®©çˆ¶è§†å›¾æ¶ˆè´¹\n\nç¬¬ä¸€ç§æ¯”è¾ƒç®€å•ï¼Œåœ¨çˆ¶è§†å›¾å†…å¯¹ACTION_DOWNä¹‹å¤–çš„åç»­äº‹ä»¶åˆ¤æ–­ï¼Œéœ€è¦åˆ™æ‹¦æˆªï¼Œä¸éœ€è¦åˆ™é€šè¿‡ï¼›\n\né€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å­è§†å›¾ä¸­ï¼Œæ˜¯å¯ä»¥æ§åˆ¶çˆ¶è§†å›¾æ˜¯å¦å¯ä»¥æ‹¦æˆªäº‹ä»¶çš„ï¼Œæ‰€ä»¥ä¸Šè¿°çš„ç¬¬äºŒç§æ–¹å¼ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚å†…éƒ¨è§†å›¾åœ¨æ”¶åˆ°ACTION_DOWNäº‹ä»¶åï¼Œé€šè¿‡`parent.requestDisallowInterceptTouchEvent(true)`æ¥ç¦æ­¢çˆ¶è§†å›¾æ‹¦æˆªäº‹ä»¶ï¼Œå½“è‡ªå·±ä¸å†éœ€è¦åç»­äº‹ä»¶æ—¶ï¼Œé€šè¿‡`parent.requestDisallowInterceptTouchEvent(false)`æ¥è®©çˆ¶è§†å›¾æ‹¦æˆªå¤„ç†åé¢çš„æ»‘åŠ¨äº‹ä»¶ï¼Œæ¥å“åº”ç”¨æˆ·çš„æ“ä½œå³å¯ã€‚\n\n```java\n// ViewGroup.java\n// Check for interception.\n@Override\npublic boolean dispatchTouchEvent(MotionEvent ev) {\n\t....\n\t// Check for interception. åˆ¤æ–­æ˜¯å¦æ‹¦æˆª\n    final boolean intercepted;\n    if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) {\n    \t// å½“è®¾ç½®äº†FLAG_DISALLOW_INTERCEPTæ—¶ï¼Œåˆ™ç›´æ¥ä¸æ‹¦æˆªäº‹ä»¶\n    \t// æ²¡æœ‰è®¾ç½®FLAG_DISALLOW_INTERCEPTæ—¶ï¼Œæ‰ä¼šå»è°ƒç”¨onInterceptTouchEventæ¥åˆ¤æ–­\n    \t// FLAG_DISALLOW_INTERCEPTé€šè¿‡requestDisallowInterceptTouchEventæ¥è®¾ç½®\n        final boolean disallowIntercept = (mGroupFlags & FLAG_DISALLOW_INTERCEPT) != 0;\n        if (!disallowIntercept) {\n            intercepted = onInterceptTouchEvent(ev);\n            ev.setAction(action); // restore action in case it was changed\n        } else {\n            intercepted = false;\n        }\n    } else {\n    \t// å½“ä¸æ˜¯ACTION_DOWNäº‹ä»¶ï¼Œä¸”ACTION_DOWNæ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ç›´æ¥æ‹¦æˆªï¼Œä¸å†å‘å†…åˆ†å‘\n        // There are no touch targets and this action is not an initial down\n        // so this view group continues to intercept touches.\n        intercepted = true;\n    }\n}\n```","tags":["Android","TouchEvent"],"categories":["Android"]},{"title":"Activityã€Windowå’ŒDecorViewçš„å…³ç³»","url":"/2021/09/dab1a10731eb/","content":"\nåœ¨Androidçš„è§†å›¾æ¡†æ¶ä½“ç³»ï¼Œä¸»è¦ç”±è¿™ä¸‰è€…ç»„æˆã€‚\n\n### å‰è¨€\næˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ¥è§¦çš„æœ€å¤šçš„æ˜¯Activityï¼Œè‡³äºWindowå’ŒDecorViewé‡åˆ°çš„æ—¶å€™ä¾¿ä¼šç›¸å¯¹å°‘ä¸€äº›ã€‚è™½ç„¶ä¸å¸¸ç”¨ï¼Œä½†å¦‚æœèƒ½å˜æ¸…å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç†è§£Androidç³»ç»Ÿçš„æ¡†æ¶ä½“ç³»è®¾è®¡ã€‚\n\n<!--more-->\n\n### Window\nä»å­—é¢ä¸Šçœ‹ï¼Œä¸€ä¸ªWindowå°±æ˜¯ä¸€ä¸ªçª—å£ï¼Œå¯¹åº”çš„ç±»å‹æœ‰å¤šç§ï¼ŒæŒ‰ç…§å±‚çº§åˆ†ä¸º3ç§ï¼šActivityçš„Windowã€å­Windowå’Œç³»ç»ŸWindowã€‚\n\nWindowæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ç°ç±»ï¼Œå³å¸¸è¯´çš„PhoneWindowï¼Œæ‰€ä»¥ï¼Œæ‰€ç”¨åˆ°çš„Windowå®ä¾‹ï¼Œå®é™…ä¸Šç±»å‹éƒ½æ˜¯PhoneWindowã€‚\n\n\n### DecorView\nDecorViewç»§æ‰¿è‡ªFrameLayoutï¼Œæ‰©å±•äº†ä¸€äº›è‡ªå·±çš„åŠŸèƒ½æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDecorViewä¼šå‘è‡ªå·±å†…éƒ¨æ·»åŠ ä¸€ä¸ªLinearLayoutä¸ºæ ¹èŠ‚ç‚¹çš„layoutæ–‡ä»¶ï¼Œè¿™ä¸ªLinearLayoutæœ‰ä¸¤ä¸ªå­Viewï¼Œä¸€ä¸ªæ˜¯ActionBarï¼Œä¸€ä¸ªæ˜¯IDä¸º`@android:id/content`çš„FrameLayoutï¼Œæˆ‘ä»¬åœ¨Activityé‡Œè°ƒç”¨setContentViewæ—¶ï¼Œå°±æ˜¯æŠŠæˆ‘ä»¬å†™çš„å¸ƒå±€æ–‡ä»¶ï¼Œä½œä¸ºå­Viewæ·»åŠ åˆ°è¿™ä¸ªFrameLayoutä¸‹\n```sh\nDecorView\n|--LinearLayout\n   |--ActionBar\n   |--FrameLayout\n```\n\n\n### ä¸‰è€…å…³ç³»\nActivityä¸­æŒæœ‰ä¸€ä¸ªWindowçš„å®ä¾‹ï¼Œåœ¨Activity.onAttachä¸­è¢«åˆå§‹åŒ–ï¼›Windowä¸­æŒæœ‰ä¸€ä¸ªDecorViewå®ä¾‹ï¼ŒDecorViewå°±æ˜¯æˆ‘ä»¬æ‰€çœ‹åˆ°çš„è§†å›¾çš„æ ¹è§†å›¾\n```sh\nActivity\n|--PhoneWindow\n   |--DecorView\n      |--LinearView\n         |--ActionBar\n         |--FrameLayout\n```\n\nåœ¨è¿™ä¸ªè§†å›¾æ¡†æ¶ä¸­ï¼ŒActivityå¤„åœ¨æœ€å¤–å±‚çš„ä½ç½®ï¼Œè¡¨é¢ä¸Šï¼Œæˆ‘ä»¬çš„å¾ˆå¤šäº¤äº’éƒ½æ˜¯åœ¨å’ŒActivityè¿›è¡Œï¼Œä½†Activityå†…éƒ¨ä¼šè°ƒç”¨Windowï¼ŒWindowå†…éƒ¨ä¼šè°ƒç”¨DecorViewï¼Œæœ€ç»ˆå®Œæˆæˆ‘ä»¬çš„è°ƒç”¨ã€‚\n\n\n### ä¸€ä¸ªé¡µé¢çš„æ˜¾ç¤ºè¿‡ç¨‹\nä¼—æ‰€å‘¨çŸ¥ï¼Œè¦åœ¨Activityé‡Œæ˜¾ç¤ºä¸€ä¸ªé¡µé¢ï¼Œé€šå¸¸æ˜¯åœ¨onCreateå›è°ƒé‡Œè°ƒç”¨setContentViewæ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹ä¸€çœ‹ä»è®¾ç½®ï¼Œåˆ°æœ€ç»ˆæ˜¾ç¤ºå‡ºæ¥ï¼Œéƒ½ç»è¿‡äº†å“ªäº›æµç¨‹\n\n1. é¦–å…ˆï¼Œåœ¨Activity.setContentViewé‡Œæ²¡æœ‰åšä»€ä¹ˆäº‹æƒ…ï¼Œè€Œæ˜¯ç›´æ¥å°†è°ƒç”¨è½¬ç»™äº†PhoneWindow\n```java\n// Activity.java\npublic void setContentView(@LayoutRes int layoutResID) {\n    getWindow().setContentView(layoutResID);\n    initWindowDecorActionBar();\n}\n\npublic Window getWindow() {\n    return mWindow;\n}\n```\n\n2. mWindowå³ä¸ºPhoneWindowçš„å®ä¾‹ï¼Œå®ƒæ˜¯åœ¨Activity.attachæ–¹æ³•é‡Œåˆå§‹åŒ–çš„ï¼Œattachæ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨ActivityThreadåˆ›å»ºActivityæ—¶è°ƒç”¨ï¼Œè¦æ—©äºonCreateï¼Œæ‰€ä»¥åœ¨onCreateè¢«è°ƒç”¨æ—¶ï¼ŒmWindowå·²ç»åˆå§‹åŒ–\n```java\n// ActivityThread.java\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n    // 1. åˆ›å»ºActivity\n    Activity activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n    // 2. è°ƒç”¨Activity.attach\n    activity.attach(appContext, this, getInstrumentation(), r.token,\n                    r.ident, app, r.intent, r.activityInfo, title, r.parent,\n                    r.embeddedID, r.lastNonConfigurationInstances, config,\n                    r.referrer, r.voiceInteractor, window, r.configCallback,\n                    r.assistToken);\n    // 3. è°ƒç”¨Activity.onCreate\n    mInstrumentation.callActivityOnCreate(activity, r.state);\n}\n\n// Activity.java\nfinal void attach(Context context, ActivityThread aThread,\n        Instrumentation instr, IBinder token, int ident,\n        Application application, Intent intent, ActivityInfo info,\n        CharSequence title, Activity parent, String id,\n        NonConfigurationInstances lastNonConfigurationInstances,\n        Configuration config, String referrer, IVoiceInteractor voiceInteractor,\n        Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) {\n    // ç”¨PhoneWindowåˆå§‹åŒ–mWindowå˜é‡\n    mWindow = new PhoneWindow(this, window, activityConfigCallback);\n    mWindow.setWindowControllerCallback(mWindowControllerCallback);\n    mWindow.setCallback(this);\n    mWindow.setOnWindowDismissedCallback(this);\n    mWindow.getLayoutInflater().setPrivateFactory(this);\n}\n```\n\n3. å›åˆ°PhoneWindowï¼Œåœ¨Activityé‡Œè°ƒç”¨setContentViewåï¼Œä¼šè°ƒç”¨PhoneWindowçš„setContentViewæ–¹æ³•ï¼Œæ ¹æ®ä¸Šé¢çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼ŒPhoneWindowä¸­æœ‰ç±»å‹ä¸ºDecorViewçš„å˜é‡ï¼Œåå­—ä¸ºmDecorï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„é¡µé¢æœ€ç»ˆä¼šæœ€ä¸ºå­Viewæ·»åŠ åˆ°DecorViewä¸‹çš„LinearLayoutä¸‹çš„IDä¸º`@android:id/content`çš„FrameLayouté‡Œé¢ã€‚\n\nåœ¨PhoneWindowé‡Œï¼Œè¿™ä¸ªFrameLayoutç”¨å˜é‡mContentParentä¿å­˜ï¼Œæ‰€ä»¥åœ¨PhoneWindowçš„setContentViewé‡Œï¼Œä¼šå…ˆæ£€æŸ¥mContentParentæ˜¯éƒ½å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™å»æ£€æŸ¥mDecoræ˜¯å¦åˆå§‹åŒ–ï¼Œå› ä¸ºmContentParentæ˜¯mDecorä¸­çš„å…ƒç´ ï¼Œæœ‰äº†mDecoræ‰èƒ½åˆå§‹åŒ–mContentParentã€‚\n\nå¦‚æœmContentParentå­˜åœ¨ï¼Œåˆ™ä¼šå°†æˆ‘ä»¬è®¾ç½®çš„viewæ·»åŠ ä¸ºå®ƒçš„å­viewã€‚\n\nåœ¨å®˜æ–¹çš„è®¾è®¡é‡Œï¼Œæ ¹è§†å›¾DecorViewæ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œä¸€ä¸ªæ˜¯ä¸Šé¢çš„ActionBarï¼Œä¸€ä¸ªæ˜¯ä¸­é—´çš„å†…å®¹åŒºContentï¼Œå³mContentParentï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬setContentViewæ˜¯åœ¨è®¾ç½®ä¸­é—´å†…å®¹åŒºçš„å†…å®¹ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬ä¸éœ€è¦ActionBarï¼Œä¼šåœ¨ä¸»é¢˜Themeé‡Œä½¿ç”¨NO_ACTION_BARçš„ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰å…¶ä»–çš„è®¾å®šï¼Œæ¯”å¦‚éœ€è¦ToolBarç­‰ã€‚\n\nç³»ç»Ÿä¸­æœ‰ä¸€äº›é»˜è®¤çš„layoutæ–‡ä»¶ï¼Œåœ¨åˆå§‹åŒ–mContentParentæ—¶ï¼Œä¼šæ ¹æ®æˆ‘ä»¬è®¾å®šçš„ä¸åŒçš„Themeï¼Œä»¥åŠä¸åŒçš„FEATUREï¼Œæ¥é€‰å¯¹åº”çš„layoutæ–‡ä»¶ï¼ŒåŠ è½½åˆ°mDecorä¸­ï¼Œä¸€èˆ¬æ¥è¯´è¿™äº›å¸ƒå±€æ–‡ä»¶ä¸­ä¼šæœ‰ä¸€ä¸ªIDä¸º`@android:id/content`çš„FrameLayoutï¼Œä¹Ÿå°±æ˜¯mContentParentã€‚\n\nä½†æ˜¯ï¼Œåœ¨å®é™…æƒ…å†µä¸­ï¼Œè¿˜ä¼šæœ‰ä¸€äº›å¤æ‚çš„æƒ…å†µï¼Œæ¯”å¦‚è®¾ç½®äº†è½¬åœºåŠ¨ç”»ç­‰ç­‰ï¼Œä»¥åŠç°åœ¨çš„AppCompatActivityï¼Œä¸ºäº†å…¼å®¹æ–°ç‰ˆSDKçš„ä¸€äº›åŠŸèƒ½è®¾è®¡ï¼Œåœ¨DecorViewçš„åŸºç¡€ä¸Šæ·»åŠ äº†åŒæ ·è®¾è®¡çš„SubDecorViewï¼Œç”¨SubDecorViewæ¥å¡«å……DecorViewçš„mContentParentï¼Œæˆ‘ä»¬é€šè¿‡setContentViewè®¾ç½®çš„Viewæœ€ç»ˆä¼šå¡«å……åˆ°SubDecorViewçš„mContentParentä¸­ï¼Œå…·ä½“è¿™é‡Œå°±ä¸åšå±•å¼€è¯´æ˜äº†ã€‚\n\nä¸‹é¢çœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹åº”çš„ä¸€äº›æºç \n```java\n// PhoneWindow.java\npublic void setContentView(int layoutResID) {\n    // Note: FEATURE_CONTENT_TRANSITIONS may be set in the process of installing the window\n    // decor, when theme attributes and the like are crystalized. Do not check the feature\n    // before this happens.\n    if (mContentParent == null) {\n        // 1. å¦‚æœä¸ºç©ºï¼Œåˆ™å»åˆå§‹åŒ–DocerViewï¼ŒåŒæ—¶ä¹Ÿä¼šåˆå§‹åŒ–mContentParent\n        installDecor();\n    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        mContentParent.removeAllViews();\n    }\n    // å¦‚æœæœ‰è½¬åœºåŠ¨ç”»ï¼Œåˆ™é€šè¿‡Sceneæ¥è¾…åŠ©ï¼Œæ²¡æœ‰åˆ™å°†viewæ·»åŠ åˆ°mContentParentä¸­\n    if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        final Scene newScene = Scene.getSceneForLayout(mContentParent, layoutResID,\n                getContext());\n        transitionTo(newScene);\n    } else {\n        mLayoutInflater.inflate(layoutResID, mContentParent);\n    }\n    mContentParent.requestApplyInsets();\n    final Callback cb = getCallback();\n    if (cb != null && !isDestroyed()) {\n        cb.onContentChanged();\n    }\n    mContentParentExplicitlySet = true;\n}\n\nprivate void installDecor() {\n    mForceDecorInstall = false;\n    if (mDecor == null) {\n        // å…ˆç”ŸæˆDecorView\n        mDecor = generateDecor(-1);\n        mDecor.setDescendantFocusability(ViewGroup.FOCUS_AFTER_DESCENDANTS);\n        mDecor.setIsRootNamespace(true);\n        if (!mInvalidatePanelMenuPosted && mInvalidatePanelMenuFeatures != 0) {\n            mDecor.postOnAnimation(mInvalidatePanelMenuRunnable);\n        }\n    } else {\n        mDecor.setWindow(this);\n    }\n    if (mContentParent == null) {\n        // å†ä»mDecorä¸­æ‰¾åˆ°mContentParentï¼Œè¿™ä¸ªæ–¹æ³•ä¸‹é¢å•ç‹¬è¯´\n        mContentParent = generateLayout(mDecor);\n    }\n}\n\n// åˆ›å»ºDocorView\nprotected DecorView generateDecor(int featureId) {\n    ...\n    return new DecorView(context, featureId, this, getAttributes());\n}\n\n```\n\nmContentParentæ˜¯åœ¨generateLayoutæ–¹æ³•ä¸­åˆ›å»ºçš„ï¼Œè¿™ä¸ªæ–¹æ³•å¾ˆé•¿ï¼Œè¶³è¶³å†™äº†ä¸‰ç™¾å¤šè¡Œã€‚å…¶ä¸­å¤§è‡´åšäº†è¿™å‡ ä»¶äº‹ï¼š\n\nç¬¬ä¸€æ­¥ï¼Œè·å–WindowStyleï¼Œç±»å‹æ˜¯TypedArrayï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç»™Activityè®¾ç½®çš„Themeä¸­çš„å±æ€§æ˜¯ç›¸å¯¹åº”çš„ï¼Œåœ¨è¿™é‡Œé€šè¿‡R.styleable.Window_æ¥è¯»å–ï¼Œå¦‚æœå†™è¿‡è‡ªå®šä¹‰æ§ä»¶çš„è¯ï¼Œå¯¹è¿™ç§è¯»å–å±æ€§çš„æ–¹å¼ä¸€å®šä¸é™Œç”Ÿ\n\nç¬¬äºŒæ­¥ï¼Œå°†å…¶ä¸­è®¾å®šçš„å€¼å–å‡ºï¼Œä¸€éƒ¨åˆ†ç›´æ¥è®¾ç½®ç»™mDecorï¼Œå¦‚çŠ¶æ€æ ã€å¯¼èˆªæ ï¼›ä¸€éƒ¨åˆ†èµ‹å€¼ç»™PhoneWindowå†…çš„æˆå‘˜å˜é‡ï¼Œå¦‚mFixedWidthMinorã€mFixedWidthMajorï¼›ä¸€éƒ¨åˆ†é€šè¿‡setFlagsè®¾ç½®ç»™Windowä¸­ç±»å‹ä¸ºWindowManager.LayoutParamsçš„å˜é‡mWindowAttributesï¼Œå¹¶åˆ·æ–°Windowæ˜¾ç¤ºï¼Œå¦‚FLAG_FULLSCREENï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†ç›´æ¥èµ‹å€¼ï¼›ä¸€éƒ¨åˆ†é€šè¿‡requestFeatureè®¾ç½®ç»™Windowçš„å˜é‡mFeaturesï¼Œå¦‚FEATURE_NO_TITLEï¼Œè¿™ä¸ªrequestFeatureå°±æ˜¯æˆ‘ä»¬ä¸ºä¿®æ”¹Activityä¸€äº›ç‰¹æ€§ï¼Œè€Œåœ¨setContentViewå‰è°ƒç”¨çš„é‚£ä¸ªæ–¹æ³•ï¼Œå¯è§ç³»ç»Ÿä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå°†æˆ‘ä»¬åœ¨ä¸»é¢˜ä¸­è®¾ç½®çš„å‚æ•°å–å‡ºå¹¶åº”ç”¨\n\nç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®è®¾å®šçš„featuresï¼Œä»ç³»ç»Ÿä¸­å·²ç»å†™å¥½çš„layoutå¸ƒå±€æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥è¿™ä¸ªç›®å½•ä¸‹çœ‹åˆ°ï¼Œ`sdk/platforms/android-version/data/res/layout`\n\nç¬¬å››æ­¥ï¼ŒåŠ è½½å¸ƒå±€æ–‡ä»¶ï¼Œå°†å…¶æ·»åŠ åˆ°mDecorä¸­\n\nç¬¬äº”æ­¥ï¼Œé€šè¿‡`@android:id/content`è¿™ä¸ªIDï¼Œæ‰¾åˆ°ViewGroupï¼Œè¿™ä¾¿æ˜¯mContentParent\n\n```java\nprotected ViewGroup generateLayout(DecorView decor) {\n    // Apply data from current theme.\n    // ç¬¬ä¸€æ­¥ï¼Œè·å–åŒ…å«ä¸»é¢˜å±æ€§çš„TypedArray\n    TypedArray a = getWindowStyle();\n\n    // ç¬¬äºŒæ­¥ï¼Œå–å€¼ï¼Œå¹¶åº”ç”¨\n    if (a.getBoolean(R.styleable.Window_windowNoTitle, false)) {\n        requestFeature(FEATURE_NO_TITLE);\n    } else if (a.getBoolean(R.styleable.Window_windowActionBar, false)) {\n        // Don't allow an action bar if there is no title.\n        requestFeature(FEATURE_ACTION_BAR);\n    }\n    if (a.getBoolean(R.styleable.Window_windowTranslucentStatus,\n            false)) {\n        setFlags(FLAG_TRANSLUCENT_STATUS, FLAG_TRANSLUCENT_STATUS\n                & (~getForcedWindowFlags()));\n    }\n    ...\n\n    // ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®featuresï¼Œæ‰¾layoutæ–‡ä»¶\n    int layoutResource;\n    int features = getLocalFeatures();\n    if ((features & ((1 << FEATURE_LEFT_ICON) | (1 << FEATURE_RIGHT_ICON))) != 0) {\n        if (mIsFloating) {\n            TypedValue res = new TypedValue();\n            getContext().getTheme().resolveAttribute(\n                    R.attr.dialogTitleIconsDecorLayout, res, true);\n            layoutResource = res.resourceId;\n        } else {\n            layoutResource = R.layout.screen_title_icons;\n        }\n        removeFeature(FEATURE_ACTION_BAR);\n    }\n    ...\n\n    // ç¬¬å››æ­¥ï¼ŒåŠ è½½layoutæ–‡ä»¶åˆ°mDecor\n    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\n\n    ...\n    // ç¬¬äº”æ­¥ï¼Œåˆå§‹åŒ–mContentParent\n    ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);\n    return contentParent;\n}\n\n```\n\nè‡³æ­¤ï¼ŒPhoneWindowä¸­çš„setContentViewå·²ç»èµ°å®Œäº†ï¼ŒmDecorã€mWindowä¹Ÿå·²ç»åˆå§‹åŒ–ï¼Œæˆ‘ä»¬è®¾ç½®çš„Viewä¹Ÿæ·»åŠ åˆ°äº†mDecorçš„contentä¸­ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œå…·ä½“è®©é¡µé¢å†…å®¹æ˜¾ç¤ºå‡ºæ¥ï¼Œæ˜¯åœ¨resumeé˜¶æ®µã€‚\n\n4. setContentViewè¯´å®Œï¼Œç°åœ¨å¼€å§‹è¯´resumeã€‚resumeæ˜¯åœ¨ActivityThreadä¸­çš„handleResumeActivityæ–¹æ³•ä¸­å›è°ƒçš„ï¼ŒhandleResumeActivityé‡Œé¢å¤§è‡´åšäº†è¿™å‡ ä»¶äº‹ï¼šè°ƒç”¨Activityçš„onResumeå›è°ƒæ–¹æ³•ã€å°†Activityçš„Windowä¸­çš„DecorViewæ·»åŠ åˆ°WindowManagerï¼Œä»¥åŠæ˜¾ç¤ºActivityçš„DecorView\n```java\n// ActivityThread.java\npublic void handleResumeActivity(IBinder token, boolean finalStateRequest, boolean isForward,\n        String reason) {\n    // è°ƒç”¨Activity.onResumeæ–¹æ³•\n    final ActivityClientRecord r = performResumeActivity(token, finalStateRequest, reason);\n\n    // å¾—åˆ°DecorView\n    View decor = r.window.getDecorView();\n    decor.setVisibility(View.INVISIBLE);\n    ViewManager wm = a.getWindowManager();\n    WindowManager.LayoutParams l = r.window.getAttributes();\n    if (a.mVisibleFromClient) {\n    if (!a.mWindowAdded) {\n        a.mWindowAdded = true;\n        // å°†decorViewåŠ åˆ°WindowManager\n        wm.addView(decor, l);\n    } else {\n        a.onWindowAttributesChanged(l);\n    }\n\n    // è°ƒç”¨Activity.makeVisibleæ–¹æ³•ï¼Œè®©å…¶æ˜¾ç¤ºï¼Œæ­¤æ—¶ä¾¿çœ‹åˆ°äº†é¡µé¢\n    if (r.activity.mVisibleFromClient) {\n        r.activity.makeVisible();\n    }\n}\n\n// Activity.java\nvoid makeVisible() {\n    if (!mWindowAdded) {\n        ViewManager wm = getWindowManager();\n        wm.addView(mDecor, getWindow().getAttributes());\n        mWindowAdded = true;\n    }\n    // è®©DecorViewå¯è§\n    mDecor.setVisibility(View.VISIBLE);\n}\n```\nè‡³æ­¤ï¼Œé¡µé¢è¿›å…¥å¯è§çŠ¶æ€ã€‚\n\n### æ€»ç»“\nå¸ƒå±€æ–‡ä»¶åœ¨è°ƒç”¨setContentViewåï¼Œä¼šåœ¨PhoneWindowä¸­åˆå§‹åŒ–DecorViewï¼Œæ‰¾åˆ°DecorViewä¸­IDä¸º`@android:id/content`çš„ViewGroupï¼Œç„¶åå°†æˆ‘ä»¬è®¾ç½®çš„Viewæ·»åŠ åˆ°å…¶ä¸­ï¼Œæœ€ç»ˆåœ¨RESUMEé˜¶æ®µï¼Œä¼šå°†DecorViewæ·»åŠ åˆ°WindowManagerä¸­ï¼Œå¹¶è®¾ç½®å…¶å¯è§ã€‚","tags":["Android"],"categories":["Android"]},{"title":"Android Context","url":"/2021/09/d4ee8f599683/","content":"æ›¾ç»è¢«é—®è¿‡ä¸€ä¸ªé—®é¢˜ï¼šAndroidç³»ç»Ÿä¸­çš„Contextæœ‰å‡ ç§ï¼Ÿå½“æ—¶æ²¡æ€ä¹ˆè¯´æ¸…æ¥šï¼Œç°åœ¨å†æ¥èŠèŠè¿™ä¸ªé—®é¢˜ã€‚\n\n<!--more-->\n\nContextæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªç›´æ¥å­ç±»ï¼šContextImplå’ŒContextWrapperã€‚ContextImplå®ç°äº†Contextä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼ŒContextWrapperä¹Ÿå®ç°äº†Contextçš„æŠ½è±¡æ–¹æ³•ï¼Œä½†å®ƒçš„å®ç°æ–¹å¼æ˜¯é€šè¿‡è°ƒç”¨å…¶æŒæœ‰çš„ContextImplå®ä¾‹mBaseçš„å¯¹åº”çš„æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒå«åšWrapperï¼Œå¯ä»¥ç†è§£æˆContextImplçš„åŒ…è£…ç±»ã€‚\n```shell\nContext\n|--ContextImpl\n|--ContextWrapper\n```\n\nè€ŒApplicationã€Serviceéƒ½æ˜¯ContextWrapperçš„ç›´æ¥å­ç±»ã€‚æ­¤å¤–ï¼ŒContextWrapperè¿˜æœ‰å…¶ä»–ç›´æ¥å­ç±»ï¼Œå¦‚ContextThemeWrapperã€ReceiverRestrictedContextï¼Œè€ŒActivityåˆ™æ˜¯ContextThemeWrapperçš„ç›´æ¥å­ç±»ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸»é¢˜ã€‚ReceiverRestrictedContextåˆ™æ˜¯ç»™BroadcastReceiverä½¿ç”¨çš„ï¼Œåé¢è¯´ã€‚\n```shell\nContext\n|--ContextImpl\n|--ContextWrapper\n   |--Appliction\n   |--Service\n   |--ReceiverRestrictedContext\n   |--ContextThemeWrapper\n      |--Activity\n```\n\nè¿™å‡ ä¸ªç±»çš„å®ä¾‹éƒ½æ˜¯åœ¨ActivityThreadä¸­åˆ›å»ºï¼Œå…¶ä¸­çš„Contextä¹Ÿæ˜¯åœ¨è¿™é‡Œé¢èµ‹å€¼çš„ï¼Œåˆ†åˆ«æ¥çœ‹ä¸€çœ‹\n\n### Activity\nåˆ›å»ºActivityæ—¶ï¼Œæœ€ç»ˆä¼šèµ°åˆ°ActivityThread.performLauncherActivityæ–¹æ³•é‡Œ\n```java\n// ActivityThread.java çœç•¥äº†éƒ¨åˆ†ä»£ç \nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n    // åˆ›å»ºContextImpl\n    ContextImpl appContext = createBaseContextForActivity(r);\n    // åˆ›å»ºActivity\n    Activity activity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n    // åˆ›å»ºApplication\n    Application app = r.packageInfo.makeApplication(false, mInstrumentation);\n    // è°ƒç”¨Activity.attach\n    activity.attach(appContext, this, getInstrumentation(), r.token,r.ident, app, r.intent, r.activityInfo, title, r.parent, r.embeddedID, r.lastNonConfigurationInstances, config, r.referrer, r.voiceInteractor, window, r.configCallback, r.assistToken);\n    // è°ƒç”¨Activity.onCreate\n    if (r.isPersistable()) {\n        mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n    } else {\n        mInstrumentation.callActivityOnCreate(activity, r.state);\n    }\n}\n\nprivate ContextImpl createBaseContextForActivity(ActivityClientRecord r) {\n\tContextImpl appContext = ContextImpl.createActivityContext(this, r.packageInfo, r.activityInfo, r.token, displayId, r.overrideConfig);\n\treturn appContext;\n}\n```\nå¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªActivityçš„è¿‡ç¨‹ä¸»è¦æœ‰3æ­¥ï¼šä¸€æ˜¯é€šè¿‡åå°„åˆ›å»ºActivityå®ä¾‹ï¼ŒäºŒæ˜¯å‡†å¤‡ç›¸å…³çš„å‚æ•°ï¼Œå…¶ä¸­åŒ…å«ContextImplå®ä¾‹å’ŒApplicationå®ä¾‹ï¼Œæ¥ç€æ˜¯attachï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œåˆå§‹åŒ–Activityçš„æˆå‘˜å˜é‡ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªApplicationç±»å‹çš„å˜é‡mApplicationï¼Œä¼ å…¥çš„Applicationæ˜¯ä¸ºäº†åˆå§‹åŒ–è¿™ä¸ªå˜é‡ã€‚\n\n### Service\nåˆ›å»ºServiceæœ€ç»ˆä¼šèµ°åˆ°ActivityThread.handleCreateServiceæ–¹æ³•é‡Œ\n```java\n// ActivityThread.java çœç•¥äº†éƒ¨åˆ†ä»£ç \nprivate void handleCreateService(CreateServiceData data) {\n\t// åˆ›å»ºContextImpl\n\tContextImpl context = ContextImpl.createAppContext(this, packageInfo);\n\t// åˆ›å»ºApplication\n\tApplication app = packageInfo.makeApplication(false, mInstrumentation);\n\t// åˆ›å»ºService\n\tService service = packageInfo.getAppFactory().instantiateService(cl, data.info.name, data.intent);\n\t// è°ƒç”¨Service.attach\n\tservice.attach(context, this, data.info.name, data.token, app, ActivityManager.getService());\n\t// è°ƒç”¨Service.onCreate\n\tservice.onCreate();\n}\n```\nå’ŒActivityç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚\n\n### BroadcastReceiver\nåˆ›å»ºBroadcastReceiveræœ€ç»ˆä¼šèµ°åˆ°ActivityThread.handleReceiveræ–¹æ³•é‡Œ\n```java\n// ActivityThread.java çœç•¥äº†éƒ¨åˆ†ä»£ç \nprivate void handleReceiver(ReceiverData data) {\n\t// åˆ›å»ºApplication\n\tApplication app = packageInfo.makeApplication(false, mInstrumentation);\n\t// åˆ›å»ºContextImpl\n\tContextImpl context = (ContextImpl) app.getBaseContext();\n\t// åˆ›å»ºBroadcastReceiver\n\tBroadcastReceiver receiver = packageInfo.getAppFactory().instantiateReceiver(cl, data.info.name, data.intent);\n\t// è°ƒç”¨BroadcastReceiver.onReceive\n\treceiver.onReceive(context.getReceiverRestrictedContext(), data.intent);\n}\n```\nå¯ä»¥çœ‹åˆ°ï¼ŒBroadcastReceiveræ²¡æœ‰ç›´æ¥ä½¿ç”¨åˆ›å»ºçš„ContextImplï¼Œè€Œæ˜¯é€šè¿‡context.getReceiverRestrictedContext()è·å–äº†ReceiverRestrictedContextï¼Œä¸Šé¢æè¿‡ï¼Œå®ƒæ˜¯ContextWrapperçš„ç›´æ¥å­ç±»ï¼Œé‡å†™äº†å…¶ä¸­çš„registerReceiverå’ŒbindServiceæ–¹æ³•ï¼Œæ–¹æ³•é‡Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥ç”¨BroadcastReceiverä¸­çš„Contextæ— æ³•åˆ›å»ºå¹¿æ’­å’ŒæœåŠ¡\n```java\n// ContextImpl.java åªå±•ç¤ºå…³é”®ä»£ç \nclass ReceiverRestrictedContext extends ContextWrapper {\n\t@Override\n    public Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter, String broadcastPermission, Handler scheduler) {\n        if (receiver == null) {\n            // Allow retrieving current sticky broadcast; this is safe since we\n            // aren't actually registering a receiver.\n            return super.registerReceiver(null, filter, broadcastPermission, scheduler);\n        } else {\n            throw new ReceiverCallNotAllowedException(\"BroadcastReceiver components are not allowed to register to receive intents\");\n        }\n    }\n\n    @Override\n    public boolean bindService(Intent service, ServiceConnection conn, int flags) {\n        throw new ReceiverCallNotAllowedException(\"BroadcastReceiver components are not allowed to bind to services\");\n    }\n}\n```\n\n### Application\nåœ¨åˆ›å»ºä¸Šé¢3ä¸ªçš„æ—¶å€™å¯ä»¥çœ‹åˆ°ï¼ŒApplicationéƒ½æ˜¯é€šè¿‡packageInfo.makeApplicationæ¥åˆ›å»ºçš„ï¼ŒpackageInfoæ˜¯ä¸ªç±»å‹ä¸ºLoadedApkç±»å‹çš„å®ä¾‹ï¼Œå…·ä½“çœ‹ä¸€çœ‹\n```java\n// LoadedApk.java åªå±•ç¤ºäº†å…³é”®ä»£ç \npublic Application makeApplication(boolean forceDefaultAppClass, Instrumentation instrumentation) {\n\tif (mApplication != null) {\n\t\treturn mApplication;\n     }\n     ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);\n     app = mActivityThread.mInstrumentation.newApplication(cl, appClass, appContext);\n     mApplication = app;\n     // è°ƒç”¨Applicationçš„onCreateæ–¹æ³•\n     instrumentation.callApplicationOnCreate(app);\n}\n\n// Instrumentation.java \npublic Application newApplication(ClassLoader cl, String className, Context context) throws InstantiationException, IllegalAccessException, ClassNotFoundException {\n    Application app = getFactory(context.getPackageName()).instantiateApplication(cl, className);\n    app.attach(context);\n    return app;\n}\n```\nå…ˆåˆ›å»ºäº†ContextImplçš„å®ä¾‹ï¼Œç„¶ååœ¨Instrumentationä¸­é€šè¿‡åå°„åˆ›å»ºäº†Applicationå®ä¾‹ï¼Œæ¥ç€å°†ä¸Šä¸€æ­¥åˆ›å»ºçš„ContextImplå®ä¾‹é€šè¿‡attachæ–¹æ³•ä¼ å…¥ï¼Œæœ€åè°ƒç”¨Application.onCreateæ–¹æ³•\n\n### ContentProvider\nå››å¤§ç»„ä»¶è¯´äº†ä¸‰ä¸ªï¼Œå†è¯´è¯´æœ€åä¸€ä¸ªContentProvicerï¼Œè™½ç„¶ä¸æ˜¯Contextçš„å­ç±»ï¼Œä½†ä¹Ÿå’ŒContextç›¸å…³ã€‚åˆ›å»ºProvideråœ¨ActivityThread.installProvideræ–¹æ³•ä¸­\n```java\n// ContextImpl.java åªå±•ç¤ºå…³é”®ä»£ç \nprivate ContentProviderHolder installProvider(Context context, ContentProviderHolder holder, ProviderInfo info, boolean noisy, boolean noReleaseNeeded, boolean stable) {\n\tContext c = null;\n    ApplicationInfo ai = info.applicationInfo;\n    if (context.getPackageName().equals(ai.packageName)) {\n        c = context;\n    } else if (mInitialApplication != null && mInitialApplication.getPackageName().equals(ai.packageName)) {\n        c = mInitialApplication;\n    } else {\n        try {\n            c = context.createPackageContext(ai.packageName, Context.CONTEXT_INCLUDE_CODE);\n        } catch (PackageManager.NameNotFoundException e) { // Ignore }\n    }\n    // åˆ›å»ºContentProvider\n\tContentProvider localProvider = packageInfo.getAppFactory().instantiateProvider(cl, info.name);\n\tlocalProvider.attachInfo(c, info);\n}\n```\nè§†æƒ…å†µè€Œå®šï¼ŒContextImplçš„æ¥æºæœ‰å¤šç§ï¼Œä½†æœ€åéƒ½æ˜¯é€šè¿‡attachInfoæ–¹æ³•ä¼ å…¥ContentProviderã€‚\n\n### æ€»ç»“\nå›åˆ°æœ€åˆçš„é—®é¢˜ï¼ŒContextæœ‰å‡ ç§å‘¢ï¼Œå°±æ™®éæ€§è€Œè¨€æœ‰3ç§ï¼šApplicationã€Activityå’ŒServiceï¼Œå¦‚æœä¸¥è°¨ä¸€ç‚¹ï¼Œç®—ä¸ŠReceiverRestrictedContextçš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯4ç§ã€‚","tags":["Android","Context"],"categories":["Android"]},{"title":"Androidé€‚é…","url":"/2021/09/352f312b568b/","content":"\nä¸ºä»€ä¹ˆè¦é€‚é…å‘¢ï¼Ÿè¿™ç¯‡æ–‡ç« æ¥èŠä¸€èŠã€‚\n<!--more-->\nå› ä¸ºç°åœ¨æœ‰ç€äº”èŠ±å…«é—¨çš„Androidæ‰‹æœºå‚å•†ï¼Œç”Ÿäº§å‡ºæ¥çš„è®¾å¤‡æœ‰ç€å„ç§å„æ ·çš„åˆ†è¾¨ç‡ã€‚è¿™ä¸€ç‚¹ä¸åƒAppleï¼Œè®¾å¤‡ç±»å‹å°±é‚£ä¹ˆæœ‰é™çš„å‡ ç§ã€‚\n\nä¸ºäº†åšåˆ°è®©ä¸€å¼ è®¾è®¡ç¨¿ï¼Œåœ¨ä¸åŒçš„è®¾å¤‡ä¸Šçœ‹èµ·æ¥éƒ½å·®ä¸å¤šï¼Œæˆ–è€…è¯´ä¸ä¼šç›¸å·®å¤ªå¤šï¼Œè¿™å°±æ˜¯é€‚é…çš„ç›®çš„ã€‚\n\n### å‡ ä¸ªæ¦‚å¿µ\n- å±å¹•å¤§å°\nå¸¸è§çš„æœ‰5.0è‹±å¯¸ã€6.1è‹±å¯¸ç­‰ç­‰ï¼Œè¿™ä¸ªé•¿åº¦æŒ‡çš„æ˜¯å±å¹•å¯¹è§’çº¿çš„é•¿åº¦ï¼Œæ ¹æ®å‹¾è‚¡å®šç†ä¾¿å¯ä»¥æ ¹æ®é•¿å’Œå®½ç®—å‡ºæ¥ã€‚ä¸ºä»€ä¹ˆè¦ç”¨å¯¹è§’çº¿çš„é•¿åº¦æ¥è¡¨ç¤ºä¸€ä¸ªå±å¹•çš„å¤§å°å‘¢ï¼Œå¯¹è§’çº¿ç›¸ç­‰çš„å±å¹•å¯ä»¥æœ‰å¤šç§é•¿å’Œå®½ã€‚æŸ¥äº†ä¸‹ï¼Œæ˜¯å†å²é—ç•™åŸå› ï¼Œå› ä¸ºæœ€å¼€å§‹çš„æ—¶å€™éƒ½æ˜¯ç”¨åœ†å½¢æ˜¾ç¤ºç®¡æ¥æ˜¾ç¤ºçš„ï¼Œæ‰€ä»¥ç”¨ç›´å¾„è¡¨ç¤ºæ˜¾ç¤ºç®¡çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å…¶å†…çŸ©å½¢çš„å¯¹è§’çº¿ã€‚åæ¥å·¥è‰ºå‘å±•ï¼Œåšæˆäº†çŸ©å½¢ï¼Œä½†è¿™ç§æ–¹å¼ä¿ç•™äº†ä¸‹æ¥\n\n- å±å¹•åˆ†è¾¨ç‡\nå¸¸è§çš„æœ‰720x1280ã€1080x1920ã€1440x2560ï¼Œå…¶ä¸­çš„æ•°å­—æŒ‡çš„æ˜¯è¯¥æ–¹å‘çš„åƒç´ å—çš„æ•°é‡ã€‚æ¯”å¦‚720x1280çš„å±å¹•ï¼Œåœ¨è¾ƒçŸ­çš„æ–¹å‘æœ‰720ä¸ªåƒç´ å—ï¼Œè¾ƒé•¿çš„æ–¹å‘æœ‰1280ä¸ªåƒç´ å—ï¼Œä¸åŒçš„å±å¹•åƒç´ å—çš„å¤§å°å¯èƒ½æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚ä¸¤å—å±å¹•éƒ½æ˜¯1080x1920ï¼Œä½†ä¸€å—æ˜¯5.0è‹±å¯¸å¦ä¸€å—æ˜¯5.9è‹±å¯¸ï¼Œé‚£5.0çš„åƒç´ å—å°±è¦å°ä¸€äº›ã€‚\n\n- px\npixelï¼Œåƒç´ \n\n- ppi\nå…¨ç§°pixel per inchï¼ŒæŒ‡æ¯è‹±å¯¸ä¸Šçš„åƒç´ æ•°é‡ï¼Œæ¯”å¦‚1080å®½ï¼Œç‰©ç†é•¿åº¦ä¸º3.375è‹±å¯¸ï¼Œé‚£ä¹ˆæ¯è‹±å¯¸ä¸Šçš„åƒç´ æ•°é‡å°±æ˜¯1080/3.75=320ä¸ªï¼Œä¸€èˆ¬é’ˆå¯¹çš„æ˜¯æè¿°å±å¹•\n\n- dpi\nå’Œppiç±»ä¼¼ï¼Œå…¨ç§°æ˜¯dots per inchï¼ŒæŒ‡æ¯è‹±å¯¸ä¸Šå¢¨ç‚¹çš„æ•°é‡ï¼Œé’ˆå¯¹çš„æ˜¯æ‰“å°åˆ°çº¸ä¸Šï¼Œæ¯”å¦‚160dpiï¼Œæ„æ€å°±æ˜¯æ‰“å°å‡ºä¸€æ¡1è‹±å¯¸é•¿çš„çº¿æ—¶ï¼Œè¿™æ¡çº¿ä¸Šä¼šæœ‰160ä¸ªå¢¨ç‚¹ã€‚åœ¨ Android é‡Œï¼Œè¿™ä¸¤ä¸ªå€¼æ˜¯ç›¸ç­‰çš„ï¼Œåœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€å¼ å›¾ç‰‡æ—¶ï¼Œä¸€ä¸ªåƒç´ å—ä¾¿ç›¸å½“äºä¸€ä¸ªå¢¨ç‚¹ï¼Œä½†æ˜¯åœ¨æ‰“å°æœºä¸Šæ‰“å°æ—¶è¿™ä¸¤ä¸ªä¸ä¸€å®šç›¸ç­‰ã€‚\n\nå› ä¸ºä¸åŒå±å¹•æœ‰ç€ä¸åŒçš„åˆ†è¾¨ç‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨ä»£ç ä¸­ä»¥åƒç´ ä¸ºå•ä½è®¾ç½®å›¾ç‰‡çš„å¤§å°ï¼Œæ¯”å¦‚ä¸€ä¸ªImageViewè®¾ç½®æˆ540pxå®½ï¼Œæœ‰çš„å±å¹•ä¸Šæ˜¯2è‹±å¯¸ï¼Œæœ‰çš„å±å¹•ä¸Šå´æ˜¯3è‹±å¯¸ï¼Œè¿™æ ·çš„æ•ˆæœæ˜¯ä¸å¯è¡Œçš„ï¼Œå› æ­¤ï¼Œè¿™é‡Œå¼•å‡ºäº†æ–°æ¦‚å¿µï¼š\n\n- dip\nå…¨ç§°æ˜¯density independent pixelï¼Œå¯†åº¦ç‹¬ç«‹åƒç´ ï¼Œç®€ç§°dpã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºåƒç´ ã€å’Œå±å¹•å¯†åº¦ç›¸å…³çš„é•¿åº¦å•ä½ã€‚è§„å®šï¼šåœ¨å¯†åº¦æ˜¯160çš„å±å¹•ä¸Šï¼Œ1dp=1pxï¼Œæ‰€ä»¥å¯†åº¦æ˜¯320çš„å±å¹•ä¸Šï¼Œ1dp=2pxï¼Œæ€»ä¹‹ï¼Œå¯†åº¦è¶Šé«˜çš„å±å¹•ä¸Šï¼Œ1dpä»£è¡¨çš„åƒç´ è¶Šå¤šã€‚\n\n- density\nå¯†åº¦ï¼Œç­‰äºdpi/160ï¼Œæ„æ€å°±æ˜¯åœ¨è¿™å—å±å¹•ä¸Šï¼Œ1dpç­‰äºå¤šå°‘px\n\nåœ¨Androidä¸­ï¼Œç”¨dpä»£æ›¿pxçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¾‹å¦‚ï¼Œè®¾è®¡ç¨¿æ˜¯1080x1920ï¼Œå±å¹•å¯†åº¦æ˜¯320ï¼Œæ‰€ä»¥densityç­‰äº2ã€‚ä¸Šé¢ä¸€å¼ 160pxå®½çš„å›¾ç‰‡ï¼Œå³160/2=80dpã€‚\nåœ¨dpiä¸º320çš„å±å¹•ä¸Šï¼Œä¹Ÿå°±æ˜¯densityç­‰äº2ï¼Œå®ƒç­‰äº160åƒç´ ï¼Œå³0.5è‹±å¯¸ï¼›\nåœ¨dpiä¸º160çš„å±å¹•ä¸Šï¼Œä¹Ÿå°±æ˜¯densityç­‰äº1ï¼Œå®ƒç­‰äº80åƒç´ ï¼Œå³0.5è‹±å¯¸ã€‚\nè™½ç„¶å±å¹•å¯†åº¦ä¸åŒï¼Œä½†è¿™å¼ å›¾å ç”¨çš„ç‰©ç†å®½åº¦éƒ½æ˜¯0.5è‹±å¯¸ï¼Œç»™äººè§†è§‰ä¸Šçš„æ„Ÿè§‰æ˜¯ä¸€æ ·çš„ã€‚\n\n### é€‚é…æ˜¯åœ¨é€‚é…ä»€ä¹ˆ\né¦–å…ˆæ˜ç¡®ä¸€ç‚¹æ˜¯ï¼Œä¸ç®¡ç”¨ä»€ä¹ˆå•ä½ï¼ŒAndroidåœ¨æœ€ç»ˆç»˜åˆ¶åˆ°å±å¹•æ—¶ï¼Œéƒ½ä¼šè½¬åŒ–æˆåƒç´ ã€‚åŸæœ¬è¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸åŒçš„å±å¹•æˆ‘å¯ä»¥æ˜¾ç¤ºå‡ºåŒæ ·çš„ç‰©ç†å®½åº¦ï¼Œä½†ç”±äºæ‰‹æœºå‚å•†ä¹‹å¤šã€ç”Ÿäº§çš„å±å¹•ä¹‹å¤šï¼Œæ‰€ä»¥è¿˜æœ‰ç€ç‰¹æ®Šçš„æƒ…å†µã€‚\n\næ¯”å¦‚ï¼ŒåŒæ ·æ˜¯1080x1920çš„å±å¹•ï¼Œä¸€å—çš„dpiæ˜¯480ï¼Œdensityä¸º480/160=3ï¼Œç‰©ç†å®½åº¦ä¸º1080/480=2.25è‹±å¯¸ï¼›å¦ä¸€å—çš„dpiæ˜¯360ï¼Œdensityä¸º360/160=2.25ï¼Œç‰©ç†å®½åº¦ä¸º1080/360=3è‹±å¯¸\n\n1080x1920ã€dpiä¸º480çš„è®¾è®¡ç¨¿ä¸Šï¼Œæœ‰ä¸ªäº§å“åˆ—è¡¨ï¼Œä»‹ç»å›¾ç‰‡å®½åº¦ä¸º360dpï¼Œåœ¨ç¬¬ä¸€å—å±å¹•ä¸Šåˆšå¥½å æ»¡å±å¹•å®½åº¦ï¼Œä½†æ˜¯åœ¨ç¬¬äºŒå—å±å¹•ä¸Šåªå ç”¨äº†360x2.25=810pxï¼Œå®½åº¦ä¸Šå‰©ä¸‹äº†ä¸€å¤§å—ç©ºç™½ï¼Œ1080-810=270pxã€‚\n\næœ¬è´¨ä¸Šï¼Œdipå°±æ˜¯ä¸ºäº†åœ¨å¤§å±å¹•ä¸Šæ˜¾ç¤ºæ›´å¤šçš„å†…å®¹ã€‚è¿™é‡Œçš„ã€Œå¤§ã€æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¯ä»¥çœ‹ä¸Šé¢çš„ä¾‹å­ï¼ŒåŒæ ·çš„1080åƒç´ çš„å®½åº¦ï¼Œå‰è€…çš„ç‰©ç†å®½åº¦æ˜¯2.25è‹±å¯¸ï¼Œè€Œåè€…æ˜¯3è‹±å¯¸ï¼Œæ˜æ˜¾åè€…æ¯”å‰è€…æ›´å¤§ï¼Œæ‰€ä»¥åœ¨æ˜¾ç¤ºåŒæ ·dpçš„å›¾ç‰‡æ—¶ï¼Œåè€…ç•™äº†ä¸€å¤§ç‰‡ç©ºç™½ï¼Œå› ä¸ºå¯ä»¥æ˜¾ç¤ºæ›´å¤šçš„å†…å®¹ã€‚\n\nä½†æ˜¯è¿™ç§æ˜¾ç¤ºæ•ˆæœå°±ä¸å¯æ¥å—çš„ï¼Œè€Œè¯´äº†åŠå¤©çš„é€‚é…ï¼Œå°±æ˜¯é€‚é…è¿™æ ·çš„æƒ…å†µï¼ŒåŒæ ·åƒç´ å®½åº¦çš„å±å¹•ï¼Œç‰©ç†å°ºå¯¸å´ä¸åŒï¼Œè®©ä¸€ç«™å›¾ç‰‡åœ¨ä¸åŒçš„å±å¹•éƒ½æ˜¾ç¤ºç›¸åŒçš„æ¯”ä¾‹ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Œå°±æ˜¯è¯´ï¼Œè®¾è®¡ç¨¿é‡Œè¿™å¼ å›¾å æ®äº†å…¨éƒ¨çš„å®½åº¦ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰çš„å±å¹•ä¸Šéƒ½è¦å æ®å…¨éƒ¨çš„å®½åº¦ï¼Œå¦‚æœåœ¨è®¾è®¡ç¨¿ä¸­å æ®äº†ä¸€åŠçš„å®½åº¦ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰çš„å±å¹•ä¸Šä¹Ÿè¦å æ®ä¸€åŠçš„å®½åº¦ã€‚\n\nå› æ­¤ï¼Œé€‚é…å°±æ˜¯ä¸ºäº†è®©UIå…ƒç´ åœ¨ä¸åŒè®¾å¤‡å±å¹•ä¸Šï¼Œæ‰€å æ¯”ä¾‹æ˜¯ç›¸åŒçš„ã€‚\n\nå¯ä»¥çœ‹å‡ºï¼Œè¿™æ ·çš„é€‚é…åªèƒ½æ»¡è¶³ä¸€ä¸ªæ–¹å‘ï¼Œå®½æˆ–è€…é«˜ã€‚æŒ‰ç…§å®½çš„æ¯”ä¾‹è°ƒæ•´å°±æ— æ³•ä¼°è®¡é«˜ï¼Œåä¹‹åŒç†ã€‚è‹¥è®¾å¤‡çš„å®½é«˜æ¯”ä¸è®¾è®¡ç¨¿çš„å®½é«˜æ¯”ç›¸åŒï¼Œæ­¤æ—¶å¯å…¼é¡¾ä¸¤è€…ã€‚\n\nç°åœ¨ä¸»è¦ä¸‹é¢è¿™å‡ ç§é€‚é…æ–¹æ¡ˆã€‚\n\n### æ–¹æ¡ˆï¼šä¿®æ”¹density\nè¿™å¥—æ–¹æ¡ˆï¼Œæ˜¯åŸºäºdpã€‚\n\nå› åœ¨ç»˜åˆ¶æ—¶ä½¿ç”¨çš„éƒ½æ˜¯pxï¼Œç³»ç»Ÿåœ¨å°†dpè½¬åŒ–æˆpxæ—¶ï¼Œç”¨çš„æ˜¯TypedValueä¸­çš„æ–¹æ³•ï¼Œæœ€åè¾“å‡ºéƒ½æ˜¯pxã€‚\n```java\npublic static float applyDimension(int unit, float value, DisplayMetrics metrics) {\n        switch (unit) {\n        case COMPLEX_UNIT_PX: // pixelï¼Œåƒç´ \n            return value;\n        case COMPLEX_UNIT_DIP: // dpè½¬px\n            return value * metrics.density;\n        case COMPLEX_UNIT_SP: // scaled dp å¯ç¼©æ”¾dp\n            return value * metrics.scaledDensity;\n        case COMPLEX_UNIT_PT: // pointï¼Œ1point = 1/72è‹±å¯¸\n            return value * metrics.xdpi * (1.0f/72);\n        case COMPLEX_UNIT_IN: // inch è‹±å¯¸\n            return value * metrics.xdpi;\n        case COMPLEX_UNIT_MM: // millimeter æ¯«ç±³\n            return value * metrics.xdpi * (1.0f/25.4f);\n        }\n        return 0;\n   }\n```\nç›´è§‚çš„æ¥çœ‹ï¼ŒåŒæ ·æ˜¯360dpå®½çš„å›¾ç‰‡ï¼Œåœ¨ä¸¤ä¸ªå±å¹•ä¸Šæ‰€å æ¯”ä¾‹ä¸åŒçš„åŸå› æ˜¯ï¼Œä¸¤ä¸ªå±å¹•çš„å®½åº¦ä¸åŒï¼Œä¸€ä¸ªæ˜¯1080px/density=360dpï¼Œå¦ä¸ªæ˜¯1080px/density=480dpã€‚\n\nè¿™ç§æ–¹æ¡ˆé€»è¾‘æ˜¯ï¼ŒåŠ¨æ€ä¿®æ”¹å±å¹•çš„dpå®½åº¦ï¼Œè®©å±å¹•çš„å®½åº¦ç­‰äºè®¾è®¡ç¨¿çš„å®½åº¦ã€‚åŒæ—¶ï¼Œå±å¹•çš„dpå®½åº¦æ˜¯åŸºäºåƒç´ å®½åº¦å’Œdensityè®¡ç®—å‡ºæ¥çš„ï¼Œè€Œå±å¹•çš„åƒç´ å®½åº¦æ— æ³•ä¿®æ”¹ï¼Œæ‰€ä»¥è¦ä¿®æ”¹çš„å°±æ˜¯densityï¼Œè¿™ä¸ªå€¼å°±æ˜¯å­˜å‚¨åœ¨DisplayMetricsä¸­çš„ä¸€ä¸ªå˜é‡ï¼Œä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿåœ¨å°†dpè½¬åŒ–æˆpxæ—¶ï¼Œä½¿ç”¨çš„æ˜¯è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥ä¿®æ”¹è¿™ä¸ªå˜é‡å°±å¯ä»¥ä¿®æ”¹ç³»ç»Ÿæœ€ç»ˆè®¡ç®—å‡ºæ¥çš„pxå€¼ã€‚å…¬å¼ä¸ºï¼š`åŠ¨æ€density = å±å¹•åƒç´ å®½åº¦/è®¾è®¡ç¨¿çš„dpå®½åº¦`\n\nä¿®æ”¹çš„æ—¶æœºæ˜¯ï¼Œåœ¨ç³»ç»Ÿä½¿ç”¨ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯åœ¨`setContentView`ä¹‹å‰ã€‚\n\n```kotlin\nfun setCustomDensity(activity: Activity, application: Application, designWidthDp: Int) {\n        val appDisplayMetrics = application.resources.displayMetrics\n        val targetDensity = 1.0f * appDisplayMetrics.widthPixels / designWidthDp\n        val targetDensityDpi = (targetDensity * 160).toInt()\n        appDisplayMetrics.density = targetDensity\n        appDisplayMetrics.densityDpi = targetDensityDpi\n        val activityDisplayMetrics = activity.resources.displayMetrics\n        activityDisplayMetrics.density = targetDensity\n        activityDisplayMetrics.densityDpi = targetDensityDpi\n    }\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n        setCustomDensity(this, application, 420)\n        super.onCreate(savedInstanceState)\n    }\n```\n\nè¿™æ˜¯å­—èŠ‚ç»™å‡ºçš„æ–¹æ¡ˆï¼Œæˆæœ¬æä½ï¼Œä½†æ˜¯æ²¡æœ‰ä»£ç ï¼ŒGithubä¸Šæœ‰äººå®ç°äº†ä¸€å¥—ï¼Œå¯ä»¥å‚è€ƒï¼Œ[ç‚¹å‡»è·³è½¬](https://github.com/JessYanCoding/AndroidAutoSize)ã€‚\n\n### æ–¹æ¡ˆï¼šsmallest width\nè¿™å¥—æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼Œæ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªåƒç´ æ‰€ä»£è¡¨çš„dpæ•°é‡ã€‚\n\nä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾è®¾è®¡ç¨¿æ˜¯1080x1920\n\nåœ¨å®½åº¦ä¸º360dpçš„å±å¹•ä¸Šï¼Œå°†å®½åº¦åˆ†ä¸º1080ä»½ï¼Œæ¯ä»½ä»£è¡¨360/1080=0.33dpï¼Œç„¶åç”Ÿæˆè¿™æ ·ä¸€ä»½æ–‡ä»¶ï¼š\n```xml\n<resources>\n    <dimen name=\"DIMEN_1PX\">0.33dp</dimen>\n    <dimen name=\"DIMEN_2PX\">0.66dp</dimen>\n    ...\n    <dimen name=\"DIMEN_1079PX\">359.67dp</dimen>\n    <dimen name=\"DIMEN_1080PX\">360dp</dimen>\n</resources>\n```\nåœ¨å®½åº¦ä¸º380dpçš„å±å¹•ä¸Šï¼Œå°†å®½åº¦åˆ†ä¸º1080ä»½ï¼Œæ¯ä»½ä»£è¡¨380/1080=0.35dpï¼›\nåœ¨å®½åº¦ä¸º400dpçš„å±å¹•ä¸Šï¼Œå°†å®½åº¦åˆ†ä¸º1080ä»½ï¼Œæ¯ä»½ä»£è¡¨400/1080=0.37dpï¼›\n...\nè¦é’ˆå¯¹å½“å‰çš„ä¸»æµå®½åº¦å±å¹•å„ç”Ÿæˆä¸€ä»½è¿™æ ·çš„æ–‡ä»¶ï¼Œæ”¾åˆ°å¯¹åº”çš„ç›®å½•ä¸‹\n```shell\nvalues\nvalues-sw360dp\nvalues-sw380dp\nvalues-sw400dp\nvalues-sw420dp\n```\nåœ¨å†™å¸ƒå±€æ–‡ä»¶æ—¶ï¼Œæ§ä»¶çš„å°ºå¯¸å°±ç”¨è®¾è®¡ç¨¿ä¸Šçš„pxå°ºå¯¸ï¼Œæ¯”å¦‚ï¼Œè®¾è®¡ç¨¿ä¸Šå®½åº¦ä¸º100pxï¼Œé‚£ä¹ˆåœ¨å¸ƒå±€æ–‡ä»¶é‡Œå°±å†™`@dimen/DIMEN_100PX`ï¼Œ\n\nåœ¨360dpçš„å±å¹•ä¸Šï¼Œå°±ä¼šè¯»å–åˆ°33dpï¼Œå æ¯”33/360=0.09ï¼›\nåœ¨380dpçš„å±å¹•ä¸Šï¼Œå°±ä¼šè¯»å–åˆ°35dpï¼Œå æ¯”35/380=0.09ï¼›\nåœ¨400dpçš„å±å¹•ä¸Šï¼Œå°±ä¼šè¯»å–åˆ°37dpï¼Œå æ¯”37/400=0.09ï¼›\n\nè™½ç„¶åœ¨ç²¾åº¦ä¸Šæœ‰ä¸€äº›æŸå¤±ï¼Œä½†å¯å¿½ç•¥ï¼Œå®ç°äº†é€‚é…çš„éœ€æ±‚ã€‚è¿™ç§æ–¹æ¡ˆéœ€è¦ç²¾å‡†å‘½ä¸­ç›®æ ‡è®¾å¤‡çš„å®½åº¦ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å‡†å¤‡è¶³å¤Ÿå¤šçš„è¿™æ ·çš„æ–‡ä»¶ã€‚\n\n### æ–¹æ¡ˆï¼šæŒ‡å®šå®½é«˜\nè¿™å¥—æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼Œæ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªåƒç´ æ‰€ä»£è¡¨çš„åƒç´ ã€‚\n\nè¿™å¥è¯çœ‹ç€æ˜¯ä¸æ˜¯æœ‰äº›åˆ«æ‰­ï¼Ÿä¸€ä¸ªåƒç´ ä¸å°±æ˜¯ä¸€ä¸ªåƒç´ ä¹ˆï¼Œæ€ä¹ˆè¿˜èƒ½ä»£è¡¨å…¶ä»–åƒç´ å‘¢ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹\n\nä¸Šé¢çš„æ–¹æ¡ˆæ˜¯æŒ‰ç…§å±å¹•å®½åº¦å‘½ä¸­è®¾å¤‡ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯æŒ‰ç…§å±å¹•çš„åƒç´ å®½åº¦å‘½ä¸­è®¾å¤‡ã€‚\n\nè¿˜æ˜¯é‚£ä¸ªä¾‹å­ï¼Œå‡è®¾è®¾è®¡ç¨¿æ˜¯1080x1920\n\nåœ¨720x1280çš„å±å¹•ä¸Šï¼ŒæŠŠå®½åˆ†æˆ1080ä»½ï¼Œæ¯ä»½ä»£è¡¨720/1080=0.67pxï¼›æŠŠé«˜åˆ†æˆ1920ä»½ï¼Œæ¯ä»½ä»£è¡¨0.67pxï¼›\n```xml\n<resources>\n    <dimen name=\"X1\">0.67px</dimen>\n    <dimen name=\"X2\">1.33px</dimen>\n    ...\n    <dimen name=\"X1079\">719.26px</dimen>\n    <dimen name=\"X1080\">720px</dimen>\n\n    <dimen name=\"Y1\">0.67px</dimen>\n    <dimen name=\"Y2\">1.33px</dimen>\n    ...\n    <dimen name=\"Y1079\">1279.33px</dimen>\n    <dimen name=\"Y1080\">1280px</dimen>\n</resources>\n```\nå…¶ä¸­çš„Xä»£è¡¨æ¨ªå‘ï¼ŒYä»£è¡¨ç«–å‘ã€‚\n\nåœ¨1080x1920çš„å±å¹•ä¸Šï¼ŒæŠŠå®½åˆ†æˆ1080ä»½ï¼Œæ¯ä»½ä»£è¡¨1080/1080=1pxï¼›æŠŠé«˜åˆ†æˆ1920ä»½ï¼Œæ¯ä»½ä»£è¡¨1920/1920=1pxï¼›\nåœ¨1440x2560çš„å±å¹•ä¸Šï¼ŒæŠŠå®½åˆ†æˆ1080ä»½ï¼Œæ¯ä»½ä»£è¡¨1440/1080=1.33pxï¼›æŠŠé«˜åˆ†æˆ1920ä»½ï¼Œæ¯ä»½ä»£è¡¨2560/1920=1.33pxï¼›\n\nå°†è¿™äº›æ–‡ä»¶åˆ†åˆ«æ”¾åˆ°å¯¹åº”çš„ç›®å½•ä¸‹\n```shell\nvalues\nvalues-1280x720\nvalues-1920x1080\nvalues-2560x1440\n```\nåœ¨å†™å¸ƒå±€æ–‡ä»¶æ—¶ï¼Œæ§ä»¶çš„å°ºå¯¸å°±ç”¨è®¾è®¡ç¨¿ä¸Šçš„pxå°ºå¯¸ï¼Œæ¯”å¦‚ï¼Œè®¾è®¡ç¨¿ä¸Šå®½åº¦ä¸º100pxï¼Œé«˜åº¦ä¸º200pxï¼Œé‚£ä¹ˆåœ¨å¸ƒå±€æ–‡ä»¶é‡Œå°±å†™`@dimen/X100`ã€`@dimen/Y200`ï¼Œ\n\nåœ¨1280x720çš„å±å¹•ä¸Šï¼Œå°±ä¼šè¯»å–åˆ°ï¼Œå®½åº¦67pxï¼Œå æ¯”67/720=0.09ï¼Œé«˜åº¦133pxï¼Œå æ¯”133/1280=0.1ï¼›\nåœ¨1920x1080çš„å±å¹•ä¸Šï¼Œå°±ä¼šè¯»å–åˆ°ï¼Œå®½åº¦100pxï¼Œå æ¯”100/1080=0.09ï¼Œé«˜åº¦200pxï¼Œå æ¯”200/1920=0.1ï¼›\nåœ¨2560x1440çš„å±å¹•ä¸Šï¼Œå°±ä¼šè¯»å–åˆ°ï¼Œå®½åº¦133pxï¼Œå æ¯”133/1440=0.09ï¼Œé«˜åº¦266pxï¼Œå æ¯”266/2560=0.1ï¼›\n\nåŒä¸Šé¢ä¸€æ ·ï¼Œä¼šæœ‰ä¸€äº›äº›ç²¾åº¦ä¸Šçš„æŸå¤±ï¼Œä½†åŸºæœ¬ä¸Šè¿˜æ˜¯æ»¡è¶³äº†é€‚é…çš„éœ€æ±‚ã€‚è¿™å¥—æ–¹æ¡ˆä¹Ÿéœ€è¦ç²¾å‡†å‘½ä¸­ç›®æ ‡è®¾å¤‡å±å¹•çš„åƒç´ å®½é«˜ï¼Œå› ä¸ºåŒæ—¶æŒ‡å®šäº†å®½å’Œé«˜ï¼Œæ‰€ä»¥ç›¸æ¯”ä¸Šé¢åªæŒ‡å®šå®½åº¦çš„æ–¹æ¡ˆï¼Œéœ€è¦å‡†å¤‡æ›´å¤šçš„dimenæ–‡ä»¶ï¼Œè€Œç°åœ¨å¸‚åœºçš„å±å¹•äº”èŠ±å…«é—¨ï¼Œå¾ˆéš¾ä¿è¯å‡†å¤‡çš„æ–‡ä»¶å¯ä»¥å›Šæ‹¬æ‰€æœ‰çš„æƒ…å†µã€‚\n\n### æ€»ç»“\næŠ›å¼€éœ€æ±‚è°ˆé€‚é…å°±æ˜¯åœ¨æ‰¯æ·¡ï¼Œæ‰€ä»¥å¦‚æœè¯´å“ªä¸ªæ–¹æ¡ˆæœ€åˆé€‚ï¼Œè¿˜æ˜¯è¦çœ‹å…·ä½“çš„éœ€æ±‚ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¬¬ä¸€å¥—æ–¹æ¡ˆæ“ä½œç®€å•ï¼Œä¸”æˆæœ¬ä½ï¼Œä¸ç”¨é¢å¤–æ·»åŠ é€‚é…æ–‡ä»¶ï¼Œä¸ä¼šè¿›ä¸€æ­¥å¢åŠ åŒ…ä½“å¤§å°ã€‚","tags":["Android","å±å¹•é€‚é…"],"categories":["Android"]},{"title":"Android Fragment","url":"/2021/09/5536a870cb20/","content":"\nåŸæ–‡åœ°å€ï¼š[https://juejin.cn/post/7006970844542926855#heading-13](https://juejin.cn/post/7006970844542926855#heading-13)\n\n<!--more-->\n\nåŸä½œè€…çš„sloganæ˜¯ï¼Œå–œæ¬¢å†™åˆè‡­åˆé•¿çš„æ–‡ç« ã€‚è¿™ç¯‡æ–‡ç« ç¡®å®é•¿çš„å¾ˆï¼Œæ´‹æ´‹æ´’æ´’ä¸Šä¸‡å­—ï¼Œå°±è¿™å­—æ•°å°±è¿‡æ»¤æ‰äº†å¾ˆå¤§ä¸€éƒ¨åˆ†äººï¼Œä½†æ˜¯æˆ‘å–œæ¬¢ã€‚å†™çš„å¾ˆå¥½ï¼Œé‡Œé¢å†…å®¹æœ‰æ—§ä¹Ÿæœ‰æ–°ï¼Œæ‹…å¿ƒå“ªå¤©ç‚¹å¼€è¿™é“¾æ¥å¼¹å‡ºæ¥ä¸ª404ï¼Œæ‰€ä»¥æ‘˜æŠ„ç‚¹å‡ºæ¥ã€‚\n\n### ç”Ÿå‘½å‘¨æœŸ\nFragmentä¸­æœ‰ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä¸€ä¸ªè‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦ä¸€ä¸ªæ˜¯å…¶æ‰€åŒ…å«çš„Viewçš„ç”Ÿå‘½å‘¨æœŸï¼Œå…¶ä¸­çš„Viewæ˜¯å¯ä»¥å¤šæ¬¡è¢«åˆ›å»ºå’Œé”€æ¯çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ViewModelæ—¶ï¼Œè¦å°†æ•°æ®ä¸Viewçš„ç”Ÿå‘½å‘¨æœŸç›¸å…³è”ã€‚\n![](https://i.loli.net/2021/09/19/YHsuRZOc6TSxVJA.png)\n\n### å›é€€æ ˆ\nå¢åŠ /ç§»é™¤/æ›¿æ¢Fragmentéƒ½æ˜¯åŸºäºäº‹åŠ¡è¿›è¡Œçš„ï¼Œå½“æäº¤äº‹åŠ¡æ—¶ï¼Œå°†äº‹åŠ¡æ·»åŠ åˆ°äº†å›é€€æ ˆï¼Œé‚£ä¹ˆåœ¨å°†äº‹åŠ¡ä»å›é€€æ ˆä¸­å¼¹å‡ºæ—¶ï¼ŒFragmentManagerå°±ä¼šreverse its operationï¼Œåå‘æ‰§è¡Œäº‹åŠ¡çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ¢å¤æˆè¯¥äº‹åŠ¡æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€ã€‚æŒ‰ä¸‹è¿”å›é”®ï¼Œå¦‚æœå›é€€æ ˆä¸ä¸ºç©ºï¼Œåˆ™å›é€€æ ˆå°±ä¼šå¼¹å‡ºäº‹åŠ¡æ¥å“åº”è¿”å›æŒ‰é’®äº‹ä»¶ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸å°†äº‹åŠ¡åŠ åˆ°å›é€€æ ˆä¸­ã€‚ç›¸å…³æ¥å£ï¼š\n```kotlin\nFragmentTransaction.addToBackStack\nFragmentTransaction.popBackStack\nFragmentTransaction.disallowAddToBackStack\n```\n\n### registerForActivityResult\n`startActivityForResult`å’Œ`onActivityResult`éƒ½å·²ç»åºŸå¼ƒï¼Œ`registerForActivityResult`æ˜¯å®˜æ–¹æ¨èçš„ä»Activityè·å–æ•°æ®çš„æ–¹å¼ï¼Œæ–°æ–¹å¼å˜å¾—çµæ´»äº†ä¸å°‘ï¼Œå¦‚ä¸‹ï¼š\n- åˆ›å»º`ActivityResultContract<I, O>`çš„å®ä¾‹ï¼Œå£°æ˜è¾“å…¥/è¾“å‡ºæ•°æ®ï¼Œéœ€è¦å®ç°é‡Œé¢çš„æŠ½è±¡æ–¹æ³•ã€‚`createIntent`æ–¹æ³•ç”¨æ¥è·å–è·³è½¬çš„Intentï¼Œ`parseResult`ç”¨æ¥å¤„ç†è¿”å›çš„æ•°æ®\n- åˆ›å»º`ActivityResultCallback<O>`æ¥å£å®ä¾‹ï¼Œç”¨æ¥å¤„ç†è¿”å›çš„æ•°æ®ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªæ–¹æ³•`onActivityResult`\n- æœ€åè°ƒç”¨ComponentActivityä¸­æ–¹æ³•`registerForActivityResult(contract, callback)`æŠŠå‰ä¸¤æ­¥åˆ›å»ºçš„å‚æ•°ä¼ å…¥å³å¯\n\n### Fragment Result\nåœ¨FragmentManageræœ‰è¿™æ ·ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®é€šä¿¡ï¼š\n```java\npublic final void setFragmentResultListener(String requestKey, LifecycleOwner lifecycleOwner, FragmentResultListener listener)\n\npublic final void setFragmentResult(String requestKey, Bundle result)\n```\nç®€å•è¯´ï¼Œå°±æ˜¯åœ¨è§‚å¯Ÿè€…æ¨¡å¼çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šäº†ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä¸ç®¡æ˜¯Activityè¿˜æ˜¯Fragmentï¼Œåªè¦èƒ½è·å–åˆ°åŒä¸€ä¸ªFragmentManagerå°±å¯ä»¥é€šä¿¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡Œé¢ä¿å­˜keyå’Œlistenerç”¨çš„æ˜¯`Map<String, FragmentResultListener>`ï¼Œæ‰€ä»¥ä¸€ä¸ªkeyåªèƒ½æœ‰ä¸€ä¸ªlistenerï¼Œåé¢çš„ä¼šæŠŠå‰é¢çš„è¦†ç›–ã€‚\n\n### Fragmentä¸­ç›‘å¬è¿”å›æŒ‰é”®\n```kotlin\nclass PlaceholderFragment(private val sectionNumber: Int) :\n    Fragment(R.layout.fragment_placeholder) {\n\n    private val onBackPressedCallback = object : OnBackPressedCallback(true) {\n        override fun handleOnBackPressed() {\n            //TODO       \n        }\n    }\n\n    override fun onAttach(context: Context) {\n        super.onAttach(context)\n        requireActivity().onBackPressedDispatcher.addCallback(this, onBackPressedCallback)\n    }\n}\n```\n\n### å…¶ä»–ç”¨é€”\n- Fragmentå¯è®¾ç½®å†…éƒ¨çš„UI Viewï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ã€‚å½“ä¸è®¾ç½®æ—¶ï¼Œå¯ç”¨å…¶æ¥ç›‘å¬ç”Ÿå‘½å‘¨æœŸï¼Œå…¶ä¸­LifeCycleã€Glideç”¨çš„ä¾¿æ˜¯è¿™ç§æ–¹å¼ã€‚\n- ä¹Ÿå¯ä»¥ç”¨ä½œæ–¹æ³•ä»£ç†ï¼Œè¯·æ±‚æƒé™ï¼Œå¯å°†è¯·æ±‚ä¸å¤„ç†æ”¾åˆ°ä¸€èµ·å¤„ç†ï¼Œè€Œä¸æ˜¯åƒ`registerForActivityResult`åˆ†å¼€å¤„ç†ã€‚FragmentTransactionçš„`add`æ–¹æ³•éƒ½æœ‰å¤šä¸ªé‡è½½æ–¹æ³•ï¼Œæ”¯æŒåªæ·»åŠ ä¸€ä¸ªFragmentï¼Œè‹¥æ­¤Fragmentæ— Viewï¼Œåˆ™å¯¹ç”¨æˆ·æ¥è¯´æ˜¯æ— æ„Ÿçš„ï¼Œä½†å¯¹äºæˆ‘ä»¬æ¥è®²å¯ä»¥åœ¨å…¶ä¸­å¤„ç†ä¸€äº›ä¸šåŠ¡ã€‚","tags":["Android","Fragment"],"categories":["Android"]},{"title":"Androidä¹‹æ£€æŸ¥çŸ¥å¦å¼€äº†ä»£ç†","url":"/2021/09/044f31f510db/","content":"\næœ€è¿‘æœ‰ä¸ªæ–°éœ€æ±‚ï¼Œç”¨æˆ·å¦‚æœå¼€å¯äº†ä»£ç†ï¼Œå°±ä¸è®©è¿›å…¥ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹æ£€æŸ¥æ–¹å¼ã€‚\n\n<!--more-->\nç®€å•è¯´ï¼Œå°±æ˜¯é€šè¿‡`ConnectivityManager`è·å–åˆ°è®¾å¤‡å½“å‰çš„æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼Œå¦‚æœå…¶ä¸­åŒ…å«`TRANSPORT_VPN`ç±»å‹çš„è¿æ¥ï¼Œåˆ™è®¤ä¸ºå¼€å¯äº†ä»£ç†ã€‚\n\nä»£ç å¦‚ä¸‹\n```kotlin\nfun checkProxyOpen(ctx: Context): Boolean {\n     val manager = ctx.getSystemService(Context.CONNECTIVITY_SERVICE) as ConnectivityManager\n     manager.allNetworks.toList().forEach { network ->\n         val cap = manager.getNetworkCapabilities(network)\n         val vpnTransport = cap?.hasTransport(NetworkCapabilities.TRANSPORT_VPN) ?: false\n         if (vpnTransport) {\n             return true\n         }\n     }\n     return false\n}\n```","tags":["Android","Proxy"],"categories":["Android"]},{"title":"å¤šapkå¯¼å‡ºä¸å®‰è£…","url":"/2021/09/b14c888939d1/","content":"\nåœ¨aabç››è¡Œçš„å¹´ä»£ï¼Œä¸€ä¸ªåº”ç”¨å·²ç»ä¸å•å•å¯¹åº”ä¸€ä¸ªapkæ–‡ä»¶äº†ï¼Œç»å¸¸æ˜¯ä¸¤ä¸ªï¼Œæˆ–æ˜¯å¤šä¸ªã€‚\n\n<!--more-->\nåœ¨è®¾å¤‡ä¸Šå®‰è£…ä¸€ä¸ªåº”ç”¨åï¼Œå®‰è£…æ—¶çš„apkæ–‡ä»¶éƒ½æ˜¯ä¼šå­˜å‚¨åœ¨æ‰‹æœºé‡Œçš„ã€‚ä¸çŸ¥é“åšæ²¡åšè¿‡è¿™æ ·çš„éœ€æ±‚ï¼Œå°±æ˜¯åç¼–è¯‘åˆ«äººapkï¼Œçœ‹çœ‹é‡Œé¢éƒ½æœ‰äº›ä»€ä¹ˆï¼Œå›¾ç‰‡èµ„æºä¹Ÿå¥½ï¼Œåº“æ–‡ä»¶ä¹Ÿç½¢ã€‚\n\n### adbå¯¼å‡ºapk\n\n```shell\n# å¦‚æœä¸çŸ¥é“å®Œæ•´çš„åŒ…åï¼Œå°±å…ˆè¿™æ ·è¿‡æ»¤å‡ºç›®æ ‡åŒ…å\n$ adb shell pm list package | grep key-word\n\n# è·å–apkæ–‡ä»¶è·¯å¾„\n$ adb shell pm path target.pakcage.name\n\n# ç»è¿‡ä¸Šä¸€æ­¥ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªapkæ–‡ä»¶çš„è·¯å¾„ï¼Œå¯¼å‡ºåˆ°æœ¬åœ°\n$ adb pull xxxx.apk ~/xxx.apk\n```\næ‹¿åˆ°apkæ–‡ä»¶äº†ï¼Œå°±å¯ä»¥åšæƒ³åšçš„äº‹äº†ï¼Œæ¯”å¦‚ç”¨jadxåç¼–è¯‘ã€‚\n\nå¦å¤–ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä½ç½®ï¼Œé€šè¿‡package managerä¹Ÿå¯ä»¥å¾—åˆ°ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```java\nPackageManager pm = getPackageManager();\nApplicationInfo info = pm.getApplicationInfo(\"package_name\", 0);\nString path = info.sourceDir; // è¿™ä¸ªpathå°±æ˜¯ä¸Šé¢pm pathçš„ç»“æœ\n```\n\n### adbå®‰è£…å¤šapk\nå®‰è£…å•ä¸ªapk\n```shell\n$ adb install xxx.apk\n```\nå®‰è£…å¤šä¸ªapk\n```shell\n$ adb install-multiple 1.apk 2.apk 3.apk\n```\n\n### é¢˜å¤–è¯\nç»ˆç«¯çª—å£ç›´æ¥æ‰§è¡Œadbå‘½ä»¤ï¼Œä¼šæ˜¾ç¤ºå‡ºå‘½ä»¤ä»‹ç»ï¼Œä¸éš¾å‘ç°å®ƒæœ‰ä¸‰ä¸ªå®‰è£…å‘½ä»¤ï¼Œ\n```shell\n$ adb\napp installation (see also `adb shell cmd package help`):\n install [-lrtsdg] [--instant] PACKAGE\n     push a single package to the device and install it\n install-multiple [-lrtsdpg] [--instant] PACKAGE...\n     push multiple APKs to the device for a single package and install them\n install-multi-package [-lrtsdpg] [--instant] PACKAGE...\n```\né™¤äº†installå’Œinstall-multipleï¼Œè¿˜æœ‰ä¸ªinstall-multi-packageå‘½ä»¤ã€‚\n\ninstallå’Œinstall-multipleéƒ½æ˜¯å®‰è£…å•åº”ç”¨çš„ï¼Œä¸€ä¸ªå¯¹åº”å•apkï¼Œä¸€ä¸ªæ˜¯å¤šapkã€‚è€Œinstall-multi-packageå‘½ä»¤æ˜¯å®‰è£…å¤šåº”ç”¨ï¼Œæ„æ€å°±æ˜¯ä¸€æ¬¡åŒæ—¶å®‰è£…å¤šä¸ªåº”ç”¨ã€‚ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ€ä¹ˆä¼šéœ€è¦ä¸€æ¬¡å®‰è£…å¤šä¸ªåº”ç”¨å‘¢ï¼Œå¹³å¸¸ä¸éƒ½æ˜¯å•ä¸ªå¼€å‘çš„å—ï¼Ÿ\n\næœ‰äº›éœ€æ±‚å§ï¼Œç›´åˆ°ä½ é‡åˆ°å‰ä½ éƒ½ä¸ä¼šç›¸ä¿¡ï¼šåŸæ¥è¿˜çœŸçš„ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚å•Šï½\n\næˆ‘æ˜¯çœŸçš„é‡åˆ°äº†ï¼Œæ‰€ä»¥é¡ºä¾¿æä¸€æã€‚å¦å¤–è¿˜æœ‰ï¼Œä¸æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„è®¾å¤‡éƒ½æ”¯æŒè¿™ä¸ªå‘½ä»¤ï¼Œåœ¨ä¸æ”¯æŒçš„è®¾å¤‡ä¸Šæ‰§è¡Œåå°±ä¼šæŠ¥é”™ï¼Œä¸ç”¨æ·±ç©¶ï¼Œæ¢ä¸ªæµ‹è¯•æœºå°±å¯ä»¥ã€‚","tags":["Android"],"categories":["Android"]},{"title":"Androidä¹‹drawableå’Œmipmapçš„åŒºåˆ«","url":"/2021/09/86f0cc8aed5a/","content":"\nAndroidé¡¹ç›®é‡Œï¼Œresä¸­æœ‰ä¸¤ç§æ”¾èµ„æºå›¾ç‰‡çš„ç›®å½•ï¼Œä¸€ä¸ªæ˜¯drawableï¼Œå¦ä¸€ä¸ªæ˜¯mipmapã€‚\n\n<!--more-->\n\nä½¿ç”¨Android Stuidoåˆ›å»ºæ–°é¡¹ç›®æ—¶ï¼Œé»˜è®¤ä¼šæŠŠapp iconæ”¾åˆ°mipmapé‡Œï¼Œæ¯ä¸ªåˆ†è¾¨ç‡é‡Œå„æ”¾ä¸€ä»½ï¼Œä»hdpiåˆ°xxxhdpiï¼Œ1å€å›¾åˆ°4å€å›¾ã€‚\n\nä½†æ˜¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œèµ„æºå›¾ä¸€èˆ¬éƒ½æ˜¯æ”¾åˆ°drawableä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯3å€å›¾ç›®å½•ï¼Œdrawable-xxhdpiï¼Œä¹ æƒ¯äº†è¿™æ ·åšå´æ²¡æ·±ç©¶ä¸ºä»€ä¹ˆè¿™æ ·åšã€‚\n\næ—¢ç„¶å·²ç»åˆ›å»ºäº†mipmapç›®å½•ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ï¼Œè€Œéè¦ç”¨æ‰‹åŠ¨åˆ›å»ºçš„drawableç›®å½•å‘¢ï¼Ÿ\n\nçªç„¶æƒ³åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå°±æŸ¥äº†ä¸€ä¸‹ï¼ŒåŸæ¥è¿™ä¸¤ä¸ªç›®å½•é™¤äº†åå­—ï¼Œè¿˜æ˜¯æœ‰å…¶ä»–åŒºåˆ«çš„ï¼š\nmipmapç›®å½•åœ¨å®‰è£…åˆ°è®¾å¤‡åï¼Œå„ä¸ªåˆ†è¾¨ç‡çš„èµ„æºä¼šå…¨éƒ¨ä¿ç•™ï¼Œè€Œdrawableä¸‹çš„èµ„æºåªä¼šé€‰æ‹©ä¸€ä»½åˆé€‚çš„ï¼Œå…¶ä»–çš„ä¸ä¿ç•™ã€‚\n\nç‰¹æ„éªŒè¯äº†ä¸€ä¸‹ï¼š\n- åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼ŒæŠŠä¸€å¼ å›¾åœ¨drawable-xxhdpiï¼ˆ3å€ï¼‰å’Œdrawable-xhdpiï¼ˆ2å€ï¼‰ä¸­å„æ”¾ä¸€ä»½\n- å®‰è£…åˆ°ä¸€ä¸ªå±å¹•å¯†åº¦440ï¼Œä¹Ÿå°±æ˜¯2.75å€çš„è®¾å¤‡ä¸Šï¼ˆ160ä¸º1å€ï¼‰\n- adbå¯¼å‡ºapkåŒ…ï¼Œjadxåç¼–è¯‘\n- å‘ç°åªæœ‰3å€ç›®å½•ä¸‹æœ‰è¿™å¼ å›¾ï¼Œ2å€ç›®å½•ä¸‹æ²¡æœ‰\n- éªŒè¯æ­£ç¡®","tags":["Android"],"categories":["Android"]},{"title":"AABä»‹ç»ä»¥åŠbundletoolçš„ä½¿ç”¨","url":"/2021/09/4d7cb573fdf1/","content":"\nè‡ª2021å¹´8æœˆå¼€å§‹ï¼ŒGooglePlayå•†åº—è¦æ±‚å¼€å‘è€…ä½¿ç”¨AABæ¥å‘å¸ƒæ–°åº”ç”¨ã€‚è‡ªæ‰“2018å¹´5æœˆè°·æ­Œå®˜æ–¹æ¨å‡ºAABï¼Œå·²ç»è¿‡å»äº†3ä¸ªå¹´å¤´ã€‚\n\n<!--more-->\n\n### ä»‹ç»\nAABï¼Œå³Android App Bundleï¼Œå¯ä»¥æŠŠå®ƒç†è§£æˆæ˜¯æ–°ä¸€ä»£çš„APKã€‚ç›¸æ¯”äºAPKï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¿›ä¸€æ­¥å‡å°å®‰è£…åŒ…çš„å¤§å°ã€‚\n\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœé¡¹ç›®äº†å¼•ç”¨äº†nativeåº“ï¼Œé‚£ä¹ˆä¸€èˆ¬éƒ½ä¼šæœ‰å¤šä¸ªsoåº“æ–‡ä»¶ï¼Œæ¯ä¸ªåº“æ–‡ä»¶å¯¹åº”ä¸€ç§abiæ¶æ„ã€‚\n\nå½“ä½¿ç”¨apkå®‰è£…æ—¶ï¼Œéœ€è¦æŠŠæ‰€æœ‰soæ–‡ä»¶æ‰“åˆ°apkæ–‡ä»¶é‡Œï¼Œç§»åŠ¨ç«¯ä¸‹è½½è¯¥apkæ–‡ä»¶æ¥å®‰è£…ç¨‹åºï¼›\n\nå½“ä½¿ç”¨aabå®‰è£…æ—¶ï¼Œä¼šæ ¹æ®ç§»åŠ¨ç«¯çš„æ¶æ„é€‰æ‹©å‡ºå¯¹åº”çš„åº“æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–èµ„æºå’Œä»£ç ï¼Œæ‰“åˆ°apkæ–‡ä»¶é‡Œï¼Œç§»åŠ¨ç«¯ä¸‹è½½è¯¥apkæ–‡ä»¶æ¥å®‰è£…ç¨‹åºï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸‹è½½å…¶ä»–ç”¨ä¸ä¸Šçš„åº“æ–‡ä»¶ï¼Œä¸‹è½½çš„æ–‡ä»¶å°ï¼Œçœæ—¶é—´åˆçœæµé‡ï¼Œç”¨æˆ·ä½“éªŒå¥½ï¼Œæ‰€æœ‰å®˜æ–¹ä¸»æ¨è¿™ç§æ ¼å¼ã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼Œä¸­é—´æœ‰ä¸ªè¿‡ç¨‹ï¼Œæ ¹æ®è¯·æ±‚å®‰è£…çš„å®¢æˆ·ç«¯æ¥ç”Ÿæˆå¯¹åº”çš„apkå®‰è£…åŒ…ï¼Œè¿™ä»¶äº‹å°±æ˜¯Goolge Playå•†åº—åœ¨åšã€‚ç›®å‰ï¼Œä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨å•†åº—éƒ½æ”¯æŒäº†è¿™ä¸ªæ“ä½œï¼Œåªèƒ½åœ¨æ”¯æŒçš„åº”ç”¨å•†åº—ä¸Šä½¿ç”¨aabåˆ†å‘åº”ç”¨ï¼Œä¸æ”¯æŒçš„ä¾ç„¶è¦ç”¨apkæ ¼å¼çš„æ–‡ä»¶ã€‚\n\n### åˆ†å‰²ç»´åº¦\næ ¹æ®å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼Œ[ç‚¹å‡»æŸ¥çœ‹](https://developer.android.com/guide/app-bundle/configure-base#disable_config_apks)ï¼Œæ”¯æŒ3ä¸ªç»´åº¦çš„åˆ†å‰²ï¼šè¯­è¨€ã€åˆ†è¾¨ç‡å’Œæ¶æ„\n```groovy\nandroid {\n    // When building Android App Bundles, the splits block is ignored.\n    splits {...}\n\n    // Instead, use the bundle block to control which types of configuration APKs\n    // you want your app bundle to support.\n    bundle {\n        language {\n            // Specifies that the app bundle should not support\n            // configuration APKs for language resources. These\n            // resources are instead packaged with each base and\n            // feature APK.\n            enableSplit = false\n        }\n        density {\n            // This property is set to true by default.\n            enableSplit = true\n        }\n        abi {\n            // This property is set to true by default.\n            enableSplit = true\n        }\n    }\n}\n```\n\n### ç”Ÿæˆaabæ–‡ä»¶\nGradleä»»åŠ¡ä¸­ï¼Œæœ‰é…ç½®å¥½çš„taskï¼ŒbundleDebugã€bundleReleaseï¼Œæ‰§è¡Œå¯¹åº”çš„taskå°±å¯ä»¥ç”Ÿæˆaabæ–‡ä»¶ã€‚\n\nä¸¥æ ¼æ¥è®²ï¼Œaabæ–‡ä»¶å¹¶ä¸æ˜¯å®‰è£…åŒ…ï¼Œåœ¨ç”Ÿæˆçš„æ—¶å€™å¹¶ä¸çŸ¥é“ç›®æ ‡è®¾å¤‡çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åªèƒ½ç®—æ˜¯ä¸€å †é›¶ä»¶ï¼Œå¯ä»¥æŒ‰éœ€ç»„è£…ã€‚\n\n### bundletool\n[è°·æ­Œå®˜æ–¹ä»‹ç»](https://developer.android.com/studio/command-line/bundletool) [å®˜æ–¹é¡¹ç›®åœ°å€](https://github.com/google/bundletool)\nè¿™æ˜¯ä¸ªä¸“é—¨ç”¨æ¥æ“ä½œaabæ–‡ä»¶çš„å·¥å…·ï¼Œå¯åœ¨é¡¹ç›®é‡Œç›´æ¥ä¸‹è½½jaråŒ…ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`brew install bundletool`å®‰è£…ã€‚\n\nè¿™ä¸ªå·¥å…·å¯ä»¥é€šè¿‡aabæ–‡ä»¶ç”Ÿæˆapksã€å°†apkså®‰è£…åˆ°æ‰‹æœºï¼Œè¿˜æœ‰å‡ ä¸ªä¸å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥çœ‹é¡¹ç›®é‡Œçš„ä»‹ç»ã€‚\n\n1. ç”Ÿæˆè®¾å¤‡è§„èŒƒçš„JSONæ–‡ä»¶\n```shell\n$ bundletool get-device-spec --output=/tmp/device-spec.json\n```\nè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”Ÿæˆå½“å‰è¿æ¥è®¾å¤‡çš„è§„èŒƒæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å‚æ•°ä¿¡æ¯æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n```json\n{\n  \"supportedAbis\": [\"arm64-v8a\", \"armeabi-v7a\"],\n  \"supportedLocales\": [\"en\", \"fr\"],\n  \"screenDensity\": 640,\n  \"sdkVersion\": 27\n}\n```\n\n2. ç”Ÿæˆapks\n```shell\n$ bundletool build-apks --bundle=/MyApp/my_app.aab --output=/MyApp/my_app.apks\n```\næ­¤å¤–è¿˜å¯ä»¥é€šè¿‡`ks`,`ks-pass`,`ks-key-alias`,`key-pass`å››ä¸ªå‚æ•°æ¥æŒ‡å®šç­¾åï¼Œå¦‚æœä¸æŒ‡å®šåˆ™ä½¿ç”¨ç¼ºçœçš„ç­¾åæ–‡ä»¶\nè¿™ä¸ªapksæ˜¯é’ˆå¯¹æ‰€æœ‰è®¾å¤‡ï¼ŒåŠ ä¸Š`--connected-device`æ•°å¯ç”Ÿæˆåªé’ˆå¯¹å½“å‰è¿æ¥çš„è®¾å¤‡ï¼Œå¤šä¸ªè®¾å¤‡æ—¶ä½¿ç”¨`--device-id=serial-id`ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`--device-spec=xxx.json`é€šè¿‡JSONæ–‡ä»¶æ¥é™å®šã€‚\nä¸ºä»€ä¹ˆæ˜¯apkså‘¢ï¼Œå› ä¸ºè¿™çœŸçš„å°±æ˜¯å¤šä¸ªapkã€‚æŠŠ.apksæ”¹æˆ.zipåè§£å‹ç¼©ï¼Œå°±ä¼šçœ‹åˆ°é‡Œé¢æœ‰å¾ˆå¤šapkæ–‡ä»¶ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„apkï¼Œä»¥åŠæŒ‰ç»´åº¦åˆ†å‰²çš„apkã€‚\n\n3. å®‰è£…apksåˆ°è®¾å¤‡\n```shell\n$ bundletool install-apks --apks=xxx.apks\n```\nå¯ä»¥å†æ£€æŸ¥ä¸€ä¸‹éƒ½å®‰è£…äº†å“ªå‡ ä¸ªapkæ–‡ä»¶ï¼š\n```shell\n$ adb shell pm path your.app.package.name\npackage:/data/app/your.app.package.name-_cJc4OrWZxYQCwC4AaWAtw==/base.apk\npackage:/data/app/your.app.package.name-_cJc4OrWZxYQCwC4AaWAtw==/split_config.arm64_v8a.apk\n```\nå¯ä»¥çœ‹åˆ°ï¼Œå®‰è£…äº†ä¸€ä¸ªåŸºæœ¬çš„base.apkï¼Œä»¥åŠä¸€ä¸ªå¯¹åº”abiçš„apkã€‚æƒ³æŸ¥è¯¢è®¾å¤‡ä¸Šå…¶ä»–appæ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤æ¥æŸ¥è¯¢åŒ…åï¼š\n```shell\n$ adb shell pm list package | grep key-word\n```\n\n4. å…¶ä»–å‘½ä»¤\n- æŠ½å–apksçš„å­é›†\n```shell\nbundletool extract-apks\n--apks=/MyApp/my_existing_APK_set.apks\n--output-dir=/MyApp/my_pixel2_APK_set.apks\n--device-spec=/MyApp/bundletool/pixel2.json\n```\n- è·å–ä¸‹è½½çš„å¤§å°\n```shell\nbundletool get-size total --apks=/MyApp/my_app.apks\n```\n\n### æ€»ç»“\nå›½å†…ä¸€èˆ¬éƒ½æ˜¯æ— çº¿ç½‘æ¥ä¸‹è½½ã€å®‰è£…ï¼Œä½†è€å¤–ä»¬ä½¿ç”¨æµé‡çš„å´ä¸åœ¨å°‘æ•°ï¼Œæ‰€ä»¥å¦‚æœèƒ½å‡å°‘å®‰è£…åŒ…çš„å¤§å°ï¼Œå¯¹äºæé«˜CVRè¿˜æ˜¯æœ‰ä¸€å®šå¸®åŠ©çš„ã€‚\n\n","tags":["Android","bundletool"],"categories":["Android"]},{"title":"Androidæ··æ·†é…ç½®","url":"/2021/09/54483afe4c94/","content":"\nè®°å½•ä¸€ä¸‹æ··æ·†é…ç½®ã€‚\n\n<!--more-->\n\næ··æ·†ï¼Œå…¶å®å°±æ˜¯ç»™é¡¹ç›®é‡Œçš„ç±»ã€å˜é‡ã€æ–¹æ³•ç­‰ï¼Œæ¢ä¸ªåå­—ï¼Œä»¥æ­¤æ¥é™ä½å¯è¯»æ€§ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä½¿åŒ…ä½“å˜å°ã€‚\n\n### å•æ¨¡å—é¡¹ç›®\nè¿™ä¸ªç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦é…ç½®build.gradleæ–‡ä»¶\n```groovy\nandroid {\n    buildTypes {\n        release {\n            minifyEnabled true // æ‰“å¼€æ··æ·†å¼€å…³ï¼Œåªæœ‰ä¸ºtrueçš„æ—¶å€™æ‰ä¼šæ··æ·†\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n            // è¿˜å¯ä»¥å†åŠ ä¸¤ä¸ªé…ç½®æ¥è¿›ä¸€æ­¥å‡å°åŒ…ä½“\n            zipAlignEnabled true // å¯¹é½\n            shrinkResources true // ç§»é™¤\n        }\n    }\n}\n```\n- åªæœ‰æ‰“å¼€minifyEnabledå¼€å…³æ‰ä¼šæ··æ·†\n- proguardFilesç”¨æ¥æŒ‡å®šæ··æ·†é…ç½®æ–‡ä»¶ï¼Œå‚æ•°é‡Œçš„æ–‡ä»¶éƒ½ä¼šç”Ÿæ•ˆ\n- proguard-android-optimize.txtåœ¨: ï½/Android/sdk/tools/proguard/ç›®å½•ä¸‹\n- é™¤äº†ä¸Šé¢è¿™ä¸ªæ–‡ä»¶ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªå®˜æ–¹å†™å¥½çš„é»˜è®¤é…ç½®\n- proguard-rule.proåœ¨build.gradleåŒç›®å½•ä¸‹ï¼Œè‡ªå·±é¢å¤–çš„æ··æ·†é…ç½®å†™åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œ\n\n### å¤šæ¨¡å—é¡¹ç›®\næ‰€æœ‰æ··æ·†é…ç½®å†™åœ¨ä¸€èµ·ï¼Œä¾¿äºä¿®æ”¹å’Œç®¡ç†ï¼Œä½†æ˜¯å½“ä¸å†ä¾èµ–å…¶ä¸­æŸä¸ªæ¨¡å—è€Œå°†å…¶ç§»é™¤åï¼Œè¿™æ—¶æ··æ·†æ–‡ä»¶ä¸­å¯¹åº”çš„é…ç½®å°±æ˜¯å†—ä½™çš„ã€‚\n\næ‰€ä»¥ï¼Œä¸€èˆ¬éƒ½æ˜¯å„è‡ªæ¨¡å—çš„æ··æ·†é…ç½®å†™åœ¨æ‰€åœ¨çš„æ¨¡å—é‡Œã€‚ä¸»æ¨¡å—å¼€å¯æ··æ·†ï¼Œå°±ä¼šç»™æ‰€æœ‰æ¨¡å—æ··æ·†ã€‚\n\nä¸»æ¨¡å—çš„é…ç½®ä¾ç„¶åŒä¸Šï¼Œå­æ¨¡å—çš„é…ç½®å¦‚ä¸‹ï¼š\n```groovy\nandroid {\n    buildTypes {\n        release {\n            consumerProguardFiles 'proguard-rules.pro'\n        }\n    }\n}\n```\nå¦‚æœä¸å…³å¿ƒç¼–è¯‘ç±»å‹çš„è¯ï¼Œå¯ä»¥ç›´æ¥å†™åœ¨é»˜è®¤é…ç½®å—ï¼Œä½¿ç”¨AndroidStudioåˆ›å»ºé¡¹ç›®æ—¶ï¼Œå®ƒå·²ç»å¸®å¿™å†™ä¸Šäº†ï¼Œç”¨consumer-rules.proæ–‡ä»¶åæ¥åŒºåˆ†\n```groovy\nandroid {\n    defaultConfig {\n        consumerProguardFiles \"consumer-rules.pro\"\n    }\n}\n```\n- æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯consumerProguardFiles\n- proguardFilesé…ç½®åœ¨å­æ¨¡å—é‡Œæ˜¯ä¸ç”Ÿæ•ˆçš„\n- getDefaultProguardFileåªèƒ½åœ¨proguardFilesé‡Œä½¿ç”¨\n\n### è¾“å‡ºæ–‡ä»¶\n- dump.txt è¯´æ˜apkä¸­æ‰€æœ‰ç±»æ–‡ä»¶çš„å†…éƒ¨ç»“æ„\n- mapping.txt åŸå§‹äºæ··æ·†åçš„ç±»ã€æ–¹æ³•å’Œå­—æ®µåç§°çš„å¯¹åº”å…³ç³»\n- seeds.txt æœªè¿›è¡Œçš„æ··æ·†çš„ç±»å’Œæˆå‘˜\n- usage.txt ä»apkç§»é™¤çš„ä»£ç \n\n### æ€»ç»“\næ‰“å¼€å®˜æ–¹å†™å¥½çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢å·²ç»åŒ…å«äº†ç”¨åˆ°çš„åŸºæœ¬é…ç½®ã€‚æ‰€ä»¥ä¸ç®¡æ˜¯ä¸»æ¨¡å—è¿˜æ˜¯å­æ¨¡å—çš„proguard-rule.proé‡Œï¼Œåªéœ€è¦å†™ä¸Šè‡ªå·±é¢å¤–éœ€è¦çš„é…ç½®ï¼Œå¦‚gsonæ•°æ®ç±»ï¼Œä»¥åŠå¼•å…¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–æ‰€è¦æ±‚çš„åæ··æ·†é…ç½®ï¼Œå³å¯ã€‚","tags":["Android"],"categories":["Android"]},{"title":"Android 9å‘é€httpè¯·æ±‚","url":"/2021/09/3b8c4beeb864/","content":"\nç›®å‰çš„httpè¯·æ±‚æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ˜æ–‡çš„httpè¯·æ±‚ï¼Œä¸€ç§æ˜¯åŠ äº†å¯†çš„httpsè¯·æ±‚ã€‚å®˜æ–¹å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒAndroid 9åŠä»¥åçš„ç‰ˆæœ¬ï¼Œç³»ç»Ÿé»˜è®¤ç¦æ‰äº†httpè¯·æ±‚ã€‚ä½†æœ‰äº›éœ€æ±‚ï¼Œååéœ€è¦æˆ‘ä»¬å‘é€httpè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é¢å¤–åŠ ä¸ªé…ç½®ã€‚\n\n<!--more-->\n\nåœ¨resç›®å½•ä¸‹ï¼Œæ–°å»ºä¸ªåå«xmlçš„ç›®å½•ï¼Œåœ¨é‡Œé¢æ–°å»ºä¸ªxmlæ–‡ä»¶ï¼Œåå­—éšæ„åˆæ³•å³å¯ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯å«`network_security_config.xml`ï¼Œè®©äººä¸€çœ‹åˆ°åå­—å°±çŸ¥é“è¿™æ–‡ä»¶çš„ä½œç”¨ã€‚æ–‡ä»¶å†…æ·»åŠ httpè®¿é—®è¯·æ±‚çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<network-security-config>\n    <base-config cleartextTrafficPermitted=\"true\" />\n</network-security-config>\n```\n\nç„¶åå†æŠŠè¿™ä¸ªé…ç½®ï¼Œåº”ç”¨åˆ°applicationï¼Œåœ¨AndroidManifest.xmlä¸­ï¼Œä¿®æ”¹applicationæ ‡ç­¾ï¼Œæ·»åŠ ä¸€è¡Œï¼Œå¦‚ä¸‹ï¼š\n```xml\n <!-- å…¶ä»–å†…å®¹çœç•¥ -->\n <application\n        android:networkSecurityConfig=\"@xml/network_security_config\"> \n</application>\n```\n\nåˆ›å»ºä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶ååº”ç”¨åˆ°applicationï¼Œè¿™æ ·å°±å¯ä»¥å‘é€httpè¯·æ±‚äº†ã€‚","tags":["Android","Http"],"categories":["Android"]},{"title":"Javaä¹‹åå°„","url":"/2021/09/48858ef75b98/","content":"\nåå°„ï¼Œæ˜¯Javaçš„ä¸€ç§é«˜çº§ç‰¹æ€§ã€‚å°±æˆ‘è€Œè¨€ï¼Œå®é™…å¼€å‘ä¸­å¾ˆå°‘é‡åˆ°ç”¨åå°„çš„éœ€æ±‚ï¼Œä½†è¿™å¹¶ä¸èƒ½å¦å®šåå°„çš„é‡è¦åœ°ä½ï¼Œè¿™ç¯‡æ–‡ç« æ¥ç®€å•è¯´ä¸€è¯´ã€‚\n\n<!--more-->\n\n\n### å‰è¨€\nåœ¨Javaé‡Œï¼Œæœ‰ä¸€ä¸ªç±»ï¼Œåå­—å«`Class`ï¼Œè¿™ä¸ªåå­—æ€»æ˜¯å®¹æ˜“ç»™äººä¸€ç§è¿™æ˜¯ä¸ªç‰¹æ®Šçš„ç±»ã€‚å…¶å®ï¼Œå’Œå…¶ä»–ç±»ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªæ™®é€šçš„ç±»ï¼Œåœ¨`java.lang`åŒ…ä¸‹ï¼Œlangå°±æ˜¯languageçš„ç®€å†™ï¼Œé‡Œé¢éƒ½æ˜¯å’ŒJavaè¯­è¨€æœ¬èº«ç›¸å…³çš„ä¸œè¥¿ã€‚è¿™ä¸ªç±»é‡Œé¢åŒ…å«äº†ä¸€ä¸ªç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼š\n```java\n// çœç•¥äº†ä¸€äº›ä»£ç \npackage java.lang\n\npublic final class Class<T> {\n\n\t// è¿™é‡Œåªåˆ—ä¸¾äº†ä¸€éƒ¨åˆ†\n\tString name; // ç±»å\n\tClassLoader classLoader; // ç±»åŠ è½½å™¨\n\tString packageName; // åŒ…å\n\tClass<?>[] interfaces; // æ‰€å®ç°çš„æ¥å£\n\tConstructor<?>[] contructors; // æ„é€ æ–¹æ³•\n\tField[] fields; // å­—æ®µ\n\tMethod[] methods; // æ–¹æ³•\n\tint modifiers; // ç±»ä¿®é¥°ç¬¦\n\n    private Class(ClassLoader loader, Class<?> arrayComponentType) {\n        this.classLoader = loader;\n        this.componentType = arrayComponentType;\n    }\n}\n```\n\nåœ¨JVMé¦–æ¬¡è°ƒç”¨åˆ°ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œä¼šå…ˆå°†è¿™ä¸ªç±»åŠ è½½åˆ°JVMé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨ä¸ºè¿™ä¸ªç±»åˆ›å»ºClasså®ä¾‹ï¼Œä¸”JVMåªä¼šä¸ºæ¯ä¸ªç±»åˆ›å»ºä¸€ä¸ªClasså®ä¾‹ï¼Œå¦‚æœå­˜åœ¨åˆ™åœ¨ç›´æ¥ä½¿ç”¨ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒClassåªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œä¸”æ˜¯ç§æœ‰çš„ï¼Œåªæœ‰JVMå¯ä»¥è°ƒç”¨ã€‚\n\né‚£ä¹ˆï¼Œæ€ä¹ˆè·å–åˆ°JVMåˆ›å»ºçš„Classå®ä¾‹å‘¢ï¼Ÿä¸€å…±æœ‰3ç§æ–¹å¼ï¼š\n```java\n// æ–¹å¼1ï¼šé€šè¿‡ç±»çš„é™æ€å˜é‡class\nClass clz = String.class;\n\n// æ–¹å¼2ï¼šé€šè¿‡å®ä¾‹çš„æ–¹æ³•\nString str = \"str\";\nClass clz = str.getClass();\n\n// æ–¹å¼3ï¼šé€šè¿‡Classçš„é™æ€æ–¹æ³•Class.forName\n// Class.forNameæœ‰3ä¸ªé‡è½½æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥ä¸åŒçš„é™å®šåç§°\nClass clz = Class.forName(\"java.lang.String\");\n```\n\né€šè¿‡ç±»çš„Classå®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºç±»çš„å®ä¾‹ï¼Œè°ƒç”¨ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ã€å’Œæˆå‘˜æ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰çš„ã€‚\n\n### æ–¹æ³•æ¦‚è§ˆ\né€šè¿‡åå°„ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªç›®çš„ï¼šè·å–æ„é€ æ–¹æ³•Constructoræ¥åˆ›å»ºå®ä¾‹ã€è·å–æ–¹æ³•Methodæ¥è°ƒç”¨ï¼Œä»¥åŠè·å–å­—æ®µFieldæ¥set/getå€¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è·å–å…¶ä»–ä¿¡æ¯ï¼Œå¦‚æ³¨è§£ï¼Œæ¥å®Œæˆé¢å¤–çš„æ“ä½œï¼Œè¿™äº›åœ¨è¿™å…ˆä¸è®¨è®ºã€‚\n\n||æ„é€ æ–¹æ³•|å­—æ®µ|æ–¹æ³•|\n|--|--|--|--|\n|å•ä¸ªpublic|getConstructor()|getField()|getMethod()|\n|æ‰€æœ‰public|getConstructors()|getFields()|getMethods()|\n|ç±»é‡Œä»»ä¸€|getDeclaredConstructor()|getDeclaredField()|getDeclaredMethod()|\n|ç±»é‡Œæ‰€æœ‰|getDeclaredConstructors()|getDeclaredFields()|getDeclaredMethods()|\n\n- ä¸åŠ sæ˜¯è·å–å•ä¸ªï¼ŒåŠ sæ˜¯è·å–æ‰€æœ‰\n- ä¸åŠ declaredçš„ï¼Œæ˜¯è·å–publicçš„ï¼Œprotectedéƒ½ä¸è¡Œï¼Œå¿…é¡»publicï¼Œå¯ä»¥æ˜¯è‡ªå·±çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»§æ‰¿çš„\n- åŠ declaredçš„ï¼Œæ˜¯è·å–ç±»é‡Œé¢è‡ªå·±å£°æ˜çš„ï¼Œåªèƒ½æ˜¯å†™åœ¨ç±»é‡Œçš„æˆå‘˜ï¼Œä¸èƒ½æ˜¯ç»§æ‰¿çš„ï¼Œå…¬å¼€çš„ã€ç§æœ‰çš„éƒ½å¯ä»¥è·å–\n\n### ç¤ºä¾‹ç±»\nåˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹æ¥å£å’Œä¸€ä¸ªç¤ºä¾‹ç±»ï¼Œå¾ˆç®€å•ï¼Œçœ‹ä¸€çœ¼å°±å¯ä»¥è·³è¿‡ã€‚\n```java\n// Personæ¥å£\npublic interface Person {\n    String getName();\n    void sayHi(String toWho);\n}\n\n// Studentå®ç°ç±»\npublic class Student implements Person {\n\n    // ä¸€ä¸ªç§æœ‰å˜é‡  ä¸€ä¸ªå…¬å¼€å˜é‡\n    private int sex;\n    public int score;\n\n    // ä¸€ä¸ªæ— å‚æ•°æ„é€ æ–¹æ³• ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•\n    public Student() {\n        this.score = 0;\n        this.sex = 1;\n    }\n\n    public Student(int score, int sex) {\n        this.score = score;\n        this.sex = sex;\n    }\n\n    // ç§æœ‰æ„é€ æ–¹æ³•\n    private Student(int score) {\n        this.score = score;\n        this.sex = 2;\n    }\n\n    // ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•\n    @Override\n    public String getName() { return \"student\"; }\n\n    @Override\n    public void sayHi(String toWho) {\n        System.out.println(\"student say hi to :\" + toWho);\n    }\n\n    // ä¸€ä¸ªç§æœ‰æ–¹æ³•\n    private void setSex(int sex) { this.sex = sex; }\n\n    public int getSex() { return sex; }\n}\n\n```\n\n### é€šè¿‡åå°„è·å–æ„é€ æ–¹æ³•\n- è·å–æ— å‚æ„é€ æ–¹æ³•\n```java\n// è·å–Classå®ä¾‹\nClass<Student> clz = Student.class;\n\nConstructor<Student> cst = clz.getConstructor();\nSystem.out.println(cst.newInstance().score); // ç¼ºçœå€¼ 0\n```\n- è·å–æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•\n```java\nClass<Student> clz = Student.class;\n\nConstructor<Student> cst = clz.getConstructor(int.class, int.class);\nSystem.out.println(cst.newInstance(80, 1).score); // ä¼ å…¥å€¼ 80\n```\n- è·å–ç§æœ‰çš„æ„é€ æ–¹æ³•\n```java\nClass<Student> clz = Student.class;\n\n// è¿™é‡Œå¿…é¡»ç”¨åŠ declaredçš„ï¼Œå› ä¸ºå¸¦ä¸€ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„\nConstructor<Student> ctr3 = clz.getDeclaredConstructor(int.class);\nctr3.setAccessible(true); // ä½¿ç”¨ç§æœ‰çš„æˆå‘˜å‰ï¼Œéœ€è¦å…ˆè®¾ç½®ä¸ºå¯è®¿é—®\nSystem.out.println(ctr3.newInstance(55).score);\n```\n\n### é€šè¿‡åå°„è·å–å­—æ®µ\nå­—æ®µï¼ŒFieldï¼Œå³ç±»é‡Œé¢å£°æ˜çš„æˆå‘˜å˜é‡ã€‚åƒä¸Šé¢ï¼Œé€šè¿‡Classå®ä¾‹è·å–åˆ°ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”¨å…¶åˆ›å»ºç±»çš„å®ä¾‹ï¼Œé‚£è·å–åˆ°å­—æ®µæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç”¨å­—æ®µå¯ä»¥è·å–å…¶å¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥ï¼Œå°±éœ€è¦ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œæœ‰äº†å®ä¾‹ï¼Œæ‰èƒ½è·å–ã€‚\n- è·å–å…¬å¼€å­—æ®µ\n```java\nClass<Student> clz = Student.class;\n\nField score = clz.getField(\"score\"); // é€šè¿‡å­—æ®µåå­—è·å–\n// ä½¿ç”¨å­—æ®µï¼Œéœ€è¦ä¸€ä¸ªStudentå®ä¾‹\nStudent student = new Student(60, 1);\n//  è¿™å¥è¯çš„æ„æ€å°±æ˜¯ï¼Œè·å–studentå®ä¾‹ä¸­scoreå­—æ®µçš„å€¼\nSystem.out.println(score.get(student)); // 60\n```\n- è·å–ç§æœ‰å­—æ®µ\n```java\nClass<Student> clz = Student.class;\nStudent student = new Student(60, 1);\n\nField sex = clz.getDeclaredField(\"sex\"); // è¿™é‡Œå¿…é¡»åŠ declared é€šè¿‡å­—æ®µåå­—è·å–\nsex.setAccessible(true); // è®¾ç½®å¯è®¿é—®\nsex.set(student, 10); // å…ˆè®¾ç½®ä¸º10\nSystem.out.println(sex.get(student)); // 10\n```\n\n### é€šè¿‡åå°„è·å–æ–¹æ³•\nå­—æ®µå¯é€šè¿‡åå­—è·å–ï¼Œä½†æ–¹æ³•ä¸å¯åªé€šè¿‡åå­—ï¼Œå› ä¸ºä¼šå­˜åœ¨æ–¹æ³•é‡è½½ï¼Œå³å‡ ä¸ªæ–¹æ³•åå­—ä¸€æ ·ï¼Œä½†å‚æ•°ç±»å‹æˆ–è€…æ•°é‡ä¸åŒï¼Œæ‰€ä»¥è¦è·å–æ–¹æ³•ï¼Œå°±éœ€è¦æŒ‡å®šæ–¹æ³•åç§°ï¼ŒåŒæ—¶å’Œæ–¹æ³•çš„å‚æ•°çš„ç±»å‹åˆ—è¡¨ã€‚å’Œå­—æ®µç›¸åŒçš„æ˜¯ï¼Œæ–¹æ³•åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå®ä¾‹ï¼Œæœ‰äº†å®ä¾‹ï¼Œæ‰èƒ½åœ¨è¿™ä¸ªå®ä¾‹ä¸Šè°ƒç”¨å…¶æ–¹æ³•ã€‚\n- è·å–å…¬å¼€æ–¹æ³•\n```java\nClass<Student> clz = Student.class;\nStudent student = new Student(60, 1);\n\nMethod sayHi = clz.getMethod(\"sayHi\", String.class); // æŒ‡æ˜æ–¹æ³•åï¼Œå’Œå‚æ•°ç±»å‹\nsayHi.invoke(student, \"Teacher\"); // student say hi to :Teacher\n```\n- è·å–ç§æœ‰æ–¹æ³•\n```java\nClass<Student> clz = Student.class;\nStudent student = new Student(60, 1);\n\nMethod setSex = clz.getDeclaredMethod(\"setSex\", int.class); // æŒ‡æ˜æ–¹æ³•åï¼Œå’Œå‚æ•°ç±»å‹\nsetSex.setAccessible(true); // setSexæ˜¯ç§æœ‰çš„ï¼Œå…ˆè®¾ç½®ä¸ºå¯è®¿é—®\nsetSex.invoke(student, 100); // è°ƒç”¨ï¼Œè®¾ç½®sexçš„å€¼\nSystem.out.println(student.getSex()); // 100\n```\n\n### æ€»ç»“\né€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹å‡ºï¼šåå°„éƒ½æ˜¯åŸºäºç±»çš„Classå®ä¾‹ï¼Œé€šè¿‡é‡Œé¢çš„æˆå‘˜ï¼Œæ¥è¿›è¡Œä¸€äº›æ“ä½œçš„ã€‚å…ˆè·å–åˆ°Classå®ä¾‹ï¼Œå†è·å–å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚å­—æ®µã€æ–¹æ³•ç­‰ï¼Œç„¶åå†åˆ©ç”¨è¿™äº›æˆå‘˜ï¼Œé‡‡å–ä¸€äº›æ“ä½œæ¥è¾¾æˆç›®çš„ã€‚\n\næ²¡æœ‰å¤ªå¤šä»£ç ï¼Œå°±ä¸åˆ›å»ºé¡¹ç›®äº†ï¼Œé™„ä¸Šæ‰€æœ‰ä»£ç ï¼š\n<script src=\"https://gist.github.com/oynix/414b7208de0e3d0b59b2aaa3879b82de.js\"></script>","tags":["Java","åå°„"],"categories":["Java"]},{"title":"ä½¿ç”¨HtmlCompatæ”¹å˜å­—ä½“æ ·å¼","url":"/2021/09/995b1034fc8d/","content":"\nè¿™ç¯‡æ–‡ç« è¯´ä¸€è¯´Androidä¸­çš„`HtmlCompat`ä½¿ç”¨ã€‚\n\nä¼—æ‰€å‘¨çŸ¥çš„æ˜¯ï¼Œè¦æƒ³åšå‡ºå„ç§ç‚«é…·å¤šå˜æ ·å¼çš„å­—ä½“ï¼Œä½¿ç”¨Html+CSSæœ€æ–¹ä¾¿ã€‚ä¸€æ¥æ˜¯æ ‡ç­¾è¯­æ³•ç®€å•ï¼ŒäºŒæ¥æ˜¯å®ƒæ”¯æŒè®¾å®šå¾ˆå¤šå±æ€§ã€‚`HtmlCompat`è¿™ä¸ªç±»ï¼Œå°±æ˜¯å¸®åŠ©æˆ‘ä»¬åœ¨Androidä¸­ä½¿ç”¨Html+CSSè¯­æ³•çš„å·¥å…·ã€‚\n\n<!--more-->\n\n### ä»‹ç»\n`HtmlCompat`æ˜¯`Html`çš„åŒ…è£…ç±»ï¼Œå…¶ä¸­åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šä¸€ä¸ªæ˜¯`fromHtml`ï¼Œå¦ä¸ªæ˜¯`toHtml`ã€‚\n\nå…¶å®ï¼Œæ‰€æœ‰å¸¦æœ‰Compatçš„ç±»åŸºæœ¬éƒ½æ˜¯åŒ…è£…ç±»ã€‚åœ¨Android SDKå‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œåˆ°äº†æŸä¸ªç‰ˆæœ¬æŸäº›ç±»å¯èƒ½æœ‰äº†å¤§æ”¹åŠ¨ï¼Œæ¯”å¦‚å¤šäº†é‡è½½æ–¹æ³•ï¼Œè¿™ä¸ªç‰ˆæœ¬ä»¥å‰çš„SDKï¼Œè°ƒç”¨è€æ–¹æ³•ï¼›è¿™ä¸ªç‰ˆæœ¬ä¹‹åçš„è°ƒç”¨æ–°æ–¹æ³•ã€‚è€ŒåŒ…è£…ç±»çš„å‡ºç°æ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒç”¨è€…ï¼Œæˆ‘ä»¬åªç®¡è°ƒç”¨åŒ…è£…ç±»ä¸­çš„æ–¹æ³•ï¼Œè€ŒåŒ…è£…ç±»é‡Œé¢ä¼šæ ¹æ®ç‰ˆæœ¬åšå‡ºåˆ¤æ–­ï¼Œå»è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ã€‚\n\n- fromHtml\næ•…åæ€ä¹‰ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠŠHtmlè¯­æ³•è½¬æ¢æˆè¦æœ€ç»ˆçš„æ ·å¼ï¼Œè¿™ä¸ªå¸¸ç”¨ï¼Œè¿™æ¬¡ä¸»è¦è¯´ä¸€è¯´å®ƒ\n\n- toHtml\nä¸`fromHtml`ç›¸åï¼Œå¾ˆå°‘ç”¨ï¼Œè¿˜æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„éœ€æ±‚ï¼Œå°±ä¸è¯´äº†\n\n### ä½¿ç”¨\n```java\npublic static Spanned fromHtml(@NonNull String source, @FromHtmlFlags int flags) {\n    if (Build.VERSION.SDK_INT >= 24) {\n        return Html.fromHtml(source, flags);\n    }\n    return Html.fromHtml(source);\n}\n```\n- param: source\nå³Htmlæ–‡æœ¬ï¼Œå¦‚\"\\<b\\>Hello\\<\\/b\\> World!\"ï¼Œæ ‡ç­¾bä¼šå°†HelloåŠ ç²—æ˜¾ç¤º\n\n- param: flags\nä¸€çœ‹ä¾¿çŸ¥ï¼Œè¿™ä¸ªæ˜¯SDK 24æ–°åŠ çš„å‚æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ·»åŠ ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œå®ƒç°åœ¨æœ‰9ä¸ªå¯é€‰çš„å¸¸é‡å€¼ï¼Œæ¯ä¸ªå€¼éƒ½æœ‰ä»‹ç»ï¼Œæ¯”å¦‚ï¼š`<p>`æ ‡ç­¾ä¼šä»æ–°çš„ä¸€è¡Œå¼€å§‹ã€`<h>`æ ‡ç­¾ä¼šä»æ–°çš„ä¸€è¡Œå¼€å§‹ï¼Œç­‰ç­‰ã€‚ä¸€èˆ¬ä¸éœ€è¦ï¼Œä¼ 0å³å¯\n\n### æ”¯æŒçš„æ ‡ç­¾\nå®˜æ–¹æ–‡æ¡£å†™çš„å¾ˆç®€å•ï¼Œè¿™æ˜¯åœ°å€ï¼š[æ–‡æ¡£](https://developer.android.com/reference/kotlin/androidx/core/text/HtmlCompat?hl=en)ã€‚æˆ‘æ˜¯ä»æºç ä¸­çœ‹çš„ï¼Œ`Html.java`æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸ª`handleStartTag`æ–¹æ³•ï¼Œå®ƒæ”¯æŒä»¥ä¸‹çš„æ ‡ç­¾è§£æï¼š\n> br, p, ul, li, div, span, strong, b, em, cite, dfn, i, big, small, font, blockquote, tt, a, u, del, s, strike, sup, sub, h, img\n\n\n### å¸¸ç”¨æ•ˆæœ\n- åŠ ç²—\nbå’Œstrongéƒ½æ˜¯åŠ ç²—ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œåœ¨è§£æçš„æ—¶å€™åŒç­‰æ–¹å¼å¤„ç†\n```kotlin\nprivate fun genBold() = HtmlCompat.fromHtml(\n    \"åŠ ç²—æ•ˆæœï¼š<b>åŠ ç²—</b> or <strong>åŠ ç²—2</strong>\", 0\n)\n```\n- å€¾æ–œ\næœ‰å¤šä¸ªæ ‡ç­¾éƒ½æ˜¯å€¾æ–œï¼šemã€citeã€dfnã€iï¼Œå®ƒä»¬çš„æ•ˆæœæ˜¯ä¸€æ ·çš„\n```kotlin\nprivate fun genItalic() = HtmlCompat.fromHtml(\n    \"å€¾æ–œæ•ˆæœ: <i>å€¾æ–œ</i> <em>å€¾æ–œ</em> <cite>å€¾æ–œ</cite>\", 0\n)\n```\n- ä¸‹åˆ’çº¿\n```kotlin\nprivate fun genUnderline() = HtmlCompat.fromHtml(\n    \"ä¸‹åˆ’çº¿ï¼š<u>ä¸‹åˆ’çº¿</u>\", 0\n)\n```\n- åˆ é™¤çº¿\n```kotlin\nprivate fun genDelLine() = HtmlCompat.fromHtml(\n    \"åˆ é™¤çº¿ï¼š<del>åˆ é™¤çº¿</del>\", 0\n)\n```\n- ä¸Šè§’æ ‡\n```kotlin\nprivate fun genSup() = HtmlCompat.fromHtml(\n    \"ä¸Šè§’æ ‡ï¼š2<sup>3</sup>\", 0\n)\n```\n- ä¸‹è§’æ ‡\n```kotlin\nprivate fun genSub() = HtmlCompat.fromHtml(\n    \"ä¸‹è§’æ ‡ï¼ša<sup>4</sup>\", 0\n)\n```\n- å­—ä½“æ ·å¼ \nè¿™é‡Œçš„fontåªæ”¯æŒä¸¤ä¸ªå±æ€§ï¼Œçœ‹è¿‡æºç æ‰çŸ¥é“ï¼Œä¹‹å‰è¿˜ä¸€ç›´ç ”ç©¶ä¸ºä»€ä¹ˆåˆ«çš„å±æ€§ä¸ç”Ÿæ•ˆã€‚\nä¸€ä¸ªæ˜¯colorï¼Œä¸€ä¸ªæ˜¯faceã€‚colorç”¨æ¥æ”¹å˜å­—ä½“é¢œè‰²ï¼Œfaceç”¨æ¥æ”¹å˜å­—ä½“çš„æ ·å¼ï¼Œfaceç”¨çš„å°‘ï¼Œcolorç”¨çš„å¤šã€‚\nfaceæœ‰å››ä¸ªå¯é€‰å€¼ï¼šnormalé»˜è®¤ï¼Œsansæ— è¡¬çº¿å­—ä½“ï¼Œserifæœ‰è¡¬çº¿å­—ä½“ï¼Œmonospaceç­‰å®½å­—ä½“ã€‚\n```kotlin\nprivate fun genFont() = HtmlCompat.fromHtml(\n    \"å­—ä½“æ ·å¼ï¼š<font color='#873748' face='monospace'>å­—ä½“é¢œè‰²</font>,\" +\n            \"<font face='sans'>å­—ä½“Face sans</font>\", 0\n)\n```\n\n### è‡ªå®šä¹‰æ ‡ç­¾\nç³»ç»Ÿæä¾›çš„æ ‡ç­¾å°±æ˜¯è¿™ä¹ˆå¤šï¼Œå¦‚æœéœ€è¦ä¸€äº›å…¶ä»–çš„æ•ˆæœï¼Œå¦‚æ”¹å˜å­—ä½“å¤§å°ï¼Œå¯ä»¥è‡ªå®šä¹‰æ ‡ç­¾ã€‚`HtmlCompat.fromHtml`æœ‰ä¸ªé‡è½½æ–¹æ³•ï¼Œæ˜¯ç”¨æ¥æ”¯æŒè‡ªå®šä¹‰æ ‡ç­¾çš„ï¼š\n```java\npublic static Spanned fromHtml(@NonNull String source, @FromHtmlFlags int flags,\n            @Nullable ImageGetter imageGetter, @Nullable TagHandler tagHandler) {\n        if (Build.VERSION.SDK_INT >= 24) {\n            return Html.fromHtml(source, flags, imageGetter, tagHandler);\n        }\n        return Html.fromHtml(source, imageGetter, tagHandler);\n    }\n```\nsourceå’ŒflagsåŒä¸Šï¼Œå¦‚æœä½¿ç”¨äº†imgæ ‡ç­¾ï¼Œå°±è¦æä¾›ImageGetterå‚æ•°æ¥è·å–å›¾ç‰‡ï¼Œæ²¡ç”¨åˆ™ä¼ å…¥nullï¼›å¦‚æœä½¿ç”¨äº†è‡ªå®šä¹‰æ ‡ç­¾ï¼Œåˆ™éœ€æä¾›tagHandleræ¥è§£æè‡ªå®šä¹‰çš„æ ‡ç­¾ã€‚\n\nè¯´ä¸€è¯´è‡ªå®šä¹‰å­—ä½“ã€‚\n\néœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°TagHandleræ¥å£ï¼Œæ¥å£é‡Œå°±ä¸€ä¸ªæ–¹æ³•ï¼Œ`handleTag`ï¼Œæ˜¯ç”¨æ¥è§£ææ ‡ç­¾çš„ï¼Œåœ¨è¿™é‡Œæ·»åŠ é€»è¾‘\n```kotlin\n// sizeæ˜¯å­—å·\nclass SizeLabel(private val size: Int) : Html.TagHandler {\n\t// è®°å½•å¼€å§‹çš„è§’æ ‡å’Œç»“æŸçš„è§’æ ‡\n    private var startIndex = 0\n    private var stopIndex = 0\n\n    // è¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œå¼€å§‹æ ‡ç­¾è°ƒç”¨ä¸€æ¬¡ï¼Œopening=trueï¼Œç»“æŸæ ‡ç­¾è°ƒç”¨ä¸€æ¬¡ï¼Œopening=false\n    // outputå°±æ˜¯å®æ—¶è§£æå‡ºæ¥çš„å†…å®¹\n    override fun handleTag(opening: Boolean, tag: String, output: Editable, xmlReader: XMLReader?) {\n    \t// tagå°±æ˜¯æ ‡ç­¾çš„åå­—ï¼Œè¿™ä¸ªåå­—ä¸å¯ä¸ç³»ç»Ÿæ”¯æŒçš„é‡å¤ï¼Œå› ä¸ºè‡ªå®šä¹‰çš„æ ‡ç­¾æ˜¯æ”¾åœ¨åˆ¤æ–­çš„æœ€åä¸€ä¸ªelseé‡Œå¤„ç†çš„\n        if (tag.lowercase(Locale.getDefault()) == \"size\") {\n            if (opening) {\n                startIndex = output.length\n            } else {\n                stopIndex = output.length\n                output.setSpan(\n                    AbsoluteSizeSpan(size),\n                    startIndex,\n                    stopIndex,\n                    Spanned.SPAN_EXCLUSIVE_EXCLUSIVE\n                )\n            }\n        }\n    }\n\n}\n```\nä½¿ç”¨çš„æ–¹å¼ä¸ä¸Šç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼š\n```kotlin\nprivate fun genSizeLabel() = HtmlCompat.fromHtml(\n    \"è‡ªå®šä¹‰æ ‡ç­¾sizeï¼š<size>åŠ å¤§å­—å·</size>\", 0, null, SizeLabel(50)\n)\n```\n\n\n### æ€»ç»“\næ€»çš„æ¥è¯´ï¼Œæ–¹å¼ç®€å•ï¼Œç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œå¯ä»¥æ»¡è¶³ä¸€äº›åŸºæœ¬çš„å¥‡ç‰¹UIéœ€æ±‚ã€‚é™¤äº†ä½¿ç”¨Htmlçš„æ–¹å¼ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹å¼ï¼Œå¦‚åœ¨`strings.xml`æ–‡ä»¶ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸€äº›ç‰¹æ®Šçš„æ•ˆæœã€‚\n\nè¿˜å¯ä»¥ä½¿ç”¨`Span`æ¥å®ç°ï¼Œè¿™ä¸ªçš„åŠŸèƒ½ç›¸å½“çš„å¤šï¼Œåœ¨`android.text.style`è¿™ä¸ªåŒ…ä¸‹éƒ½æ˜¯å®ƒçš„å®ç°ç±»ï¼Œæ¯ä¸ªç±»éƒ½å¯ä»¥å®ç°ä¸€ç§UIæ•ˆæœï¼Œä¸‹æ¬¡ç”¨åˆ°çš„æ—¶å€™å†æ¥ä»”ç»†è¯´ä¸€è¯´ã€‚\n\né™„ä¸Šç¤ºä¾‹çš„Githubåœ°å€ï¼š[https://github.com/oynix/htmlcompat-sample](https://github.com/oynix/htmlcompat-sample)","tags":["Android"],"categories":["Android"]},{"title":"Hexo+Githubå¿«é€Ÿæ­å»ºä¸ªäººåšå®¢","url":"/2021/09/33313fbab399/","content":"ç°åœ¨æ­å»ºä¸ªäººåšå®¢çš„æ–¹å¼è¶Šæ¥è¶Šå¤šï¼Œè€Œä¸”è¿‡ç¨‹ä¹Ÿè¶Šæ¥è¶Šç®€å•ã€‚å¤§ä½“çš„æ€è·¯ï¼Œéƒ½æ˜¯å…ˆç”Ÿæˆé™æ€ç½‘é¡µï¼Œç„¶åéƒ¨ç½²åˆ°ä¸€ä¸ªä¾æ‰˜ç½‘ç«™ã€‚\n\nè¿™ç¯‡æ–‡ä»‹ç»çš„æ˜¯ç”¨Hexoç”Ÿæˆé™æ€ç½‘ç«™ï¼Œç„¶åéƒ¨ç½²åˆ°Githubã€‚\n\n<!--more-->\n\n### ä»‹ç»Nodeå’Œnpm\nHexoæ˜¯ç”¨Nodeå†™çš„ï¼Œæ‰€ä»¥è¦å®‰è£…å®ƒæ‰€ä¾èµ–çš„ç¯å¢ƒåæ‰èƒ½ç”¨ï¼Œå…ˆè´´ä¸€ä¸‹å»–é›ªå³°å…³äºNodeå’Œnpmå…³ç³»çš„ä»‹ç»\n> npmæ˜¯ä»€ä¹ˆä¸œä¸œï¼Ÿnpmå…¶å®æ˜¯Node.jsçš„åŒ…ç®¡ç†å·¥å…·ï¼ˆpackage managerï¼‰ã€‚\n>\n>ä¸ºå•¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬åœ¨Node.jsä¸Šå¼€å‘æ—¶ï¼Œä¼šç”¨åˆ°å¾ˆå¤šåˆ«äººå†™çš„JavaScriptä»£ç ã€‚å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨åˆ«äººå†™çš„æŸä¸ªåŒ…ï¼Œæ¯æ¬¡éƒ½æ ¹æ®åç§°æœç´¢ä¸€ä¸‹å®˜æ–¹ç½‘ç«™ï¼Œä¸‹è½½ä»£ç ï¼Œè§£å‹ï¼Œå†ä½¿ç”¨ï¼Œéå¸¸ç¹çã€‚äºæ˜¯ä¸€ä¸ªé›†ä¸­ç®¡ç†çš„å·¥å…·åº”è¿è€Œç”Ÿï¼šå¤§å®¶éƒ½æŠŠè‡ªå·±å¼€å‘çš„æ¨¡å—æ‰“åŒ…åæ”¾åˆ°npmå®˜ç½‘ä¸Šï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œç›´æ¥é€šè¿‡npmå®‰è£…å°±å¯ä»¥ç›´æ¥ç”¨ï¼Œä¸ç”¨ç®¡ä»£ç å­˜åœ¨å“ªï¼Œåº”è¯¥ä»å“ªä¸‹è½½ã€‚\n>\n>æ›´é‡è¦çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨æ¨¡å—Aï¼Œè€Œæ¨¡å—Aåˆä¾èµ–äºæ¨¡å—Bï¼Œæ¨¡å—Båˆä¾èµ–äºæ¨¡å—Xå’Œæ¨¡å—Yï¼Œnpmå¯ä»¥æ ¹æ®ä¾èµ–å…³ç³»ï¼ŒæŠŠæ‰€æœ‰ä¾èµ–çš„åŒ…éƒ½ä¸‹è½½ä¸‹æ¥å¹¶ç®¡ç†èµ·æ¥ã€‚å¦åˆ™ï¼Œé æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨ç®¡ç†ï¼Œè‚¯å®šæ—¢éº»çƒ¦åˆå®¹æ˜“å‡ºé”™ã€‚\n\n### å®‰è£…Nodeå’Œnpm\nå¼€å§‹æˆ‘ç”¨`brew`è£…äº†åŠå¤©ï¼Œä¸­é—´æ€»æœ‰ä¸ªåŒ…ä¸æˆåŠŸã€‚æœ€åå‘ç°ç›´æ¥ä»Nodeå®˜ç½‘ä¸‹è½½å®‰è£…åŒ…æœ€çœäº‹ï¼Œä¸€æ­¥åˆ°ä½ã€‚[https://nodejs.org/en/](https://nodejs.org/en/)ã€‚\n\nå®‰è£…å®Œä¹‹åæ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœèƒ½æ˜¾ç¤ºå‡ºç‰ˆæœ¬å·ï¼Œå°±å¯ä»¥äº†ï¼š\n```sh\n$ node -v\nv14.17.6\n\n$ npm -v\n6.14.15\n```\n\n### å®‰è£…hexo-cli\nè¿™ä¸ªå·¥å…·æ˜¯å¸®åŠ©æˆ‘ä»¬åˆå§‹åŒ–ä¸ªäººç«™çš„ï¼Œä¸€è¡Œå‘½ä»¤å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªç©ºç«™ç‚¹\n```sh\n# For Mac\n$ sudo npm install hexo-cli -g\n\n# For Windows\n$ npm install hexo-cli -g\n```\n\nè£…å®Œä¹‹åï¼ŒéªŒè¯ä¸€ä¸‹æ˜¯å¦æˆåŠŸï¼Œæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹åˆ™è¡¨ç¤ºæˆåŠŸäº†\n```sh\n$ hexo\nUsage: hexo <command>\n\nCommands:\n  help     Get help on a command.\n  init     Create a new Hexo folder.\n  version  Display version information.\n```\n\n### åˆå§‹åŒ–ä¸ªäººç«™\nä¸€è¡Œå‘½ä»¤å³å¯ï¼š\n```sh\n# blogå°±æ˜¯ç½‘ç«™ç›®å½•çš„åå­—ï¼Œå¯éšæ„èµ·ï¼Œåˆæ³•å³å¯\n$ hexo init blog\nINFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git\nINFO  Install dependencies\nadded 242 packages from 207 contributors and audited 243 packages in 13.774s\n\n15 packages are looking for funding\n  run `npm fund` for details\n\nfound 0 vulnerabilities\n\nINFO  Start blogging with Hexo!\n```\n\nç„¶åï¼Œè¿›åˆ°blogç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™å°±æ˜¯ä¸ªNodeé¡¹ç›®ã€‚`package.json`é‡Œé¢æ˜¯é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–ï¼Œæ¥ä¸‹æ¥å®‰è£…ä¾èµ–\n```sh\n# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•\n$ cd blog\n\n$ npm install\nadded 1 package from 5 contributors and audited 243 packages in 2.29s\n\n15 packages are looking for funding\n  run `npm fund` for details\n\nfound 0 vulnerabilities\n\n```\næ‰§è¡Œä¸€ä¸‹hexoå‘½ä»¤ï¼Œå¦‚ä¸‹æ˜¾ç¤ºåˆ™è¯´æ˜æˆåŠŸ:\n```sh\n$ hexo\nINFO  Validating config\nUsage: hexo <command>\n\nCommands:\n  clean     Remove generated files and cache.\n  config    Get or set configurations.\n  deploy    Deploy your website.\n  generate  Generate static files.\n  help      Get help on a command.\n  init      Create a new Hexo folder.\n  list      List the information of the site\n  migrate   Migrate your site from other system to Hexo.\n  new       Create a new post.\n  publish   Moves a draft post from _drafts to _posts folder.\n  render    Render files with renderer plugins.\n  server    Start the server.\n  version   Display version information.\n```\n\n### ç”Ÿæˆé™æ€ç½‘ç«™\nçœ‹ä¸Šé¢çš„å‘½ä»¤ä»‹ç»ï¼Œå…¶ä¸­è¿™å‡ ä¸ªæœ€å¸¸ç”¨ï¼š\n- `generate`ï¼šå°±æ˜¯ç”¨æ¥ç”Ÿæˆé™æ€ç½‘ç«™çš„ï¼Œä¸€èˆ¬ç®€å†™æˆ`g`\n- `server`ï¼šæ˜¯åœ¨æœ¬åœ°è¿è¡Œï¼Œä¹Ÿå°±æ˜¯æŠŠé™æ€ç½‘ç«™ä¾æ‰˜åœ¨æœ¬æœºä¸Šï¼Œä¸€èˆ¬ç®€å†™æˆ`s`\n- `deploy`ï¼šæ˜¯æŠŠé™æ€ç«™éƒ¨ç½²åˆ°è¿œç¨‹ï¼Œä¸€èˆ¬ç®€å†™æˆ`d`\n- `new`ï¼šç”¨æ¥ç”Ÿæˆä¸€ç‰‡ç©ºæ–‡ç« \n- `init`ï¼šç”¨æ¥ç”Ÿæˆä¸€ä¸ªç©ºé¡µé¢\n- `claan`ï¼šæ˜¯åˆ é™¤ç”Ÿæˆçš„é™æ€ç½‘ç«™\n\n```sh\n# ç”Ÿæˆ\n$ hexo g\n\n# è¿è¡Œ\n$ hexo s\nINFO  Validating config\nINFO  Start processing\nINFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.\n```\nçœ‹æç¤ºå¯ä»¥çŸ¥é“ï¼Œhexoæ­£åœ¨è¿è¡Œï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®æœ¬åœ°çš„4000ç«¯å£ï¼Œå°±å¯ä»¥çœ‹åˆ°äº†\n\n### éƒ¨ç½²ä¹‹Github Token\næ‰€è°“éƒ¨ç½²ï¼Œå°±æ˜¯æŠŠç”Ÿæˆçš„é™æ€ç½‘ç«™çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ¨é€åˆ°è¿œç¨‹çš„Githubä»“åº“ã€‚æ‰€ä»¥ï¼ŒHexoå°±éœ€è¦æ¨é€çš„æƒé™ã€‚æˆ‘ç”¨çš„æ˜¯httpsåè®®ï¼Œè¿˜æ²¡è¯•è¿‡gitåè®®ã€‚httpsçš„æ–¹å¼å°±æ˜¯æŠŠå¸¦æœ‰æ¨é€æƒé™çš„tokenæ”¾åˆ°ä»“åº“é“¾æ¥é‡Œå³å¯ã€‚\n\nGithub Tokenï¼šGithubé¦–é¡µ -> å³ä¸Šè§’ä¸ªäººå¤´åƒ -> Settings -> Developer settings -> Personal access token -> Generate new token -> æŠŠrepoçš„å¤§æƒé™å‹¾ä¸Š\n\né»˜è®¤çš„è¿‡æœŸæ—¶é—´Expirationæ˜¯30å¤©ï¼Œå¯ä»¥é€‰é•¿ä¸€ç‚¹ï¼Œä¸ç„¶è¿‡æœŸä¹‹åè¿˜è¦æ›´æ–°tokenã€‚æœ€åå°±å¾—åˆ°äº†ä¸€ä¸ªä»¥`ghp_`å¼€å¤´ã€æ€»é•¿åº¦ä¸º40çš„å­—ç¬¦ä¸²çš„tokenã€‚\n\n### éƒ¨ç½²ä¹‹è¿œç¨‹ä»“åº“\nåœ¨Githubä¸Šæ–°å»ºä¸ªä»“åº“ï¼Œç”¨æ¥æ”¾é™æ€ç½‘ç«™çš„æ–‡ä»¶ã€‚ä»“åº“çš„åå­—æœ‰è¦æ±‚ï¼Œä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š`*.github.io`ï¼Œ\næ˜Ÿå·å¯ä»¥æ›¿æ¢æˆä½ è‡ªå·±æƒ³è¦çš„å•è¯ã€‚ç„¶åï¼Œè¿™æ•´ä¸ªå°±æ˜¯ä»“åº“çš„åå­—ï¼Œæ¯”å¦‚æˆ‘çš„ä»“åº“åœ°å€å°±æ˜¯ï¼š\n> `https://github.com/oynix/oynix.github.io.git`\n\n\n- å¦‚æœï¼Œè¿™ä¸ªæ˜Ÿå·ä½¿ç”¨çš„æ˜¯Githubè´¦å·çš„åå­—ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç½‘ç«™åœ°å€å°±æ˜¯ï¼š\n> `https://oynix.github.io/`\n- å¦‚æœï¼Œè¿™ä¸ªæ˜Ÿå·ä½¿ç”¨çš„æ˜¯å…¶ä»–çš„åå­—ï¼Œæ¯”å¦‚blogï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç½‘ç«™åœ°å€å°±æ˜¯ï¼š\n> `https://oynix.github.io/blog.github.io/`\n\næ¢å¥è¯è¯´ï¼Œå¦‚æœæƒ³è¦ç”¨æœ€çŸ­URLï¼Œé‚£ä¹ˆå°±ç”¨Githubè´¦å·çš„åå­—ï¼›å¦‚æœè¦ç”¨åˆ°pathäº†ï¼Œå¯ä»¥ç»™ä»“åº“èµ·ä¸ªçŸ­ç‚¹åå­—ï¼Œå¦‚å°±å«blogï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç½‘ç«™åœ°å€å°±æ˜¯:\n> `https://oynix.github.io/blog/`\n\nå½“ç„¶ï¼Œå¦‚æœä¹°äº†è‡ªå·±çš„åŸŸåï¼Œé‚£ä¹ˆè¿™äº›éƒ½ä¸é‡è¦ã€‚\n\næˆ‘æœ¬ä¹Ÿæƒ³ä¹°ä¸ªåŸŸåçš„ï¼Œä¸€å¹´å‡ åå—é’±ã€‚ä½†å›½å†…çš„ç¯å¢ƒå§ï¼Œå„ç§éªŒè¯ã€å®åã€å®¡æ ¸ç­‰ç­‰ï¼Œå°†æˆ‘å†·å†°å†°çš„åŠé€€äº†ï¼Œä»¥è‡³äºæˆ‘è§‰å¾—githubè¿™ä¸ªå°±æŒºå¥½çš„ã€‚\n\n\n### éƒ¨ç½²ä¹‹hexo-deployer-gitæ’ä»¶\nå› ä¸ºè¦æŠŠä»£ç éƒ¨ç½²åˆ°Githubï¼Œæ‰€æœ‰éœ€è¦å…ˆå®‰è£…è¿™ä¸ªæ’ä»¶ã€‚hexoä¹Ÿæ”¯æŒéƒ¨ç½²åˆ°å…¶ä»–åœ°æ–¹ï¼Œå„è‡ªéƒ½æœ‰å¯¹åº”çš„æ’ä»¶ã€‚\n```sh\n# æ ¹ç›®å½•ä¸‹æ‰§è¡Œ\n$ npm install hexo-deployer-git --save\n+ hexo-deployer-git@3.0.0\nadded 1 package from 1 contributor and audited 244 packages in 2.394s\n\n15 packages are looking for funding\n  run `npm fund` for details\n\nfound 0 vulnerabilities\n```\n\n### éƒ¨ç½²ä¹‹é…ç½®\næ ¹ç›®å½•ä¸‹æœ‰ä¸ªæ–‡ä»¶ï¼Œ`_config.yml`ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥é…ç½®ç½‘ç«™çš„ä¸€äº›å±æ€§çš„ï¼Œä½¿ç”¨çš„yamlæ ¼å¼ï¼Œé‡Œé¢çš„æ³¨é‡Šé‡Œå†™äº†å¾ˆè¯¦ç»†çš„ä»‹ç»ï¼Œå¤§éƒ¨åˆ†åº”è¯¥éƒ½å¯ä»¥çœ‹å¾—æ‡‚ã€‚\n\nå…¶ä¸­ï¼Œ`deploy`æ˜¯ç”¨æ¥é…ç½®é€‰é¡¹çš„ï¼š\n```yaml\n# Deployment\n## Docs: https://hexo.io/docs/one-command-deployment\ndeploy:\n  type: ''\n```\næŠŠå‰ä¸¤æ­¥ç”Ÿæˆçš„tokenå’Œä»“åº“åœ°å€ï¼Œå†™è¿›å»å°±å¯ä»¥ï¼Œgithubçš„è§„åˆ™æ˜¯æŠŠtokenåŠ åœ¨å‰é¢ç„¶åç”¨@è¿æ¥\n```yaml\n# Deployment\n## Docs: https://hexo.io/docs/deployment.html\ndeploy:\n  type: git\n  repo: https://{your_github_person_access_token}@github.com/{yourname}/{repo_name}.git\n  branch: master\n\n```\n\n\n### éƒ¨ç½²\n`generate`ä¹‹åï¼Œä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ªåå­—æ˜¯`.deploy_git`çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•é»˜è®¤æ˜¯éšè—çš„ï¼Œé‡Œé¢å°±æ˜¯ç”Ÿæˆçš„é™æ€ç½‘ç«™ï¼Œå°†ä¼šè¢«æ¨é€åˆ°è¿œç¨‹ã€‚\n```sh\n# æ ¹ç›®å½•ä¸‹æ‰§è¡Œ\n$ hexo g\n$ hexo d\nINFO  Validating config\nINFO  Deploying: git\nINFO  Setting up Git deployment...\n.... çœç•¥ ....\n```\nç„¶åï¼Œå°±å¯ä»¥åœ¨è¿œç¨‹ä»“åº“çœ‹åˆ°æ‰€æœ‰çš„ç½‘ç«™æ–‡ä»¶äº†\n\n\n### å¯ç”¨Github Pages\næ‰“å¼€Githubï¼Œè¿›å…¥åˆšåˆšåˆ›å»ºçš„ä»“åº“ï¼Œè¿›å…¥Settingsï¼Œç‚¹è¿›Pagesï¼ŒBranché€‰masterï¼Œsaveä¸€ä¸‹ã€‚\n\nç„¶åï¼Œä¸Šé¢å°±ä¼šå‡ºç°ç½‘ç«™åœ°å€äº†ï¼š`Your site is published at https://oynix.github.io/`\n\né¦–æ¬¡éƒ¨ç½²ï¼Œéœ€è¦ç­‰1åˆ†é’Ÿå·¦å³æ‰èƒ½è®¿é—®ï¼Œä¸ç„¶çœ‹åˆ°çš„å°±æ˜¯404ã€‚\n\n\n### æ€»ç»“\næ€»çš„æ¥è¯´ï¼Œåˆ†ä¸º3å¤§æ­¥ï¼šæ­å»ºç¯å¢ƒã€ç”Ÿæˆé™æ€ç½‘ç«™ä»¥åŠæ¨é€åˆ°è¿œç¨‹ã€‚æŒ‰æµç¨‹æ¥ï¼Œè¿˜æ˜¯å¾ˆé¡ºåˆ©çš„ã€‚\n\nå…¶ä¸­ï¼Œæœ‰ä¸ªä¸»é¢˜è¿˜æ²¡è¯´ï¼Œhexoæ”¯æŒå¾ˆå¤šä¸»é¢˜ï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥é…ç½®å¾ˆå¤šé€‰é¡¹ï¼Œå¦‚å­—ä½“çš„é¢œè‰²å¤§å°ã€å­—é—´è·ã€è¡Œé—´è·ã€å¤šå­—ä½“ï¼Œç­‰ç­‰ã€‚æ­é…ä¸Šè¿™äº›ï¼Œå°±å¯ä»¥è®©é¡µé¢åœ¨è§†è§‰ä¸Šæ›´åŠ ç¾è§‚ã€èˆ’æœï¼Œç­‰æœ‰æ—¶é—´å†å•ç‹¬å†™ä¸€å†™è¿™äº›ã€‚","tags":["Hexo","Github"],"categories":["è‡ªå»ºåšå®¢"]},{"title":"æ•°æ®ç»“æ„ä¹‹æ’åºç®—æ³•","url":"/2021/08/de342dd74fb7/","content":"[åŸæ–‡é“¾æ¥](https://www.cnblogs.com/onepixel/articles/7674659.html)\n\nåœ¨å®é™…åº”ç”¨ä¸­å¸¸å¸¸ç”¨åˆ°æ’åºç®—æ³•ï¼Œè¿™ç¯‡æ–‡æ¥æ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„ã€‚ä¸Šé¢æ˜¯åŸæ–‡é“¾æ¥ï¼Œæ–‡ç« é‡Œä»‹ç»å¾ˆè¯¦ç»†ï¼Œè¿˜æœ‰åŠ¨å›¾ç¤ºä¾‹ï¼Œå½¢è±¡æ˜“æ‡‚ã€‚\n\né‡å¤çš„å†…å®¹ä¸å†èµ˜è¿°ï¼Œçœ‹åŸæ–‡å°±å¥½ï¼Œè¿™é‡Œå†™ä¸€å†™æˆ‘å¸¸ç”¨åˆ°çš„ã€‚\n<!--more-->\n\n### å†’æ³¡æ’åº\nè¿™ä¸ªè®°çš„æœ€æ·±åˆ»ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ï¼Œå› ä¸ºä¸€é‡åˆ°æ’åºé—®é¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯å†’æ³¡ã€‚åŸç†å¾ˆç®€å•ï¼Œä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œæ¯æ¬¡å°†æœªæ’åºéƒ¨åˆ†çš„æå€¼ç§»åŠ¨åˆ°å°¾ç«¯ã€‚å¦‚æœæ˜¯å‡åºæ’åˆ—ï¼Œé‚£ä¹ˆæ¯æ¬¡å¯»æ‰¾çš„å°±æ˜¯æœ€å¤§å€¼ï¼Œåä¹‹åˆ™æ˜¯æœ€å°å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±åƒæ˜¯åœ¨å†’æ³¡ã€‚\n```kotlin\nval arr = intArrayOf(3, 44, 38, 5, 47, 15, 36, 26, 27, 2, 46, 4, 19, 50, 48)\n\nfun bubble() {\n    for (i in arr.indices) {\n    \t// æ¯è¶Ÿå¾ªç¯åˆ°å€’æ•°ç¬¬äºŒä¸ªå³å¯ï¼Œå› ä¸ºæ¯”è¾ƒçš„æ—¶å€™æ˜¯jå’Œj+1\n        for (j in 0 until (arr.size - i - 1)) {\n            if (arr[j] > arr[j + 1]) {\n                val temp = arr[j]\n                arr[j] = arr[j + 1]\n                arr[j + 1] = temp\n            }\n        }\n    }\n    println(arr.localString())\n}\n\n// è¾“å‡º\n[2,3,4,5,15,19,26,27,36,38,44,46,47,48,50]\n```\n\n### é€‰æ‹©æ’åº\nè¿™ä¸ªå’Œå†’æ³¡æ’åºå¾ˆåƒï¼Œç¬¬ä¸€æ¬¡ä»æ‰€æœ‰å…ƒç´ ä¸­æ‰¾åˆ°æå€¼æ”¾åˆ°ç¬¬ä¸€ä½ï¼Œç¬¬äºŒæ¬¡ä»å‰©ä¸‹çš„å…ƒç´ ä¸­æ‰¾åˆ°æå€¼æ”¾åˆ°ç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n```kotlin\n// é€‰æ‹©æ’åº\nfun select () {\n    var temp = 0 // ä¸´æ—¶å˜é‡\n    var pointer = 0 // ç”¨æ¥æ ‡è®°å½“å‰åœ¨æ‰¾çš„ä½ç½®\n    while (pointer < arr.size - 1) {\n        temp = arr[pointer]\n        // é€šè¿‡forå¾ªç¯ï¼Œæ‰¾åˆ°æœ¬è¶Ÿçš„æå€¼\n        for (i in pointer until arr.size) {\n            if (arr[i] < temp) {\n                temp = temp xor arr[i]\n                arr[i] = temp xor arr[i]\n                temp = temp xor arr[i]\n            }\n        }\n        // æœ¬è¶Ÿç»“æŸï¼ŒæŠŠæå€¼èµ‹å€¼ç»™å½“å‰ä½ç½®\n        arr[pointer++] = temp\n    }\n}\n```\n\n### å¿«é€Ÿæ’åº\n- è¿™æ˜¯ä¸ªæœ‰è¶£çš„æ’åºç®—æ³•ï¼Œä½¿ç”¨é€’å½’\n- é€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ï¼Œä¸€èˆ¬é€‰å·¦ç«¯ï¼Œæˆ–è€…å³ç«¯\n- ç›®æ ‡æ˜¯æŠŠæ¯”åŸºå‡†å€¼å°çš„æ”¾åˆ°å·¦è¾¹ï¼Œå¤§çš„æ”¾åˆ°å³è¾¹\n- å¦‚æœé€‰æ‹©å·¦ç«¯åˆ™ä»å³ç«¯æŒ‡é’ˆå¼€å§‹åˆ¤æ–­ï¼Œåä¹‹ä»å·¦ç«¯æŒ‡é’ˆå¼€å§‹\n- è¿™é‡Œå‡è®¾é€‰æ‹©å·¦ç«¯ä¸ºåŸºå‡†å€¼ï¼Œæ‰€ä»¥ä»å³ç«¯æŒ‡é’ˆå¼€å§‹æ‰«æ\n- ç”¨ä¸´æ—¶å˜é‡å­˜å‚¨åŸºå‡†å€¼ï¼Œæ­¤æ—¶å¯è®¤ä¸ºå·¦æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®æ˜¯ç©º\n- å¦‚æœå³æŒ‡é’ˆæ¯”åŸºå‡†å€¼å°ï¼Œåˆ™å°†å³æŒ‡é’ˆçš„å€¼å¡«å……åˆ°å·¦æŒ‡é’ˆï¼Œæ­¤æ—¶è®¤ä¸ºå³æŒ‡é’ˆä½ç½®æ˜¯ç©º\n- æ­¤æ—¶ç”¨å·¦æŒ‡é’ˆæ‰«æ\n- é‡åˆ°æ¯”åŸºå‡†å€¼å¤§çš„æ—¶å€™ï¼Œå°†å·¦æŒ‡é’ˆçš„å€¼å¡«å……åˆ°å³æŒ‡é’ˆï¼Œæ­¤æ—¶è®¤ä¸ºå·¦æŒ‡é’ˆä½ç½®ä¸ºç©º\n- æ­¤æ—¶ç”¨å³æŒ‡é’ˆæ‰«æ\n- ç›´åˆ°ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡ï¼Œå°†ä¸´æ—¶å˜é‡çš„åŸºå‡†å€¼å¡«å……åˆ°ä»»ä¸€æŒ‡é’ˆ\n- ç„¶åå°†åŸºå‡†å€¼å·¦å³ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«é€’å½’\n```kotlin\nfun quick(low: Int,high: Int, array: IntArray) {\n    if (low >= high) return\n    var left = low\n    var right = high\n    val temp = array[left]\n    var reverse = true\n    while (left < right) {\n        if (reverse) {\n            // ä»å³æŒ‡é’ˆæ‰«æ\n            // å½“å€¼æ¯”åŸºå‡†å€¼å°æ—¶ï¼Œå³æŒ‡é’ˆçš„å€¼å¡«å……åˆ°å·¦æŒ‡é’ˆï¼Œæ­¤æ—¶è®¤ä¸ºå³æŒ‡é’ˆä¸ºç©º\n            if (array[right] < temp) {\n                array[left] = array[right]\n                reverse = !reverse // æ‰å¤´\n            } else {\n                right-- // å³æŒ‡é’ˆå·¦ç§»åŠ¨\n            }\n        } else {\n            // ä»å·¦æŒ‡é’ˆæ‰«æ\n            // å½“å€¼æ¯”åŸºå‡†å€¼å¤§æ—¶ï¼Œå·¦æŒ‡é’ˆå¡«å……åˆ°å³æŒ‡é’ˆï¼Œæ­¤æ—¶è®¤ä¸ºå·¦æŒ‡é’ˆä¸ºç©º\n            if (array[left] > temp) {\n                array[right] = array[left]\n                reverse = !reverse // è°ƒç”¨\n            } else {\n                left++ // å·¦æŒ‡é’ˆå³ç§»åŠ¨\n            }\n        }\n    }\n    // ä¸€è¶Ÿç»“æŸåï¼ŒæŒ‡é’ˆç›¸é‡ï¼ŒæŠŠåŸºå‡†å€¼æ”¾åˆ°æŒ‡é’ˆæ‰€åœ¨ä½ç½®\n    // æ­¤æ—¶å·¦ä¾§éƒ½æ¯”åŸºå‡†å€¼å°ï¼Œå³ä¾§éƒ½æ¯”åŸºå‡†å€¼å¤§\n    array[left] = temp\n    // åˆ†åˆ«é€’å½’å·¦ä¾§å’Œå³ä¾§\n    quick(low, left - 1, array)\n    quick(left + 1, high, array)\n}\n```\n\n### æ’å…¥æ’åº\n- å°†åºåˆ—åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå·¦ä¾§æ˜¯å·²ç»æ’å¥½é¡ºåºçš„ï¼Œå³ä¾§æ˜¯æœªæ’çš„\n- æ¯æ¬¡ä»æœªæ’åºåˆ—ä¸­å–ä¸€ä¸ªæ•°å­—ï¼Œå°†å…¶æ’å…¥åˆ°å·²æ’å¥½éƒ¨åˆ†\n- å¾ªç¯è‡³æ’åºå®Œæˆ\n```kotlin\nfun insert(array: IntArray) {\n    var border = 0 // å·¦ä¾§å·²æ’åºéƒ¨åˆ†çš„è¾¹ç•Œ\n    while (border < array.size - 1) {\n        // æ¯æ¬¡å–å³ä¾§æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªæ•°å­—ï¼Œå°†å…¶æ’å…¥åˆ°å·¦ä¾§çš„ç›®æ ‡ä½ç½®\n        for (i in border downTo 0) {\n            if (array[i + 1] < array[i]) {\n                // å¼‚æˆ–æ“ä½œäº¤æ¢å€¼ï¼Œä¸ç”¨é¢å¤–çš„ä¸´æ—¶å˜é‡\n                array[i] = array[i] xor array[i + 1]\n                array[i + 1] = array[i] xor array[i + 1]\n                array[i] = array[i] xor array[i + 1]\n            } else {\n                break\n            }\n        }\n        border++\n    }\n}\n```\n\n\n[https://github.com/oynix/SortAlgorithmSample](https://github.com/oynix/SortAlgorithmSample)","tags":["æ•°æ®ç»“æ„","æ’åºç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"AndroidåŸºç¡€ä¹‹Handler","url":"/2021/08/aeb0be134986/","content":"\nè¯´åˆ°Androidçš„åŸºç¡€ï¼Œå°±ä¸€å®šç»•ä¸å¼€Handlerï¼Œä»¥åŠç›¸å…³çš„Looperã€Messageã€MessageQueueç­‰ã€‚è¿™ç¯‡æ–‡å°±è¯´è¯´å®ƒä»¬ä¹‹é—´çš„è”ç³»ï¼Œæ¥åŠ æ·±å°è±¡ã€‚\n\nå¤ªåŸºç¡€çš„å°±ä¸è¯´äº†ï¼Œé‚£æ ·è¦è¯´çš„ä¸œè¥¿å°±å¤ªå¤šå¤ªå¤šäº†ï¼Œå¤šå°‘ä¼šæ˜¾å¾—å†—æ‚ã€‚\n\n<!--more-->\n\n### å‰è¨€\nä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªapplicationå¯åŠ¨åï¼Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä½œä¸ºä¸»çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ActivityThreadï¼Œæ‰€æœ‰æ›´æ–°UIçš„æ“ä½œéƒ½è¦æ”¾åˆ°è¿™ä¸ªçº¿ç¨‹é‡Œè¿›è¡Œã€‚é™¤å»è¿™ä¸ªä¸»çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹å‡ä¸ºå­çº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹é‡Œæ›´æ–°UIä¼šæŠ¥é”™ï¼šCalledFromWrongThreadExceptionã€‚è¿™æ˜¯å› ä¸ºåœ¨ViewRootImplä¸­åšäº†æ£€æŸ¥ï¼Œåªè¦å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸»çº¿ç¨‹ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n\né‚£ä¹ˆï¼ŒAndroidä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿ\n\nå¯ä»¥å‡æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸è¿™ä¹ˆè®¾è®¡ï¼Œå…è®¸æ‰€æœ‰çº¿ç¨‹æ›´æ–°UIï¼Œé‚£ä¹ˆåœ¨å¹¶å‘é‡å¤šçš„æ—¶å€™ï¼šä¸€ä¸ªTextViewï¼ŒåŒä¸€æ—¶åˆ»ï¼Œæœ‰10ä¸ªçº¿ç¨‹æƒ³è¦æ›´æ–°å…¶æ˜¾ç¤ºçš„å†…å®¹ï¼Œè¿™å°±ä¼šå‘ç”Ÿæ··ä¹±ã€‚\n\nå¦‚æœæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯åŠ ä¸ªåŒæ­¥é”synchronizedï¼Œä½ ä»¬éƒ½å¯ä»¥æ›´æ–°UIï¼Œä½†æ˜¯è¦æ’é˜Ÿï¼Œä¸€ä¸ªä¸€ä¸ªæ¥ã€‚æ··ä¹±çš„é—®é¢˜è§£å†³ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ï¼ŒåŒæ­¥é”è¿™ä¸ªä¸œè¥¿ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²çš„æ—¶å€™æˆ‘éƒ½ä¸ä¼šç”¨ã€‚\n\næœ€åï¼Œå°±æœ‰äº†ç°åœ¨çš„è¿™ç§æ¨¡å¼ï¼Œå•ç‹¬å‡ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹ï¼Œç”¨äºæ›´æ–°UIï¼Œå…¶ä»–çº¿ç¨‹è‹¥æƒ³æ›´æ–°UIï¼Œé‚£ä¹ˆå°±å‘ä¸»çº¿ç¨‹å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œå‘é€ä¹‹åç»§ç»­è‡ªå·±çš„ä»»åŠ¡ï¼Œç­‰åˆ°åˆé€‚çš„æ—¶æœºï¼Œä¸»çº¿ç¨‹å°±ä¼šæ ¹æ®å‘æ¥çš„æ¶ˆæ¯ï¼Œåšå‡ºç›¸åº”çš„å¤„ç†ã€‚\n\nè¿™å°±æ˜¯Androidçš„æ¶ˆæ¯é©±åŠ¨æ¨¡å‹ã€‚\n\n### å›¢é˜Ÿç»„æˆ\nä»¥å‰æˆ‘åªæ˜¯çŸ¥é“ä¸ªå¤§æ¦‚ï¼Œä¸ºäº†å†™æ¸…æ¥šè¿™ç¯‡æ–‡ï¼Œå°±å»çœ‹äº†å¯¹åº”çš„æºæ–‡ä»¶ã€‚æ­é…ç€AndroidStudioï¼Œæºæ–‡ä»¶çš„å¯è¯»æ€§è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œå¦‚æœæœ‰æ—¶é—´éƒ½å¯ä»¥å»çœ‹çœ‹ã€‚\n\n- Handler\nç”¨æ¥å‘æ¶ˆæ¯ï¼Œå³Messageï¼›åŒæ—¶ï¼ŒHandlerä¹Ÿè¦æä¾›Messageçš„å¤„ç†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯éœ€è¦åšå“ªäº›æ“ä½œã€‚\n- Looper\nå¦‚åŒåå­—ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªå¾ªç¯å™¨ã€‚å®ƒè´Ÿè´£å¾ªç¯è¯»å–æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒMessageQueueä¸­çš„æ¶ˆæ¯ï¼Œå¦‚æœå…¶ä¸­æœ‰æ–°çš„æœªå¤„ç†çš„æ¶ˆæ¯ï¼Œåˆ™å°±å°†å…¶å–å‡ºï¼Œå¹¶å¤„ç†ã€‚\n- Message\næ¶ˆæ¯ä¸­åŒ…å«äº†ä¸€ä¸ªæ“ä½œéœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼Œåé¢ç»†è¯´ã€‚\n- MessageQueue\næ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å°†ä¼šå‘é€åˆ°è¿™é‡Œ\n\nè¿™ä¹ˆè¯´æœ‰äº›æŠ½è±¡ï¼Œç†è§£èµ·æ¥å¯èƒ½æœ‰äº›å›°éš¾ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼šä½ å»é“¶è¡Œå­˜æ¬¾ï¼Œåˆ°äº†é“¶è¡Œéœ€è¦å…ˆæ’å·ï¼Œç„¶åç­‰ç€å–Šå·ï¼Œæ’å·æœŸé—´ï¼Œä½ å¯ä»¥åšäº›åˆ«çš„äº‹æƒ…ï¼Œæ¯”å¦‚èŠå¤©ã€æ‰“æ¸¸æˆæˆ–è€…çœ‹è§†é¢‘ï¼Œç­‰åˆ°è½®åˆ°ä½ çš„æ—¶å€™ï¼Œä½ å°±ä¼šå»æŸœå°ï¼Œæ‹¿å‡ºè‡ªå·±è£…åœ¨å…œé‡Œçš„é’±ï¼Œç„¶åå­˜åˆ°è‡ªå·±çš„è´¦æˆ·ä¸Šã€‚\n\nè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å°±æ˜¯ä¸€ä¸ªHandlerï¼Œæ’å·å°±ç›¸å½“äºå‘é€äº†ä¸€ä¸ªMessageï¼Œæ‰€æœ‰æ’é˜Ÿä¸­çš„å·å°±ç›¸å½“äºä¸€ä¸ªMessageQueueï¼Œè€Œé“¶è¡Œçš„å«å·ç³»ç»Ÿå°±å¦‚åŒä¸€ä¸ªLooperã€‚\n\nå¯ä»¥åŒæ—¶æœ‰å¤šä¸ªHandlerï¼Œä¸€ä¸ªHandlerä¹Ÿå¯ä»¥å‘é€å¤šä¸ªMessageã€‚\n\n\n### Looper\n- çº¿ç¨‹é‡Œæœ¬æ²¡æœ‰Looperï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œè°ƒç”¨é™æ€æ–¹æ³•Looper.prepare()ã€‚\n- ä¸€ä¸ªçº¿ç¨‹åªå…è®¸åˆ›å»ºä¸€ä¸ªLooperï¼ŒLooperé‡Œé¢ä½¿ç”¨äº†ä¸€ä¸ªç±»å‹ä¸º`ThreadLocal<Looper>`é™æ€å˜é‡`sThreadLocal`ï¼Œä¿å­˜äº†æ‰€æœ‰çº¿ç¨‹çš„Looper\n- ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå¤šä¸ªLooperæ—¶ä¼šæŠ¥é”™ï¼šRuntimeException(\"Only one Looper may be created per thread\")\n- ä¸»çº¿ç¨‹çš„Looperä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œå› ä¸ºActivityThreadåœ¨mainæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºçš„å…¥å£ï¼Œè‡ªåŠ¨åˆ›å»º\n- Looperé‡Œé¢æŒæœ‰äº†ä¸€ä¸ªMessageQueueï¼Œåœ¨æ„é€ æ–¹æ³•é‡Œé¢å°†å…¶åˆå§‹åŒ–\n- è°ƒç”¨Looperä¸­çš„loopæ–¹æ³•ä¹‹åï¼ŒLooperä¾¿ä¼šå¾ªç¯ä»MessageQueueä¸­å–æ¶ˆæ¯ï¼Œæ²¡æœ‰æ¶ˆæ¯æ—¶ä¾¿ä¼šç­‰å¾…\n```java\n// åªåˆ—å‡ºäº†æºç ä¸­çš„éƒ¨åˆ†é‡è¦ä»£ç \npublic class Looper {\n    static ThreadLocal<Looper> sThreadLocal = new ThreadLocal<Looper>()\n    static Looper sMainLooper;\n    final MessageQueue mQueue;\n\n    // æ„é€ æ–¹æ³•ä¸­å‡ºå®ä¾‹åŒ–MessageQueue\n    private Looper(boolean quitAllowed) {\n        mQueue = new MessageQueue(quitAllowed);\n        mThread = Thread.currentThread();\n    }\n\n    // é€šè¿‡prepareåˆ›å»ºLooperï¼Œå¹¶æ·»åŠ åˆ°sThreadLocalä¸­\n    private static void prepare(boolean quitAllowed) {\n        if (sThreadLocal.get() != null) {\n            throw new RuntimeException(\"Only one Looper may be created per thread\");\n        }\n        sThreadLocal.set(new Looper(quitAllowed));\n    }\n\n    public static Looper myLooper() {\n        return sThreadLocal.get(); // è·å–å½“å‰çº¿ç¨‹çš„Looper\n    }\n\n    public static void loop() {\n        final Looper me = myLooper();\n        final MessageQueue queue = me.mQueue;\n        for (;;) {\n            Message msg = queue.next(); // å–å‡ºæ¶ˆæ¯\n            msg.target.dispatchMessage(msg); // æ‰ç”¨Handlerçš„æ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯\n        }\n    }\n}\n\n```\n\n\n### Handler\n- åœ¨åˆ›å»ºHandleræ—¶ï¼Œä¼šä»Looperçš„é™æ€å˜é‡`sThreadLocal`ä¸­è·å–å½“å‰çº¿ç¨‹çš„Looperï¼Œè·å–ä¸åˆ°åˆ™æŠ¥é”™`RuntimeException(\"Can't create handler inside thread that has not called Looper.prepare()\");`\n- é™¤ä¼šè‡ªåŠ¨åˆ›å»ºLooperçš„ä¸»çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦æ‰‹åŠ¨è°ƒç”¨Loopr.prepare()è¿›è¡Œåˆ›å»ºï¼Œè°ƒç”¨Looper.loop()å¼€å§‹å¾ªç¯å–æ¶ˆæ¯\n- ç°åœ¨æ¨èçš„åˆ›å»ºHandlerçš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡Looper.mainLooper()è·å–ä¸»çº¿ç¨‹çš„Looperï¼Œç„¶åå°†å…¶ä½œä¸ºæ„é€ å‚æ•°ä¼ åˆ°Handlerçš„æ„é€ æ–¹æ³•é‡Œ\n- æ‰€ä»¥ï¼Œå¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªHandlerå‘æ¶ˆæ¯æ›´æ–°UIï¼Œå› ä¸ºä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªLooperï¼Œå³mainLooper\n- å¯ä»¥é€šè¿‡Handlerå‘é€Messageï¼Œä¹Ÿå¯ä»¥å‘é€Runnableï¼Œåœ¨åŠ å…¥åˆ°MessageQueueå‰ï¼ŒRunnableä¹Ÿä¼šè¢«å°è£…æˆMessageï¼Œæœ€åLooperç»Ÿä¸€å¤„ç†Message\n```java\n// åªåˆ—å‡ºäº†æºç ä¸­çš„éƒ¨åˆ†é‡è¦ä»£ç \npublic class Handler {\n    Looper mLooper;\n    MessageQueue mQueue;\n    Handler.Callback mCallback;\n\n    public Handler(Callback callback, boolean async) {\n        mLooper = Looper.myLooper() // è·å–å½“å‰çº¿ç¨‹çš„Looper\n        if (mLooper == null) {\n            throw new RuntimeException(\"Can't create handler inside thread that has not called Looper.prepare()\");\n        }\n        mQueue = mLoopr.mQueue;\n        mCallback = callback;\n    }\n\n    public Handler(Looper looper, Callback callback, boolean async) {\n        mLooper = looper;\n        mQueue = looper.mQueue;\n        mCallback = callback;\n    }\n\n    // åœ¨Looperä¸­è°ƒç”¨ï¼Œç”¨æ¥åˆ†å‘æ¶ˆæ¯\n    public void dispatchMessage(Message message) {\n        if (msg.callback != null) {\n            handleCallback(msg); // æ˜¯Runnableçš„æ—¶å€™èµ°åˆ°è¿™é‡Œ\n        } else { // æ˜¯Messageçš„æ—¶å€™èµ°çš„è¿™é‡Œ\n            if (mCallback != null) { \n                // è¿™ä¸ªmCallbackå°±æ˜¯æ„é€ æ–¹æ³•é‡Œä¼ å…¥çš„ï¼Œ\n                // å¦‚æœä¸é‡å†™handleMessageæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªCallbackæ¥å¤„ç†Message\n                if (mCallback.handleMessage(msg)) {\n                    return;\n                }\n            }\n            handleMessage(msg); // å¦‚æœæ²¡ä¼ å…¥Callbackï¼Œåˆ™è°ƒç”¨handleMessage\n        }\n    }\n\n    // ç”¨æ¥å¤„ç†Runnable\n    private static void handleCallback(Message message) {\n        message.callback.run();\n    }\n\n    // ç”¨æ¥å¤„ç†Message\n    public void handleMessage(@NonNull Message msg) {\n    }\n}\n```\n\n\n### Message\n- Messageæ˜¯ä¸ªé“¾è¡¨ç»“æ„ï¼Œå…¶ä¸­æœ‰ä¸ªMessageç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå«`next`ï¼Œé è¿™ä¸ªå˜é‡æ¥å»ºç«‹èµ·é“¾è¡¨ç»“æ„\n- Messageä¸­æŒæœ‰Handlerçš„å¼•ç”¨ï¼Œå«åš`target`ï¼Œåœ¨Handlerå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŠŠHandlerèµ‹å€¼ç»™Messageçš„`target`å˜é‡\n- åœ¨Looperä»MessageQueueä¸­å–å‡ºMessageæ—¶ï¼Œä¾¿ä¼šè°ƒç”¨å…¶`target`çš„dispatchMessageæ–¹æ³•æ¥è®©Handlerå¤„ç†Message\n- Messageä¸€èˆ¬ä¸æ‰‹åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡`Message.obtain()`æ–¹æ³•ï¼Œå¦‚æœMessageæ± å­é‡Œæœ‰å¯ç”¨çš„å®ä¾‹åˆ™ä¼šé‡ç”¨ï¼Œæ²¡æœ‰åˆ™ä¼šè¿”å›ä¸€ä¸ªnew Message\n- å½“ä½¿ç”¨Handler.post Runnableæ—¶ï¼Œä¼šå°†Runnableå°è£…æˆMessageï¼Œå°†Runnableèµ‹å€¼ç»™å…¶ä¸­çš„callbackå˜é‡\n```java\n// åªåˆ—å‡ºäº†æºç ä¸­çš„éƒ¨åˆ†é‡è¦ä»£ç \npublic class Message {\n    Message next; // é“¾è¡¨ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªMessage\n    Handler target; // å‘é€å’Œå¤„ç†Messageçš„Handler\n    Runnable callback; // å‘é€çš„Runnable\n\n    // obtainæœ‰å¾ˆå¤šé‡è½½æ–¹æ³•\n    public static Message obtain() { /*çœç•¥*/ }\n}\n```\n\n### MessageQueue\n- è¿™å°±æ˜¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŒæœ‰é˜Ÿåˆ—å¤´æ¶ˆæ¯çš„å¼•ç”¨\n- å¯¹é˜Ÿåˆ—çš„æ“ä½œéƒ½å°è£…åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæ¯”å¦‚å¢åŠ æ¶ˆæ¯åˆ°é“¾è¡¨\n- å› ä¸ºå¯é€šè¿‡Handleræ¶ˆæ¯å‘é€å»¶è¿Ÿæ¶ˆæ¯ï¼Œæ‰€ä»¥é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ˜¯æ ¹æ®æ‰§è¡Œæ—¶é—´æ’é˜Ÿçš„\n\n\n### ThreadLocal\næ€»è§‰å¾—è¯´ä¸€è¯´è¿™ä¸ªThreadLocalæ‰ç®—å®Œæ•´ã€‚ThreadLocalæ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„ï¼Œå¸¦æœ‰ä¸€ä¸ªèŒƒå‹çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œå®ƒèƒ½å¤Ÿå°†æ•°æ®ä¸çº¿ç¨‹ç›¸äº’å…³è”ï¼Œä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å–åˆ°çš„æ•°æ®æ˜¯åŒä¸€ä¸ªã€‚é€šè¿‡getæ–¹æ³•è·å–å€¼ï¼Œé€šè¿‡setæ–¹æ³•è®¾ç½®å€¼ã€‚\nå®ç°åŸç†å°±æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹é‡Œç»´æŠ¤äº†ä¸€ä¸ªåå­—ä¸º`threadLocals`ï¼Œç±»å‹æ˜¯`ThreadLocal.ThreadLocalMap`çš„å˜é‡ï¼Œè¿™ç§ç±»å‹å°±æ˜¯ä¸€ä¸ªå®šåˆ¶çš„Map\n```java\npublic class ThreadLocal<T> {\n\n    public void set(T value) {\n        Thread t = Thread.currentThread();\n        ThreadLocalMap map = getMap(t); // å…ˆè·å–åˆ°Threadé‡Œçš„map\n        if (map != null) // ç„¶åå°†å€¼setè¿›å»\n            map.set(this, value);\n        else\n            createMap(t, value);\n    }\n\n    public T get() {\n        Thread t = Thread.currentThread();\n        ThreadLocalMap map = getMap(t); // å…ˆè·å–åˆ°Threadé‡Œçš„map\n        if (map != null) { // ç„¶åä»é‡Œé¢getå€¼\n            ThreadLocalMap.Entry e = map.getEntry(this);\n            if (e != null) {\n                @SuppressWarnings(\"unchecked\")\n                T result = (T)e.value;\n                return result;\n            }\n        }\n        return setInitialValue();\n    }\n}\n\n// ä½¿ç”¨\nThreadLocal tl = new ThreadLocal<String>();\ntl.set(\"something\");\nString value = tl.get()\n\n```\n\n\n### Handlerä½¿ç”¨\nå½“ä½¿ç”¨Handlerå‘é€Runnableæ—¶ï¼Œç›´æ¥ä½¿ç”¨Handler.post()æ–¹æ³•å³å¯ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰å¾ˆå¤šé‡è½½æ–¹æ³•ï¼Œä¾‹å¦‚ï¼šå¯å‘é€å»¶è¿Ÿçš„æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥å‘é€åœ¨æŸä¸ªå…·ä½“æ—¶é—´æ‰§è¡Œçš„æ¶ˆæ¯ï¼Œç­‰ç­‰ã€‚\nå½“ä½¿ç”¨Handlerå‘é€Messageæ—¶ï¼Œä¸€èˆ¬é€šè¿‡sendMessageæ–¹æ³•å‘æ¶ˆæ¯ï¼Œç„¶åé‡å†™å®ƒçš„handleMessageæ–¹æ³•ï¼Œæ¥å¤„ç†å¯¹åº”çš„æ¶ˆæ¯ï¼ŒåŒæ ·è¿™ä¸ªå‘é€æ–¹æ³•ä¹Ÿæœ‰å‡ ä¸ªé‡è½½æ–¹æ³•ï¼ŒæŸ¥çœ‹å¯¹åº”çš„APIæ–‡æ¡£å³å¯ï¼š\n```kotlin\nclass HandlerTest : AppCompatActivity() {\n\n    // åˆ›å»ºä¸€ä¸ªHandler\n    val handler = object : Handler(Looper.getMainLooper()) {\n        override fun handleMessage(msg: Message) {\n            when (msg.what) {\n            1 -> { textView.text = \"message 1\" }\n            2 -> { textView.text = \"message 2\" }\n            }\n        }\n    }\n    \n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        object : Thread() {\n            override fun run() {\n                // åœ¨å­çº¿ç¨‹è°ƒç”¨ï¼Œå¦‚ä»ç½‘ç»œè·å–åˆ°æ•°æ®å\n                val message = Message.obtain()\n                message.what = 1\n                handler.sendMessage(message)\n            }\n        }.start()\n    }\n}\n```\nä¸€èˆ¬ç”¨æ³•å°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯è¿™æ ·ç¼–è¯‘å™¨ä¼šæç¤ºä¸€ä¸ªå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºçš„è­¦å‘Šï¼Œå› ä¸ºåœ¨Handlerçš„æ„é€ æ–¹æ³•é‡Œåšäº†æ£€æŸ¥ï¼š\n```java\npublic Handler(@Nullable Callback callback, boolean async) {\n    if (FIND_POTENTIAL_LEAKS) {\n        final Class<? extends Handler> klass = getClass();\n        // åœ¨è¿™é‡Œï¼Œå¦‚æœå½“å‰ç±»æ˜¯åŒ¿åç±»ï¼Œæˆ–è€…æ˜¯æˆå‘˜ç±»ï¼Œæˆ–è€…æ˜¯å±€éƒ¨ç±»ï¼Œå¹¶ä¸”ä¸æ˜¯é™æ€ç±»ï¼Œé‚£ä¹ˆå°±ä¼šå‘å‡ºè­¦å‘Š\n        if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &&\n                (klass.getModifiers() & Modifier.STATIC) == 0) {\n            Log.w(TAG, \"The following Handler class should be static or leaks might occur: \" +\n                klass.getCanonicalName());\n        }\n    }\n    // çœç•¥äº†ä¸€äº›ä»£ç \n}\n```\n\n### ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\nç®€å•è¯´ï¼Œå°±æ˜¯å½“ä¸€ä¸ªå®ä¾‹è¯¥è¢«GCå›æ”¶çš„æ—¶å€™ï¼Œå´æ— æ³•è¢«å›æ”¶ï¼Œè¿™å—æ— æ³•è¢«å›æ”¶çš„å†…å­˜ï¼Œå°±æ˜¯æ³„æ¼çš„å†…å­˜ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“ä»ä¸€ä¸ªActivityè¿”å›çš„æ—¶å€™ï¼ŒActivityçš„å®ä¾‹ä»ä»»åŠ¡æ ˆå¼¹å‡ºï¼Œè¿™ä¸ªæ—¶å€™è¿™ä¸ªå®ä¾‹å°±è¯¥è¢«GCå›æ”¶æ‰ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¿™æ—¶è¿˜è¢«å…¶ä»–å®ä¾‹å¼•ç”¨çš„è¯ï¼ŒGCæ˜¯ä¸ä¼šå¯¹å®ƒå›æ”¶çš„ã€‚\n\n\n### ä¸ºä½•é€ æˆå†…å­˜æ³„æ¼\næˆ‘ä»¬æ¥æ‹ä¸€æ‹ï¼Œä½œä¸ºActivityçš„åŒ¿åå†…éƒ¨ç±»ï¼ŒHandlerä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œè¿™æ˜¯Javaçš„æœºåˆ¶ï¼›è€ŒHandlerä¼šè¢«Messageä¸­çš„targetå˜é‡å¼•ç”¨ï¼ŒMessageä¼šè¢«MessageQueueå¼•ç”¨ï¼ŒMessageQueueä¼šè¢«Looperå¼•ç”¨ï¼Œè€ŒLooperçš„ç”Ÿå‘½å‘¨æœŸæ˜¯å’Œå½“å‰Threadçš„ç”Ÿå‘½ä¸€æ ·é•¿ï¼Œå¦‚æœæ˜¯ä¸»çº¿ç¨‹çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªLooperå°±ä¼šè´¯ç©¿åº”ç”¨å…¨ç¨‹ï¼Œå› ä¸ºActivityçš„å®ä¾‹é—´æ¥è¢«ä¸»çº¿ç¨‹å¼•ç”¨ï¼Œå¯¹äºæœ‰å¼•ç”¨çš„å†…å­˜ï¼Œè™šæ‹Ÿæœºå®æ„¿æŠ¥é”™OOMï¼Œä¹Ÿä¸ä¼šè®©GCå›æ”¶ã€‚\n\n\n### å¦‚ä½•è§£å†³æ³„æ¼\nåŸå› æ—¢ç„¶æ¸…æ¥šäº†ï¼Œé‚£ä¹ˆå°±å¥½è§£å†³äº†ï¼Œåªè¦é¿å…Handlerå¼•ç”¨å¤–éƒ¨ç±»ï¼Œè¿™é‡Œå°±æ˜¯Activityï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ³„æ¼äº†ã€‚ä¸€èˆ¬çš„æ–¹æ¡ˆï¼Œå°±æ˜¯ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»å¯¹å¤–éƒ¨ç±»æ˜¯æ²¡æœ‰å¼•ç”¨çš„ï¼Œè¿™ä¹Ÿæ˜¯Javaçš„æœºåˆ¶ï¼›æˆ–è€…å°†Handlerç‹¬ç«‹å‡ºå»ï¼Œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªç±»æ–‡ä»¶ä¸­ï¼Œä½¿å…¶ä¸å†æ˜¯å†…éƒ¨ç±»ï¼Œè¿™æ ·ä¾¿ä¸ä¼šåœ¨å¼•ç”¨å¤–éƒ¨ç±»ã€‚\n\n\n### æ€»ç»“\nAndroidé€šè¿‡ä¸»çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—æ¥æ›´æ–°UIï¼Œè€ŒHandleræ˜¯è¿™ä¸ªæ¶ˆæ¯é©±åŠ¨æ¨¡å‹ä¸­çš„ä¸€å‘˜ï¼Œè´Ÿè´£å‘æ¶ˆæ¯å’Œå¤„ç†æ¶ˆæ¯ï¼ŒåŒæ—¶è¿™ä¸ªæ¨¡å‹ä¸­è¿˜æœ‰å…¶ä»–å‡ ä¸ªæˆå‘˜ï¼šMessageï¼Œæ¶ˆæ¯ï¼›MessageQueueï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼›Looperï¼Œä»é˜Ÿåˆ—å»æ¶ˆæ¯çš„å¾ªç¯å™¨ã€‚\n","tags":["Android"],"categories":["Android"]},{"title":"AndroidåŸºç¡€ä¹‹singleTask","url":"/2021/08/83315178a002/","content":"\næ—¶é—´åšçš„ä¹…äº†ï¼ŒåŸºç¡€çš„çŸ¥è¯†å¿˜çš„è¶Šæ¥è¶Šå¤šï¼Œæ­£æ‰€è°“ï¼šåŸºç¡€ä¸ç‰¢ï¼Œåœ°åŠ¨å±±æ‘‡ã€‚æœ€è¿‘æœ‰éœ€è¦ï¼Œæ‰€ä»¥åœ¨æ…¢æ…¢é‡æ¥ï¼Œä»Šå¤©è¯´ä¸€è¯´Activityçš„å‡ ç§å¯åŠ¨æ¨¡å¼ã€‚\n\n<!--more-->\n\n### å‰è¨€\n\nå¯åŠ¨æ¨¡å¼æœ‰4ç§ï¼š`standard`ã€`singleTop`ã€`singleTask`å’Œ`singleInstance`ï¼Œè¿™æ¬¡ä¸»è¦è¯´ä¸€è¯´`singleTask`ï¼Œç›¸æ¯”äºå…¶ä»–ï¼Œè¿™ä¸ªç®—æ˜¯æ¯”è¾ƒå¤æ‚ä¸€äº›çš„ã€‚\n\nåˆ©ç”¨`adb`æä¾›çš„å‘½ä»¤`adb shell dumpsys activity activities`å¯ä»¥æŸ¥çœ‹è®¾å¤‡å½“å‰çš„activityæ ˆä¿¡æ¯ã€‚æ­¤å¤–ï¼Œ`adb shell dumpsys`å¯ä»¥æŸ¥çœ‹å„ç§ä¿¡æ¯ï¼Œç›´æ¥è¾“å…¥å°±ä¼šåˆ—å‡ºå®ƒæ‰€æ”¯æŒçš„æ‰€æœ‰æœåŠ¡ã€‚\n\nä¸‹é¢è´´äº†ä¸€æ®µæˆ‘ç”¨çš„æµ‹è¯•è®¾å¤‡çš„activityä¿¡æ¯ï¼Œä¹ä¸€çœ‹ä¸Šå»å†…å®¹æœ‰äº›å†—æ‚ï¼Œå…¶å®æ˜¯å› ä¸ºé‡Œé¢åŒ…å«äº†å¾ˆè¯¦ç»†çš„ä¿¡æ¯å’Œå…³ç³»ï¼Œä»å¤´æŒ‰è¡Œè¯»ï¼Œè¯»æ‡‚çš„è¯ä¸æ˜¯é—®é¢˜ã€‚ä»è¿™äº›æ•°æ®ä¸­ï¼Œå¯ä»¥å¯¹`Process`ã€`Task`ä¹‹é—´çš„å…³ç³»æœ‰ä¸ªå¤§è‡´äº†è§£ã€‚\n\nä¸ºäº†ä¸å½±å“é˜…è¯»ä½“éªŒï¼Œæˆ‘æŠŠå®ƒæŠ˜å èµ·æ¥äº†ã€‚\n\n<details style='background-color:#f9f2f4'>\n<summary><font color='#c7254e' size='3px'> view detail</font></summary>\n```shell\n$ adb shell dumpsys activity activities\nACTIVITY MANAGER ACTIVITIES (dumpsys activity activities)\nDisplay #0 (activities from top to bottom):\n\n  Stack #7: type=standard mode=fullscreen\n  isSleeping=false\n  mBounds=Rect(0, 0 - 0, 0)\n    Task id #25\n    mBounds=Rect(0, 0 - 0, 0)\n    mMinWidth=-1\n    mMinHeight=-1\n    mLastNonFullscreenBounds=null\n    * TaskRecord{3e1780c #25 A=com.oynix.launch.mode.sample U=0 StackId=7 sz=2}\n      userId=0 effectiveUid=u0a208 mCallingUid=2000 mUserSetupComplete=true mCallingPackage=null\n      affinity=com.oynix.launch.mode.sample\n      intent={act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=0x10000000 cmp=com.oynix.launch.mode.sample/.MainActivity}\n      realActivity=com.oynix.launch.mode.sample/.MainActivity\n      autoRemoveRecents=false isPersistable=true numFullscreen=2 activityType=1\n      rootWasReset=false mNeverRelinquishIdentity=true mReuseTask=false mLockTaskAuth=LOCK_TASK_AUTH_PINNABLE\n      Activities=[ActivityRecord{a1dcebd u0 com.oynix.launch.mode.sample/.MainActivity t25}, ActivityRecord{907f0e u0 com.oynix.launch.mode.sample/.AActivity t25}]\n      askedCompatMode=false inRecents=true isAvailable=true\n      mRootProcess=ProcessRecord{26080b8d0 21734:com.oynix.launch.mode.sample/u0a208}\n      stackId=7\n      hasBeenVisible=true mResizeMode=RESIZE_MODE_RESIZEABLE_VIA_SDK_VERSION mSupportsPictureInPicture=false isResizeable=true lastActiveTime=6697777 (inactive for 3s)\n      isLaunchedPairApp=false\n      mOverrideConfig={0.0 ?mcc?mnc ?localeList ?layoutDir ?swdp ?wdp ?hdp ?density ?lsize ?long ?ldr ?wideColorGamut ?orien ?uimode ?night ?touch ?keyb/?/? ?nav/? winConfig={ mBounds=Rect(0, 0 - 0, 0) mAppBounds=null mWindowingMode=undefined mActivityType=undefined} mkbd/? desktop/?showBtnShape = -1  themeSeq=0 0 0  ?dc}\n      dexBoundsPolicy:\n       mLastNonFullBoundsDisplayId=-1\n      * Hist #1: ActivityRecord{907f0e u0 com.oynix.launch.mode.sample/.AActivity t25}\n          packageName=com.oynix.launch.mode.sample processName=com.oynix.launch.mode.sample\n          launchedFromUid=10208 launchedFromPackage=com.oynix.launch.mode.sample userId=0\n          app=ProcessRecord{26080b8d0 21734:com.oynix.launch.mode.sample/u0a208}\n          Intent { cmp=com.oynix.launch.mode.sample/.AActivity }\n          frontOfTask=false task=TaskRecord{3e1780c #25 A=com.oynix.launch.mode.sample U=0 StackId=7 sz=2}\n          taskAffinity=com.oynix.launch.mode.sample\n          realActivity=com.oynix.launch.mode.sample/.AActivity\n          baseDir=/data/app/com.oynix.launch.mode.sample-3DMFUnGXrp7XpBKiFV3-Tg==/base.apk\n          dataDir=/data/user/0/com.oynix.launch.mode.sample\n          stateNotNeeded=false componentSpecified=true mActivityType=standard\n          compat={480dpi} labelRes=0x7f0e001b icon=0x7f0c0000 theme=0x7f0f01a1\n          mLastReportedConfigurations:\n           mGlobalConfig={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 0, 0) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=undefined} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n           mOverrideConfig={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 1080, 2076) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=standard} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n          CurrentConfiguration={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 1080, 2076) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=standard} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n          taskDescription: label=\"null\" icon=null iconResource=0 iconFilename=null primaryColor=ff6200ee\n           backgroundColor=ffffffff\n           statusBarColor=ff3700b3\n           navigationBarColor=fff2f2f2\n          launchFailed=false launchCount=1 lastLaunchTime=-5s311ms\n          haveState=false icicle=null\n          state=RESUMED stopped=false delayedResume=false finishing=false\n          keysPaused=false inHistory=true visible=true sleeping=false idle=true mStartingWindowState=STARTING_WINDOW_NOT_SHOWN\n          fullscreen=true noDisplay=false immersive=false launchMode=0\n          frozenBeforeDestroy=false forceNewConfig=false\n          mActivityType=standard\n          vrActivityType=0\n          waitingVisible=false nowVisible=true lastVisibleTime=-4s856ms\n          resizeMode=RESIZE_MODE_RESIZEABLE_VIA_SDK_VERSION\n          mLastReportedMultiWindowMode=false mLastReportedPictureInPictureMode=false\n          mUseDeviceDefaultTheme=false\n      * Hist #0: ActivityRecord{a1dcebd u0 com.oynix.launch.mode.sample/.MainActivity t25}\n          packageName=com.oynix.launch.mode.sample processName=com.oynix.launch.mode.sample\n          launchedFromUid=2000 launchedFromPackage=null userId=0\n          app=ProcessRecord{26080b8d0 21734:com.oynix.launch.mode.sample/u0a208}\n          Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=0x10000000 cmp=com.oynix.launch.mode.sample/.MainActivity }\n          frontOfTask=true task=TaskRecord{3e1780c #25 A=com.oynix.launch.mode.sample U=0 StackId=7 sz=2}\n          taskAffinity=com.oynix.launch.mode.sample\n          realActivity=com.oynix.launch.mode.sample/.MainActivity\n          baseDir=/data/app/com.oynix.launch.mode.sample-3DMFUnGXrp7XpBKiFV3-Tg==/base.apk\n          dataDir=/data/user/0/com.oynix.launch.mode.sample\n          stateNotNeeded=false componentSpecified=true mActivityType=standard\n          compat={480dpi} labelRes=0x7f0e001b icon=0x7f0c0000 theme=0x7f0f01a1\n          mLastReportedConfigurations:\n           mGlobalConfig={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 0, 0) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=undefined} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n           mOverrideConfig={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 1080, 2076) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=standard} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n          CurrentConfiguration={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 1080, 2076) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=standard} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n          taskDescription: label=\"null\" icon=null iconResource=0 iconFilename=null primaryColor=ff6200ee\n           backgroundColor=ffffffff\n           statusBarColor=ff3700b3\n           navigationBarColor=fff2f2f2\n          launchFailed=false launchCount=0 lastLaunchTime=-24s316ms\n          haveState=true icicle=Bundle[mParcelledData.dataSize=2448]\n          state=STOPPED stopped=true delayedResume=false finishing=false\n          keysPaused=false inHistory=true visible=false sleeping=false idle=true mStartingWindowState=STARTING_WINDOW_REMOVED\n          fullscreen=true noDisplay=false immersive=false launchMode=0\n          frozenBeforeDestroy=false forceNewConfig=false\n          mActivityType=standard\n          vrActivityType=0\n          waitingVisible=false nowVisible=false lastVisibleTime=-6s410ms\n          resizeMode=RESIZE_MODE_RESIZEABLE_VIA_SDK_VERSION\n          mLastReportedMultiWindowMode=false mLastReportedPictureInPictureMode=false\n          mUseDeviceDefaultTheme=false\n\n    Running activities (most recent first):\n      TaskRecord{3e1780c #25 A=com.oynix.launch.mode.sample U=0 StackId=7 sz=2}\n        Run #1: ActivityRecord{907f0e u0 com.oynix.launch.mode.sample/.AActivity t25}\n        Run #0: ActivityRecord{a1dcebd u0 com.oynix.launch.mode.sample/.MainActivity t25}\n\n    mResumedActivity: ActivityRecord{907f0e u0 com.oynix.launch.mode.sample/.AActivity t25}\n    mLastPausedActivity: ActivityRecord{a1dcebd u0 com.oynix.launch.mode.sample/.MainActivity t25}\n\n  Stack #0: type=home mode=fullscreen\n  isSleeping=false\n  mBounds=Rect(0, 0 - 0, 0)\n\n    Task id #18\n    mBounds=Rect(0, 0 - 0, 0)\n    mMinWidth=-1\n    mMinHeight=-1\n    mLastNonFullscreenBounds=null\n    * TaskRecord{13181bb #18 I=com.sec.android.app.launcher/com.android.launcher3.infra.activity.Launcher U=0 StackId=0 sz=1}\n      userId=0 effectiveUid=u0a96 mCallingUid=1000 mUserSetupComplete=true mCallingPackage=android\n      intent={act=android.intent.action.MAIN cat=[android.intent.category.HOME] flg=0x10800100 cmp=com.sec.android.app.launcher/com.android.launcher3.infra.activity.Launcher}\n      origActivity=com.sec.android.app.launcher/.activities.LauncherActivity\n      realActivity=com.sec.android.app.launcher/com.android.launcher3.infra.activity.Launcher\n      autoRemoveRecents=false isPersistable=false numFullscreen=1 activityType=2\n      rootWasReset=false mNeverRelinquishIdentity=true mReuseTask=false mLockTaskAuth=LOCK_TASK_AUTH_PINNABLE\n      Activities=[ActivityRecord{ad01979 u0 com.sec.android.app.launcher/.activities.LauncherActivity t18}]\n      askedCompatMode=false inRecents=true isAvailable=true\n      stackId=0\n      hasBeenVisible=true mResizeMode=RESIZE_MODE_RESIZEABLE mSupportsPictureInPicture=false isResizeable=true lastActiveTime=6676345 (inactive for 24s)\n      isLaunchedPairApp=false\n      mOverrideConfig={0.0 ?mcc?mnc ?localeList ?layoutDir ?swdp ?wdp ?hdp ?density ?lsize ?long ?ldr ?wideColorGamut ?orien ?uimode ?night ?touch ?keyb/?/? ?nav/? winConfig={ mBounds=Rect(0, 0 - 0, 0) mAppBounds=null mWindowingMode=undefined mActivityType=undefined} mkbd/? desktop/?showBtnShape = -1  themeSeq=0 0 0  ?dc}\n      dexBoundsPolicy:\n       mLastNonFullBoundsDisplayId=-1\n      * Hist #0: ActivityRecord{ad01979 u0 com.sec.android.app.launcher/.activities.LauncherActivity t18}\n          packageName=com.sec.android.app.launcher processName=com.sec.android.app.launcher\n          launchedFromUid=0 launchedFromPackage=null userId=0\n          app=ProcessRecord{95a823d0 5418:com.sec.android.app.launcher/u0a96}\n          Intent { act=android.intent.action.MAIN cat=[android.intent.category.HOME] flg=0x10800100 cmp=com.sec.android.app.launcher/.activities.LauncherActivity }\n          frontOfTask=true task=TaskRecord{13181bb #18 I=com.sec.android.app.launcher/com.android.launcher3.infra.activity.Launcher U=0 StackId=0 sz=1}\n          taskAffinity=null\n          realActivity=com.sec.android.app.launcher/com.android.launcher3.infra.activity.Launcher\n          baseDir=/system/priv-app/TouchWizHome_2017/TouchWizHome_2017.apk\n          dataDir=/data/user/0/com.sec.android.app.launcher\n          stateNotNeeded=true componentSpecified=false mActivityType=home\n          compat={480dpi} labelRes=0x7f090042 icon=0x7f020127 theme=0x7f0e019c\n          mLastReportedConfigurations:\n           mGlobalConfig={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 0, 0) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=undefined} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n           mOverrideConfig={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 1080, 2076) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=home} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n          CurrentConfiguration={0.9 ?mcc?mnc [zh_CN_#Hans] ldltr sw360dp w360dp h668dp 480dpi nrml long port finger -keyb/v/h -nav/h winConfig={ mBounds=Rect(0, 0 - 1080, 2076) mAppBounds=Rect(0, 0 - 1080, 2076) mWindowingMode=fullscreen mActivityType=home} s.9 mkbd/h desktop/dshowBtnShape = 0  themeSeq=0 0 0  ?dc}\n          OverrideConfiguration={0.0 ?mcc?mnc ?localeList ?layoutDir ?swdp ?wdp ?hdp ?density ?lsize ?long ?ldr ?wideColorGamut ?orien ?uimode ?night ?touch ?keyb/?/? ?nav/? winConfig={ mBounds=Rect(0, 0 - 0, 0) mAppBounds=null mWindowingMode=undefined mActivityType=home} mkbd/? desktop/?showBtnShape = -1  themeSeq=0 0 0  ?dc}\n          taskDescription: label=\"null\" icon=null iconResource=0 iconFilename=null primaryColor=ff0074d4\n           backgroundColor=fffafafa\n           statusBarColor=0\n           navigationBarColor=0\n          launchFailed=false launchCount=0 lastLaunchTime=-1h51m21s986ms\n          haveState=true icicle=Bundle[mParcelledData.dataSize=14056]\n          state=STOPPED stopped=true delayedResume=false finishing=false\n          keysPaused=false inHistory=true visible=false sleeping=false idle=true mStartingWindowState=STARTING_WINDOW_NOT_SHOWN\n          fullscreen=true noDisplay=false immersive=false launchMode=2\n          frozenBeforeDestroy=false forceNewConfig=false\n          mActivityType=home\n          vrActivityType=0\n          waitingVisible=false nowVisible=false lastVisibleTime=-1m33s752ms\n          connections=[ConnectionRecord{108b50e u0 CR com.samsung.android.app.spage/.service.overlay.PageOverlayService:@e38ef09}]\n          resizeMode=RESIZE_MODE_RESIZEABLE\n          mLastReportedMultiWindowMode=false mLastReportedPictureInPictureMode=false\n          mUseDeviceDefaultTheme=true\n\n    Running activities (most recent first):\n      TaskRecord{13181bb #18 I=com.sec.android.app.launcher/com.android.launcher3.infra.activity.Launcher U=0 StackId=0 sz=1}\n        Run #0: ActivityRecord{ad01979 u0 com.sec.android.app.launcher/.activities.LauncherActivity t18}\n\n    mLastPausedActivity: ActivityRecord{ad01979 u0 com.sec.android.app.launcher/.activities.LauncherActivity t18}\n\n  ResumedActivity: ActivityRecord{907f0e u0 com.oynix.launch.mode.sample/.AActivity t25}\n  mFocusedStack=ActivityStack{9f0e91 stackId=7 type=standard mode=fullscreen visible=true translucent=false, 1 tasks} mLastFocusedStack=ActivityStack{9f0e91 stackId=7 type=standard mode=fullscreen visible=true translucent=false, 1 tasks}\n  mCurTaskIdForUser={0=25}\n  mUserStackInFront={}\n  displayId=0 stacks=2\n   mHomeStack=ActivityStack{364f85f stackId=0 type=home mode=fullscreen visible=false translucent=true, 1 tasks}\n   mDefaultMinSizeOfResizeableTask=660\n  isHomeRecentsComponent=true  mDefaultMinSizeOfResizeableTask=660  KeyguardController:\n    mKeyguardShowing=false\n    mAodShowing=false\n    mKeyguardGoingAway=true\n    mOccluded=false\n    mDismissingKeyguardActivity=null\n    mDismissalRequested=false\n    mVisibilityTransactionDepth=0\n    mDexOccluded=false\n    mDexDisplaySleepToken=null\n  LockTaskController\n    mLockTaskModeState=NONE\n    mLockTaskModeTasks=\n    mLockTaskPackages (userId:packages)=\n      u0:[]\n```\n</details>\n\n### å‡ ä¸ªæ¦‚å¿µ\nåœ¨æ­¤ä¹‹å‰ï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæœ‰å‡ ä¸ªåè¯éœ€è¦å…ˆè§£é‡Šã€‚\n- Process è¿›ç¨‹\nå¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„é…ç½®ï¼Œå¯åŠ¨ä¸€ä¸ª`application`å°±ä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹åç§°é»˜è®¤ä¸ºåŒ…åã€‚è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå†…å­˜äº’ä¸å…±äº«ã€‚ä¸€ä¸ªè¿›ç¨‹å†…å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹çš„å†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªå˜é‡å¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä»è€Œå¯¼è‡´çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚\nåœ¨`AndroidManifest.xml`æ–‡ä»¶ä¸­å£°æ˜å››å¤§ç»„ä»¶æ—¶ï¼Œå¦‚æœè®¾ç½®äº†`android:process`å±æ€§ï¼Œè¿™ä¸ªå°±ä¸ä¼šè¿è¡Œåœ¨`applicaton`çš„æ‰€åœ¨çš„è¿›ç¨‹ï¼Œè€Œæ˜¯å¦èµ·ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚è¿›ç¨‹çš„åå­—å°±æ˜¯`android:process`å±æ€§çš„å€¼ã€‚\n\n- Task ä»»åŠ¡\nå¯ä»¥ç®€å•çš„æŠŠTaskç†è§£æˆä¸€ä¸ªå­˜æ”¾Activityçš„æ ˆï¼Œä¸€ä¸ªActivityå¿…é¡»ä¾é™„äºä¸€ä¸ªTaskï¼Œå¯åŠ¨Activityå°±æ˜¯å°†Activityå®ä¾‹å‹å…¥æ ˆé¡¶ï¼Œé”€æ¯Activityå°±æ˜¯å°†Activityå®ä¾‹å‡ºæ ˆçš„è¿‡ç¨‹ã€‚Activityè™½ç„¶ä¾é™„äºTaskï¼Œä½†å¹¶ä¸æ˜¯éšä¾¿ä¸€ä¸ªTaskå°±å¯ä»¥ï¼Œæ¯ä¸ªTaskéƒ½æœ‰ä¸€ä¸ª`name`ï¼ŒActivityå°±æ˜¯æ ¹æ®è¿™ä¸ªåå­—æ‰¾åˆ°è‡ªå·±çš„å½’å®¿ã€‚æ„æ€å°±æ˜¯è¯´ï¼Œä¼šåŒæ—¶å­˜åœ¨å¤šä¸ªTaskï¼Œä»ä¸Šé¢`dumpsys`çš„ç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ï¼Œå…¶ä¸­çš„`TaskRecord`ä¾¿æ˜¯ä¸€ä¸ªTaskå®ä¾‹ã€‚Taskçš„åå­—æ˜¯å¯ä»¥é‡å¤çš„ï¼Œè¿™ä¸å…¶ä¸­åŒ…å«çš„Activityçš„æ¨¡å¼æœ‰å…³ï¼Œä¸‹é¢å†è¯´ã€‚\n\n- android:taskAffinity\nè¿™æ˜¯`AndroidManifest.xml`æ–‡ä»¶ä¸­ï¼Œ`activity`æ ‡ç­¾çš„ä¸€ä¸ªå±æ€§ï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚`affinity`ï¼Œç›´è¯‘è¿‡æ¥å°±æ˜¯å¯†åˆ‡å…³ç³»ã€ç±»åŒçš„æ„æ€ï¼Œåœ¨è¿™é‡Œå°±æ˜¯æŒ‡å®šTaskçš„åå­—ã€‚`application`ä¹Ÿæœ‰è¿™ä¸ªå±æ€§ï¼Œå½“`activity`ä¸è®¾ç½®è¿™ä¸ªå±æ€§æ—¶ï¼Œé»˜è®¤ä¼šä½¿ç”¨`application`è¿™ä¸ªå±æ€§çš„å€¼ï¼›å¦‚æœ`application`ä¹Ÿæ²¡æœ‰è®¾ç½®è¿™ä¸ªå±æ€§çš„å€¼ï¼Œé‚£å°±é»˜è®¤ä½¿ç”¨åŒ…åã€‚æ‰€ä»¥ï¼Œä¸è®¾ç½®è¿™ä¸ªå±æ€§æ—¶ï¼Œactivityå¯åŠ¨åéƒ½ä¼šä¾é™„åœ¨ä¸€ä¸ªåå­—ä¸ºåŒ…åçš„Taskä¸­ï¼Œä»`dumpsys`ç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ã€‚\n\n\n### æ¨¡å¼ï¼šstandard\nè¿™ä¸ªæ˜¯é»˜è®¤çš„æ¨¡å¼ï¼Œä¸ä¸»åŠ¨è®¾ç½®çš„Activityï¼Œéƒ½æ˜¯è¿™ä¸ªæ¨¡å¼ã€‚è¿™ä¸ªæ¨¡å¼å¾ˆå¥½ç†è§£ï¼Œåªè¦è®¾ç½®æˆè¿™ä¸ªæ¨¡å¼ï¼Œå®ƒä»ç”Ÿåˆ°æ­»éƒ½ä¼šå­˜åœ¨åŒ…åä¸ºåç§°çš„Taskä¸­ï¼Œå³ä¾¿æ˜¯è®¾ç½®äº†`taskAffinify`ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚æ¯æ¬¡å¯åŠ¨ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„å®ä¾‹å‹å…¥Taskçš„æ ˆé¡¶ã€‚\n\n### æ¨¡å¼ï¼šsingleTop\nä»åå­—æ¥çœ‹ï¼Œå°±æ˜¯å•ç‹¬çš„é¡¶éƒ¨ã€‚æ„æ€å°±æ˜¯ï¼Œåœ¨Taskæ ˆé¡¶åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å¯åŠ¨æ—¶ï¼Œå¦‚æœå‘ç°æ ˆé¡¶å°±æ˜¯è¿™ä¸ªactivityçš„å®ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡é‡ç”¨è¿™ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰ç”¨Activityä¸­çš„`onNewIntent`æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡å¼ä¹Ÿå¯¹`taskAffinify`å±æ€§æ— æ•ˆï¼Œåªä¼šå­˜åœ¨äºåŒ…åçš„Taskä¸­ã€‚å¸¸ç”¨äºå†…å®¹è¯¦æƒ…ï¼Œå¦‚æ–°é—»è¯¦æƒ…ï¼Œå•ç‹¬å ä¸€ä¸ªé¡µé¢ï¼Œæµè§ˆå®Œè¯¦æƒ…ï¼Œåº•éƒ¨ä¼šæ˜¾ç¤ºå‡ ä¸ªå…¶ä»–æ–°é—»çš„é“¾æ¥ï¼Œç‚¹å‡»ä¹‹åï¼Œä¼šå†æ¬¡å¯åŠ¨æ–°é—»è¯¦æƒ…ï¼Œè‡ªå·±è·³è‡ªå·±ï¼Œè¿™æ ·ä¸ç®¡è·³è½¬äº†å¤šå°‘æ¬¡ï¼ŒæŒ‰ä¸€æ¬¡è¿”å›ï¼Œå°±å¯ä»¥å›åˆ°æ–°é—»åˆ—è¡¨é¡µé¢ã€‚\n\n### æ¨¡å¼ï¼šsingleTask\nå¦‚æœä¸Šé¢è§£é‡Šçš„å‡ ä¸ªæ¦‚å¿µéƒ½èƒ½æ˜ç™½ï¼Œé‚£è¿™ä¸ªå±æ€§å°±å¾ˆå¥½è¯´äº†ã€‚é¡¾åæ€ä¹‰ï¼Œåœ¨Taskä¸­åªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œ`taskAnffinity`å±æ€§ä¼šç”Ÿæ•ˆï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé‚£å°±æ˜¯åŒ…åã€‚å¯åŠ¨Activityæ—¶ï¼Œé¦–å…ˆä¼šæŒ‰ç…§`taskAnffinity`æŸ¥æ‰¾å¯¹åº”çš„Taskï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±æ–°å»ºä¸€ä¸ªï¼Œç„¶åå°†Activityå®ä¾‹å‹å…¥æ ˆï¼›å¦‚æœæ‰¾åˆ°äº†è¯¥åå­—çš„Taskï¼Œé‚£ä¹ˆä¼šåœ¨è¯¥Taskä¸­æŸ¥æ‰¾Activityçš„å®ä¾‹ï¼Œè‹¥æ‰¾åˆ°ï¼Œå¦‚æœä¸åœ¨Taskæ ˆé¡¶ï¼Œé‚£ä¹ˆå°±å°†ä¸Šé¢çš„Activityå®ä¾‹å…¨éƒ¨å‡ºæ ˆï¼Œä½¿å…¶ä½äºæ ˆé¡¶ï¼›å¦‚æœæ ˆä¸­æ— æ­¤Activityçš„å®ä¾‹ï¼Œåˆ™æ–°å»ºå®ä¾‹å¹¶å‹å…¥æ ˆã€‚\n\n### æ¨¡å¼ï¼šsingleInstance\nè¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå‡¡æ˜¯ä»¥è¿™ä¸ªæ¨¡å¼å¯åŠ¨çš„Activityï¼Œéƒ½ä¼šè‡ªå·±ç‹¬å ä¸€ä¸ªTaskã€‚å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°Taskç„¶åå®ä¾‹å‹å…¥æ ˆï¼Œå¦‚æœå­˜åœ¨åˆ™`onNewIntent`å¤ç”¨å…¶ä¸­çš„Activityå®ä¾‹ã€‚å¦‚æœä¸è®¾ç½®`taskAffinity`ï¼Œé‚£ä¹ˆTaskçš„åå­—å°±æ˜¯åŒ…åï¼Œè¿™æ—¶ï¼Œå°±ä¼šæœ‰ä¸¤ä¸ªåå­—éƒ½æ˜¯åŒ…åçš„Taskï¼Œæ‰€ä»¥Taskçš„åå­—æ˜¯å¯èƒ½ä¼šç›¸åŒçš„ã€‚è¿™é‡Œå¼ºè°ƒä¸€ä¸‹ç‹¬å è¿™ä¸ªè¯ï¼Œå¦‚æœä¸€ä¸ªä»¥`singleTask`å¯åŠ¨çš„Activityï¼Œæ‰¾åˆ°äº†å®ƒç›®æ ‡åå­—çš„Taskï¼Œä½†æ˜¯è¿™ä¸ªTaské‡ŒåŒ…å«`singleInstance`å¯åŠ¨çš„Activityå®ä¾‹ï¼Œé‚£ä¹ˆå®ƒä¼šå°†å®ä¾‹å‹å…¥è¯¥æ ˆå—ï¼Ÿä¸ä¼šçš„ï¼Œå› ä¸ºæ˜¯ç‹¬å ï¼Œæ‰€ä»¥ä¸å…è®¸å…¶ä»–å®ä¾‹ã€‚\n\n### æ€»ç»“\nå…¶ä¸­3ä¸ªéƒ½å¾ˆå¥½ç†è§£ï¼Œ`standard`æ˜¯é»˜è®¤æ¨¡å¼ï¼Œåªè¦å¯åŠ¨å°±ä¼šåˆ›å»ºæ–°å®ä¾‹å¹¶å‹å…¥é»˜è®¤Taskï¼›`singleTop`æ˜¯æ ˆé¡¶å­˜åœ¨å°±å¤ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼›`singleInstance`æ˜¯ç‹¬å ä¸€ä¸ªTaskï¼›`singleTask`æ˜¯å…ˆæ‰¾åˆ°ç›®æ ‡åå­—ã€ä¸”æ²¡æœ‰è¢«ç‹¬å çš„Taskï¼Œæ‰¾ä¸åˆ°åˆ™æ–°å»ºï¼ŒTaskä¸­è‹¥å­˜åœ¨å®ä¾‹åˆ™é€šè¿‡å¼¹å‡ºä¸Šé¢çš„å®ä¾‹ä½¿å…¶å¤„äºæ ˆé¡¶å¹¶`onNewIntent`å¤ç”¨ï¼Œå·²åœ¨æ ˆé¡¶åˆ™ç›´æ¥å¤ç”¨ï¼Œè‹¥Taskæ ˆä¸­ä¸å­˜åœ¨å®ä¾‹ï¼Œåˆ™åˆ›å»ºå¹¶å‹å…¥æ ˆã€‚\n\nå¦‚æœèƒ½è‡ªå·±æŠŠæ¯ä¸ªæ¨¡å¼éªŒè¯ï¼Œé‚£ä¹ˆç†è§£çš„å°±ä¼šæ·±åˆ»äº›ã€‚æˆ‘ä¾¿æ˜¯è·‘äº†ä¸€ä¸ªApplicationï¼Œå†™äº†å‡ ä¸ªç®€å•çš„Activityï¼Œé€šè¿‡ä¸æ–­è°ƒæ•´`AndroidManifest.xml`ä¸­Activityçš„`launchMode`å’Œ`taskAnffinity`ï¼Œç„¶åé…åˆ`adb shell dumpsys activity activities`å‘½ä»¤ï¼Œä»å¤´åˆ°å°¾èµ°äº†ä¸€éã€‚\n\né™„ä¸ŠGitåœ°å€ï¼š[https://github.com/oynix/launch-mode-sample](https://github.com/oynix/launch-mode-sample)\n","tags":["Android"],"categories":["Android"]},{"title":"Kotlinä¹‹letã€applyã€alsoã€with","url":"/2021/08/517bb194f5b9/","content":"\nè‡ªä»å‰ä¸¤å¹´çš„I/Oå¤§ä¼šä¸Šï¼ŒGoogleå®˜æ–¹å®£å¸ƒKotlin-firståï¼Œè¶Šæ¥è¶Šå¤šçš„Androidç”±Kotlinè½¬å‘äº†Kotlinã€‚è€Œä½¿ç”¨Kotlinå¸¸å¸¸è¦ç¢°ä¸Šæ ‡é¢˜ä¸­çš„è¿™å‡ ä¸ªå‡½æ•°ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ç€ç›¸ä¼¼çš„åœ°æ–¹ï¼Œä½†ä¹Ÿæœ‰å„è‡ªçš„ä¸åŒã€‚æ”¾åœ¨ä¸€èµ·ï¼Œæ¨ªå‘å¯¹æ¯”ï¼Œä¾¿äºè®°å¿†ï¼Œåœ¨æ­¤åšä¸ªè®°å½•ã€‚\n\n<!--more-->\n\n### åˆ†ç±»\nè¿™å‡ ä¸ªå‡½æ•°å‡æ¥è‡ªkotlin-stdlibåº“ä¸­çš„Standard.ktæ–‡ä»¶ï¼ŒåŒæ ·åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­è¿˜æœ‰å¦å¤–å‡ ä¸ªå‡½æ•°ï¼Œä¸€å—è¯´ä¸€è¯´ã€‚\n\næŒ‰ç…§ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯é¡¶å±‚å‡½æ•°ï¼Œä¸€ç±»æ˜¯æ‰©å±•å‡½æ•°ã€‚\n\nè¿™å‡ ä¸ªå‡½æ•°çš„å‚æ•°ä¸­ï¼ŒåŸºæœ¬éƒ½æœ‰ä¸€ä¸ªä»£ç å—å‚æ•°blockï¼Œ`T.() -> R`è¡¨ç¤ºblockçš„å‚æ•°æ˜¯T.thisï¼Œ`(T) -> R`è¡¨ç¤ºblockçš„å‚æ•°æ˜¯Tï¼Œä¹Ÿå°±æ˜¯itã€‚\n\n### é¡¶å±‚å‡½æ•°æœ‰ï¼š\n```kotlin\npublic inline fun TODO(): Nothing \n\npublic inline fun TODO(reason: String): Nothing \n\npublic inline fun repeat(times: Int, action: (Int) -> Unit) \n\npublic inline fun <R> run(block: () -> R): R \n\npublic inline fun <T, R> with(receiver: T, block: T.() -> R): R \n```\nå…¶ä¸­ï¼Œ`TODO`æ˜¯ç”¨æ¥æ ‡è®°å°šæœªå®ç°çš„ç©ºæ–¹æ³•ï¼Œ`repeat`ç”¨æ¥é‡å¤æ‰§è¡Œä¼ å…¥çš„actionï¼Œè¿™ä¸¤ä¸ªå°±ä¸å¤šè¯´äº†ï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹`with`å’Œ`run`\n\n|åç§°|blockå‚æ•°|è¿”å›å€¼|\n|-|-|-|\n|run|æ— |block()|\n|with|T.this|block()|\n\n### æ‰©å±•å‡½æ•°æœ‰ï¼š\n```kotlin\npublic inline fun <T, R> T.run(block: T.() -> R): R \n\npublic inline fun <T> T.apply(block: T.() -> Unit): T \n\npublic inline fun <T, R> T.let(block: (T) -> R): R\n\npublic inline fun <T> T.also(block: (T) -> Unit): T\n\npublic inline fun <T> T.takeIf(predicate: (T) -> Boolean): T?\n\npublic inline fun <T> T.takeUnless(predicate: (T) -> Boolean): T?\n```\nå…¶ä¸­ï¼Œ`takeIf`è¡¨ç¤ºä¼ å…¥çš„predicateä¸ºtrueæ—¶ï¼Œè¿”å›Tï¼Œfalseè¿”å›nullï¼Œè€Œ`takeUnless`æ°æ°ç›¸åï¼Œfalseæ—¶è¿”å›Tï¼Œtrueæ—¶è¿”å›nullã€‚\n\nç„¶åï¼Œæˆ‘ä»¬æ¥ä¸€å—çœ‹ä¸€ä¸‹å‰©ä¸‹çš„4ä¸ªå‡½æ•°ã€‚å…¶å®æ ¹æ®blockçš„ä¼ å…¥å‚æ•°ï¼Œå’Œè¿”å›å€¼çš„å¯¹æ¯”ï¼ŒåŒºåˆ«å°±å¾ˆæ¸…æ™°äº†ã€‚\nä¼ å…¥å‚æ•°æœ‰ä¸¤ç§ï¼šT.this å’Œ T\nè¿”å›å€¼æœ‰ä¸¤ç§ï¼šT å’Œ block()\nä¸¤ç§ä¼ å…¥å‚æ•°å’Œä¸¤ç§è¿”å›å€¼ï¼Œä¸¤ä¸¤ç»„åˆï¼Œå°±æœ‰äº†è¿™4ä¸ªå‡½æ•°\n\n|åç§°|blockå‚æ•°|è¿”å›å€¼|\n|-|-|-|\n|run|T.this|block()|\n|apply|T.this|T|\n|let|T|block()|\n|also|T|T|\n\né€šè¿‡è¡¨æ ¼å¯¹æ¯”ï¼Œå°±æ›´åŠ æ¸…æ™°äº†\n\n### åº”ç”¨\nä»ä¼ å…¥å‚æ•°æ¥çœ‹ï¼Œä¼ T.thiså’ŒTæ˜¯ç±»ä¼¼çš„ï¼Œä¼ å…¥T.thisæ—¶ï¼Œè°ƒç”¨Tçš„æ–¹æ³•é€šè¿‡this.è°ƒç”¨ï¼›ä¼ å…¥Tæ—¶ï¼Œè°ƒç”¨Tçš„æ–¹æ³•é€šè¿‡it.è°ƒç”¨ã€‚\nå¦‚æœä½ ä¸å…³å¿ƒæ‰©å±•å‡½æ•°çš„è¿”å›å€¼ï¼Œé‚£ä¹ˆéšä¾¿ä½ ç”¨å“ªä¸ªï¼Œæœ¬è´¨ä¸Šçš„åŒºåˆ«å¹¶ä¸å¤§ã€‚\nå¦‚æœå…³å¿ƒæ‰©å±•å‡½æ•°çš„è¿”å›å€¼ï¼Œå½“éœ€è¦ä¿®æ”¹Tä¸­çš„ä¸€äº›æˆå‘˜çš„æ—¶å€™ï¼Œè€ƒè™‘ä½¿ç”¨`apply`å’Œ`also`ï¼›å½“éœ€è¦é€šè¿‡Tæ¥å¾—åˆ°ä¸€ä¸ªç»“æœçš„æ—¶å€™ï¼Œè€ƒè™‘ä½¿ç”¨`run`å’Œ`let`ã€‚\n\n### æ€»ç»“\nè¿™äº›ä¸ªå‡½æ•°ï¼Œéƒ½æ˜¯Kotlinä¸ºäº†æ–¹ä¾¿å¼€å‘è€…å†™ä»£ç è€Œè®¾è®¡çš„ï¼Œå¦‚æœä½ ä¸€ä¸ªéƒ½ä¸ç”¨ï¼Œè¿™å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚å¦‚æœè¦ç”¨çš„è¯ï¼Œå°±è¦æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»ã€‚\n\n","tags":["Kotlin"],"categories":["Kotlin"]},{"title":"Roomçš„ä½¿ç”¨","url":"/2021/08/6960a7d25570/","content":"Roomæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼ŒåŸºäºSQLiteçš„æŠ½è±¡å±‚ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨SQLiteï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨Roomã€‚\n\nå®˜æ–¹æ–‡æ¡£ï¼š[Android Room](https://developer.android.com/training/data-storage/room)\n\n<!--more-->\n\n### å¯¼å…¥ä¾èµ–\n```groovy\ndependencies {\n    // ..... å…¶ä»–ä¾èµ– .....\n\n    // Room\n    def room_version = \"2.3.0\"\n\n    implementation \"androidx.room:room-runtime:$room_version\"\n    annotationProcessor \"androidx.room:room-compiler:$room_version\"\n\n    // To use Kotlin annotation processing tool (kapt)\n    kapt \"androidx.room:room-compiler:$room_version\"\n}\n```\n\n### åˆ›å»ºè¡¨ã€‚\nRoomé‡Œçš„è¡¨ï¼Œéœ€è¦ç”¨@Entryæ³¨è§£æ ‡æ³¨ï¼Œè¿™é‡Œç”¨ä¸ªç®€å•çš„å­¦ç”Ÿè¡¨\n```kotlin\n// table_nameå°±æ˜¯è¡¨çš„åå­—ï¼Œindeciesæ˜¯å¯é€‰é¡¹ï¼Œç”¨æ¥ç”Ÿæˆè¡¨çš„ç´¢å¼•\n@Entity(tableName = \"student\", indices = [Index(value = [\"num\"], unique = true)])\ndata class Student(\n    @PrimaryKey val id: Int,\n    val num: Int,\n    val name: String,\n    val age: Int\n)\n```\n\n### åˆ›å»ºæ•°æ®è¡¨è®¿é—®ç±»ã€‚\nè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å£°æ˜æ¥å£ï¼Œå¹¶åŠ ä»¥@Daoæ³¨è§£æ ‡æ³¨ï¼Œå…·ä½“å®ç°äº¤ç»™Roomæ¥åšï¼Œ\n```kotlin\n// è¿™é‡Œåªå®šä¹‰CRUDï¼Œå¢åˆ æ”¹æŸ¥ï¼Œä¹Ÿå¯æ ¹æ®éœ€è¦å®šä¹‰å…¶ä»–æ¥å£ï¼Œå¦‚æŸ¥è¯¢åˆ†æ•°å¤§äºæŸä¸ªæ•°å€¼çš„æ‰€æœ‰å­¦ç”Ÿ\n@Dao\ninterface StudentDao {\n    @Insert\n    fun insert(student: Student): Long\n\n    @Delete\n    fun delete(student: Student): Int\n\n    @Update\n    fun update(student: Student): Int\n\n    @Query(\"SELECT * FROM student WHERE num = :num\")\n    fun query(num: Int): Student?\n}\n```\n\n### è¡¨æœ‰äº†ï¼Œè®¿é—®æ–¹å¼ä¹Ÿæœ‰äº†ï¼Œä¸‹é¢åˆ›å»ºæ•°æ®åº“ã€‚\n```kotlin\n// ç»§æ‰¿è‡ªRoomDatabaseï¼Œå…¶ä¸­å·²ç»å®ç°äº†ç»å¤§æ•°åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€è¦é¢å¤–å£°æ˜å‡ ä¸ªæ¥å£ï¼Œç”¨æ¥æä¾›Daoæ•°æ®ç±»\n// æ–¹æ³•çš„å…·ä½“å®ç°äº¤ç»™Roomæ¥åš\n@Database(entities = [Student::class], version = 1)\nabstract class AppDatabase : RoomDatabase() {\n    abstract fun studentDao(): StudentDao\n}\n```\n\n### ä¸‡äº‹ä¿±å¤‡ï¼Œç°åœ¨å¯ä»¥ç”¨äº†ã€‚åœ¨Activityé‡Œè°ƒç”¨ä¸‹è¯•è¯•çœ‹\n```kotlin\noverride fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // é€šè¿‡Roomæä¾›çš„Builderåˆ›å»ºæ•°æ®åº“çš„å®ä¾‹\n        // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ªcontextï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°æ®åº“çš„Classï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°æ®åº“æ–‡ä»¶çš„åå­—\n        val db = Room.databaseBuilder(this, AppDatabase::class.java, \"app.db\").build()\n\n        // è·å¾—ä¸€ä¸ªDao\n        val dao = db.studentDao()\n\n        // æ·»åŠ ä¸€æ¡è®°å½•\n        dao.insert(Student(1, 1, \"john\", 98))\n    }\n```\n\n### æ·»åŠ å®Œæˆï¼Œè¿è¡Œä¸€ä¸‹ã€‚\nç„¶åä½ ä¼šå‘ç°ï¼Œå´©æºƒäº†ã€‚ã€‚ã€‚æ—¥å¿—å¦‚ä¸‹ï¼š\n```shell\njava.lang.RuntimeException: Unable to start activity ComponentInfo{com.oynix.room.sample/com.oynix.room.sample.MainActivity}: java.lang.IllegalStateException: Cannot access database on the main thread since it may potentially lock the UI for a long period of time.\n```\nè¿™å¥è¯çš„æ„æ€æ˜¯è¯´ï¼Œä¸èƒ½åœ¨main threadï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹è®¿é—®æ•°æ®åº“ï¼Œå› ä¸ºè¿™æ ·æœ‰å¯èƒ½ä¼šæŠŠé¡µé¢å¡ä½ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´ã€‚è¿™æ ·çš„æ£€æµ‹æœºåˆ¶ç®—æ˜¯åˆç†çš„ï¼Œæ¯•ç«Ÿè¿™å±äºIOæ“ä½œï¼Œè€ŒIOæ“ä½œéƒ½åº”è¯¥æ”¾åˆ°å•ç‹¬çš„çº¿ç¨‹å»è·‘ã€‚\nä½†æ˜¯ä¹Ÿå¯ä»¥å»æ‰è¿™ç§æ£€æµ‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™é¢å¤–ä¼ å…¥ä¸ªé…ç½®ï¼š\n```kotlin\noverride fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val db = Room.databaseBuilder(this, AppDatabase::class.java, \"app.db\")\n            .allowMainThreadQueries() // å…è®¸åœ¨ä¸»çº¿ç¨‹æ“ä½œ\n            .build()\n        val dao = db.studentDao()\n        dao.insert(Student(1, 1, \"john\", 98))\n    }\n```\nè¿™ä¸ªæ—¶å€™å†è¿è¡Œä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°é¡ºåˆ©æ‰§è¡Œ\n\n### æ•°æ®åº“æ–‡ä»¶\nè¿™ä¸ªæ—¶å€™ï¼Œåœ¨Android Studioçš„Device File Explorerä¸­ï¼Œå¯ä»¥åœ¨data/data/{åŒ…å}/databaseç›®å½•ä¸‹å‘ç°3ä¸ªæ–‡ä»¶ï¼Œapp.dbã€app.db-shmå’Œapp.db-walï¼Œå…¶ä¸­.dbæ˜¯æ•°æ®åº“æ–‡ä»¶ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ä¸´æ—¶æ–‡ä»¶ã€‚\næŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶å¯¼å‡ºåˆ°ç”µè„‘æ¡Œé¢ï¼Œç„¶åç”¨èƒ½æ‰“å¼€dbæ–‡ä»¶çš„è½¯ä»¶å°†app.dbæ‰“å¼€ï¼Œå¦‚SQLite Professionalã€SQLite Studioç­‰ï¼Œä¼šçœ‹åˆ°æˆ‘ä»¬åˆ›å»ºçš„studentè¡¨ï¼Œä»¥åŠè¡¨ä¸­åˆšåˆšæ’å…¥çš„é‚£æ¡æ•°æ®ã€‚\n\n### å¢åŠ ä¸€å¼ è¡¨\nè¿™ä¸ªæ—¶å€™ï¼Œä¸šåŠ¡å‘ç”Ÿè°ƒæ•´ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€å¼ æ•™å¸ˆè¡¨ï¼Œå¦‚ä¸‹\n```kotlin\n@Entity(tableName = \"teacher\", indices = [Index(value = [\"num\"], unique = true)])\ndata class Teacher(\n    @PrimaryKey val id: Int,\n    val num: Int, // æ•™å¸ˆç¼–å·\n    val name: String,\n    val course: String\n)\n\n@Dao\ninterface TeacherDao {\n    @Insert\n    fun insert(teacher: Teacher): Long\n\n    @Delete\n    fun delete(teacher: Teacher): Int\n\n    @Update\n    fun update(teacher: Teacher): Int\n\n    @Query(\"SELECT * FROM teacher WHERE num = :num\")\n    fun query(num: Int): Teacher?\n}\n```\nåŒæ—¶ï¼Œä¹Ÿè¦ä¿®æ”¹æ•°æ®åº“ç±»ï¼Œå¢åŠ æ–°çš„æ•™å¸ˆè¡¨å®ä½“\n```kotlin\n\n@Database(entities = [Student::class, Teacher::class], version = 1)\nabstract class AppDatabase : RoomDatabase() {\n    abstract fun studentDao(): StudentDao\n    abstract fun teacherDao(): TeacherDao\n}\n```\nå¢åŠ ä¸€æ¡æ•™å¸ˆçš„è®°å½•ã€‚å¼ è€å¸ˆï¼Œä»–å¾ˆå‰å®³ï¼Œä¼šæ•™æ•°å­¦\n```kotlin\noverride fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val db = Room.databaseBuilder(this, AppDatabase::class.java, \"app.db\")\n            .allowMainThreadQueries()\n            .build()\n        // Johnï¼Œå­¦å·ï¼š1\n        val dao = db.studentDao()\n        dao.insert(Student(1, 1, \"John\", 14))\n        \n        // å¼ è€å¸ˆï¼Œæ•™æ•°å­¦\n        val teacherDao = db.teacherDao()\n        teacherDao.insert(Teacher(1, 1001, \"Miss Zhang\", \"Math\"))\n    }\n```\nå†ä¸€è¿è¡Œï¼Œå‘ç°åˆæŠ¥é”™äº†ã€‚ã€‚ã€‚\n```shell\njava.lang.RuntimeException: Unable to start activity ComponentInfo{com.oynix.room.sample/com.oynix.room.sample.MainActivity}: java.lang.IllegalStateException: Room cannot verify the data integrity. Looks like you've changed schema but forgot to update the version number. You can simply fix this by increasing the version number.\n```\nè¿™å¥è¯çš„æ„æ€æ˜¯è¯´ï¼Œæ•°æ®åº“çš„schemaï¼Œä¹Ÿå°±æ˜¯ç»“æ„å‘ç”Ÿäº†æ”¹å˜ï¼Œä½†æ˜¯ç‰ˆæœ¬å·æ²¡æœ‰æ›´æ–°ï¼ŒRoomä¸çŸ¥é“æ€ä¹ˆå¤„ç†è¿™äº›schemaçš„ä¿®æ”¹ï¼Œç„¶åå°±æŠ¥äº†ä¸ªé”™ã€‚\n\n### æ•°æ®åº“å‡çº§\nå°±åƒåˆšåˆšé‚£æ ·ï¼Œåœ¨ç‰ˆæœ¬çš„è¿­ä»£æ›´æ–°ä¸­ï¼Œå¸¸å¸¸ä¼šæœ‰ä¿®æ”¹æ•°æ®åº“ç»“æ„çš„æƒ…å†µã€‚åœ¨Roomä¸­ï¼Œæ•°æ®åº“æ˜¯é€šè¿‡versionå·ï¼Œæ¥ç®¡ç†æ•°æ®åº“ç‰ˆæœ¬çš„ï¼Œæ¯åšä¸€æ¬¡ä¿®æ”¹ï¼Œversionéƒ½è¦å¢åŠ ï¼Œä¸€èˆ¬å¢åŠ 1ï¼Œä½ æ¯æ¬¡åŠ 2ä¹Ÿæ²¡äººèƒ½æ‹¿ä½ æ€ä¹ˆæ ·ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºæ•°æ®åº“çš„åŒæ—¶ï¼Œè¿˜è¦å‘Šè¯‰Roomç‰ˆæœ¬æ›´æ–°åšäº†å“ªäº›æ“ä½œï¼Œè¿™äº›éœ€è¦é€šè¿‡addMigrationsæ¥æ·»åŠ ã€‚\nåªä¿®æ”¹schemaï¼Œè€Œä¸å¢åŠ versionï¼Œç¨‹åºä¼šå´©æºƒã€‚\nåªå¢åŠ versionï¼Œè€Œä¸æä¾›Migrationï¼Œç¨‹åºä¼šåˆ é™¤å¹¶é‡å»ºæ•°æ®åº“\n```kotlin\noverride fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val db = Room.databaseBuilder(this, AppDatabase::class.java, \"app.db\")\n            .allowMainThreadQueries()\n            .addMigrations(object : Migration(1, 2){\n                override fun migrate(database: SupportSQLiteDatabase) {\n                    database.execSQL(\"CREATE TABLE IF NOT EXISTS `teacher` (`id` INTEGER NOT NULL, `num` INTEGER NOT NULL, `name` TEXT NOT NULL, `course` TEXT NOT NULL, PRIMARY KEY(`id`))\")\n                    database.execSQL(\"CREATE UNIQUE INDEX IF NOT EXISTS `index_teacher_num` ON `teacher` (`num`)\")\n                }\n            })\n            .build()\n        // è¿™é‡Œè¦æ³¨æ‰ï¼Œå› ä¸ºè¡¨é‡Œå·²ç»æœ‰äº†ä¸€ä¸ªidä¸º1çš„è®°å½•äº†\n        // val dao = db.studentDao()\n        // dao.insert(Student(1, 1, \"John\", 14))\n\n        val teacherDao = db.teacherDao()\n        teacherDao.insert(Teacher(1, 1001, \"Miss Zhang\", \"Math\"))\n    }\n```\nå¦‚ä¸Šï¼Œä»1åˆ°2åï¼Œæˆ‘ä»¬æ–°åŠ äº†ä¸€ä¸ªteacherè¡¨ï¼Œå¹¶åœ¨è¡¨ä¸ŠåŠ äº†ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¹ˆå†™å°±å¯ä»¥äº†ã€‚\nå¦‚æœè¯´ï¼Œä¸æƒ³å†™è¿™ä¹ˆé•¿çš„SQLè¯­å¥æ€ä¹ˆåŠï¼Ÿä¹Ÿå¥½åŠï¼Œå…¨å±€æœAppDatabase_Impl.javaæ–‡ä»¶ï¼Œè¿™é‡Œé¢å°±æ˜¯Roomå·²ç»å†™å¥½çš„ã€‚\nå†æ¬¡è¿è¡Œï¼Œå‘ç°æ²¡æœ‰å†å´©æºƒï¼Œæ‰“å¼€app.dbï¼Œé‡Œé¢å¤šäº†ä¸€å¼ è¡¨ï¼Œè¡¨é‡Œæœ‰ä¸€æ¡åˆšåŠ çš„å¼ è€å¸ˆçš„è®°å½•ã€‚\n\n### addMigrations\nè¿™é‡Œè¦å•ç‹¬è¯´ä¸€è¯´è¿™ä¸ªæ–¹æ³•ï¼Œç¨‹åºè¿è¡Œåï¼Œå¦‚æœæœ¬åœ°æ•°æ®åº“ç‰ˆæœ¬å’Œä»£ç é‡Œçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè¿™ä¸ªæ—¶å€™è¿™ä¸ªæ–¹æ³•æ‰ä¼šæ´¾ä¸Šç”¨åœºï¼Œå¦‚æœä¸€è‡´åˆ™æ— ç”¨ã€‚\nå…ˆå¸–ä¸‹æ–‡æ¡£é‡Œçš„è¯´æ˜ï¼š\n```kotlin\n/**\nAdds a migration to the builder.\nEach Migration has a start and end versions and Room runs these migrations to bring the database to the latest version.\nIf a migration item is missing between current version and the latest version, Room will clear the database and recreate so even if you have no changes between 2 versions, you should still provide a Migration object to the builder.\nA migration can handle more than 1 version (e.g. if you have a faster path to choose when going version 3 to 5 without going to version 4). If Room opens a database at version 3 and latest version is >= 5, Room will use the migration object that can migrate from 3 to 5 instead of 3 to 4 and 4 to 5.\nParams:\nmigrations â€“ The migration object that can modify the database and to the necessary changes.\nReturns:\nThis RoomDatabase.Builder instance.\n*/\n@NonNull\npublic Builder<T> addMigrations(@NonNull Migration... migrations)\n```\nå®ƒæ¥æ”¶å¯å˜å‚æ•°ï¼Œå³å¯åŒæ—¶æ¥æ”¶å¤šä¸ªMigrationã€‚æ¯ä¸ªMigrationéƒ½æœ‰ä¸ªstartVersionï¼Œä»¥åŠä¸€ä¸ªendVersionï¼ŒRoomå°†ä¼šè¿è¡Œè¿™äº›Migrationï¼Œå°†æœ¬åœ°æ•°æ®åº“çš„ç‰ˆæœ¬ä¸€æ­¥æ­¥å‡çº§åˆ°ä»£ç é‡Œçš„æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœç¼ºå¤±å½“å‰ç‰ˆæœ¬åˆ°æœ€æ–°ç‰ˆæœ¬çš„Migrationï¼ŒRoomå°†ä¼šæ¸…ç©ºæ•°æ®åº“å¹¶é‡å»ºã€‚æ‰€ä»¥ï¼Œå³ä¾¿åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´æ²¡æœ‰å˜åŒ–ï¼Œä»ç„¶éœ€è¦æä¾›ä¸€ä¸ªMigrationç»™builderã€‚\nä¸€ä¸ªMigrationå¯ä»¥å¤„ç†å¤šä¸ªç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼Œå½“å‰æ˜¯ç‰ˆæœ¬3ï¼Œæœ€æ–°æ˜¯ç‰ˆæœ¬5ï¼Œä½ æä¾›äº†3åˆ°4çš„Migrationã€4åˆ°5çš„Migrationä»¥åŠ3åˆ°5çš„Migrationï¼Œé‚£ä¹ˆRoomå°±ä¼šé€‰æ‹©æ›´å¿«çš„Migrationï¼Œå³3åˆ°5ï¼Œè€Œä¸æ˜¯ç”±3åˆ°4å†åˆ°5ã€‚\n\n### æ•°æ®åŠ å¯†\nè™½ç„¶Androidé«˜ç‰ˆæœ¬åœ¨æ•°æ®å®‰å…¨è¿™ä¸€å—å·²ç»æå‡äº†å¾ˆå¤šï¼Œæœªrootçš„æ‰‹æœºåŸºæœ¬çœ‹ä¸åˆ°å…¶ä»–åº”ç”¨ç‹¬ç«‹å­˜å‚¨ç©ºé—´é‡Œçš„å†…å®¹ï¼Œä½†ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œå¯ä»¥è¿›ä¸€æ­¥å°†æ•°æ®åº“æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯app.dbï¼Œè¿›è¡ŒåŠ å¯†ã€‚\nå½“å‰æœ‰å¾ˆå¤šç§å®ç°æ€è·¯ï¼Œå¦‚æ¯æ¬¡å†™ä¹‹å‰ï¼Œå°†æ•°æ®åŠ å¯†ï¼Œè¯»ä¹‹åï¼Œå°†æ•°æ®è§£å¯†ï¼Œç­‰ã€‚\nè¿™é‡Œä»‹ç»ä¸ªç¬¬ä¸‰æ–¹åŠ å¯†åº“ï¼Œä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œå½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå°±æ˜¯åŒ…ä½“ä¼šå˜å¤§ï¼Œå› ä¸ºç”¨åˆ°äº†nativeåº“ï¼Œå¢å¤§6Må·¦å³\n- å¼•å…¥ä¾èµ–\n```groovy\n // room cypher maven\nmaven { url \"https://s3.amazonaws.com/repo.commonsware.com\" }\n\n// room cypher\nimplementation \"com.commonsware.cwac:saferoom.x:1.2.1\"\n```\n- å¢åŠ Factoryï¼ŒopenHeloperFactoryï¼Œ\n```kotlin\n override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val db = Room.databaseBuilder(this, AppDatabase::class.java, \"app.db\")\n            .allowMainThreadQueries()\n            .openHelperFactory(SafeHelperFactory(\"your_database_password\".toCharArray()))\n            .addMigrations(object : Migration(1, 2){\n                override fun migrate(database: SupportSQLiteDatabase) {\n                    database.execSQL(\"CREATE TABLE IF NOT EXISTS `teacher` (`id` INTEGER NOT NULL, `num` INTEGER NOT NULL, `name` TEXT NOT NULL, `course` TEXT NOT NULL, PRIMARY KEY(`id`))\")\n                    database.execSQL(\"CREATE UNIQUE INDEX IF NOT EXISTS `index_teacher_num` ON `teacher` (`num`)\")\n                }\n            })\n            .build()\n//        val dao = db.studentDao()\n//        dao.insert(Student(1, 1, \"John\", 14))\n\n//        val teacherDao = db.teacherDao()\n//        teacherDao.insert(Teacher(1, 1001, \"Miss Zhang\", \"Math\"))\n    }\n```\n- åŠ å¯†ä¹‹åï¼Œå†å¯¼å‡ºæ¥çš„app.dbå°±æ— æ³•æ‰“å¼€äº†\n\n### æ€»ç»“\nä»¥ä¸Šï¼ŒRoomçš„ç®€å•ä½¿ç”¨å°±è¿™äº›äº†ï¼Œç›¸æ¯”äºSQLiteï¼Œç®€å•ã€æ–¹ä¾¿äº†ä¸å°‘ï¼Œæœ¬åœ°åŒ–æ•°æ®å¯ä»¥å¤šè€ƒè™‘ä½¿ç”¨ã€‚\nå¦å¤–è¿˜æœ‰äº›æ›´é«˜çº§çš„ç”¨æ³•ï¼Œæ¯”å¦‚å’ŒViewModelçš„ç»“åˆã€å’ŒHiltçš„ç»“åˆã€å¼‚æ­¥æ“ä½œæ•°æ®æµï¼Œç­‰ç­‰ï¼Œè¿™é‡Œå°±å°±ä¸åšè¯´æ˜äº†ã€‚\n\né™„ä¸ŠGithubåœ°å€ï¼š[https://github.com/oynix/RoomSample](https://github.com/oynix/RoomSample)","tags":["Android","Kotlin","Room"],"categories":["Android"]},{"title":"ç®¡ç† MacOS ä¸Šçš„ Python ç¯å¢ƒç‰ˆæœ¬","url":"/2021/06/d54bb8006555/","content":"\n### 00.å‰è¨€\nMacOS ä¸Šçš„ Pythonä¸åŒç‰ˆæœ¬çš„ç¯å¢ƒä¸€ç›´æ˜¯ä¸ªè®©äººå¤´å¤§çš„é—®é¢˜ï¼ŒåŸå› åœ¨äºï¼Œç³»ç»Ÿé¢„å…ˆå®‰è£…äº†2.7ç‰ˆæœ¬ï¼Œä½†è¿™æ˜¯ä¸ªè€ç‰ˆæœ¬äº†ï¼Œè€ç‰ˆæœ¬æ˜¯ä¸èƒ½å¸è½½çš„ï¼Œä¸€äº›ç³»ç»Ÿç¨‹åºéƒ½åœ¨ä¾èµ–å®ƒã€‚\n\nç°åœ¨å¸‚é¢ä¸Šå¼€å‘çš„æ–°ç¨‹åºå¤šæ•°åœ¨ç”¨3.xç‰ˆæœ¬ï¼Œéƒ¨åˆ†è€ä»£ç è¿˜åœ¨ç”¨2.xç‰ˆæœ¬ï¼Œä¸¤ä¸ªå¤§ç‰ˆæœ¬è¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ï¼Œæ— æ³•å®Œå…¨å…¼å®¹ï¼Œè¿™å°±è®©ç®¡ç†å¤šç‰ˆæœ¬å…±å­˜æˆäº†ä¸ªé—®é¢˜ã€‚\n\nå½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›ç®¡ç†å·¥å…·ï¼Œå¦‚pyenvï¼Œä½†å…¶å®pythonçš„venvæ¨¡å—å·²ç»è¶³å¤Ÿäº†ï¼Œä¸‹é¢ä¼šç®€å•è¯´ä¸€è¯´ä½¿ç”¨ã€‚\n<!--more--> \n### 01.å¸è½½å¹²å‡€\næ®ä¸å®Œå…¨ç»Ÿè®¡ï¼Œç›®å‰å‘ç°äº†ä»¥ä¸‹è¿™äº›è¿˜ç®—å›ºå®šçš„å®‰è£…ç›®å½•ï¼š\n\n- è‡ªå·±å®‰è£…çš„Pythonåœ¨è¿™ä¸ªç›®å½•ï¼Œå³é€šè¿‡å®˜ç½‘ä¸‹è½½çš„å®‰è£…ç¨‹åºå®‰è£…\n/Library/Frameworks/Python.framework\n\n- Pythonåº”ç”¨ç›®å½•\n/Applications/Python3.x\n\n- é€šè¿‡brewå‘½ä»¤å®‰è£…åœ¨è¿™ä¸ªç›®å½•ï¼Œbrewæ˜¯ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨å®ƒå®‰è£…çš„éƒ½åœ¨Cellarç›®å½•\n/usr/local/Cellar\n\n- é€šè¿‡CommandLineToolså®‰è£…åœ¨è¿™ä¸ªç›®å½•ï¼Œè¿™æ˜¯ä¸ªXcodeå¸¦çš„å·¥å…·åŒ…\n/Libaray/Developer/CommandLineTools/Library/Frameworks\n\n- ç³»ç»Ÿé¢„å®‰è£…çš„åœ¨è¿™ä¸ªç›®å½•ï¼Œè¿™ä¸ªçœ‹çœ‹å°±è¡Œäº†ï¼Œä¸èƒ½åˆ \n/System/Library/Frameworks/Python.framework\n\n```sh\n$ which python\n$ which python3\n```\n\né€šè¿‡è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œæ‰¾åˆ°pythonå¯æ‰§è¡Œç¨‹åº\n- /usr/local/binï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„ï¼Œå¯ä»¥åˆ é™¤\n- /usr/binï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„ï¼Œæƒ³åˆ ä¹Ÿåˆ ä¸äº†ï¼Œæ²¡æƒé™ã€‚Catalinaä»¥ä¸‹çš„é€šè¿‡å…³é—­SIPå¯ä»¥æ“ä½œ/usr/binç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½†ä»¥ä¸Šçš„ç‰ˆæœ¬å…³æ‰SIPä¹Ÿä¸è¡Œäº†ã€‚æˆ‘åœ¨æ—©å¹´é—´é€šè¿‡è¿™ç§æ–¹å¼åœ¨/usr/binç›®å½•ä¸‹æ”¾äº†ä¸€ä¸ªpython3çš„å¯æ‰§è¡Œç¨‹åºï¼Œç°åœ¨å‡çº§åˆ°äº†Big Surç‰ˆæœ¬ï¼Œå¯¼è‡´è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åˆ ä¸æ‰äº†ï¼Œé™¤äº†é‡è£…ç³»ç»Ÿï¼Œæˆ‘ä¹Ÿæ²¡æƒ³åˆ°ä»€ä¹ˆå¥½åŠæ³•ï¼Œæš‚æ—¶å°±å…ˆè¿™ä¹ˆæ”¾ç€ã€‚\n\nç»ˆç«¯çª—å£æ‰§è¡Œpythonä¼šè¿›å…¥2.7çš„äº¤äº’è§£é‡Šç¯å¢ƒï¼Œæ‰§è¡Œpython3ä¼šæŠ¥é”™command not found\n```sh\n$ python3\n-bash: python3: command not found\n\n$ which python\n/usr/bin/python\n\n$ python\nWARNING: Python 2.7 is not recommended. \nThis version is included in macOS for compatibility with legacy software. \n```\n\nè‡³æ­¤ï¼Œç°åœ¨ç³»ç»Ÿé‡Œåº”è¯¥åªå‰©ä¸‹ç³»ç»Ÿé¢„å®‰è£…çš„python2.7äº†ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åœ¨/usr/binç›®å½•ï¼ŒåŒæ—¶/usr/local/binç›®å½•ä¸å†æœ‰pythonå¯æ‰§è¡Œæ–‡ä»¶ã€‚\n\n### 02.å®‰è£…æœ€æ–°\nç›´æ¥ç”¨brewå®‰è£…å°±å¥½ï¼Œåˆ«å†ç”¨å…¶ä»–çš„å„è·¯ç¥ä»™å·¥å…·äº†ï¼Œå¬æˆ‘ä¸€å¥åŠï¼Œä¸è¦åœ¨æ„åˆ«äººæ€ä¹ˆæ€‚æ¿ï¼Œå°±ç”¨brewå°±å¯ä»¥äº†ï¼Œè¿™ä¸ªæ˜¯macOSä¸Šæœ€æ™®éã€æœ€é€šç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œç”¨æœ€ç®€å•çš„æ–¹å¼åšæœ€å¤§çš„äº‹ï¼Œå¤šäº†ä¸èµ·ã€‚\n\nå¦‚æœä¸æ˜¯æ–°ä¹°çš„æœºå™¨ï¼Œåº”è¯¥éƒ½è£…äº†brewå·¥å…·äº†ï¼Œè¦æ˜¯æ²¡è£…ï¼Œé‚£å°±å…ˆè£…ä¸€ä¸‹ï¼Œä¸€è¡Œä»£ç ï¼Œç­‰ç€å°±å¥½äº†\n```sh\n$ ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n```\n\nå¦‚æœå‘ç°è®¿é—®å›°éš¾ï¼Œå¡ä½ã€ç½‘é€Ÿæ…¢ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒç½‘ç«™ï¼Œä¸‹é¢è¿™ä¸ªæ˜¯ä¸­ç§‘å¤§çš„ï¼Œé€Ÿåº¦è¿˜å¯ä»¥\n```sh\n$ ruby -e \"$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install)\"\n```\n\nç„¶åï¼Œå®‰è£…python3ï¼Œä¸€è¡Œä»£ç ï¼Œè¿˜æ˜¯ç­‰ç€å°±å¥½äº†ï¼Œpython3æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œ3.6ã€3.7ã€3.8ä»¥åŠæœ€æ–°çš„3.9ï¼Œä¸æŒ‡å®šç‰ˆæœ¬ä¼šé»˜è®¤å®‰è£…æœ€æ–°ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼špython@3.xï¼Œå¦‚æœåŒæ—¶å­˜åœ¨å¤šä¸ª3.xï¼Œè¦æ³¨æ„åå­—çš„åŒºåˆ†\n```sh\n$ brew install python3\n```\n\nè¿™é‡Œå” å¨å‡ å¥pipï¼Œpipæ˜¯pythonçš„åŒ…ç®¡ç†å·¥å…·ï¼Œå‰èº«æ˜¯easy_installï¼Œè¿™ä¸¤è€…çš„å…³ç³»æ˜¯ï¼Œpythonæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œpipæ˜¯pythonçš„ä¸€ä¸ªæ¨¡å—ï¼Œå¯æœ‰ä¹Ÿå¯æ— ï¼Œéå¿…éœ€ï¼Œå»ºè®®è¿˜æ˜¯ç”¨pipï¼Œæ¯•ç«Ÿå…¶ä»–æ–¹å¼ç®¡ç†åŒ…å¾ˆéº»çƒ¦ã€‚å¦‚æœæ„å¤–æŠŠpipåˆ é™¤äº†ä¹Ÿå¯ä»¥å•ç‹¬å®‰è£…\n\n```sh\n# å®‰è£…\n$ python3 -m ensurepip\n$ python3 -m pip install pip --upgrade\n# ç›®æ ‡ä½ç½®\n$ which pip\n/usr/local/bin/pip\n# å¸è½½\n$ python3 -m pip uninstall pip\n\n# é»˜è®¤ä¼šå®‰è£…è¿™ä¸ªä¸‰ä¸ªï¼Œå†å®‰è£…ç”¨pip install {package}å³å¯\n$ pip list -v\npip          21.1.2    /usr/local/lib/python3.9/site-packages     pip\nsetuptools   57.0.0    /usr/local/lib/python3.9/site-packages     pip\nwheel        0.36.2    /usr/local/lib/python3.9/site-packages     pip\n```\n\nä¸€ä¸ªpipå…³è”ä¸€ä¸ªpythonå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåƒä¸Šé¢è¿™æ ·ï¼Œå°±æ˜¯å°†pipå…³è”åˆ°äº†python3ï¼Œé€šè¿‡è¿™ä¸ªpipå®‰è£…çš„åŒ…åªæœ‰python3å¯è°ƒç”¨åˆ°ï¼Œç³»ç»Ÿè‡ªå¸¦çš„pythonè°ƒç”¨ä¸åˆ°ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥ä¸ºç³»ç»Ÿpythonå¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿè£…ä¸ªpipå·¥å…·ï¼Œä½†è¦æ³¨æ„åå­—çš„åŒºåˆ†\n\n```sh\n# å®‰è£…\n$ python -m ensurepip\n# pythonæ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä½†æ²¡æœ‰æ“ä½œç³»ç»Ÿç›®å½•çš„æƒé™ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š--user\n$ python -m pip install pip --upgrade --user\n# --useråä¼šå®‰è£…åˆ°å½“å‰ç”¨æˆ·ç›®å½•åº“ä¸‹ï¼Œæˆ‘çš„åœ¨è¿™\n$ cd /Users/{username}/Library/Python/2.7/bin\n# ç„¶ååœ¨pipåŒæ ·çš„ä½ç½®åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥å°±å¯ä»¥äº†\n$ ln -s /Users/{username}/Library/Python/2.7/bin/pip /usr/local/bin/pip2\n# ç›®æ ‡ä½ç½®\n$ which pip2\n/usr/local/bin\n\n# å¸è½½\npython -m pip uninstall\n\n# è¿™ä¸ªå°±æ¯”è¾ƒå¤šäº†ï¼Œè€Œä¸”éƒ½åœ¨ç³»ç»Ÿç›®å½•é‡Œï¼Œå’±ä¹Ÿæ“ä½œä¸äº†\n# å†å®‰è£…è¦åŠ --userï¼Œè¿™æ ·ä¼šå®‰è£…åˆ°å½“å‰ç”¨æˆ·ç›®å½•åº“æ–‡ä»¶ä¸‹: pip2 install {package} --user\n# /Users/{username}/Library/Python/2.7/lib/python/site-packages\n$ pip2 list -v\naltgraph   0.10.2  /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python\nasn1crypto 0.24.0  /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python\nbdist-mpkg 0.5.0   /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python\nbonjour-py 0.3     /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python\n```\n\n### 03.æ—¥å¸¸ä½¿ç”¨\næ—¥å¸¸ä½¿ç”¨æ˜¯é€šè¿‡venvæ¨¡å—ï¼Œä¸€èˆ¬ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨ä¸€ä¸ªvenvç¯å¢ƒï¼Œäº’ç›¸ç‹¬ç«‹ã€äº’ä¸å¹²æ‰°ã€‚\n\nè¿™ç§æ¨¡å¼ï¼Œå°±åƒæ˜¯åœ¨ä¸€åº§å¤§æˆ¿å­ï¼ˆæœºå™¨ï¼‰é‡Œå¯ä»¥å»ºé€ å¾ˆå¤šä¸åŒç±»å‹ï¼ˆç‰ˆæœ¬ï¼‰çš„å°æˆ¿é—´ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰ï¼Œæ¯ä¸ªå°æˆ¿é—´ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰é‡Œçš„æ“ä½œçš„å½±å“èŒƒå›´åªé™äºåœ¨è¿™ä¸ªæˆ¿é—´ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰å†…ï¼Œå„ä¸ªæˆ¿é—´ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰äº’ç›¸ç‹¬ç«‹äº’ä¸å½±å“ï¼Œæˆ¿é—´ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰å¯ä»¥éšæ—¶åˆ›å»ºï¼ˆæ–°å»ºï¼‰å’Œæ‹†é™¤ï¼ˆåˆ é™¤ï¼‰ã€‚\n\n```sh\n# åˆ‡æ¢åˆ°é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹\n$ cd PyProj\n\n# åˆ›å»ºä¸€ä¸ªvenvç¯å¢ƒï¼Œç¬¬äºŒä¸ªå‚æ•°venvDiræ˜¯ç¯å¢ƒç›®å½•çš„åç§°ï¼Œä¸€èˆ¬ä½¿ç”¨venvï¼Œå¯éšæ„ï¼Œåˆæ³•å³å¯\n$ python3 -m venv venvDir\n\n# æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒï¼Œå¯çœ‹åˆ°å¦‚ä¸‹å†…å®¹\n$ ls -l venvDir\ndrwxr-xr-x  12 username  staff  384 Jun  8 23:44 bin\ndrwxr-xr-x   2 username  staff   64 Jun  8 23:44 include\ndrwxr-xr-x   3 username  staff   96 Jun  8 23:44 lib\n-rw-r--r--   1 username  staff   90 Jun  8 23:44 pyvenv.cfg\n\n# æ¿€æ´»å½“å‰venvç¯å¢ƒï¼Œä¹‹åæ¯è¡Œå‰é¢ä¼šå¤šä¸ª(venvDir)ï¼Œè¡¨ç¤ºåœ¨è¯¥ç¯å¢ƒä¸­\n$ source venvDir/bin/activate\n\n# æŸ¥çœ‹pythonå¯æ‰§è¡Œæ–‡ä»¶ä½ç½®ï¼Œæ­¤æ—¶åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œåªæœ‰ä¸€ä¸ªpythonï¼Œæ‰€ä»¥ä¸è¦å†è¾“å…¥python3\n(venvDir)$ which python\nPyPorj/venvDir/bin/python\n\n# æŸ¥çœ‹pip\n(venvDir)$ which pip\nPyPorj/venvDir/bin/pip\n\n# æ­¤æ—¶çš„pythonå¯æ‰§è¡Œç¨‹åºå’Œpipå¯æ‰§è¡Œç¨‹åºåªåœ¨å½“å‰ç¯å¢ƒå†…æœ‰æ•ˆï¼Œè‹¥è¦é€€å‡ºå½“å‰ç¯å¢ƒåˆ™æ‰§è¡Œ\n(venvDir)$ deactivate\n```\n\næ³¨æ„ï¼Œå¦‚æœåœ¨IDEï¼ˆå¦‚PyCharmï¼‰çš„Terminalé‡Œæ‰§è¡Œåˆ›å»ºvenvçš„å‘½ä»¤ï¼Œå¯èƒ½ä¼šæŠ¥æƒé™çš„é”™ï¼Œä½¿ç”¨ç³»ç»Ÿçš„ç»ˆç«¯ä¾¿å¯æ­£å¸¸ä½¿ç”¨ã€‚\n\n### 04.é™„å½•\n- æŸ¥çœ‹pipç‰ˆæœ¬\n```sh\n$ pip -V\n```\n\n- ç”¨pipå®‰è£…packageæ—¶ï¼ŒåŠ ä¸Š--userå‚æ•°ï¼Œä¼šå®‰è£…åˆ°å½“å‰ç”¨æˆ·çš„åº“ç›®å½•ä¸­ï¼Œåªå¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆï¼Œä¸åŠ --userä¼šå®‰è£…åˆ°å…¨å±€ç›®å½•ï¼Œå¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆã€‚å¦‚æœä½ çš„ç”µè„‘åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆäºŒè€…æ²¡æœ‰åŒºåˆ«\n```sh\n$ pip install --user\nï½/Library/Python/3.9/lib/python/site-packages/\n\n$ pip install\n/usr/local/lib/python3.9/site-packages/\n```\n\n- brewå®‰è£…ç›®å½•\n/usr/local/Cellar\nHomebrewé…ç½®ç›®å½•\n/usr/lcoal/etc\nHomebrewå‘½ä»¤ç›®å½•\n/usr/local/bin\n\n- brewå¸¸ç”¨å‘½ä»¤\nbrew install FORMULA\nbrew cleanup\nbew searh FORMULA\nbrew info FORMULA\nbrew upgrade FORMULA\nbrew update","tags":["Python","MacOS"],"categories":["Python"]},{"title":"CircleImageView","url":"/2020/02/c0c9e38ff81e/","content":"\nAndroid ç³»ç»Ÿé»˜è®¤çš„ ImageView æ˜¯çŸ©å½¢ï¼Œä½†æœ‰æ—¶é¡µé¢ä¸Šéœ€è¦å±•ç¤ºåœ†å½¢çš„å›¾ç‰‡ï¼Œå¦‚å¤´åƒã€‚è¿™é‡Œæä¾›ä¸€ç§æœ€ç®€å•çš„å®ç°æ€è·¯ã€‚\n\n<!--more-->\nå°†åœ†å½¢é®ç½©å½“ä½œç›®æ ‡ï¼ˆDSTï¼‰ï¼Œå›¾ç‰‡å½“ä½œæºï¼ˆSRCï¼‰\nå…ˆç”»çš„æ˜¯destinationï¼Œåç”»çš„æ˜¯source\n\n```java\npublic class CircleImageView extends AppCompatImageView {\n\n    private Paint mPaint;\n    private Xfermode mXfermodeDstOut;\n    private Path mPath;\n\n    public CircleImageView(Context context, @Nullable AttributeSet attrs) {\n        super(context, attrs);\n        init();\n    }\n\n    private void init() {\n        mPaint = new Paint(Paint.ANTI_ALIAS_FLAG | Paint.FILTER_BITMAP_FLAG);\n        mPaint.setStyle(Paint.Style.FILL);\n        mXfermodeDstOut = new PorterDuffXfermode(PorterDuff.Mode.DST_OUT);\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        if (mPath == null) {\n            int w = getWidth();\n            int h = getHeight();\n            int cx = w / 2;\n            int cy = h / 2;\n            mPath = new Path();\n            mPath.moveTo(0, 0);\n            mPath.lineTo(w, 0);\n            mPath.lineTo(w, h);\n            mPath.lineTo(0, h);\n            mPath.addCircle(cx, cy, Math.min(cx, cy), Path.Direction.CCW);\n        }\n        canvas.saveLayer(0, 0, getWidth(), getHeight(), mPaint, Canvas.ALL_SAVE_FLAG);\n        super.onDraw(canvas);\n        mPaint.setXfermode(mXfermodeDstOut);\n        canvas.drawPath(mPath, mPaint);\n        mPaint.setXfermode(null);\n        canvas.restore();\n    }\n}\n```\n[æºæ–‡ä»¶](https://github.com/oynix/widgetlib/blob/master/widget/src/main/java/com/oynix/widget/CircleImageView.java)","tags":["Android","Widget","CircleImageView"],"categories":["Android"]},{"title":"Paintå¸¸ç”¨æ–¹æ³•è¯´æ˜","url":"/2020/02/bcaaeeb315b6/","content":"\n# Paintå¸¸ç”¨æ–¹æ³•è¯´æ˜\n\n[åŸæ–‡åœ°å€](https://blog.csdn.net/aigestudio/article/details/41316141)ï¼Œå†™çš„å¾ˆè¯¦ç»†å¹¶ä¸”æœ‰è¶£ã€‚è¿™é‡ŒåªæŒ‘å‡ºä¸€äº›å¸¸ç”¨çš„ï¼Œéš¾äºç†è§£çš„ï¼Œå•ç‹¬æ‹¿å‡ºæ¥åšä¸ªç¬”è®°ã€‚\n\n<!--more-->\n\n## setAntiAlias(boolean aa)\n\nè®¾ç½®æŠ—é”¯é½¿ã€‚ä¹Ÿå¯ä»¥åœ¨ new çš„æ—¶å€™ä¼ å…¥ Paint.ANTI_ALIAS_FLAGã€‚\n\n## setColorFilter(ColorFilter filter)\n\nç±» ColorFilter æ²¡æœ‰å…·ä½“å®ç°ï¼Œå®ƒæœ‰ä¸‰ä¸ªå­ç±»ï¼š\n\n### ColorMatricColorFilter\n\nçŸ©é˜µé¢œè‰²è¿‡æ»¤å™¨ï¼Œåœ¨ Android ä¸­å›¾ç‰‡æ˜¯ä»¥ RGBA åƒç´ ç‚¹çš„å½¢å¼åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œä¿®æ”¹è¿™äº›æ©¡å¡‘ä¿¡æ¯éœ€è¦ä¸€ä¸ª ColorMatrix ç±»çš„æ”¯æŒï¼Œå…¶å®šä¹‰äº†ä¸€ä¸ª 4x5 çš„ float[] ç±»å‹çš„çŸ©é˜µï¼š\n\n```java\nColorMatrix colorMatric = new ColorMatrix(new float[]{\n  1, 0, 0, 0, 0,// R\n  0, 1, 0, 0, 0,// G\n  0, 0, 1, 0, 0,// B\n  0, 0, 0, 1, 0,// A\n});\n```\n\nå…¶ä¸­ï¼Œç¬¬ä¸€è¡Œè¡¨ç¤º R(çº¢è‰²) çš„å‘é‡ï¼Œç¬¬äºŒè¡Œè¡¨ç¤º G(çº¢è‰²) çš„å‘é‡ï¼Œç¬¬ä¸‰è¡Œè¡¨ç¤º B(è“è‰²) çš„å‘é‡ï¼Œæœ€åä¸€è¡Œè¡¨ç¤º A(é€æ˜åº¦) çš„å‘é‡ï¼Œè¿™ä¸€é¡ºåºæ˜¯å›ºå®šçš„ï¼Œä¸å¯æ”¹å˜ã€‚æ¯ä¸€è¡Œçš„å‰ 4 ä¸ªå€¼è¡¨ç¤ºçš„æ˜¯ RGBA çš„å€¼ï¼Œå…¶èŒƒå›´åœ¨ 0.0F è‡³ 2.0F ä¹‹é—´ï¼Œ1 ä¸ºä¿æŒåŸå›¾çš„ RGB çš„å€¼ã€‚æ¯ä¸€è¡Œçš„ç¬¬ 5 ä¸ªè¡¨ç¤ºåç§»å€¼ï¼Œæƒ³è®©é¢œè‰²æ›´å€¾å‘äºæŸä¸ªé¢œè‰²æ—¶ï¼Œå°±å¢åŠ è¯¥é¢œè‰²çš„åç§»å€¼ã€‚\n\n> ä½•ä¸ºåç§»å€¼ï¼Ÿé¡¾åæ€ä¹‰å½“æˆ‘ä»¬æƒ³è®©é¢œè‰²æ›´å€¾å‘äºçº¢è‰²çš„æ—¶å€™å°±å¢å¤§Rå‘é‡ä¸­çš„åç§»å€¼ï¼Œæƒ³è®©é¢œè‰²æ›´å€¾å‘äºè“è‰²çš„æ—¶å€™å°±å¢å¤§Bå‘é‡ä¸­çš„åç§»å€¼ï¼Œè¿™æ˜¯æœ€æœ€æœ´ç´ çš„ç†è§£ï¼Œä½†æ˜¯äº‹å®ä¸Šè‰²å½©åç§»çš„æ¦‚å¿µæ˜¯åŸºäºç™½å¹³è¡¡æ¥ç†è§£çš„ï¼Œä»€ä¹ˆæ˜¯ç™½å¹³è¡¡å‘¢ï¼Ÿè¯´å¾—ç®€å•ç‚¹å°±æ˜¯ç™½è‰²æ˜¯ä»€ä¹ˆé¢œè‰²ï¼å¦‚æœå¤§å®¶æ˜¯ä¸ªå•åçˆ±å¥½è€…æˆ–è€…ä¼šäº›PSå°±ä¼šå¾ˆå®¹æ˜“ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œåœ¨å•åçš„è®¾ç½®å‚æ•°ä¸­æœ‰ä¸ªè‰²å½©åç§»ï¼Œå…¶å®šä¹‰çš„å°±æ˜¯ç™½å¹³è¡¡çš„è‰²å½©åç§»å€¼ï¼Œå°±æ˜¯å½“ä½ å»æ‹ä¸€å¼ ç…§ç‰‡çš„æ—¶å€™ç™½è‰²æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ç™½è‰²æ˜¯ï¼ˆ255, 255, 255, 255ï¼‰ä½†æ˜¯ç°å®ä¸–ç•Œä¸­æˆ‘ä»¬æ˜¯æ— æ³•æ‰¾åˆ°è¿™æ ·çš„çº¯ç™½ç‰©ä½“çš„ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬ç”¨å•åæ‹ç…§ä¹‹å‰å°±ä¼šæ‹¿ä¸€ä¸ªæˆ‘ä»¬è®¤ä¸ºæ˜¯ç™½è‰²çš„ç‰©ä½“è®©ç›¸æœºè®°å½•è¿™ä¸ªç‰©ä½“çš„é¢œè‰²ä½œä¸ºç™½è‰²ï¼Œç„¶åæ‹æ‘„æ—¶æ•´å¼ ç…§ç‰‡çš„é¢œè‰²éƒ½ä¼šä¾æ®è¿™ä¸ªå®šä¹‰çš„ç™½è‰²æ¥åç§»ï¼è€Œè¿™ä¸ªæˆ‘ä»¬å®šä¹‰çš„â€œç™½è‰²â€ï¼ˆæ¯”å¦‚ï¼š255, 253, 251, 247ï¼‰å’Œçº¯ç™½ï¼ˆ255, 255, 255, 255ï¼‰ä¹‹é—´çš„åç§»å€¼ï¼ˆ0, 2, 4, 8ï¼‰æˆ‘ä»¬ç§°ä¹‹ä¸ºç™½å¹³è¡¡çš„è‰²å½©åç§»ã€‚\n\nColorMetrix ç±»é‡Œé¢æä¾›ä¸€äº›å®åœ¨çš„æ–¹æ³•ï¼Œå¦‚ setSaturation(float sat) è®¾ç½®é¥±å’Œåº¦ã€‚\n\n### LighingColorFilter\n\nå…‰ç…§é¢œè‰²è¿‡æ»¤ï¼Œè¯¥ç±»åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼š\n\n```java\nLightingColorFilter(int mul, int add)\n```\n\nå…¶ä¸­ mul çš„å…¨ç§°æ˜¯ colorMultiply æ„ä¸ºè‰²å½©å€å¢ï¼Œadd å…¨ç§°æ˜¯ colorAdd æ„ä¸ºè‰²å½©å¢åŠ ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯ 16 è¿›åˆ¶çš„è‰²å½©å€¼ 0xAARRGGBBã€‚\n\n### PorterDuffColorFilter\n\nåŒ LightingColorFilter ä¸€æ ·ï¼Œåªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼š\n\n```java\nPorterDuffColorFilter(int color, PorterDuff.Mode mode)\n```\n\næ¥å—ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ªæ˜¯ 16 è¿›åˆ¶çš„é¢œè‰²å€¼ï¼Œå¦ä¸€ä¸ªæ˜¯ PorterDuff å†…éƒ¨ç±» Mode ä¸­çš„å¸¸é‡å€¼ï¼Œè¡¨ç¤ºæ··åˆæ¨¡å¼ã€‚Mode ä¸ä»…ä»…åº”ç”¨äºè‰²å½©æ··åˆï¼Œè¿˜åº”ç”¨äºå›¾å½¢æ··åˆï¼Œå¦‚æœåœ¨ PorterDuffColorFilter ä¸­å¼ºè¡Œè®¾ç½®å›¾å½¢æ··åˆçš„æ¨¡å¼ï¼Œå°†ä¸ä¼šçœ‹åˆ°ä»»ä½•å¯¹åº”çš„æ•ˆæœã€‚\n\n## setXfermode(Xfermode xfermode)\n\nXfermodeï¼Œå¯ä»¥ç›´æ¥ç†è§£ä¸ºå›¾åƒæ··åˆæ¨¡å¼ï¼Œå®ƒæ²¡æœ‰å…·ä½“å®ç°ï¼Œä½†æœ‰ 3 ä¸ªå­ç±»ï¼Œè¿™ 3 ä¸ªå­ç±»å®ç°çš„åŠŸèƒ½æ¯” setColorFilter çš„ 3 ä¸ªå­ç±»å¤æ‚\n\n### AvoidXfermode\n\nè¿™ä¸ª API å› ä¸ºä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿæ‰€ä»¥åœ¨ API 16 å·²ç»è¿‡æ—¶äº†ï¼Œå¦‚æœæƒ³åœ¨é«˜äº 16 çš„æœºå™¨ä¸Šä½¿ç”¨ï¼Œå¿…é¡»å…³é—­ç¡¬ä»¶åŠ é€Ÿï¼Œå¯ä»¥åœ¨ [HardwareAccelerate](https://developer.android.com/guide/topics/graphics/hardware-accel.html) æ–‡æ¡£ä¸­æŸ¥çœ‹å¦‚ä½•å…³é—­ç¡¬ä»¶åŠ é€Ÿï¼Œä»¥åŠæŸ¥çœ‹æ›´å¤šä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿçš„ APIã€‚\n\nAvoidXfermode åªæœ‰ä¸€ä¸ªå«å‚çš„æ„é€ æ–¹æ³•ï¼š\n\n```java\nAvoidXfermode(int opColor, int tolerance, AvoidXfermode.Mode mode)\n```\n\nå…·ä½“å®ç°å’Œ ColorFilter ä¸€æ ·éƒ½è¢«å°è£…åœ¨ C/C++ å†…ï¼Œæˆ‘ä»¬åªç®¡è°ƒç”¨å°±å¥½ã€‚ç¬¬ä¸€ä¸ªå‚æ•° opColor è¡¨ç¤ºä¸€ä¸ª 16 è¿›åˆ¶çš„å¯ä»¥å¸¦é€æ˜é€šé“çš„é¢œè‰²å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•° tolerance è¡¨ç¤ºå®¹å·®å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡è¯†ã€Œç²¾ç¡®ã€æˆ–ã€Œæ¨¡ç³Šã€çš„ä¸œè¥¿ï¼Œæœ€åä¸€ä¸ªå‚æ•° AvoidXfermode è¡¨ç¤ºå…·ä½“æ¨¡å¼ï¼Œå¯é€‰å€¼åªæœ‰ä¸¤ä¸ªï¼šAvoidXfermode.Mode.AVOID æˆ– AvoidXfermode.Mode.TARGET\n\n#### AvoidXfermode.Mode.TARGET\n\nåœ¨è¯¥æ¨¡å¼ä¸‹ Android ä¼šåˆ¤æ–­ç”»å¸ƒä¸Šçš„é¢œè‰²æ˜¯å¦æœ‰è·Ÿ opColor ä¸€æ ·çš„é¢œè‰²ï¼Œæ¯”å¦‚ opColor æ˜¯çº¢è‰²ï¼ŒTARGET æ¨¡å¼ä¸‹å°±ä¼šåˆ¤æ–­ç”»å¸ƒä¸Šæ˜¯å¦æœ‰å­˜åœ¨çº¢è‰²çš„åœ°æ–¹ï¼Œå¦‚æœæœ‰åˆ™æŠŠè¯¥åŒºåŸŸã€ŒæŸ“ã€ä¸Šä¸€å±‚ç”»ç¬”å®šä¹‰çš„é¢œè‰²ï¼Œå¦åˆ™ä¸ã€ŒæŸ“ã€è‰²ï¼Œè€Œ tolerance å®¹å·®å€¼åˆ™è¡¨ç¤ºç”»å¸ƒä¸Šçš„åƒç´ å’Œ opColor ä¹‹é—´çš„å·®åˆ«æ˜¯å¤šå°‘çš„æ—¶å€™æ‰å»ã€ŒæŸ“ã€ï¼Œæ¯”å¦‚å½“å‰ç”»å¸ƒæœ‰ä¸€ä¸ªåƒç´ çš„è‰²å€¼æ˜¯(200, 20, 13)ï¼Œè€Œ opColore æ˜¯ (255, 0, 0)ï¼Œå½“ tolerance å®¹å·®å€¼ä¸º 255 æ—¶ï¼Œå³ä¾¿(200, 20, 13)å¹¶ä¸ç­‰äº opColor ä¹Ÿä¼šè¢«æŸ“è‰²ï¼Œå®¹å·®å€¼è¶Šå¤§ã€ŒæŸ“ã€è‰²èŒƒå›´è¶Šå¹¿ã€‚\n\n#### AvoidXfermode.Mode.AVOID\n\nä¸ TARGET æ°æ°ç›¸åï¼ŒTARGET æ˜¯ä¸ opColor ä¸ç”»å¸ƒé¢œè‰²ä¸€æ ·ï¼Œè€Œ AVOID æ˜¯ opColor ä¸ ç”»å¸ƒé¢œè‰²ä¸ä¸€æ ·ï¼Œå…¶ä»–çš„éƒ½ç±»ä¼¼ã€‚\n\n### PixelXorXfermode\n\nä¸ AvoidXfermode ä¸€æ ·ä¹Ÿåœ¨ API 16 è¿‡æ—¶äº†ï¼Œè¯¥ç±»ä¹Ÿæä¾›äº†ä¸€ä¸ªå«å‚çš„æ„é€ æ–¹æ³•\n\n```java\nPixelXorXfermode(int opColor)\n```\n\nè¯¥ç±»çš„è®¡ç®—å®ç°å¾ˆç®€å•ï¼Œä»å®˜æ–¹ç»™å‡ºçš„è®¡ç®—å…¬å¼æ¥çœ‹å°±æ˜¯ï¼šop^src^dstï¼Œåƒç´ è‰²å€¼æŒ‰ä½å¼‚æˆ–è¿ç®—\n\n### PorterDuffXfermode\n\nXfermodeçš„æœ€åä¸€ä¸ªå­ç±»ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰è¿‡æ—¶åˆ‡æ²¿ç”¨è‡³ä»Šçš„å­ç±»ã€‚è¯¥ç±»åŒæ ·åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼š\n\n```\nPorterDuffXfermode(PorterDuff.Mode mode)\n```\n\nå…¶ä¸­çš„ PorterDuff.Mode å’Œä¸Šé¢è®²çš„ ColorFilter ç”¨åˆ°çš„ PorterDuff.Mode æ˜¯ä¸€æ ·çš„ã€‚PorterDuffXfermode å°±æ˜¯å›¾å½¢æ··åˆæ¨¡å¼çš„æ„æ€ï¼Œå…¶æ¦‚å¿µæœ€æ—©æ¥è‡ª SIGGRAPH çš„ Tomas Porter å’Œ Tom Duffï¼Œåå­—å°±æ˜¯è¿™ä¸¤ä¸ªäººçš„åå­—çš„ç»„åˆ\n\n![](https://i.loli.net/2021/07/19/ALKqGnE3UshgClQ.jpg)\n\nè¿™å¼ å›¾ç‰‡ä»ä¸€å®šç¨‹åº¦ä¸Šå½¢è±¡åœ°è¯´æ˜äº†å›¾å½¢æ··åˆçš„ä½œç”¨ï¼Œä¸¤ä¸ªå›¾å½¢ä¸€åœ†ä¸€æ–¹é€šè¿‡ä¸€å®šçš„è®¡ç®—äº§ç”Ÿä¸åŒçš„ç»„åˆæ•ˆæœï¼Œåœ¨ API ä¸­ Android æä¾›äº† 18 ç§ï¼ˆæ¯”ä¸Šå›¾å¤šäº†ä¸¤ç§ ADD å’Œ OVERPLAYï¼‰æ¨¡å¼ï¼š\n\n![](https://i.loli.net/2021/07/19/3kGpPcMVwu7XaxL.jpg)\n\nSa å…¨ç§° Source Alphaï¼ŒSc å…¨ç§° Source Colorï¼ŒDa å…¨ç§° Destination Alphaï¼ŒDc å…¨ç§° Destination Colorã€‚æ¯ä¸ªä¸­æ‹¬å·ç”±ä¸¤ä¸ªå€¼ç»„æˆï¼š[Alpha, Color]ã€‚\n\nSource ä¸ºæºå›¾åƒï¼Œæ„ä¸ºå°†è¦ç»˜åˆ¶çš„å›¾åƒï¼›Destination ä¸ºç›®æ ‡å›¾åƒï¼Œæ„ä¸ºå°†æºå›¾åƒç»˜åˆ¶åˆ°çš„å›¾åƒã€‚ç®€å•ç†è§£ï¼Œå…ˆç»˜åˆ¶çš„æ˜¯ dstï¼Œåç»˜åˆ¶çš„æ˜¯ srcã€‚\n\n#### æ€»ç»“\n\nOVERï¼šè°åœ¨ä¸Šè°åœ¨ä¸‹çš„é—®é¢˜\n\nINï¼šç»˜åˆ¶ç›¸äº¤éƒ¨åˆ†ï¼ŒSRC_INç»˜åˆ¶SRCï¼ŒDST_INç»˜åˆ¶DST\n\nOUTï¼šç»˜åˆ¶ä¸ç›¸äº¤éƒ¨åˆ†ï¼ŒSRC_OUTç»˜åˆ¶SRCï¼ŒDST_OUTç»˜åˆ¶DST\n\nATOPï¼šSRC_ATOPåªç»˜åˆ¶SRCä¸­ç›¸äº¤éƒ¨åˆ†ï¼ŒDST_ATOPåªç»˜åˆ¶DSTä¸­ç›¸äº¤éƒ¨åˆ†\n\n## setDither(boolean dither)\n\nè®¾ç½®ç»˜åˆ¶å›¾åƒæ—¶çš„æŠ—æŠ–åŠ¨ï¼Œä¹Ÿç§°ä¸ºé€’è‰²\n\næ”¾å¤§æ¥çœ‹ï¼Œå…¶åœ¨å¾ˆå¤šç›¸é‚»åƒç´ ä¹‹é—´æ’å…¥äº†ä¸€ä¸ªä¸­é—´å€¼ï¼Œä½¿é¢œè‰²è¿‡æ¸¡å˜å¾—äº›è®¸æŸ”å’Œ\n\n## setMaskFilter(MaskFilter maskFilter)\n\nMaskFilter ç±»ä¸­æ²¡æœ‰ä»»ä½•å®ç°æ–¹æ³•ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±» BlurMaskFilter å’Œ EmbossMaskFilterï¼Œå‰è€…ä¸ºæ¨¡ç³Šé®ç½©æ»¤é•œï¼Œè€Œåè€…ä¸ºæµ®é›•é®ç½©æ»¤é•œï¼Œä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿ\n\n### BlurMaskFilter\n\nåªæœ‰ä¸€ä¸ªå«å‚çš„éƒ½æ—©æ–¹æ³•\n\n```java\nBlurMaskFilter(float radisu, BlurMaskFilter.Blur style)\n```\n\nå…¶ä¸­ radius è¡¨ç¤ºé˜´å½±åŠå¾„ï¼Œå€¼è¶Šå¤§è¶Šæ‰©æ•£ã€‚ç¬¬äºŒä¸ªå‚æ•° style è¡¨ç¤ºæ¨¡ç³Šç±»å‹ï¼Œæœ‰å››ç§é€‰æ‹©ï¼šSOLD æ•ˆæœæ˜¯åœ¨å›¾åƒçš„ Alpha è¾¹ç•Œäº§ç”Ÿä¸€å±‚ä¸ Paint é¢œè‰²ä¸€è‡´çš„é˜´å½±æ•ˆæœè€Œä¸å½±å“å›¾åƒæœ¬èº«ï¼›NORMAL ä¼šå°†æ•´ä¸ªå›¾åƒæ¨¡ç³Šæ‰ï¼›OUTER ä¼šåœ¨ Alpha è¾¹ç•Œå¤–äº§ç”Ÿä¸€å±‚é˜´å½±ä¸”ä¼šå°†åŸæœ¬çš„å›¾åƒå˜å¾—é€æ˜ï¼›INNER åˆ™ä¼šåœ¨å›¾åƒå†…éƒ¨äº§ç”Ÿæ¨¡ç³Šï¼Œå¾ˆå°‘ç”¨\n\nå¦‚ä¸Šæ‰€è¯´ BlurMaskFilter æ˜¯æ ¹æ® Alpha é€šé“çš„è¾¹ç•Œæ¥è®¡ç®—æ¨¡ç³Šçš„ï¼Œå¦‚æœæ˜¯ä¸€å¼ å›¾ç‰‡ï¼ˆæ³¨ï¼šAndroid ä¼šæŠŠå¤åˆ¶åˆ°èµ„æºç›®å½•çš„å›¾ç‰‡è½¬ä¸º RGB565ï¼‰ä½ ä¼šå‘ç°æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œé‚£ä¹ˆå¦‚ä½•ç»™å›¾ç‰‡åŠ ä¸€ä¸ªç±»ä¼¼é˜´å½±çš„æ•ˆæœå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œå¯ä»¥å°è¯•ä» Bitmap ä¸­è·å–å…¶ Alpha é€šé“ï¼Œå¹¶åœ¨ç»˜åˆ¶ Bitmap å‰å…ˆä»¥è¯¥ Alpha é€šé“ç»˜åˆ¶ä¸€ä¸ªæ¨¡ç³Šå°±å¯ä»¥äº†\n\n```java\npublic class BlurMaskFilterView extends View {\n\tprivate Paint shadowPaint;// ç”»ç¬”\n\tprivate Context mContext;// ä¸Šä¸‹æ–‡ç¯å¢ƒå¼•ç”¨\n\tprivate Bitmap srcBitmap, shadowBitmap;// ä½å›¾å’Œé˜´å½±ä½å›¾\n \n\tprivate int x, y;// ä½å›¾ç»˜åˆ¶æ—¶å·¦ä¸Šè§’çš„èµ·ç‚¹åæ ‡\n \n\tpublic BlurMaskFilterView(Context context) {\n\t\tthis(context, null);\n\t}\n \n\tpublic BlurMaskFilterView(Context context, AttributeSet attrs) {\n\t\tsuper(context, attrs);\n\t\tmContext = context;\n\t\t// è®°å¾—è®¾ç½®æ¨¡å¼ä¸ºSOFTWARE\n\t\tsetLayerType(LAYER_TYPE_SOFTWARE, null);\n \n\t\t// åˆå§‹åŒ–ç”»ç¬”\n\t\tinitPaint();\n \n\t\t// åˆå§‹åŒ–èµ„æº\n\t\tinitRes(context);\n\t}\n \n\t/**\n\t * åˆå§‹åŒ–ç”»ç¬”\n\t */\n\tprivate void initPaint() {\n\t\t// å®ä¾‹åŒ–ç”»ç¬”\n\t\tshadowPaint = new Paint(Paint.ANTI_ALIAS_FLAG | Paint.DITHER_FLAG);\n\t\tshadowPaint.setColor(Color.DKGRAY);\n\t\tshadowPaint.setMaskFilter(new BlurMaskFilter(10, BlurMaskFilter.Blur.NORMAL));\n\t}\n \n\t/**\n\t * åˆå§‹åŒ–èµ„æº\n\t */\n\tprivate void initRes(Context context) {\n\t\t// è·å–ä½å›¾\n\t\tsrcBitmap = BitmapFactory.decodeResource(context.getResources(), R.drawable.a);\n \n\t\t// è·å–ä½å›¾çš„Alphaé€šé“å›¾\n\t\tshadowBitmap = srcBitmap.extractAlpha();\n \n\t\t/*\n\t\t * è®¡ç®—ä½å›¾ç»˜åˆ¶æ—¶å·¦ä¸Šè§’çš„åæ ‡ä½¿å…¶ä½äºå±å¹•ä¸­å¿ƒ\n\t\t */\n\t\tx = MeasureUtil.getScreenSize((Activity) mContext)[0] / 2 - srcBitmap.getWidth() / 2;\n\t\ty = MeasureUtil.getScreenSize((Activity) mContext)[1] / 2 - srcBitmap.getHeight() / 2;\n\t}\n \n\t@Override\n\tprotected void onDraw(Canvas canvas) {\n\t\tsuper.onDraw(canvas);\n\t\t// å…ˆç»˜åˆ¶é˜´å½±\n\t\tcanvas.drawBitmap(shadowBitmap, x, y, shadowPaint);\n \n\t\t// å†ç»˜åˆ¶ä½å›¾\n\t\tcanvas.drawBitmap(srcBitmap, x, y, null);\n\t}\n}\n```\n\n## setPathEffect(PathEffect effect)\n\nPathEffect å¾ˆæ˜æ˜¾å°±æ˜¯è·¯å¾„æ•ˆæœçš„æ„æ€ï¼Œå…¶ä¸€å…±æœ‰å…­ä¸ªå­ç±»ï¼Œæ•ˆæœå¦‚ä¸‹\n\n![](https://i.loli.net/2021/07/19/MUrCkB97ZFY8Hya.jpg)\n\nä»ä¸Šåˆ°ä¸‹ï¼šæœªè®¾ç½®PathEffectï¼ŒCornerPathEffectï¼ŒDiscretePathEffectï¼ŒDashPathEffectï¼ŒPathDashPathEffectï¼ŒComposePathEffectï¼ŒSumPathEffect\n\n## setStrokeCap(Paint.Cap cap)\n\nè®¾ç½®ç”»ç¬”ç¬”è§¦é£æ ¼ï¼ŒROUNDï¼ŒSQUARE å’Œ BUTT\n\n##setStrokeJoin(Paint.Join join)\n\nè®¾ç½®ç»“åˆå¤„çš„å½¢æ€\n\n## setShadowLayer(float radius, float dx, float dy, int shadowColor)\n\nä¸ºç»˜åˆ¶çš„å›¾å½¢æ·»åŠ ä¸€ä¸ªé˜´å½±å±‚æ•ˆæœï¼Œä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿ\n\n## setShader(Shader shader)\n\nç€è‰²å™¨ï¼Œæœ‰äº”ä¸ªå­ç±»\n\n### BitmapShader\n\nåªæœ‰ä¸€ä¸ªå«å‚çš„æ„é€ æ–¹æ³•ï¼Œå…¶ä»– 4 ä¸ªå­ç±»éƒ½æœ‰ä¸¤ä¸ª\n\n```java\nBitmapShader(Bitmap bitmap, Shader.TileMode tileX, Shader.TileMode tileY)\n```\n\nShader.TileMode æœ‰ä¸‰ç§ï¼šCLAMP æ‹‰ä¼¸ï¼ŒMIRROR é•œåƒå’Œ REPEAT é‡å¤\n\n### LinearGradient\n\nçº¿æ€§æ¸å˜\n\n```java\nLinearGradient(float x0, float y0, float x1, float y1, int color0, int color1, Shader.TileMode tile)\n```\n\n(x0, y0) æ¸å˜çš„èµ·ç‚¹ï¼Œ(x1, y1) æ¸å˜çš„ç»ˆç‚¹ï¼Œcolor0 èµ·ç‚¹é¢œè‰²ï¼Œcolor1 ç»ˆç‚¹é¢œè‰²\n\n```java\nLinearGradient(float x0, float y0, float x1, float y1, int[] colors, float[] positions, Shader.TileMode tile)\n```\n\ncolors è¡¨ç¤ºæ”¯æŒå¤šä¸ªé¢œè‰²ï¼Œpositons è¡¨ç¤ºå„ä¸ªé¢œè‰²çš„åˆ†ç•Œä½ç½®ï¼Œå¦‚ {Color.RED, Color.GREEN, Color.BLUE}ï¼Œ{0, 0.3F, 0.8F}ï¼Œpositions ä¸ºnull æ—¶å‡åˆ†æ¸å˜åŒºåŸŸ\n\n### SweepGradient\n\næ¢¯åº¦æ¸å˜ï¼Œä¹Ÿç§°æ‰«æå¼æ¸å˜ï¼Œç´¯æ­»é›·è¾¾æ‰«ææ•ˆæœ\n\n```java\nSweepGradient(float cx, float cy, int color0, int color1)\n\nSweepGradient(float cx, float cy, int[] colors, float[] positons)\n```\n\nåŒ LinearGradient\n\n### RadialGradient\n\nå¾„å‘æ¸å˜ï¼Œä»åœ†å¿ƒä¸­å¿ƒå‘å››å‘¨æ¸å˜çš„æ•ˆæœï¼Œæ„é€ æ–¹æ³•å°±å…ˆå†™ä¸€ä¸ªï¼ŒåŒä¸Š\n\n```java\nRadialGradient(float cx, float cy, float radius, int centerColor, int edgeColor, Shader.TileMode tile);\n```\n\n### ComposeShader\n\nç»„åˆ Shader\n\n```java\nComposeShasdr(Shader s0, Shader s1, Xfermode mode);\nComposeShader(Shader s0, Shader s1, PorterDuff.Mode mode)\n```\n\n## Metrix\n\n3 x 3 åæ ‡çŸ©é˜µï¼Œåˆå§‹å€¼:\n\n```java\nnew float[]{\n  1, 0, 0, // x\n  0, 1, 0, // y\n  0, 0, 1, // 1\n}\n```\n\nç¬¬ä¸€åˆ—è¡¨ç¤º x è½´æ–¹å‘ç¼©æ”¾ï¼Œç¬¬äºŒåˆ—è¡¨ç¤º y è½´æ–¹å‘ç¼©æ”¾ï¼Œç¬¬ä¸‰åˆ—è¡¨ç¤ºåç§»\n\n### setTranslate scale\n### preTranslate scale\n### postTranslate scale\nå¸¸åº”ç”¨äºä¸­å¿ƒç¼©æ”¾\n```java\nmatrix.setScale(interpolatedTime, interpolatedTime);\nmatrix.preTranslate(-centerX, -centerY);\nmatrix.postTranslate(centerX, centerY);\n```\n","tags":["Android","Paint"],"categories":["Android"]},{"title":"Flask API å•å…ƒæµ‹è¯• unittestï¼Œmock && patch","url":"/2019/12/97c306187ae6/","content":"\nå•å…ƒæµ‹è¯•ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•æŸä¸ªæ–¹æ³•ï¼Œæˆ–æ˜¯æŸä¸ªä»£ç å¿«ï¼Œå¯¹äºå„ç§è¾“å…¥çš„å¤„ç†ï¼Œè¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä½†ç”±äºå…¶ä»–åº“ã€æˆ–æ¨¡å—çš„ä¾èµ–ï¼Œä»¥è‡³äºå¾ˆéš¾ç‹¬ç«‹æµ‹è¯•æˆ‘ä»¬è‡ªå·±å®ç°çš„é€»è¾‘ä»£ç ã€‚\n\nå¯¹æ­¤ï¼Œå¼•å‡º mockã€‚\n<!--more--> \n## ä¸€ã€Flask\n**Flask**æ˜¯ä¸ªè½»é‡ API æ¡†æ¶ï¼Œä½¿ç”¨èµ·æ¥éå¸¸å®¹æ˜“ä¸Šæ‰‹\n```python\n# å®‰è£…ï¼špip install flask\nfrom flask import Flask\n\napp = Flask(__name__)\n\n@app.route('/')\ndef index():\n    return 'Hello Flask'\n\napp.run(port=5000)\n```\nè¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„ server å°±è·‘èµ·æ¥äº†ï¼Œè®¿é—® **http:localhost:5000** ä¾¿å¯ä»¥çœ‹åˆ°è¿”å›çš„æ•°æ®ï¼š**Hello Flask**\n\nä¸‹é¢ä¸¾ä¾‹è¯´æ˜ï¼Œå¦‚æœå¯¹å•ä¸€çš„æ¥å£å†™æµ‹è¯•ç”¨ä¾‹\n\n## äºŒã€ä¸¾ä¾‹ï¼šç”¨æˆ·ç™»å½•\n1. ç”¨æˆ·ç™»å½•æ˜¯ä¸ªå¸¸è§çš„åŠŸèƒ½æ¥å£ï¼Œæ¥å£é€»è¾‘ä¹‹å¤–çš„éƒ¨åˆ†åŸºæœ¬åŒä¸Šï¼Œè¿™é‡Œçœç•¥ä¸å†™ã€‚ç”¨æˆ·ä½¿ç”¨ **name** å’Œ **password** è¿›è¡Œç™»é™†æ“ä½œï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ® **name** ä»æ•°æ®åº“æŸ¥è¯¢ **password** ï¼Œä¸€è‡´åˆ™è¿”å› **200 OK**ï¼Œä¸ä¸€è‡´è¿”å› **400 Bad Request**ï¼Œå¾ˆç®€å•çš„å®ç°ï¼Œå¦‚ä¸‹ï¼š\n\t```python\n\tfrom flask import request\n\tfrom app.model import UserDB\n\t\n\t@app.route('/login')\n\tdef login():\n\t    name = request.args.get('name')\n\t    if not name:\n\t        return 'name is required', 400\n\t   \n\t    password = request.args.get('password')\n\t    if not password:\n\t        return 'password is required', 400\n\t  \n\t    # ä»æ•°æ®åº“è·å–ç”¨æˆ·æ•°æ®\n\t    user = UserDB.get_user(name)\n\t    if user.get('password') == password:\n\t        return 'OK', 200\n\t    else:\n\t        return 'password is wrong', 400\n\t```\n    å…¶ä¸­ **UserDB** ä¸ºæ•°æ®æ¨¡å—ä¸­ï¼Œä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·æ•°æ®çš„ç±»ã€‚è¿™é‡Œå¯¹äº**ç™»å½•é€»è¾‘**çš„å•å…ƒæµ‹è¯•ï¼ŒåªæŒ‡æµ‹è¯•è¯¥éƒ¨åˆ†æœ€å°çš„ä»£ç å—ï¼Œå¯¹äºä»£ç å—ä¸­å¼•å…¥çš„ä¾èµ–ï¼Œåœ¨æµ‹è¯•æ—¶éƒ½è®¤ä¸ºæ˜¯æ­£å¸¸çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨æµ‹è¯• **login()** çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¤ä¸º **UserDB** æ˜¯æ­£å¸¸çš„ã€å¯ç”¨çš„ï¼Œè‡³äº **UserDB** çš„å¯é æ€§ï¼Œéœ€è¦ **UserDB** æ¨¡å—çš„å•å…ƒæµ‹è¯•æ¥ä¿éšœã€‚\n    å¯¹äºå¾…æµ‹è¯•æ¨¡å—å†…å¼•å…¥çš„ä¾èµ–ï¼Œé‡‡ç”¨ **mock** çš„æ–¹å¼æ¨¡æ‹Ÿã€‚\n2. **Flask** çš„å•å…ƒæµ‹è¯•ï¼Œå…ˆçœ‹ä»£ç \n\t```python\n\timport unittest\n\tfrom unittest.mock import Mock\n\tfrom unittest.mock import patch\n\t# è¯¥appä¸ºåˆ›å»ºçš„Flaskå®ä¾‹\n\tfrom application import app\n\t\n\tfrom app.model import UserDB\n\t\n\tclass LoginTestCase(unittest.TestCase):\n\t  \n\t    def setUp(self):\n\t        # pushä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä¾¿å¯ä»¥ä½¿ç”¨flaskä¸­çš„å…¨å±€å˜é‡ï¼Œå¦‚g\n\t        app.app_context().push()\n\t        app.testing = True\n\t        # æµ‹è¯•ç”¨çš„http client\n\t        self.client = app.test_client()\n\t    \n\t    def test_login_success(self):\n\t        # çœŸå®è¯·æ±‚ä¸­çš„urlï¼Œhostå’Œportå¯çœç•¥\n\t        url = '/login?name=flask&password=flaskpassword'\n\t        # æ¨¡æ‹Ÿçš„æ–¹æ³•åç§°ï¼Œä¹Ÿå¯ç›´æ¥å†™å­—ç¬¦ä¸²ï¼š get_user\n\t        func_name = UserDB.get_user.__name__\n\t        # æ¨¡æ‹Ÿçš„æ–¹æ³•ï¼Œä¸ç®¡è¯·æ±‚å‚æ•°æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¿”å›return_valueçš„å€¼ï¼ˆMockè¿˜æœ‰å…¶ä»–ç”¨æ³•ï¼‰\n\t        mock_func = Mock(return_value={'name': 'flask', 'password': 'flaskpassword'})\n\t        # patchæ„ä¸ºï¼Œå½“UserDBçš„get_useræ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œç”¨mockå‡ºæ¥çš„funcæ¥å¤„ç†\n\t        # è€Œmockçš„funcï¼Œä¸ç®¡è¯·æ±‚å‚æ•°ï¼Œéƒ½ä¼šè¿”å›return_value\n\t        # æ•…è€Œï¼Œåªè¦UserDBçš„get_userè¢«è°ƒç”¨ï¼Œéƒ½ä¼šè¿”å›{'name': 'flask', 'password': 'flaskpassword'}\n\t        # withï¼Œè¡¨ç¤ºè¿™ç§å¤„ç†æ–¹å¼çš„ä½œç”¨èŒƒå›´\n\t        # å½“åœ¨withçš„èŒƒå›´ä¹‹å¤–æ—¶ï¼Œè°ƒç”¨UserDBçš„get_userä¸å—mockå½±å“ï¼Œä¼šæ­£å¸¸è°ƒç”¨\n\t        with patch.object(UserDB, func_name, func):\n\t            # responseä¸ºè¿”å›çš„å“åº”\n\t            response = self.client.get(url)\n\t            # å› ä¸ºä¼ å…¥çš„nameå’Œpasswordï¼Œå’ŒUserDBçš„mock funcè¿”å›çš„nameå’Œpasswordç›¸åŒ\n\t            # æ‰€ä»¥ï¼Œè¯¥è¯·æ±‚ä¼šè¿”å›200\n\t            # assertEqualæ„ä¸ºï¼Œè®¤å®šè¿”å›ç ä¸200ç›¸ç­‰ï¼Œè‹¥ä¸ç­‰åˆ™è¯¥ç”¨ä¾‹ä¸é€šè¿‡\n\t            self.assertEqual(response.status_code, 200)\n\t       \n\t    def test_login_failed(self):\n\t        # æµ‹è¯•ä¼ å…¥é”™è¯¯å¯†ç çš„æƒ…å†µ\n\t        url = '/login?name=flask&password=wrongpassword'\n\t        func_name = UserDB.get_user.__name__\n\t        mock_func = Mock(return_value={'name': 'flask', 'password': 'flaskpassword'})\n\t        with patch.object(UserDB, func_name, func):\n\t            response = self.client.get(url)\n\t            # å› ä¸ºä¼ å…¥å¯†ç é”™è¯¯ï¼Œæ‰€ä»¥åœ¨æ­¤æˆ‘ä»¬è®¤å®šè¿”å›ç æ˜¯400\n\t            self.assertEqual(response.status_code, 400)\n\t```\n\næ­¤å¤–ï¼Œè¿˜å¯ä»¥å¯¹æµ‹è¯•ç¼ºå°‘å‚æ•°ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚è¿™æ ·ï¼Œä¾¿å¯å¯¹æ¥å£çš„å„ç§æƒ…å†µè¿›è¡Œæµ‹è¯•äº†ã€‚\n","tags":["Flask","Python"],"categories":["Flask"]},{"title":"React - Webpack é¡¹ç›®è„šæ‰‹æ¶æ­å»º","url":"/2019/11/05d3ed0e9549/","content":"\n> æŠŠæ‰‹è¿˜æ˜¯ä¼¸å‘äº†å‰ç«¯ï¼ŒæŠ½ç©ºæŠ˜è…¾äº†å‡ å¤©ï¼Œç®—æ˜¯ç†æ¸…äº†èµ·æ­¥é—¨æ§›ã€‚\n<!--more--> \n##### ä¸€ã€é¦–å…ˆç¡®ä¿å®‰è£…äº† npmï¼Œå¦‚æœæ²¡è£…....é‚£å°±æƒ³åŠæ³•è£…ä¸Š\n```sh\n$ npm\nUsage: npm <command>\n\nwhere <command> is one of:\n    access, adduser, bin, bugs, c, cache, completion, config,\n    ddp, dedupe, deprecate, dist-tag, docs, doctor, edit,\n    explore, get, help, help-search, i, init, install,\n    install-test, it, link, list, ln, login, logout, ls,\n    outdated, owner, pack, ping, prefix, profile, prune,\n    publish, rb, rebuild, repo, restart, root, run, run-script,\n    s, se, search, set, shrinkwrap, star, stars, start, stop, t,\n    team, test, token, tst, un, uninstall, unpublish, unstar,\n    up, update, v, version, view, whoami\n\nnpm <command> -h     quick help on <command>\nnpm -l           display full usage info\nnpm help <term>  search for help on <term>\nnpm help npm     involved overview\n\nSpecify configs in the ini-formatted file:\n    /Users/xiaoyu/.npmrc\nor on the command line via: npm <command> --key value\nConfig info can be viewed via: npm help config\n\nnpm@5.6.0 /usr/local/lib/node_modules/npm\n```\n##### äºŒã€å®‰è£… create-react-appã€‚å¦‚æœç”¨ WebStormï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚\n> IDE å¯ä»¥é€‰æ‹©åˆ›å»º React Appï¼Œçœå»äº†æ‰‹åŠ¨æ‰§è¡Œï¼Œæ‰€ä»¥åˆ›å»ºåçš„ç›®å½•å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚\n```sh\n// -g : global\n$ npm install create-react-app -g\n/usr/local/bin/create-react-app -> /usr/local/lib/node_modules/create-react-app/index.js\n+ create-react-app@3.2.0\nadded 91 packages in 24.685s\n\n$ create-react-app\nPlease specify the project directory:\n  create-react-app <project-directory>\n\nFor example:\n  create-react-app my-react-app\n\nRun create-react-app --help to see all options.\n```\nå¦‚ä»‹ç»æ‰€è¨€ï¼Œåˆ›å»ºä¸€ä¸ªappï¼Œåå­—ä»»æ„ï¼Œåˆæ³•å³å¯\n```sh\n$ create-react-app my-react-app\n```\né¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š\n```sh\n$ ls my-react-app\nREADME.md\t\t    package-lock.json\tpublic\nnode_modules\t\tpackage.json\t\tsrc\n```\n- README.md : ä½ æ‡‚çš„\n- node_moudles : ä¾èµ–éƒ½åœ¨æ‰¾ä¸ªç›®å½•ä¸‹\n- package.json : npmçš„é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…è¯´æ˜¯é¡¹ç›®çš„é…ç½®æ–‡ä»¶\n- package-lock.json : é”å®šç‰ˆæœ¬å·\n- public : å­˜æ”¾é™æ€èµ„æº\n- src :  ä»£ç ï¼èµ„æº\n\n#### ä¸‰ã€å®‰è£… webpack å…¨å®¶æ¡¶\n> npm install å‚æ•°è¯´æ˜ï¼špackage.json æœ‰å‡ ä¸ªä¾èµ–èŠ‚ç‚¹ï¼Œ`dependencies` ã€ `devDependencies` å’Œ `optionalDependencies`ï¼Œå‰è€…ä¼šéšç€é¡¹ç›®å‘å¸ƒå‡ºå»ï¼›åè€…é¡¾åæ€ä¹‰ï¼Œåªåœ¨å¼€å‘æ—¶ä½¿ç”¨ï¼›ååè€…ä¸ºå¯é€‰é˜¶æ®µ\n>  - - - - - - - \n> -Sï¼Œ --save ï¼šä¾èµ–æ·»åŠ åˆ° `dependencies` èŠ‚ç‚¹ï¼Œ\n> -Dï¼Œ--save-dev ï¼šä¾èµ–æ·»åŠ åˆ° `devDependencies` èŠ‚ç‚¹\n> -Oï¼Œ--save-optional ï¼šä¾èµ–æ·»åŠ åˆ°  `optionalDependencies` èŠ‚ç‚¹\n\nä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ\n```sh\n// ä¹Ÿå¯ä»¥æ”¾åœ¨ä¸€è¡Œæ‰§è¡Œ\n$ npm install webpack -D\n$ npm install webpack-cli -D\n$ npm install webpack-dev-server -D\n```\n**æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸ªå‘ï¼šè¿™ä¸‰ä¸ªä¾èµ–çš„ç‰ˆæœ¬å·ä¸€å®šè¦ç›¸äº’åŒ¹é…ï¼Œå¦‚æœä½ è¦æŒ‡å®šç‰ˆæœ¬ï¼Œä¸€å®šè¦ç¡®è®¤æŒ‡å®šçš„ç‰ˆæœ¬å·æ˜¯è¡Œä¸é€šçš„ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚éƒ½ç”¨æœ€æ–°ç‰ˆï¼Œç›®å‰ä¸€åˆ‡æ­£å¸¸ã€‚**\n\n#### å››ã€é…ç½® webpack server\né‰´äº webpack å¯ç”¨äºæœ¬åœ° serverï¼Œä¹Ÿå¯ç”¨äºæ‰“åŒ…ï¼Œå„è‡ªä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸ªæ–‡ä»¶å¤¹ `wepack`ï¼Œç”¨äºå­˜æ”¾ webpack é…ç½®æ–‡ä»¶ã€‚\n1. webpack/webpack.config.jsï¼Œç”¨äºå¼€å‘ server\n```js\nconst path = require('path');\nconst webpack = require('webpack');\nconst __repo = path.dirname(__dirname);\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n    entry: { // ç¨‹åºå”¯ä¸€å…¥å£\n        'index': path.resolve(__repo, 'src/index.jsx'),\n    },\n    mode: 'development',\n    output: { // æ‰“åŒ…æ–‡ä»¶è¾“å‡ºä½ç½®\n        path: path.resolve(__repo, \"build\"),\n        filename: \"bundle.js\",\n        publicPath: \"/\"\n    },\n    devServer: {\n        contentBase: [path.join(__repo, 'public'),], // æœ¬åœ°æœåŠ¡å™¨ç´¢ä»·åœ¨çš„é¡µé¢æ‰€åœ¨ç›®å½•\n        compress: false,\n        port: 7788, // server ä½¿ç”¨ç«¯å£\n        disableHostCheck: true,\n        inline: true, // å®æ—¶åˆ·æ–°\n        historyApiFallback: true, // ä¸è·³è½¬\n        hot: true\n    },\n    module: {\n        rules: [\n            {\n                test: /(\\.jsx|\\.js)$/, // åŒ¹é…æ‰€æŠ¤ç†æ–‡ä»¶çš„æ‰©å±•åæ­£åˆ™è¡¨è¾¾å¼\n                exclude: /(node_modules|bower_components)/, // æ‰‹åŠ¨æ·»åŠ ï¼å±è”½çš„æ–‡ä»¶\n                use: {\n                    loader: 'babel-loader', // loaderåç§°\n                }\n            },\n            {\n                test: /\\.(css|styl)$/,\n                use: [\n                    {\n                        loader: 'style-loader'\n                    },\n                    {\n                        loader: 'css-loader'\n                    }\n                 ]\n            },\n            {\n                test: /\\.html$/,\n                use: [\n                    {loader: 'html-loader'}\n                ]\n            },\n            {\n                test: /\\.(gif|jpg|png|svg|ttf|eot|woff|woff2)$/,\n                use : {\n                    loader: 'file-loader?name=fonts/[name].[ext]'\n                }\n            },\n        ]\n    },\n    plugins: [\n        new HtmlWebpackPlugin({\n            filename: 'index.html',\n            template: 'public/index.html'\n        })\n    ]\n};\n```\nå…¶ä¸­çš„ `module`ï¼Œå°±æ˜¯ webpack çš„ loaderï¼Œéƒ½æ˜¯ç”¨æ¥æ‰“åŒ…ç”¨çš„ï¼š\n- **babel-loader**ï¼šæ‰“åŒ…jsxã€jsæ–‡ä»¶ï¼Œè½¬åŒ–æˆæµè§ˆå™¨è®¤è¯†çš„æ ¼å¼ï¼Œå› è¯¥loaderé…ç½®é€‰é¡¹è¾ƒå¤šï¼Œä¸€èˆ¬å•æŠ½å–å‡ºç‹¬ç«‹çš„æ–‡ä»¶`.bebelrc`ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œwebpackå¯ä»¥è‡ªåŠ¨è¯†åˆ«åˆ°\n- **css-loader**ï¼Œ**style-loader**ï¼šæ‰“åŒ…cssã€styleæ–‡ä»¶\n- **html-loader**ï¼šæ‰“åŒ…htmlæ–‡ä»¶\n- **file-loader**ï¼šæ‰“åŒ…å…¶ä»–æ ¼å¼æ–‡ä»¶ï¼Œå¦‚é…ç½®ä¸­æ‰€å†™\n\n**.babelrc å†…å®¹å¦‚ä¸‹ï¼š**\n```json\n{\n  \"presets\": [\"@babel/preset-react\", \"@babel/preset-env\"], // æ”¯æŒçš„ç¼–ç \n  \"plugins\": [\n    \"@babel/plugin-transform-runtime\"\n  ]\n}\n```\nå…¶ä¸­ï¼Œæ‰€æœ‰çš„loaderã€pluginï¼Œéƒ½éœ€è¦æ‰‹åŠ¨å®‰è£…\n```shell\n$ npm install -D babel-core babel-loader css-loader style-loader html-loader file-loader\n\n$ npm install -D @babel/preset-env @babel/preset-react @babel/plugin-transform-runtime html-webpack-plugin\n```\n2. é…ç½® package.jsonï¼Œä½¿ç”¨webpack/webpack.config.jsã€‚ä¿®æ”¹ package.json ä¸­çš„`scripts` èŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š\n```json\n\"dev\": \"webpack-dev-server --config webpack/webpack.config.js\"\n```\næ­¤æ—¶ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå³å¯ã€‚\n\n```sh\n$ npm run dev\n```\n\n#### äº”ã€é…ç½® webpack æ‰“åŒ…é…ç½®\nå’Œ server ç±»ä¼¼ï¼Œè¿™é‡Œç›´æ¥è´´ä¸Šé…ç½®æ–‡ä»¶\n1. **webpack/webpack.config.build.js**\n\n```js\nconst path = require('path');\nconst webpack = require('webpack');\nconst __repo = path.dirname(__dirname);\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\n\nmodule.exports = {\n    mode: \"production\",\n    entry: path.resolve(__repo, 'src/index.jsx'),\n    devtool: \"#source-map\",\n    output: {\n        path: path.resolve(__repo, \"dist\"),\n        filename: \"app/[name].bundle.js\",\n        publicPath: \"/\"\n    },\n    module: {\n        rules: [\n            {\n                test: /(\\.jsx|\\.js)$/, // åŒ¹é…æ‰€æŠ¤ç†æ–‡ä»¶çš„æ‰©å±•åæ­£åˆ™è¡¨è¾¾å¼\n                exclude: /(node_modules|bower_components)/, // æ‰‹åŠ¨æ·»åŠ ï¼å±è”½çš„æ–‡ä»¶\n                use: {\n                    loader: 'babel-loader', // loaderåç§°\n                }\n            },\n            {\n                test: /\\.(css|styl)$/,\n                use: [\n                    {\n                        loader: 'style-loader'\n                    },\n                    {\n                        loader: 'css-loader'\n                    }\n                ]\n            },\n            {\n                test: /\\.html$/,\n                use: [\n                    {loader: 'html-loader'}\n                ]\n            },\n            {\n                test: /\\.(gif|jpg|png|svg|ttf|eot|woff|woff2)$/,\n                use : {\n                    loader: 'file-loader?name=fonts/[name].[ext]'\n                }\n            },\n        ]\n    },\n\n    plugins: [\n        new HtmlWebpackPlugin({\n            filename: 'index.html',\n            template: 'public/index.html'\n        })\n    ]\n};\n```\n2. ä¿®æ”¹`package.json`ä¸­çš„scriptsèŠ‚ç‚¹ï¼Œå¦‚ä¸‹\n\n```json\n\"build\": \"webpack --config webpack/webpack.config.build.js\"\n```\næ‰§è¡Œæ‰“åŒ…å‘½ä»¤åï¼Œæ‰€æœ‰æ–‡ä»¶ä¼šè¾“å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`dist`ä¸­ã€‚\n```sh\n$ npm run build\n```\næ‰“åŒ…åçš„æ–‡ä»¶ï¼Œé…åˆ`nginx`å°±å¯ä»¥è®¿é—®è¯·æ±‚äº†ã€‚\n","tags":["React","Webpack"],"categories":["React"]},{"title":"RHEL(Red Hat Enterprise Linux) å®‰è£… zipã€unzip","url":"/2019/11/4ae565dbddd3/","content":"\n> å¤šæ•°çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ä¸­éƒ½æ˜¯åŒ…å«è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œä½†æ€»æœ‰æ„å¤–ã€‚\n<!--more--> \n- ä¸€èˆ¬æ–¹æ³•\n```sh\n$ sudo yum install zip unzip\n```\n- å¦‚æœä¸€èˆ¬æ–¹æ³•æŠ¥é”™ï¼Œè¿™ä¸ªæ˜¯å®‰è£…unzip\n```sh\n$ sudo rpm -ivh https://rpmfind.net/linux/mageia/distrib/cauldron/x86_64/media/core/release/unzip-6.1c-6.mga8.x86_64.rpm\n```\n\n##### å…¶ä»–ç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œé“¾æ¥ä»è¿™é‡Œæ‰¾ -> [ç‚¹ä¸€ä¸‹å‘—](https://rpmfind.net/linux/rpm2html/search.php?query=unzip)\n","tags":["Linux"],"categories":["Linux"]},{"title":"yum å®‰è£…æœ€æ–°ç‰ˆæœ¬ mysql","url":"/2019/11/fda8ed989b0e/","content":"---\n\n#### ä¸€. å…ˆåˆ°å®˜ç½‘æŸ¥è¯¢æœ€æ–°çš„ç‰ˆæœ¬ï¼Œ[å®˜ç½‘åœ°å€](https://dev.mysql.com/downloads/repo/yum/)\næ³¨æ„é€‰æ‹©è‡ªå·±Linuxå¯¹åº”çš„ç‰ˆæœ¬ï¼ŒæŸ¥è¯¢æ–¹å¼ï¼š\n<!--more--> \n```shell\n$ cat /etc/*-release\nNAME=\"Red Hat Enterprise Linux Server\"\nVERSION=\"7.7 (Maipo)\"\n......\n\n$ uname -m\nx86_64\n```\næ ¹æ®ä»¥ä¸Šä¿¡æ¯ï¼Œé€‰æ‹©æ‰€éœ€ç‰ˆæœ¬çš„ rpm åç§°ï¼Œå¦‚å›¾\n![](https://i.loli.net/2021/07/07/JsqNMBWZcmKpEXu.png)\n#### äºŒ. å®‰è£…ã€å¯åŠ¨\n1. ä¸‹è½½ rpm æ–‡ä»¶ã€‚å¯ä»¥åœ¨ç½‘é¡µä¸Šç‚¹ Downloadï¼Œç„¶ååœ¨ä¼ é€åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œå¦‚ä¸‹ï¼Œæ›¿æ¢é“¾æ¥åé¢éƒ¨åˆ†å³å¯ï¼š\n\t```sh\n\t$ wget http://repo.mysql.com/mysql80-community-release-el7-3.noarch.rpm\n\t```\n2. å¯¼å…¥ yum repoã€‚\n\t```sh\n\t$ sudo rpm -ivh mysql80-community-release-el7-3.noarch.rpm\n\t```\n3. å®‰è£…\n\t```sh\n\t$ sudo yum install mysql-server\n\t```\n4. å¯åŠ¨\n\t```sh\n\t$ sudo systemctl start mysqld.service\n\t```\n\n#### ä¸‰. è¿æ¥ã€å¯†ç \n1. è¿æ¥\n\t```sh\n\t$ mysql -u root -p\n\t```\n2. å¦‚æœéœ€è¦å¯†ç ï¼Œå» `/var/log/mysqld.log`é‡Œé¢æ‰¾ï¼Œæ ¼å¼ç±»ä¼¼å¦‚ä¸‹ï¼Œ`5Vgr6>Go.Azi`å³æ˜¯\n\t```sh\n\t2019-11-25T08:46:57.138469Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: 5Vgr6>Go.Azi\n\t```\n3. ç™»é™†æˆåŠŸä¹‹åï¼Œå¦‚æœæç¤ºç”¨`ALTER USER`ä¿®æ”¹å¯†ç ï¼Œå¦‚ä¸‹\n\t```sh\n\tmysql> alter user 'root'@'localhost' identified by 'new_password';\n\t```\n4. å¦‚æœæç¤ºå¯†ç ä¸åˆæ ¼ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å½“å‰å¯†ç è¦æ±‚ï¼Œå¦‚ä¸‹ï¼Œlengthè¡¨ç¤ºå¯†ç æœ€å°é•¿åº¦ï¼Œmixed_case_countè¡¨ç¤ºå¤§å°å†™å­—æ¯æ··åˆæ•°é‡ï¼Œnumber_countè¡¨ç¤ºæ•°å­—æ•°é‡ï¼Œspecial_char_countè¡¨ç¤ºç‰¹æ®Šå­—ç¬¦æ•°é‡\n\t```sh\n\tmysql> show variables like 'validate_password%';\n\t+--------------------------------------+--------+\n\t| Variable_name                        | Value  |\n\t+--------------------------------------+--------+\n\t| validate_password.check_user_name    | ON     |\n\t| validate_password.dictionary_file    |        |\n\t| validate_password.length             | 6      |\n\t| validate_password.mixed_case_count   | 1      |\n\t| validate_password.number_count       | 1      |\n\t| validate_password.policy             | MEDIUM |\n\t| validate_password.special_char_count | 0      |\n\t+--------------------------------------+--------+\n\t7 rows in set (0.00 sec)\n\t```\n5. å¦‚æœæƒ³è®¾ç½®ä¸ªç®€å•å¥½è®°çš„å¯†ç ï¼Œä¿®æ”¹ä¸€ä¸‹å¯†ç æ£€æŸ¥ï¼Œexité€€å‡ºmysqlï¼Œå†è¿æ¥ç™»é™†åç”Ÿæ•ˆ\n\t```sh\n\tmysql> set global validate_password.mixed_case_count=0;\n\tmysql> set global validate_password.special_char_count=0;\n\t```","tags":["Linux","mysql","yum"],"categories":["Linux"]},{"title":"nginxè·¯ç”±åŒ¹é…","url":"/2019/11/6e1530768100/","content":"\nå‡ ç§åŒ¹é…æ¨¡å¼ï¼Œä»Šå¤©æ¶‰åŠåˆ°äº†ï¼Œåœ¨æ­¤è®°å½•ã€‚\n<!--more--> \n1. =\nç²¾ç¡®åŒ¹é…\n2. ^~\nç²¾ç¡®å‰ç¼€åŒ¹é…\n3. ~\næ­£åˆ™åŒ¹é…ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰\n4. ~*\næ­£åˆ™åŒ¹é…ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰\n5. /uri\næ™®é€šå‰ç¼€åŒ¹é…\n6. /\né€šç”¨åŒ¹é…\n","tags":["nginx"],"categories":["nginx"]},{"title":"nginx è½¬å‘é”™è¯¯ 13 permission denied","url":"/2019/11/5e5a9e36111c/","content":"---\n\nä»Šå¤©åœ¨åš nginx è½¬å‘çš„æ—¶å€™ï¼Œæ€»æ˜¯æƒé™çš„é”™è¯¯ï¼š\n<!--more-->\n```shell\n2019/11/23 14:22:28 [crit] 19986#19986: *1 connect() to 127.0.0.1:5050 failed (13: Permission denied) while connecting\n```\n\nä»ç½‘ä¸Šç¿»äº†ç¿»ï¼Œå¤§å¤šæ•°æ–‡ç« éƒ½åœ¨è¯´ä¿®æ”¹ nginx ç”¨æˆ·ï¼Œè€Œä¸”è¿™äº›æ–‡ç« çš„å†…å®¹è¿˜éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™è®©ç€æ€¥è§£å†³é—®é¢˜çš„æˆ‘å¾ˆæ¼ç«....ä¸çŸ¥é“æ˜¯ä¸€ä¸ªäººå†™å®Œåœ¨å„ä¸ªåœ°æ–¹å‘äº†ä¸€éï¼Œè¿˜æ˜¯åˆ«çš„ä»€ä¹ˆï¼Œæˆ‘æ²¡æ— èŠåˆ°æŸ¥è¿™äº›... -_-#\n\nä¿®æ”¹ nginx é…ç½®æ–‡ä»¶ï¼Œ`/etc/nginx/nginx.conf`ï¼Œæ”¹æˆ root\n```shell\nuser root\n```\n\nç„¶åç”¨ root æƒé™ restart nginx æœåŠ¡\n```shell\n$ sudo systemctl restart nginx\n```\n\nä¸€èˆ¬åˆ°è¿™å°±ç»“æŸäº†ï¼Œä½†æ˜¯å´è¿˜æ²¡è§£å†³æˆ‘çš„é—®é¢˜ï¼Œæƒé™é—®é¢˜ä¾ç„¶åœ¨ã€‚åˆåœ¨ç½‘ä¸Šä¸€ç•ªæ‰¾ï¼ŒåŸæ¥æ˜¯ linux ç»™æ‹¦æˆªäº†ï¼Œæš‚æ—¶å…³æ‰å°±å¯ä»¥äº† [é“¾æ¥](https://www.cnblogs.com/songxingzhu/p/10063043.html)\n```sh\n$ setenforce 0                  ##è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼\n```\n","tags":["nginx"],"categories":["nginx"]},{"title":"ELK å•æœºéƒ¨ç½²ï¼Œå¤š beat èŠ‚ç‚¹","url":"/2019/11/c712d783ad18/","content":"\n[å‚è€ƒæ–‡ç« ](https://www.cnblogs.com/sparkdev/p/10554076.html)\n\né€‚ç”¨åœºæ™¯ï¼šå¤šä¸ªé¡¹ç›®æˆ–æœåŠ¡ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œå„ä¸ªæœåŠ¡æœ‰è‡ªå·±çš„ log æ–‡ä»¶ã€‚ä¸ºä¾¿äºæŸ¥çœ‹ã€è¿‡æ»¤ç­‰ï¼Œå¯å•æœºéƒ¨ç½² ELK æœåŠ¡åï¼Œå„ä¸ªæœåŠ¡é€šè¿‡ filebeat æœåŠ¡å°† log å‘é€è‡³ ELK æœºå™¨ã€‚\n<!--more--> \n![](https://i.loli.net/2021/07/07/rNvnGcQ4SyhpZlf.png)\n\n#### ä¸€ã€å®‰è£… java\n```sh\n$ sudo yum install java\n\n$ java -version\nopenjdk version \"11.0.5\" 2019-10-15 LTS\nOpenJDK Runtime Environment Corretto-11.0.5.10.1 (build 11.0.5+10-LTS)\nOpenJDK 64-Bit Server VM Corretto-11.0.5.10.1 (build 11.0.5+10-LTS, mixed mode)\n```\n\n> å¯¹äº elasticsearchã€logstash å’Œ kibanaï¼Œ**Elastic.co** éƒ½æä¾›äº†å¤šç§ç¯å¢ƒçš„å®‰è£…æ–¹å¼ï¼Œè¿™é‡Œåªä»‹ç»é€šè¿‡ RPM çš„æ–¹å¼ï¼Œå…¶ä»–ç¯å¢ƒå¯å‚è€ƒ[å®˜ç½‘æ–‡æ¡£](https://www.elastic.co/guide/index.html)ã€‚\n#### äºŒã€å®‰è£… elasticsearch \n1. ä¸‹è½½å®‰è£…å…¬é’¥ã€‚\n\t```sh\n$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch\n\t```\n2. å¢åŠ  yum æºã€‚åœ¨ `/etc/yum.repos.d/` åˆ›å»ºæ–‡ä»¶ `elasticsearch.repo` å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹:\n\t```sh\n[elasticsearch-7.x]\nname=Elasticsearch repository for 7.x packages\nbaseurl=https://artifacts.elastic.co/packages/7.x/yum\ngpgcheck=1\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md\n\t```\n3. å®‰è£…ã€å¯åŠ¨\n    ```sh\n$ sudo yum install elasticsearch\n\n$ sudo systemctl daemon-reload\n\n$ sudo systemctl enable elasticsearch.service\n Created symlink from /etc/systemd/system/multi-user.target.wants/elasticsearch.service to /usr/lib/systemd/system/elasticsearch.service.\n\n$ sudo systemctl start elasticsearch.service\n\n$ sudo systemctl | grep elasticsearch\n elasticsearch.service   loaded active running   Elasticsearch\n    ```\n    **æ³¨æ„**ï¼šelasticsearch åŸºäº javaï¼Œé»˜è®¤å ç”¨çš„æœ€å°å†…å­˜æ˜¯ 1Gï¼Œå¦‚æœæœºå™¨å†…å­˜ä¸å¤Ÿå¯åŠ¨æ—¶ä¼šæŠ¥é”™ `Not enough space`ï¼Œå°† `/etc/elasticsearch/jvm.options` ä¸­çš„ `-Xms` å’Œ `-Xmx` æ”¹å°åé‡è¯•å³å¯ã€‚\n\n\n#### ä¸‰ã€å®‰è£… logstash\n1. ä¸‹è½½å®‰è£…å…¬é’¥ã€‚å¦‚æœä¸Šé¢æ‰§è¡Œè¿‡ï¼Œå¯è·³è¿‡ã€‚\n\t```sh\n$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch\n\t```\n2. å¢åŠ  yum æºã€‚åœ¨ `/etc/yum.repos.d/` åˆ›å»ºæ–‡ä»¶ `logstash.repo` å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹:\n\t```sh\n[logstash-7.x]\nname=Elastic repository for 7.x packages\nbaseurl=https://artifacts.elastic.co/packages/7.x/yum\ngpgcheck=1\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md\n\t```\n3. å®‰è£…\n\t```sh\n$ sudo yum install logstash\n\t\n$ sudo systemctl daemon-reload\n\t\n$ sudo systemctl enable logstash.service\n Created symlink from /etc/systemd/system/multi-user.target.wants/logstash.service to /etc/systemd/system/logstash.service.\n\t```\n4. é…ç½®ã€‚åœ¨ `/etc/logstash/conf.d/` åˆ›å»ºæ–‡ä»¶ `beat2es.conf`ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\n\t```js\ninput {\n    beats{\n        port => 5044\n        ssl => false\n    }\n}\nfilter {\n    grok {\n        match => { \"message\" => \"%{TIMESTAMP_ISO8601:[@metadata][timestamp]} %{DATA:message\" }\n        overwrite => [ \"message\" ]\n    }\n    date {\n        match => [ \"[@metadata][timestamp]\" , \"yyyy-MM-dd HH:mm:ss,SSS\" ]\n    }\n}\noutput {\n    elasticsearch {\n        hosts => [\"localhost:9200\"]\n        index => \"%{[fields][appname]}-%{+YYYY.MM.dd}\"\n        sniffing => true\n    }\n}\n\t```\n5. å¯åŠ¨\n\t```sh\n$ sudo systemctl start logstash\n\t```\n\n#### å››ã€å®‰è£… kibana\n1. ä¸‹è½½å®‰è£…å…¬é’¥ã€‚å¦‚æœä¸Šé¢æ‰§è¡Œè¿‡ï¼Œå¯è·³è¿‡ã€‚\n\t```sh\n$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch\n\t```\n2. å¢åŠ  yum æºã€‚åœ¨ `/etc/yum.repos.d/` åˆ›å»ºæ–‡ä»¶ `kibana.repo` å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹:\n\t```sh\n[kibana-7.x]\nname=Kibana repository for 7.x packages\nbaseurl=https://artifacts.elastic.co/packages/7.x/yum\ngpgcheck=1\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md\n\t```\n3. å®‰è£…ã€å¯åŠ¨\n\t```sh\n$ sudo yum install kibana\n\n$ sudo systemctl daemon-reload\n\n$ sudo systemctl enable kibana.service\nCreated symlink from /etc/systemd/system/multi-user.target.wants/kibana.service to /etc/systemd/system/kibana.service.\n\t\n$ sudo systemctl start kibana.service\n\t```\n\n###### è‡³æ­¤ï¼ŒELK æœåŠ¡å·²ç»éƒ¨ç½²å®Œæˆã€‚logstash ç›‘å¬ 5044 ç«¯å£ï¼Œæ‰€æœ‰å‘é€åˆ° 5044 ç«¯å£çš„å†…å®¹éƒ½ä¼šä¼ é€è‡³ elasticsearchï¼Œå¯é€šè¿‡ kibana å¯è§†åŒ–æœç´¢é¡µé¢è¿›è¡ŒæŸ¥è¯¢ã€‚\n###### kibana é»˜è®¤éƒ¨ç½²åœ¨ locaohost:5601ï¼Œä¸ºäº†å¢åŠ å®‰å…¨æ€§ï¼Œéœ€é€šè¿‡ nginx ä¸º kibana è®¾ç½®ç”¨æˆ·ç™»é™†è®¿é—®ã€‚\n###### å¦‚æœä¸éœ€è¦å®‰å…¨æ€§ï¼Œå¯ä¿®æ”¹ `/etc/kibana/kibana.yml` æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ `server.host` çš„å€¼æ”¹ä¸º `0.0.0.0` åé‡å¯ kibana æœåŠ¡ï¼Œè¿™æ ·å¤–ç½‘å¯ç›´æ¥é€šè¿‡è¯¥æœºå™¨çš„ 5601 ç«¯å£è®¿é—® kibana æœåŠ¡ã€‚\n\n#### äº”ã€è®¾ç½® kibana ç™»é™†è®¿é—®\n1. æ·»åŠ  nginx æº\n\t```sh\n$ sudo rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n\t```\n2. å®‰è£… nginx\n\t```sh\n$ sudo yum install nginx\n\t```\n3. é…ç½® nginxã€‚ä¿®æ”¹ `/etc/nginx/conf.d/default.conf` ä¸­ `/` è·¯ç”±çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š\n\t```sh\nlocation / {\n     auth_basic \"secret\";\n     auth_basic_user_file /etc/nginx/db/passwd.db;\n     proxy_pass http://localhost:5601;\n     proxy_set_header Host $host:5601;\n     proxy_set_header X-Real-IP $remote_addr;\n     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n     proxy_set_header Via \"nginx\";\n  }\n\t```\n4. å®‰è£… httpd\n\t```sh\n$ sudo yum install httpd\n\t```\n5. è®¾ç½®ç”¨æˆ·ã€‚ç”¨æˆ·åï¼šjackï¼Œå¯†ç ï¼š123456\n\t```sh\n$ sudo htpasswd -bc /etc/nginx/pwd.db jack 123456\n\t```\n6. å¯åŠ¨ nginx\n\t```sh\n$ sudo systemctl nginx.service\n\t```\n\n###### è‡³æ­¤ï¼Œè®¿é—®è¯¥æœºå™¨çš„ 80 ç«¯å£ï¼Œé€šè¿‡ç”¨æˆ·å¯†ç éªŒè¯ï¼Œå³å¯è®¿é—®åˆ° kibana æœåŠ¡ã€‚\n\n#### å…­ã€å®‰è£… filebeat\n> filebeat æœåŠ¡å¯å®‰è£…åœ¨ä»»ä½•æœ‰ log æ–‡ä»¶çš„æœºå™¨ä¸Šï¼Œå…¶å®æ—¶ç›‘å¬ log æ–‡ä»¶ï¼Œå¹¶å°†å†…å®¹å‘é€è‡³ logstash æœåŠ¡ã€‚\n1. ä¸‹è½½ rpm æ–‡ä»¶ï¼Œå¹¶å®‰è£…\n\t```sh\n$ curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.4.2-x86_64.rpm\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 22.7M  100 22.7M    0     0  24.8M      0 --:--:-- --:--:-- --:--:-- 24.8M\n\n$ sudo rpm -vi filebeat-7.4.2-x86_64.rpm\nPreparing packages...\nfilebeat-7.4.2-1.x86_64\n\n$ filebeat version\nfilebeat version 7.4.2 (amd64), libbeat 7.4.2 [15075156388b44390301f070960fd8aeac1c9712built 2019-10-28 19:46:13 +0000 UTC]\n\t```\n2. é…ç½®ã€‚é…ç½®æ–‡ä»¶æŒ‰æ¨¡å—åˆ†ä¸ºäº†å‡ éƒ¨åˆ†ï¼Œå¦‚ Filebeat inputsã€Filebeat modulesã€Outputsç­‰ï¼Œåœ¨è¿™é‡Œåªéœ€å…³å¿ƒä¸¤ä¸ªæ¨¡å—ï¼Œä¸€æ˜¯ Filebeat inputsï¼Œå¦ä¸ªä¸º Outputsã€‚\nFilebeat inputs ç”¨æ¥é…ç½® Filebeat æœåŠ¡æ‰€ç›‘å¬ã€è¯»å–çš„æ–‡ä»¶ï¼Œä»¥åŠè¯»å–æ—¶çš„ä¸€äº›é€‰é¡¹ï¼Œè¿™é‡Œçš„æ–‡ä»¶ï¼Œå³ä¸º log æ–‡ä»¶ã€‚\n\n\t```\n\t   enabled: true è¡¨ç¤ºå¼€å¯\n\t\n\t   paths: æŒ‡å®š log æ–‡ä»¶çš„è·¯å¾„\n\t\n\t   fields: é…ç½®å…ƒæ•°æ®ï¼Œappname ä¸ºå¿…å¡«é¡¹ï¼Œç”¨æ¥åŒºåˆ†ä¸åŒé¡¹ç›®\n\t\n\t   multiline.pattern: æ­£åˆ™è¡¨è¾¾å¼\n\t\n\t   multiline.negate: æ˜¯å¦åå‘ã€‚true è¡¨ç¤ºåŒ¹é… multiline.pattern æ—¶å¼€å§‹æ–°çš„ä¸€è¡Œï¼›false è¡¨ç¤ºä¸åŒ¹é…æ—¶å¼€å§‹æ–°çš„ä¸€è¡Œ\n\t\n\t   multiline.match: è¿æ¥çš„ä½ç½®ã€‚after è¡¨ç¤ºä¸åŒ¹é… multiline.pattern æ—¶è¿åœ¨ä¸Šä¸€å¥åé¢ï¼›before è¡¨ç¤ºè¿åœ¨ä¸‹ä¸€å¥å‰é¢\n\t\n\t   è¿™ 3 é¡¹ç”¨æ¥è®¾ç½®å¤šè¡Œè¯†åˆ«ï¼Œ'^[0-9]{4}-[0-9]{2}-[0-9]{2}' æ˜¯è¯†åˆ«ï¼Œè¡Œé¦–æ ¼å¼ä¸º YYYY-MM-DD çš„æ—¥æœŸï¼Œå³æ¯å½“è¡Œé¦–ä¸ºè¯¥æ ¼å¼çš„æ—¥æœŸæ—¶ï¼Œå¦‚ 2019-11-15ï¼Œéƒ½ä¼šé‡æ–°å¼€å§‹ä¸€è¡Œã€‚\n\t```\n   \n   Outputs ç”¨æ¥é…ç½®è¯»å–åˆ°çš„å†…å®¹ï¼Œå¦‚ä½•è¾“å‡ºã€‚é…ç½®é‡Œç¼ºçœçš„è¾“å‡ºæ–¹å‘æ˜¯ Elasticsearchï¼Œè¿™é‡Œéœ€è¦åˆ‡æ¢ä¸º Logstashã€‚Logstash çš„ SSL ç›®å‰å°šæœªå¼€å¯ï¼Œå› æ­¤åªéœ€é…ç½® hosts å³å¯ã€‚\n\n\t```\nhosts: [\"{host}:5044\"]ï¼Œlogstash æœåŠ¡æ‰€åœ¨çš„ä¸»æœºåœ°å€\n\t```\n\n   å¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¿®æ”¹ä¸‹é¢å†…å®¹ä¸­çš„ `paths` å’Œ `appname` ä»¥åŠ `hosts`ï¼Œæ›¿æ¢åŸ filebeat.yml æ–‡ä»¶å†…å®¹ï¼Œå³å¯ã€‚\n\n\t```sh\n\t   #=========================== Filebeat inputs =============================\n\t \n\tfilebeat.inputs:\n\t \n\t- type: log\n\t  enabled: true\n\t  paths:\n\t    - /var/log/app.log\n\t  fields:\n\t    appname: {your-app-name}\n\t  multiline.pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'\n\t  multiline.negate: true\n\t  multiline.match: after\n\t \n\t#============================= Filebeat modules ===============================\n\t \n\tfilebeat.config.modules:\n\t  # Glob pattern for configuration loading\n\t  path: ${path.config}/modules.d/*.yml\n\t \n\t  # Set to true to enable config reloading\n\t  reload.enabled: false\n\t \n\t#==================== Elasticsearch template setting ==========================\n\t \n\tsetup.template.settings:\n\t  index.number_of_shards: 1\n\t  #index.codec: best_compression\n\t  #_source.enabled: false\n\t \n\t#================================ Outputs =====================================\n\t \n\t#----------------------------- Logstash output --------------------------------\n\toutput.logstash:\n\t  # The Logstash hosts\n\t  hosts: [\"{host}:5044\"]\n\t \n\t  # Optional SSL. By default is off.\n\t  # List of root certificates for HTTPS server verifications\n\t  #ssl.certificate_authorities: [\"/etc/pki/root/ca.pem\"]\n\t \n\t  # Certificate for SSL client authentication\n\t  #ssl.certificate: \"/etc/pki/client/cert.pem\"\n\t \n\t  # Client Certificate Key\n\t  #ssl.key: \"/etc/pki/client/cert.key\"\n\t \n\t#================================ Processors =====================================\n\t \n\tprocessors:\n\t  - add_host_metadata: ~\n\t  - add_cloud_metadata: ~\n\t ```\n3. å¯åŠ¨\n\t```sh\n\t$ sudo systemctl enable filebeat.service\n\t\n\t$ sudo systemctl start filebeat.service\n\t```","tags":["ELK","Linux"],"categories":["ELK"]},{"title":"Elastic Beanstalk (EB) å¼•å…¥ CloudWatch Log æœåŠ¡","url":"/2019/11/95ca4e5703e9/","content":"\n- åŸå› \n ç°æ‰€æœ‰ EB ç¯å¢ƒæœåŠ¡çš„ logï¼Œå‡ä»¥æ–‡ä»¶çš„å½¢å¼ï¼Œå­˜å‚¨åœ¨ EB æœºå™¨æœ¬åœ°ã€‚å½“æœºå™¨å› å„ç§é—®é¢˜ï¼ˆåŒ…å«ä½†ä¸é™äº bug ï¼‰ï¼Œé€ æˆæ— æ³•è¿œç¨‹è®¿é—®æ—¶ï¼Œæ— æ³•è¯»å–å…¶ä¸Šçš„ log æ¥å®šä½é—®é¢˜ã€‚æ•…å¼•å…¥ AWS çš„ CloudWatch Log æœåŠ¡ã€‚\n\n<!--more-->\n\n- åŸç†\n CloudWatch Log æ˜¯ä¸€é¡¹æœåŠ¡ã€‚åŠŸèƒ½æ˜¯ï¼Œä»¥æ¥è¿‘å®æ—¶çš„é€Ÿåº¦ä»¥æµçš„æ–¹å¼è¯»å–ã€å¹¶å­˜å‚¨æ–‡ä»¶ã€‚\n\n- é…ç½®\n 1. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºåä¸º`.ebextentions`çš„ç›®å½•ï¼›\n 2. åœ¨`.ebextentions`ä¸­æ–°å»ºæ–‡ä»¶`default.config`ï¼Œæ‰©å±•åå¿…é¡»ä¸º`.config`ï¼Œæ–‡ä»¶åä»»æ„ï¼Œåˆæ³•å³å¯ï¼›\n 3. å†™å…¥å¦‚ä¸‹å†…å®¹ï¼Œéƒ¨ç½²æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œå…·ä½“è§[AWSæ–‡æ¡£](https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/ebextensions.html)\n```yaml\npackages:\n  yum:\n    awslogs: []\n\nfiles:\n  \"/etc/awslogs/awscli.conf\" :\n    mode: \"000600\"\n    owner: root\n    group: root\n    content: |\n      [plugins]\n      cwlogs = cwlogs\n      [default]\n      region = `{\"Ref\":\"AWS::Region\"}`\n\n  \"/etc/awslogs/awslogs.conf\" :\n    mode: \"000600\"\n    owner: root\n    group: root\n    content: |\n      [general]\n      state_file = /var/lib/awslogs/agent-state\n\n  \"/etc/awslogs/config/logs.conf\" :\n    mode: \"000600\"\n    owner: root\n    group: root\n    content: |\n      [/var/log/automation/app.log]\n      log_group_name = `{\"Fn::Join\":[\"/\", [\"/aws/elasticbeanstalk\", { \"Ref\":\"AWSEBEnvironmentName\" }, \"var/log/automation/app.log\"]]}`\n      log_stream_name = {instance_id}\n      file = /var/log/automation/app.log\n\ncommands:\n  \"1_init_log_dir\":\n      cwd: /var/log/\n      command: |\n        mkdir automation\n        chmod 775 automation\n        chgrp wsgi automation\n        chown wsgi automation\n      ignoreErrors: true\n  \"2_check_awslogs\":\n    command: chkconfig awslogs on\n  \"3_reload_awslogs\":\n    command: service awslogs restart\n```\n\n- è¯´æ˜\né…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨äº† 3 ä¸ªé”®ï¼Œ**packages**ã€**files** å’Œ **commands**ã€‚å…·ä½“è¯´æ˜å¯è§AWSæ–‡æ¡£ã€‚\n 1. **packages**\n - ä½¿ç”¨ yum å®‰è£… CloudWatch Log æœåŠ¡ï¼Œ**awslogs**ã€‚\n \n 2. **files**ï¼šå†™å…¥ awslogs çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å‰ä¸¤ä¸ª **awscli.conf** å’Œ **awslogs.conf** åœ¨æ­¤ä¸éœ€è¦å…³å¿ƒï¼Œåªéœ€å…³æ³¨ç¬¬ 3 ä¸ª **logs.conf**ã€‚\n - **log_group_name:** åœ¨ CloudWatch Log ä¸­æ˜¾ç¤ºçš„ **group** çš„åç§°ï¼Œå¯¹åº”ä¸‹å›¾ä¸­çº¢è‰²æ¡†ï¼›\n - **log_stream_name:** åœ¨ CloudWatch Log ä¸­æ˜¾ç¤ºçš„ **stream** çš„åç§°ï¼Œå¯¹åº”ä¸‹å›¾ä¸­è“è‰²æ¡†ï¼›\n - **file:** è¯¥æ•°æ®æµæ‰€å…³è”çš„æ–‡ä»¶çš„ç»å¯¹è·¯å¾„\n ![](https://i.loli.net/2021/08/02/F7rtfBhgzmG6iLW.png)\n \n 3. **commands**\n ä¸ºä¾¿äºæŸ¥çœ‹å’Œç®¡ç†ï¼Œç»Ÿä¸€å°†logæ”¾åˆ°äº†è·¯å¾„ `/var/log/` ä¸‹ï¼Œå¹¶æ¯ä¸ªç‹¬ç«‹ç¨‹åºä½¿ç”¨ä¸€ä¸ªç›®å½•ï¼Œè¿™é‡Œä½¿ç”¨automationè¯´æ˜ã€‚åœ¨ 2 ä¸­ï¼Œå‚æ•° **file** ä½¿ç”¨çš„å€¼æ˜¯ `/var/log/automation/app.log`ï¼Œæ‰€ä»¥åœ¨å¯åŠ¨å‰éœ€å…ˆåˆ›å»º **automation** ç›®å½•ã€‚\n  - **1_init_log_dirï¼š** åˆ›å»ºç›®å½•å¹¶ä¿®æ”¹æƒé™ï¼ŒEBç¯å¢ƒä¸­ï¼Œç¨‹åºçš„é»˜è®¤æ‰§è¡Œç”¨æˆ·æ˜¯ wsgiï¼›\n  - **2_check_awslogsï¼š** æ›´æ–° awslogs æœåŠ¡ï¼›\n  - **3_reload_awslogsï¼š** é‡å¯ awslogs æœåŠ¡ã€‚\n\n- ä½¿ç”¨\nå°†é…ç½®æ–‡ä»¶ **default.config** ä¸­ **logs.conf** çš„ **log_group_name**ã€**log_stream_name**å’Œ**file**ä»¥åŠ **1_init_log_dir** æ›¿æ¢ä¸ºå¯¹åº”é¡¹ç›®ä¿¡æ¯å³å¯ï¼Œåœ¨ **CloudWatch Log** ä¸­å¯æ ¹æ® **group_name** å’Œ **stream_name** æŸ¥æ‰¾ **log**ã€‚\n\n- æ‰©å±•\nå¦‚æœ‰éœ€è¦ï¼Œå¯åŒæ—¶åˆ›å»ºå¤šä¸ªæµï¼Œä¿®æ”¹ **logs.conf** å³å¯ï¼Œæ ¼å¼å‚è€ƒå¦‚ä¸‹\n```yaml\n\"/etc/awslogs/config/logs.conf\" :\n    mode: \"000600\"\n    owner: root\n    group: root\n    content: |\n      [/var/log/messages]\n      log_group_name = `{\"Fn::Join\":[\"/\", [\"/aws/elasticbeanstalk\", { \"Ref\":\"AWSEBEnvironmentName\" }, \"var/log/messages\"]]}`\n      log_stream_name = {instance_id}\n      file = /var/log/messages\n\n      [/var/log/dmesg]\n      log_group_name = `{\"Fn::Join\":[\"/\", [\"/aws/elasticbeanstalk\", { \"Ref\":\"AWSEBEnvironmentName\" }, \"var/log/dmesg\"]]}`\n      log_stream_name = {instance_id}\n      file = /var/log/dmesg\n\n      [/var/log/automation/app.log]\n      log_group_name = `{\"Fn::Join\":[\"/\", [\"/aws/elasticbeanstalk\", { \"Ref\":\"AWSEBEnvironmentName\" }, \"var/log/automation/app.log\"]]}`\n      log_stream_name = {instance_id}\n      file = /var/log/automation/app.log\n```\n","tags":["AWS","CloudWatch Log"],"categories":["AWS"]},{"title":"ä¿æŒsshè¿œç¨‹è¿æ¥ä¸æ–­å¼€","url":"/2019/09/ced3db1f808e/","content":"\né€šè¿‡`ssh user@server`ç™»é™†åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ\n\n```sh\nConnection closed by remote host\n```\næ„æ€å°±æ˜¯æœåŠ¡å™¨æ–­å¼€äº†è¿™ä¸ªè¿æ¥ã€‚\n<!--more--> \n##### è§£å†³æ–¹æ³•\n\n```sh\n// å…ˆç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨\n$ ssh -i ./ssh/authorization.pem {root}@{server}\n\n// åˆ‡æ¢åˆ°root\n$ sudo su -\n\n// ä¿®æ”¹é…ç½®æ–‡ä»¶\n# vi /etc/ssh/sshd_config\n\n// å°†å…¶ä¸­çš„ä¸¤è¡Œ\n#ClientAliveInterval 0\n#ClientAliveCountMax 3\n// ä¿®æ”¹ä¸º\nClientAliveInterval 2\nClientAliveCountMax 3\n// :wq ä¿å­˜ï¼Œå¹¶é€€å‡º\n\n// é‡å¯sshæœåŠ¡\n# /etc/init.d/sshd restart\nStopping sshd:                                             [  OK  ]\nStarting sshd:                                             [  OK  ]\n```\n\næ–­å¼€å½“å‰sshè¿æ¥ï¼Œé‡æ–°ç™»å½•ï¼Œé—®é¢˜è§£å†³ã€‚","tags":["Linux","ssh"],"categories":["Linux"]},{"title":"åœ¨AWS Lambdaä¸­ä½¿ç”¨psycopg2è¿æ¥Redshift","url":"/2019/09/6df5f8cca1a9/","content":"\n- ç¯å¢ƒï¼šMacOS 10.12.6\n\nå¼€å§‹è¯´æ­£é¢˜ã€‚\n\nRedshiftæ˜¯åŸºäºPostgreSQLçš„äºŒæ¬¡å¼€å‘åº”ç”¨ï¼Œæ‰€ä»¥ï¼Œèƒ½è¿æ¥PostgreSQLçš„å·¥å…·éƒ½å¯ä»¥ç”¨æ¥è¿æ¥Redshiftã€‚æˆ‘é€‰æ‹©çš„æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„`psycopg2`ã€‚\n<!--more--> \nå¦‚æœä¸Šæ¥å°±æ‰§è¡Œ:\n```sh\n$ pip install psycopg2\n```\nä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„æç¤ºé”™è¯¯ï¼š\n\n```sh\nError: pg_config executable not found.\n    \n    pg_config is required to build psycopg2 from source.  Please add the directory\n    containing pg_config to the $PATH or specify the full executable path with the\n    option:\n    \n        python setup.py build_ext --pg-config /path/to/pg_config build ...\n    \n    or with the pg_config option in 'setup.cfg'.\n    \n    If you prefer to avoid building psycopg2 from source, please install the PyPI\n    'psycopg2-binary' package instead.\n    \n    For further information please check the 'doc/src/install.rst' file (also at\n    <http://initd.org/psycopg/docs/install.html>).\n    \n    ----------------------------------------\nERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.\n```\næç¤ºéœ€è¦ä¸€ä¸ªå«åš`pg_config`çš„ä¸œè¥¿ã€‚`pg_config`æ˜¯ä¸ªç¼–è¯‘PostgreSQLæºç åå¾—åˆ°çš„ä¸€ä¸ªæ–‡ä»¶ã€‚æ‰€ä»¥æƒ³è¦é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…`psycopg2`å°±éœ€è¦æ‰‹åŠ¨å»ç¼–è¯‘æºç ã€‚\n\nå¦‚æœæ‡’å¾—ç¼–è¯‘ï¼Œäººå®¶å·²ç»æ›¿ä½ æƒ³å¥½äº†åŠæ³•ï¼Œæ­£å¦‚æç¤ºé‡Œæ‰€è¨€ï¼Œ\n\n```sh\n If you prefer to avoid building psycopg2 from source, please install the PyPI\n    'psycopg2-binary' package instead.\n```\nå› æ­¤ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤å®‰è£…åˆ å‡ç‰ˆçš„`psycopg2`ï¼Œ\n\n```sh\n$ pip install psycopg2-binary\n```\nç„¶åï¼Œåœ¨æœ¬æœºä¸Šå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚\n\n---\n\n**ä½†æ˜¯ï¼ŒLambdaä¸å¯ä»¥ã€‚ä¸åŒäºç‹¬ç«‹çš„æœºå™¨ï¼ŒLambdaéœ€è¦å®Œæ•´çš„ä¾èµ–åŒ…æ‰èƒ½æ‰§è¡Œã€‚**\n\nåœ¨Githubä¸Šæœåˆ°äº†[awslambda-psycopg2](https://github.com/jkehler/awslambda-psycopg2)ï¼Œä½œè€…ä»‹ç»è¯´æ˜¯ä¸“é—¨è§£å†³åœ¨Lambdaä¸Šä½¿ç”¨`psycopg2`çš„ã€‚\n\næŒ‰ç…§`README.md`çš„æ­¥éª¤ï¼Œå…ˆç¼–è¯‘PostgreSQLï¼Œå†ç”¨ç”Ÿæˆçš„`pg_config`å»ç¼–è¯‘`psycopg2`ã€‚ä½†æ‰§è¡Œåæ€»ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼Œ\n\n```python\nNo module named 'psycopg2._psycopg'\n```\nçœ‹ç€[issue](https://github.com/jkehler/awslambda-psycopg2/issues/47)é‡Œé¢å‡ ä¸ªè€å¤–è¯´æ¥è¯´å»ï¼Œä¹Ÿæ²¡è¯´å‡ºä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚\n\nå‡ ç•ªå°è¯•ä¸‹æ¥ï¼Œç»ˆç©¶æ˜¯å¡«äº†å‘ã€‚\n\n**å…¶å®æ˜¯ç¼–è¯‘ç¯å¢ƒçš„é—®é¢˜ï¼Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹ç¼–è¯‘ç”Ÿæˆçš„ä¾èµ–åŒ…ï¼Œåªèƒ½åœ¨è¯¥ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚Lambdaæ˜¯åœ¨Linuxæœºå™¨ä¸Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¿…é¡»åœ¨Linuxä¸Šè¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆçš„ä¾èµ–åŒ…æ‰å¯ä»¥ä½¿ç”¨ã€‚**\n\nå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚\n\n![](https://i.loli.net/2021/07/07/IX1DjFi72OblPoG.png)\n","tags":["AWS Lambda","python"],"categories":["Python"]},{"title":"åœ¨Sparkä¸­åŠ è½½Redshiftæ•°æ®é—®é¢˜æ±‡æ€»","url":"/2019/09/e4951d749391/","content":"\n#### 1. java.sql.SQLException: No suitable driver\nè¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºï¼Œè¿æ¥Redshiftæ—¶éœ€è¦ä¸€ä¸ªdriverï¼Œè€Œç¨‹åºæ‰§è¡Œæ—¶æ‰¾ä¸åˆ°èƒ½ç”¨çš„driverï¼Œæ‰€ä»¥æŠ¥é”™ã€‚AWSæä¾›äº†å¤šä¸ªç‰ˆæœ¬è¿æ¥Redshiftçš„driverï¼Œ[**ç‚¹å‡»æŸ¥çœ‹**](https://docs.aws.amazon.com/zh_cn/redshift/latest/mgmt/configure-jdbc-connection.html#download-jdbc-driver)ã€‚\n<!--more--> \n#### 2. java.lang.NoClassDefFoundError: com/amazonaws/services/kinesis/model/Record\nç»è¿‡å‡ æ¬¡å°è¯•å‘ç°ï¼Œç›´æ¥ä½¿ç”¨AWSæä¾›çš„é©±åŠ¨å¯ä»¥è¿ä¸ŠRedshiftï¼Œæ‰“å°å‡ºè¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸èƒ½åŠ è½½æ•°æ®ï¼Œä¸€åŠ è½½æ•°æ®ä¼šæŠ¥è¿™ä¸ªå¥‡æ€ªçš„é”™è¯¯ï¼Œè¡¨ç»“æ„éƒ½å¯ä»¥æ‰“å°å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åŠ è½½æ•°æ®å‘¢ï¼Ÿæˆ‘æƒ³ä¸é€šã€‚å‡ ç•ªæŸ¥è¯¢ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªåŒ…è£…åº“ï¼Œ[**githubåœ°å€**](https://github.com/databricks/spark-redshift#python)ã€‚\n\n#### 3. java.lang.IllegalArgumentException: AWS Access Key ID and Secret Access Key must be specified as the username or password (respectively) of a s3n URL, or by setting the fs.s3n.awsAccessKeyId or fs.s3n.awsSecretAccessKey properties (respectively).\næŒ‰ç…§2é‡Œé¢çš„githubåº“é‡Œçš„æ–‡æ¡£è¯´æ˜é…ç½®å¥½åï¼Œå¯èƒ½ä¼šæŠ¥è¿™ä¸ªé”™ã€‚å› ä¸ºspark-redshiftç”¨åˆ°äº†S3ï¼Œæ‰€ä»¥è¦é…ç½®keyå’Œsecretæ‰å¯ä»¥ã€‚æ–‡æ¡£é‡Œä¹Ÿæä¾›äº†[**å‡ ç§æ–¹å¼**](https://github.com/databricks/spark-redshift#configuration)ï¼Œiã€iiå’Œiiiï¼Œå¼€å§‹æˆ‘é€‰æ‹©çš„æ˜¯ç¬¬ä¸‰ç§æ–¹å¼ï¼Œç›´æ¥å†™åœ¨äº†URIé‡Œé¢ã€‚\n\n#### 4. java.lang.NoClassDefFoundError: com/eclipsesource/json/Json\nç´§æ¥ç€ï¼Œé…ç½®å¥½awsçš„keyå’Œsecretï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé”™è¯¯ã€‚è¿™ä¸ªé”™è¯¯ä¸€çœ¼çœ‹ä¸Šå»æ„Ÿè§‰å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¼šæŠ¥jsonçš„é”™è¯¯å‘¢ï¼Ÿåœ¨[**spark-redshiftçš„issue**](https://github.com/databricks/spark-redshift/issues/279)é‡Œé¢æ‰¾åˆ°äº†é‡åˆ°åŒæ ·é—®é¢˜çš„äººï¼Œæœ€ä¸‹é¢**arvindkanda**æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå¯åŠ¨æ—¶æä¾›ä¸€ä¸ªé¢å¤–çš„jaråŒ…å°±å¯ä»¥äº†ã€‚\n\n\n#### 5. java.sql.SQLException: [Amazon](500310) Invalid operation: S3ServiceException:The S3 bucket addressed by the query is in a different region from this cluster.\nè¿™ä¸ªé—®é¢˜æ˜¯è¯´ï¼ŒS3å’ŒEMRå¿…é¡»åœ¨åŒä¸€ä¸ªregionï¼Œä¸ç„¶Sparkæ˜¯è¯»ä¸åˆ°Redshiftçš„æ•°æ®çš„ã€‚æˆ‘è¿™é‡Œç”¨çš„éƒ½æ˜¯us-west-2ï¼ŒOregonï¼Œä¿„å‹’å†ˆã€‚\n\n\n#### 6. com.amazon.ws.emr.hadoop.fs.shaded.com.amazonaws.services.s3.model.AmazonS3Exception: Bad Request (Service: Amazon S3; Status Code: 400; Error Code: 400 Bad Request; \nè¿™ä¸ªé—®é¢˜ï¼Œå°±æ¯”è¾ƒå‰å®³äº†ï¼Œå¡äº†æˆ‘å¥½å‡ ä¸ªå°æ—¶ã€‚ç½‘ä¸Šå„ç§æ–¹æ¡ˆéƒ½åœ¨è¯´ï¼Œå› ä¸ºç­¾åç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ‰€ä»¥è®¿é—®S3æ—¶ï¼Œå¿…é¡»æŒ‡å®šS3çš„endpointï¼ŒæŸ¥æ¥çš„éƒ½æ˜¯`s3a`çš„ï¼Œ[**æ¯”å¦‚è¿™ä¸ª**](https://stackoverflow.com/questions/34209196/amazon-s3a-returns-400-bad-request-with-spark)ã€‚ä½†æ˜¯å› ä¸ºspark-redshifté‡Œç”¨çš„æ˜¯`s3n`ï¼Œæˆ‘å°±å°†aæ›¿æ¢æˆäº†nï¼Œä½†æ˜¯è¿™ä¸ªé—®é¢˜è¿˜æ˜¯åœ¨ã€‚å„ç§æ–¹æ¡ˆä¸æ–­å°è¯•ï¼Œå¯èƒ½æ˜¯è¿æ°”å¥½ï¼Œè«åçš„å°±è¯•å¯¹äº†ä¸€ç§æ–¹å¼ï¼šå°†3é‡Œé¢çš„æ–¹å¼æ›¿æ¢æˆiiï¼Œç„¶åå†é…ç½®`sc.hadoopConfiguration.set(\"fs.s3a.endpoint\", \"s3.us-west-2.amazonaws.com\")`ï¼Œå°±å¯ä»¥äº†ã€‚\n\n#### æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼Œ\n\n```java\nspark = SparkSession.builder.getOrCreate()\nspark._jsc.hadoopConfiguration().set('fs.s3n.awsAccessKeyId', aws_access_key_id)\nspark._jsc.hadoopConfiguration().set('fs.s3n.awsSecretAccessKey', aws_secret_access_key)\nspark._jsc.hadoopConfiguration().set(\"fs.s3n.endpoint\", \"s3.us-west-2.amazonaws.com\")\n\nrsdf = spark.read\\\n        .format('com.databricks.spark.redshift')\\\n        .option('url', 'jdbc:redshift://host:port/schema')\\\n        .option('dbtable', 'table_name')\\\n        .option('user', 'username')\\\n        .option('password', 'password')\\\n        .option('tempdir', 's3n://bucket/dir')\\\n        .load()\n# æ‰“å°è¡¨ç»“æ„\nrsdf.printSchema()\n# æ‰“å°è¡¨å†…å®¹\nrsdf.show()\n```\n\n##### å…³äºsparkå¯åŠ¨å‘½ä»¤å‚æ•°ï¼Œ[**è¿™ç¯‡æ–‡ç« **](https://blog.csdn.net/u012402124/article/details/99485901)å·²ç»è¯´æ˜è¿‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚","tags":["AWS","Spark","Redshift"],"categories":["Spark"]},{"title":"ã€ŒAWSã€å…¥é—¨å®‰è£…aws cli","url":"/2019/08/c35313b67e87/","content":"\n> cliï¼Œå³Command Line Interfaceï¼Œæ˜¯awsæœåŠ¡å¸¸ç”¨çš„å‘½ä»¤å·¥å…·\n<!--more--> \n[AWSå®˜ç½‘åœ°å€](https://amazonaws-china.com/cn/cli/)\n\n- ç¯å¢ƒï¼šPython\n\n1. å®‰è£…\n\nå®‰è£…èµ·æ¥åªéœ€è¦ä¸€æ¡å‘½ä»¤ï¼š\n```shell\n$ pip install awscli --user\n```\n \næ‰§è¡Œå®Œæˆä¹‹åï¼Œè¾“å…¥`aws`ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸäº†ï¼š\n```shell\n$ aws\nusage: aws [options] <command> <subcommand> [<subcommand> ...] [parameters]\nTo see help text, you can run:\n\n  aws help\n  aws <command> help\n  aws <command> <subcommand> help\naws: error: the following arguments are required: command\n```\n\næŸ¥çœ‹æ”¯æŒçš„å‘½ä»¤ï¼Œå…¶ä¸­çš„`AVAILABLE SERVICES`ä¾¿æ˜¯æ”¯æŒçš„å‘½ä»¤ï¼Œå†…å®¹è¿‡å¤šï¼Œåªç½—åˆ—äº†éƒ¨åˆ†\n```shell\n$ aws help\nNAME\n       aws -\n\nDESCRIPTION\n       The  AWS  Command  Line  Interface is a unified tool to manage your AWS\n       services.\n\nSYNOPSIS\n          aws [options] <command> <subcommand> [parameters]\n\n       Use aws command help for information on a  specific  command.  Use  aws\n       help  topics  to view a list of available help topics. The synopsis for\n       each command shows its parameters and their usage. Optional  parameters\n       are shown in square brackets.\nAVAILABLE SERVICES\n       o acm\n\n       o acm-pca\n\n       o alexaforbusiness\n\n       o amplify\n\n       o apigateway\n\n       o apigatewaymanagementapi\n\n       o apigatewayv2\n\n       o application-autoscaling\n\n       o appmesh\n\n       o appstream\n\n       o appsync\n\n       o athena\n\n       o autoscaling\n\n       o autoscaling-plans\n\n       o backup\n\n       o batch\n\n       o budgets\n\n       o ce\n\n       o chime\n\n       o cloud9\n\n       o clouddirectory\n\n       o cloudformation\n\n       o cloudfront\n\n       o cloudhsm\n\n       o cloudhsmv2\n\n       o cloudsearch\n\n```\n\n2. é…ç½®\n\nå…¶ä¸­æœ‰ä¸€ä¸ªå­å‘½ä»¤`configure`ï¼Œæ˜¯ç”¨æ¥é…ç½®aws cliçš„ã€‚aws cliè®¿é—®çš„éƒ½æ˜¯ aws æœåŠ¡ï¼Œè€Œæ¯ä¸ªæœåŠ¡éƒ½æ˜¯éœ€è¦èº«ä»½éªŒè¯çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œéœ€è¦å…ˆé…ç½®èº«ä»½ä¿¡æ¯ã€‚\n\nåŒæ ·ï¼Œå…ˆæŸ¥çœ‹`configure`çš„è¯´æ˜ï¼š\n```shell\n$ aws configure help\nNAME\n       configure -\n\nDESCRIPTION\n       Configure  AWS  CLI  options. If this command is run with no arguments,\n       you will be prompted for configuration values such as your  AWS  Access\n       Key  Id  and you AWS Secret Access Key.  You can configure a named pro-\n       file using the --profile argument.  If your config file does not  exist\n       (the default location is ~/.aws/config), the AWS CLI will create it for\n       you.  To keep an existing value, hit enter when prompted for the value.\n       When  you  are prompted for information, the current value will be dis-\n       played in [brackets].  If the config item has no value, it be displayed\n       as  [None].  Note that the configure command only work with values from\n       the config file.  It does not use any configuration values  from  envi-\n       ronment variables or the IAM role.\n\n       Note:  the  values  you  provide  for the AWS Access Key ID and the AWS\n       Secret Access Key will  be  written  to  the  shared  credentials  file\n       (~/.aws/credentials).\n\nCONFIGURATION VARIABLES\n       The following configuration variables are supported in the config file:\n\n       o aws_access_key_id - The AWS access key part of your credentials\n\n       o aws_secret_access_key - The AWS secret access key part of  your  cre-\n         dentials\n\n       o aws_session_token  - The session token part of your credentials (ses-\n         sion tokens only)\n\n       o metadata_service_timeout - The number of seconds to  wait  until  the\n         metadata service request times out.  This is used if you are using an\n         IAM role to provide your credentials.\n\n       o metadata_service_num_attempts - The number  of  attempts  to  try  to\n         retrieve  credentials.   If you know for certain you will be using an\n         IAM role on an Amazon EC2 instance, you can set this value to  ensure\n         any intermittent failures are retried.  By default this value is 1.\n\n       For  more information on configuration options, see Configuring the AWS\n       Command Line Interface in the AWS CLI User Guide.\n\n       See 'aws help' for descriptions of global parameters.\n\n```\n\nå…¶ä¸­æœ‰ç”¨çš„å°±æ˜¯`CONFIGURATION VARIABLES`ï¼Œä¸€èˆ¬éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œ`aws_access_key_id`å’Œ`aws_secrct_access_key`ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ç™»é™†AWSåä»IAMè·å–ï¼Œä¸‹é¢æ˜¯é…ç½®æ–¹æ³•ï¼Œ`--profile`æ˜¯ç»™å½“å‰é…ç½®çš„èº«ä»½èµ·ä¸€ä¸ªåå­—ï¼Œè¿™é‡Œèµ·åå«`dev`ï¼š\n```shell\n$ aws configure --profile dev\nAWS Access Key ID [None]: \nAWS Secret Access Key [None]: \nDefault region name [None]: \nDefault output format [None]: \n```\næ‰§è¡Œåä¼šè®©ä½ è¾“å…¥ä»¥ä¸Šå‡ é¡¹ï¼Œ`aws_access_key_id`å’Œ`aws_secrct_access_key`ç…§å¸¸å¡«å†™ï¼Œåé¢å‡ é¡¹å¯ä»¥ä¸å¡«ï¼Œä¹Ÿå¯æŒ‰éœ€å¡«å†™ã€‚\n\nè¿™æ ·ï¼Œå°±é…ç½®å®Œæˆäº†ï¼Œä½¿ç”¨`dev`è¿™ä¸ªèº«ä»½ï¼Œå°±å¯ä»¥è®¿é—®awsçš„å„ç§æœåŠ¡äº†ã€‚\n\n---\n\n**åˆ°è¿™å°±ç®—æ˜¯å…¥é—¨äº†**","tags":["AWS","Python"],"categories":["AWS"]},{"title":"Golang é¡¹ç›®ç»“æ„","url":"/2019/08/d923d0c927c5/","content":"\n>  å¥½ä¹…æ²¡å†™ golang çš„é¡¹ç›®äº†ï¼Œå‰ä¸¤å¤©æ¥ä¸ªä¸´æ—¶éœ€æ±‚ï¼Œéœ€æ±‚ä¸éš¾ï¼Œä½†è¦æ±‚å¿…é¡»ç”¨golangæ¥å†™ã€‚ä¸€æ—¶é—´ç«Ÿç„¶å¿˜äº†å¦‚ä½•å¼€å§‹ï¼Œä»å“ªå…¥æ‰‹äº†ï¼Œæ•…åœ¨æ­¤åšä¸ªè®°å½•ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚\n<!--more--> \n- ç¯å¢ƒï¼š MacOS\n- IDEï¼šGoLand\n\n1. é¡¹ç›®è·¯å¾„\n    ä¸ºäº†ä¾¿äºç®¡ç†å’Œå¼•ç”¨å…¶ä»– packageï¼Œä¸€èˆ¬æ”¾åœ¨ `/{GOPATH}/src` ä¸‹ã€‚åœ¨è¯¥ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªå…¬å¸åŸŸåçš„æ–‡ä»¶å¤¹ï¼Œåœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºé¡¹ç›®å‘½åçš„æ–‡ä»¶å¤¹ï¼Œå¦‚`/{GOPATH}/src/domain.com/project_name/`ã€‚\n\n2. é¡¹ç›®ç»“æ„\n```\n  project_name/\n    |__bin/\n    |__build/\n    |__config/\n    |__cmd/\n    |  |__service_1/\n    |     |__service_1.go\n    |  |__service_2/\n    |     |__service_2.go\n    |__docs/\n    |__Godep/\n    |__pkg/\n    |    |__lib/\n    |    |__...\n    |    |__...\n    |__resource/\n    |__vendor/\n```\n- bin/ï¼šç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶\n- build/ï¼šç¼–è¯‘ã€æ„å»ºè„šæœ¬æ–‡ä»¶\n- config/ï¼šé…ç½®æ–‡ä»¶ï¼Œjson/yamlç­‰\n- cmd/ï¼šæ‰€æœ‰æœåŠ¡\n- cmd/service_1/ï¼šæŸä¸ªå…·ä½“çš„æœåŠ¡\n- cmd/service_1/service_1.goï¼šæœåŠ¡å…¥å£\n- docs/ï¼šæ–‡æ¡£\n- Godep/ï¼šgodep è‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•\n- pkg/ï¼šä¸»è¦ä»£ç \n- resource/ï¼šèµ„æº\n- vendor/ï¼šgodep è‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•\n\n3. `godep`\n    åŒ…ä¾èµ–ç®¡ç†å·¥å…·ï¼Œä½¿æ¯ä¸ªé¡¹ç›®çš„ä¾èµ–çš„ç‰ˆæœ¬ç›¸äº’ç‹¬ç«‹ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ`godep save ./cmd`ï¼Œè‡ªåŠ¨ç”Ÿæˆ Godep å’Œ vendorã€‚\n\n\n**å¤§è‡´ï¼Œå°±è¿™äº›ã€‚**","tags":["Golang"],"categories":["Golang"]},{"title":"AWS EMR ä¸Šè¿è¡Œ Spark + Kinesis: NoSuchMethodError: org.apache.spark.internal.Logging","url":"/2019/08/bb99d69df7f6/","content":"\n> å¦‚é¢˜ï¼Œå› æœ‰éœ€æ±‚ï¼Œè¿™ä¸¤å¤©åœ¨å¼„è¿™ä¸ªSparkï¼Œç”¨çš„æ˜¯AWSçš„EMRï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå°±ä¸è§£é‡Šäº†ã€‚ä¸Šé¢è¿™ä¸ªé—®é¢˜å¡äº†å¾ˆä¹…ï¼Œæ•…åœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚\n<!--more--> \n- Sparkæ”¯æŒå¤šç§è¯­è¨€ï¼Œå¦‚Scalaã€Javaã€Pythonã€Rï¼Œæˆ‘ç”¨çš„æ˜¯Pythonã€‚\n\nå®˜æ–¹æœ‰ä¸ªå«WordCountçš„Exampleï¼Œæˆ‘æ²¡çœ‹ï¼Œç›´æ¥ç…§ç€æ–‡æ¡£æ’¸ä»£ç ã€‚[Sparkæ–‡æ¡£åœ°å€](https://spark.apache.org/docs/latest/streaming-kinesis-integration.html)\n\n\nåˆå§‹åŒ–ä»£ç å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\n\n```python \n# main.py\nfrom pyspark import SparkContext\nfrom pyspark.streaming import StreamingContext\nfrom pyspark.streaming.kinesis import KinesisUtils, InitialPositionInStream\n\naws_access_key_id = 'your-aws-access-key-id'\naws_secret_access_key = 'your-aws-secret-access-key'\n\nif __name__ == '__main__':\n    sc = SparkContext('local[*]', 'first_test0809')\n    ssc = StreamingContext(sc, 1)\n    kinesis_stream = KinesisUtils.createStream(\n        ssc,\n        'ssc_kinesis',\n        'kinesistest',\n        'https://kinesis.us-west-2.amazonaws.com',\n        'region-name',\n        InitialPositionInStream.TRIM_HORIZON,\n        2,\n        awsAccessKeyId=aws_access_key_id,\n        awsSecretKey=aws_secret_access_key\n    )\n\n    kinesis_stream.pprint(500)\n\n    ssc.start()\n    ssc.awaitTermination()\n```\n\n`kinesistest`æ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªkinesis streamingï¼Œä¼šæœ‰æºæºä¸æ–­çš„æ•°æ®å†™åˆ°è¿™ä¸ªstreamingé‡Œï¼ŒSparkè´Ÿè´£å¤„ç†è¿™ä¸ªstreamingé‡Œçš„æ•°æ®ã€‚\n\næ¥ä¸‹æ¥å°±æ˜¯å°†è¿™ä¸ªæ–‡ä»¶éƒ¨ç½²åˆ°EMRä¸Šï¼Œä¾ç„¶æ˜¯ç…§ç€æ–‡æ¡£æ¥æ“ä½œã€‚[æ–‡æ¡£åœ°å€](https://docs.aws.amazon.com/zh_cn/emr/latest/ReleaseGuide/emr-spark-submit-step.html)\n\nä¸å¾—ä¸è¯´ï¼ŒAWSçš„æ–‡æ¡£æ—¢ç®€çº¦åˆç®€å•ï¼Œå´ä¸æ˜äº†ï¼Œåœ¨è¿™ä¸ªæ–‡æ¡£çš„æŒ‡å¼•ä¸‹ï¼Œæ²¡æœ‰ä¸€æ¬¡æˆ‘æ˜¯é¡ºåˆ©èµ°é€šçš„ã€‚\n\næ·»åŠ Stepçš„å‘½ä»¤ï¼š\n\n```shell\naws emr add-steps --cluster-id j-2AXXXXXXGAPLF --steps Type=Spark,Name=\"Spark Program\",ActionOnFailure=CONTINUE,Args=[--class,org.apache.spark.examples.SparkPi,/usr/lib/spark/lib/spark-examples.jar,10]\n```\n\nè¿™ä¸ªå‘½ä»¤è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†æ¥çœ‹ï¼Œå‰éƒ¨åˆ†æ˜¯AWSè‡ªèº«çš„å‘½ä»¤`aws emr add-steps`ï¼Œåéƒ¨åˆ†å°±æ˜¯`Args`è¿™ä¸ªå‚æ•°çš„å€¼ã€‚\nå› ä¸ºéƒ¨ç½²Sparkç¨‹åºå®é™…ä¸Šç”¨çš„æ˜¯`spark-submit`å‘½ä»¤ï¼Œè€Œ`Args`çš„å€¼ï¼Œéƒ½ä¼šä¼ ç»™`spark-submit`ã€‚\n\nå‰åŠéƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œ`cluster-id`å°±æ˜¯åœ¨åˆ›å»ºEMRé›†ç¾¤åè‡ªåŠ¨ç”Ÿæˆçš„idï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ›å»ºçš„EMRé›†ç¾¤å¿…é¡»è¦è®¾ç½®å…±æœ‰IPï¼Œè¿™æ ·å¤–éƒ¨æœºå™¨æ‰èƒ½è®¿é—®åˆ°ã€‚`Type`å›ºå®šä¸ºSparkï¼Œ`Name`è‡ªå·±éšä¾¿å†™ï¼Œ`ActionOnFailure`ä¸€èˆ¬éƒ½ä¼ CONTINUEï¼Œå…¶ä»–å¯é€‰å€¼å¯é€šè¿‡`aws emr add-steps help`æŸ¥çœ‹ã€‚\n\nååŠéƒ¨åˆ†çš„`Args`çš„ç›¸å…³è¯´æ˜åœ¨[è¿™é‡Œ](https://github.com/apache/spark/blob/branch-1.3/core/src/main/scala/org/apache/spark/deploy/SparkSubmitArguments.scala#L454)ï¼Œè¯´çš„å¾ˆè¯¦ç»†ã€‚\n\nåœ¨éƒ¨ç½²è¿è¡Œä¹‹åï¼Œä¼šæŠ¥ä¸€äº›`ClassNotFound`çš„é”™è¯¯ï¼Œè¿™ç§é”™è¯¯ä¸è¦ç´§ï¼ŒæŠŠç¼ºçš„jaræ–‡ä»¶å½“ä½œå‚æ•°ä¼ ä¸Šå»å°±èƒ½è§£å†³é—®é¢˜ã€‚[Mavenæœç´¢åœ°å€1](https://mvnrepository.com/) | [Mavenæœç´¢åœ°å€2](https://search.maven.org/)\n\nä¸Šé¢çš„main.pyç”¨åˆ°äº†ä¸¤ä¸ªæ²¡æœ‰çš„jaræ–‡ä»¶ï¼Œkinesisiå’Œkclï¼Œä¸ºäº†ä¾¿äºè§‚çœ‹ï¼Œä½¿ç”¨äº†å¦ä¸€ç§æ ¼å¼ï¼Œå¦‚ä¸‹ï¼š\n\n```shell\n$ aws emr add-steps --cluster-id j-2AXXXXXXGAPLF --steps file://./step.json\n```\n\nå°†å‚æ•°éƒ½æŠ½å–åˆ°ä¸€ä¸ªjosnæ–‡ä»¶ä¸­ï¼š\n```json\n[\n  {\n    \"Name\": \"Spark Program\",\n    \"Type\": \"Spark\",\n    \"ActionOnFailure\": \"CONTINUE\",\n    \"Args\": [\n      \"--master\",\n      \"local\",\n      \"--jars\",\n      \"local:///home/hadoop/spark-streaming-kinesis-asl_2.11-2.4.3.jar,local:///home/hadoop/amazon-kinesis-client-1.11.1.jar\",\n      \"local:///home/hadoop/main.py\"\n    ]\n  }\n]\n```\n\næ³¨æ„ï¼Œå‘½ä»¤ä¸­æ‰€ç”¨åˆ°çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬jarå’Œpyï¼Œéƒ½éœ€è¦æå‰ä¸Šä¼ åˆ°æœºå™¨ä¸Šã€‚å…·ä½“ä¸Šä¼ æ–¹æ³•è§`aws emr put`å‘½ä»¤\n\nè‡³æ­¤ï¼Œæ‰€æœ‰çš„å·¥ä½œåŸºæœ¬å®Œæˆï¼Œä½ ä»¥ä¸ºè¿™æ ·å°±å¯ä»¥è·‘èµ·æ¥äº†å—ï¼Ÿ\nNOï¼\n\næœ€éº»çƒ¦çš„é—®é¢˜ï¼Œå°±æ˜¯Sparkç‰ˆæœ¬çš„é—®é¢˜ã€‚ä¹‹å‰ç”¨çš„æœ€å¤šã€æœ€ç¨³å®šçš„å°±æ˜¯1.6.5ç‰ˆæœ¬çš„ï¼Œç°åœ¨æœ€æ–°ç‰ˆå·²ç»2.4.3äº†ï¼Œé‡Œé¢å˜åŠ¨ä¸å°ï¼Œå°¤å…¶æ˜¯`Logging`è¿™ä¸ªç±»ï¼Œç›´æ¥å†…éƒ¨åŒ–äº†ã€‚\n\nä»”ç»†çœ‹ä¼šå‘ç°ï¼Œä¸Šé¢çš„kinesis jaræ–‡ä»¶æœ‰ä¸¤ä¸ªç‰ˆæœ¬å·ï¼š2.11-2.4.3ï¼Œåé¢çš„2.4.3æ˜¯Sparkå¤§ç‰ˆæœ¬ï¼Œå‰é¢çš„æ˜¯ä»€ä¹ˆæˆ‘æ²¡æŸ¥ã€‚åœ¨Mavené‡Œï¼Œè¿™ä¸ªç‰ˆæœ¬æœ€æ–°çš„æ˜¯2.12ï¼Œæ‰€ä»¥æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ç›´æ¥ç”¨äº†æœ€æ–°çš„ï¼Œå› ä¸ºç½‘ä¸Šä¸€ç›´åœ¨å¼ºè°ƒçš„éƒ½æ˜¯åé¢çš„2.4.3è¿™ä¸ªç‰ˆæœ¬å·ï¼Œç»“æœå°±å‡ºé—®é¢˜äº†ï¼Œå¦‚é¢˜æ‰€å†™ï¼Œæ€»æ˜¯æŠ¥NoSuchMethodErrorã€‚\n\n2.0ä¹‹å‰çš„ï¼ŒLoggingçš„ä½ç½®æ˜¯org.apache.spark.Loggingï¼Œ2.0ä¹‹åå˜æˆäº†org.apache.spark.internal.Loggingï¼Œä½†æˆ‘ç”¨çš„éƒ½æ˜¯æœ€æ–°ç‰ˆï¼Œä¸ºä»€ä¹ˆæ€»è¯´æ‰¾ä¸åˆ°å‘¢ï¼Ÿæƒ³äº†æƒ³ï¼Œæƒ³äº†åˆæƒ³ï¼Œè¯•äº†å„ç§åŠæ³•ï¼Œéƒ½è¡Œä¸é€šï¼Œè¿™ä¸ªè¿‡ç¨‹æŒç»­äº†ä¸€å¤©å¤šï¼Œè®©äººå¤´å¤§ã€‚\n\nåæ¥ä¸çŸ¥æ˜¯å·§åˆï¼Œè¿˜æ˜¯æ—¶å€™åˆ°äº†ï¼Œå¶ç„¶å‘ç°clusteræœºå™¨ä¸Šspark-coreçš„ç‰ˆæœ¬å·æ˜¯2.11-2.4.3ï¼ŒæŠ¥ç€å°è¯•çš„å¿ƒæ€ä»Mavenä¸‹äº†2.11-2.4.3çš„kinesis jaræ–‡ä»¶ï¼Œæ¢ä¸Šå»ä¸€è·‘ï¼Œå“ï¼Œå°±è¿™ä¹ˆæˆäº†ã€‚çœŸæ˜¯æ°”äººã€‚\n\næ‰€ä»¥è¯´å‘¢ï¼Œæœ‰äº›æ—¶å€™è§£å†³é—®é¢˜æ˜¯å¾ˆç®€å•çš„ï¼Œå›°éš¾çš„æ˜¯å‘ç°é—®é¢˜ã€‚\n","tags":["AWS","EMR"],"categories":["Spark"]},{"title":"æ‘¸æ‘¸ã€Œæµ®ç‚¹æ•°ã€çš„åº•","url":"/2019/06/3754d5b7c490/","content":"\n> æ‘†ç†è®ºå’Œå¥—å…¬å¼å…¶å®ä¹Ÿæ˜¯ä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œè§£é‡ŠåŸç†ï¼Œä¸è¿‡æœ‰æ—¶å´é€‚å¾—å…¶åã€‚\n\n\n\nå‰ä¸€ä¸ªä¸»é¢˜ä»‹ç»äº†æ•´æ•°åœ¨è®¡ç®—æœºé‡Œçš„å­˜å‚¨å½¢å¼ï¼Œæµ®ç‚¹æ•°ï¼Œå³å°æ•°ï¼Œä¾‹å¦‚ 3.14ã€2.71828 ç­‰ï¼Œçœ‹èµ·æ¥å’Œæ•´æ•°ç›¸è¿‘ï¼Œè€ŒäºŒè€…åœ¨è®¡ç®—æœºä¸­å­˜å‚¨çš„å½¢å¼å¤§ä¸ºä¸åŒï¼Œä½œä¸ºä¸€ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œæ¥äº†è§£äº†è§£å…¶ä¸­çš„æœ¬è´¨ï¼Œè¿™ä¸ªä¸»é¢˜æˆ‘ä»¬ä¸€èµ·æ¥æ‘¸æ‘¸ã€Œæµ®ç‚¹æ•°ã€çš„åº•ã€‚\n\n\n\næµ®ç‚¹æ•°æœ‰å¤šç§ç±»å‹ï¼Œ*ä½†æ˜¯æˆ‘ä»¬å†™ä»£ç æ—¶å¸¸ç”¨åˆ°çš„æœ‰ä¸¤ç§*ï¼ŒæŒ‰ç…§æ‰€å é•¿åº¦åˆ†ä¸ºï¼šä¸€ä¸ªæ˜¯å•ç²¾åº¦ï¼Œå ç”¨ 32 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå¦ä¸€ä¸ªæ˜¯åŒç²¾åº¦ï¼Œå ç”¨ 64 ä¸ªäºŒè¿›åˆ¶ä½ã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹ã€å ç”¨å¤šå°‘ä½ï¼Œå­˜å‚¨çš„**æ¨¡å¼**éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œè€Œè¿™ä¹Ÿæ­£æ˜¯æˆ‘ä»¬æƒ³è¦æ‘¸çš„ã€Œåº•ã€ã€‚\n\n\n\n##### 1. åŒ–èº«ä¸ºäºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°\n\né¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œä¸ç®¡ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œæ•´æ•°ä¹Ÿå¥½ï¼Œæµ®ç‚¹æ•°ä¹Ÿç½¢ï¼Œåœ¨è®¡ç®—æœºä¸­éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨ï¼Œå³ 01001ã€10110 è¿™æ ·çš„å½¢å¼ã€‚\n\n\n\né‚£ä¹ˆï¼ŒäºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°è¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿ\n\n\n\nåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åè¿›åˆ¶çš„å°æ•° 22.71æ˜¯å¦‚ä½•è¡¨ç¤ºçš„ï¼š**å°æ•°ç‚¹å·¦è¾¹ç¬¬ä¸€ä½ä¸ºä¸ªä½ï¼Œè¡¨ç¤º 1ï¼Œç¬¬äºŒä½ä¸ºåä½ï¼Œè¡¨ç¤º 10ï¼›å°æ•°ç‚¹å³è¾¹ç¬¬ä¸€ä½ä¸ºååˆ†ä½ï¼Œè¡¨ç¤º 1/10ï¼Œå³ 10^<sup>-1</sup>ï¼Œç¬¬äºŒä½ä¸ºç™¾åˆ†ä½ï¼Œè¡¨ç¤º 1/100ï¼Œå³ 10^<sup>-2</sup>ï¼Œç»¼åˆå¦‚ä¸‹**ã€‚\n\n```java\n22.71 = 2*10^1 + 2*10^0 + 7*10^-1 + 1*10^-2\n      = 20 + 2 + 0.7 + 0.01\n      = 22.71\n```\n\n\n\nä¸Šé¢å°±æ˜¯åè¿›åˆ¶æµ®ç‚¹æ•°çš„è¡¨ç¤ºå½¢å¼ï¼Œè€ŒäºŒè¿›åˆ¶ä¸åè¿›åˆ¶æ•´ä½“ç›¸åŒï¼Œå”¯ä¸€åŒºåˆ«å°±åœ¨äºå°† 10 æ¢æˆäº† 2ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚äºŒè¿›åˆ¶æµ®ç‚¹æ•° 101.11ï¼š**å°æ•°ç‚¹å·¦è¾¹ç¬¬ä¸€ä½è¡¨ç¤º 2^<sup>0</sup>ï¼Œå³ 1ï¼Œç¬¬äºŒä½è¡¨ç¤º 2^<sup>1</sup>ï¼Œå³ 2ï¼Œç¬¬ä¸‰ä½è¡¨ç¤º2^<sup>2</sup>ï¼Œå³ 4ï¼›å°æ•°ç‚¹å³è¾¹ç¬¬ä¸€ä½è¡¨ç¤º 2^<sup>-1</sup>ï¼Œå³ 0.5ï¼Œç¬¬äºŒä½è¡¨ç¤º 2^<sup>-2</sup>ï¼Œå³ 0.25ï¼Œç»¼åˆå¦‚ä¸‹**ã€‚\n\n```java\n101.11 = 1*2^2 + 0*2^1 + 1*2^0 + 1*2^-1 + 1*2-2\n       = 4 + 0 + 1 + 0.5 + 0.25\n       = 5.75\n```\n\n\n\n##### 2. è‡ªç”±è½¬åŒ–çš„æµ®ç‚¹æ•°\n\næ—¢ç„¶ï¼Œæµ®ç‚¹æ•°æ—¢å¯ä»¥ç”¨åè¿›åˆ¶è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œé‚£ä¹ˆåŒä¸€ä¸ªæµ®ç‚¹æ•°å¦‚ä½•åœ¨è¿™ä¸¤ç§è¿›åˆ¶ä¹‹é—´è‡ªç”±è½¬åŒ–å‘¢ï¼Ÿç”±äºŒè¿›åˆ¶è½¬ä¸ºåè¿›åˆ¶å°±ä¸ç”¨è¯´äº†ï¼Œä¸Šé¢åˆšåˆšç”¨ 101.11 æ¼”ç¤ºå®Œï¼Œè€Œç”±åè¿›åˆ¶è½¬ä¸ºäºŒè¿›åˆ¶å¾ˆå¤šäººéƒ½æ˜¯ç›´æ¥å¥—å…¬å¼å´æ²¡æƒ³è¿‡åŸç†ï¼Œæ¥ä¸‹æ¥è¯´è¯´æ¨å¯¼å…¬å¼çš„è¿‡ç¨‹ã€‚**è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹éœ€è¦å°†æµ®ç‚¹æ•°çš„æ•´æ•°éƒ¨åˆ†å’Œå°æ•°åˆ†åˆ«è½¬åŒ–ï¼Œä¹‹åå†è¿›è¡Œåˆå¹¶**ã€‚\n\n\n\næˆ‘ä»¬ç”¨ 6.625 æ¥ä¸¾ä¾‹è¯´æ˜ã€‚å…ˆçœ‹æ•´æ•°éƒ¨åˆ†çš„ 6ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ï¼Œç»“æœæ˜¯ 110ï¼Œä½†æ˜¯å¦‚æœæ¢æˆ 60ã€600ï¼Œè¿™äº›ä¸èƒ½ä¸€çœ¼çœ‹å‡ºçš„æ•°å‘¢ï¼Ÿå…¶å®å¾ˆå¤šäº‹æƒ…éƒ½æ˜¯å¦‚æ­¤ï¼Œå°†æ€è€ƒè¿‡ç¨‹ä»ã€Œä¸€çœ¼å°±èƒ½çœ‹å‡ºçš„ã€çš„æƒ…å†µä¸­æŠ½è±¡å‡ºæ¥ï¼Œå°±æ˜¯è®¡ç®—æ–¹æ³•ã€‚è¿™ä¸ªæ€è€ƒè¿‡ç¨‹æ— éå°±æ˜¯ï¼Œæƒ³çŸ¥é“éœ€è¦å‡ ä¸ªäºŒè¿›åˆ¶ä½ã€æ¯ä¸ªäºŒè¿›åˆ¶çš„å€¼æ˜¯å¤šå°‘ï¼Œå°±å¯ä»¥è¡¨ç¤º 6ã€‚\n\n\n\nä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è®¡ç®—è¡¨ç¤º 758 éœ€è¦å‡ ä¸ªåè¿›åˆ¶ä½ä»¥åŠæ¯ä½çš„å€¼æ˜¯å¤šå°‘ã€‚\n\n\n\n```java\nå…ˆä»ä¸ªä½ï¼Œå³å³èµ·ç¬¬ä¸€ä½å¼€å§‹:\n\nå¾ˆæ˜¾ç„¶ï¼Œæ±‚ä¸ªä½çš„å€¼ç”¨ 758 å¯¹ 10 å–ä½™å³å¯ï¼š758 / 10 = 75Â·Â·Â·8ï¼Œç»“æœä¸º 8ï¼Œæ­¤æ—¶åŸæ•°è¿˜å‰©ä¸‹ 75*10ï¼Œå¤§äº 0ï¼Œè¯´æ˜ä¸€ä½ä¸å¤Ÿï¼›\n\nç»§ç»­æ±‚ç¬¬äºŒä½çš„å€¼ï¼š75*10 / 100 = 75 / 10 = 7Â·Â·Â·5ï¼Œç»“æœä¸º 5ï¼Œæ­¤æ—¶åŸæ•°è¿˜å‰©ä¸‹ 7*100ï¼Œå¤§äº 0ï¼Œè¯´æ˜ä¸¤ä½è¿˜æ˜¯ä¸å¤Ÿï¼›\n\nç»§ç»­æ±‚ç¬¬ä¸‰ä½çš„å€¼ï¼š7*100 / 1000 = 7 / 10 = 0Â·Â·Â·7ï¼Œç»“æœä¸º 7ï¼Œæ­¤æ—¶åŸæ•°è¿˜å‰©ä¸‹ 0*1000ï¼Œç­‰äº 0ï¼Œè¯´æ˜ä¸‰ä½åè¿›åˆ¶å¤Ÿç”¨äº†ã€‚\n\næœ€ç»ˆç»“æœï¼Œéœ€è¦ 3 ä¸ªåè¿›åˆ¶ä½ï¼Œä»å·¦åˆ°å³çš„å€¼åˆ†åˆ«æ˜¯ 7ã€5ã€8ï¼Œå³ 758ã€‚\n\nåŒæ—¶æˆ‘ä»¬å‘ç°çš„ä¸€ä¸ªè§„å¾‹æ˜¯ï¼š\næ±‚ç¬¬äºŒä½çš„å€¼æ—¶ï¼Œç”¨è®¡ç®—å®Œç¬¬ä¸€ä½çš„å•†å¯¹ 10 å–ä½™å³å¯ï¼Œ\næ±‚ç¬¬ä¸‰ä½çš„å€¼æ—¶ï¼Œç”¨è®¡ç®—å®Œç¬¬äºŒä½çš„å•†å¯¹ 10 å–ä½™å³å¯ã€‚\n```\n\n**ç”±æ­¤å¯å¾—ï¼Œæ±‚ç¬¬ n ä½çš„å€¼æ—¶ï¼Œç”¨è®¡ç®—å®Œ n-1 ä½çš„å•†å¯¹ 10 å–ä½™æ•°å³å¯ï¼Œå½“å•†ä¸º 0 æ—¶ï¼Œç»“æŸï¼Œæ³¨æ„ n > 1ã€‚**å¦‚ä¸Šï¼Œå°±æ˜¯åè¿›åˆ¶æŠ½å–æ–¹æ³•çš„è¿‡ç¨‹ï¼Œä¹ŸåŒæ ·é€‚ç”¨äºäºŒè¿›åˆ¶ï¼ŒåŒºåˆ«å°±åœ¨äºå°† 10 æ¢æˆäº† 2ï¼Œå®é™…è®¡ç®—ä¸€ä¸‹ã€‚\n\n```java\nè®¡ç®—å°† 6 ç”¨äºŒè¿›åˆ¶çš„å€¼ï¼ŒåŒæ ·ä»å³èµ·çš„ç¬¬ä¸€ä½å¼€å§‹ï¼š\n\nå…ˆæ±‚ç¬¬ä¸€ä½ï¼š6 / 2 = 3Â·Â·Â·0ï¼Œç»“æœä¸º 0ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ 3*2^1ï¼Œå¤§äº 0ï¼Œè¯´æ˜ä¸€ä½ä¸å¤Ÿï¼›\n\nç»§ç»­æ±‚ç¬¬äºŒä½ï¼Œ3 / 2 = 1Â·Â·Â·1ï¼Œç»“æœä¸º 1ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ 1*2^2ï¼Œå¤§äº 0ï¼Œè¯´æ˜ä¸¤ä½ä¸å¤Ÿï¼›\n\nç»§ç»­æ±‚ç¬¬ä¸‰ä½ï¼Œ1 / 2 = 0Â·Â·Â·1ï¼Œç»“æœä¸º 1ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ 0*2^3ï¼Œç­‰äº 0ï¼Œè¯´æ˜ä¸‰ä½äºŒè¿›åˆ¶å¤Ÿäº†ã€‚\n\næœ€ç»ˆç»“æœï¼Œéœ€è¦ 3 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä»å·¦åˆ°å³çš„å€¼åˆ†åˆ«æ˜¯ 1ã€1ã€0ï¼Œå³ 110ï¼Œè€Œè¿™ä¹Ÿä¸æˆ‘ä»¬ç›´è§‚ä¸Šçœ‹åˆ°çš„ç»“æœç›¸ç¬¦ã€‚\n```\n\n\n\nä¸æ•´æ•°éƒ¨åˆ†çš„è®¡ç®—ç±»ä¼¼ï¼Œå†çœ‹ä¸‹å°æ•°éƒ¨åˆ†çš„è®¡ç®—ã€‚åŒæ ·ï¼Œå…ˆç”¨æ¯”è¾ƒç›´è§‚çš„åè¿›åˆ¶æµ®ç‚¹æ•°ä¸¾ä¾‹ï¼Œä»è€Œä»ä¸­æ€»ç»“è§„å¾‹ã€‚\n\n```java\nè®¡ç®— 0.358 ç”¨å‡ ä½åè¿›åˆ¶çš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼ŒåŠæ¯ä½çš„å€¼çš„è¿‡ç¨‹ï¼Œä»å·¦å¼€å§‹ï¼Œ\n\nå…ˆæ±‚ç¬¬ä¸€ä½ï¼Œæ³¨æ„ï¼Œä¸æ•´æ•°ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œæ˜¯å–å•†ï¼Œè€Œä¸æ˜¯ä½™æ•°ï¼š\n0.358 / 10^-1 = 0.358 * 10 = 3Â·Â·Â·0.58ï¼Œç»“æœæ˜¯ï¼š3ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ï¼š0.58*10^-1 > 0;\nç»§ç»­æ±‚ç¬¬äºŒä½ï¼Œ\n0.58*10^-1 / 10^-2 = 0.58 * 10 = 5Â·Â·Â·0.8ï¼Œç»“æœæ˜¯ï¼š5ï¼Œè¿˜å‰©ä¸‹ï¼š0.8*10^-2 > 0;\nç»§ç»­æ±‚ç¬¬ä¸‰ä½ï¼Œ\n0.8*10^-2 / 10^-3 = 0.8 * 10 = 8Â·Â·Â·0ï¼Œç»“æœæ˜¯ï¼š8ï¼Œè¿˜å‰©ä¸‹ï¼š0ï¼Œè¯´æ˜ 3 ä½åè¿›åˆ¶å¤Ÿäº†ã€‚\n\næœ€ç»ˆç»“æœï¼Œéœ€è¦ 3 ä¸ªåè¿›åˆ¶ï¼Œä»å³å‘å·¦åˆ†åˆ«æ˜¯ 3ã€5ã€8ï¼Œå³ 0.358ã€‚\n\nåŒæ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼š\næ±‚ç¬¬äºŒä½æ—¶ï¼Œç”¨è®¡ç®—å®Œç¬¬ä¸€ä½çš„ä½™æ•°ä¹˜ 10 å†å–å•†å³å¯ï¼Œ\næ±‚ç¬¬ä¸‰ä½æ—¶ï¼Œç”¨è®¡ç®—å®Œç¬¬äºŒä½çš„ä½™æ•°ä¹˜ 10 å†å–å•†å³å¯ã€‚\n```\n\n**ç”±æ­¤å¯å¾—ï¼Œè®¡ç®—ç¬¬ n ä½æ—¶ï¼Œç”¨è®¡ç®—å®Œç¬¬ n-1 ä½çš„ä½™æ•°ä¹˜ 10 å†å–å•†å³å¯ï¼Œå½“ä½™æ•°ç­‰äº 0 æ—¶ç»“æŸï¼Œæ³¨æ„ n > 1ã€‚**ç´§æ¥ç€ï¼Œç”¨æˆ‘ä»¬ä»ä¸Šé¢åè¿›åˆ¶ä¾‹å­ä¸­æ€»ç»“çš„æ–¹æ³•è®¡ç®—ä¸‹äºŒè¿›åˆ¶ã€‚\n\n```java\nè®¡ç®— 6.625 çš„å°æ•°éƒ¨åˆ† 0.625 çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œä»å·¦å¼€å§‹ï¼Œ\n\nå…ˆæ±‚ç¬¬ä¸€ä½ï¼Œ0.625 * 2 = 1Â·Â·Â·0.25ï¼Œç»“æœæ˜¯ 1ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ï¼š0.25*2^-1 > 0ï¼›\nç»§ç»­æ±‚ç¬¬äºŒä½ï¼Œ0.25 * 2 = 0Â·Â·Â·0.5ï¼Œç»“æœæ˜¯ 0ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ï¼š0.5*2^-2 > 0ï¼›\nç»§ç»­æ±‚ç¬¬ä¸‰ä½ï¼Œ0.5 * 2 = 1Â·Â·Â·0ï¼Œç»“æœæ˜¯ 1ï¼ŒåŸæ•°è¿˜å‰©ä¸‹ï¼š0ï¼Œç»“æŸã€‚\n\næœ€ç»ˆç»“æœï¼Œéœ€è¦ 3 ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä»å·¦å‘å³åˆ†åˆ«æ˜¯ï¼š1ã€0ã€1ï¼Œå³ 0.101ã€‚\n```\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰è®¡ç®—è¿‡ç¨‹ï¼Œæ•´æ•°éƒ¨åˆ†ï¼š110ï¼Œå°æ•°éƒ¨åˆ†ï¼š101ï¼Œæœ€ç»ˆç»“æœä¸ºï¼š110.101ã€‚\n\n\n\n##### 3. å¦‚ä½•å­˜å‚¨\n\nå‰é¢åšäº†é‚£ä¹ˆå¤šé“ºå«ï¼Œç°åœ¨ç»ˆäºå¯ä»¥å¼€å§‹è¯´å­˜å‚¨äº†ã€‚å­˜å‚¨ä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠäºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼Œä¹Ÿç§°è§„èŒƒåŒ–ï¼Œå³ \n\n**N = Â±a x 2^<sup>n</sup>** , aâˆˆ **[1,2)**\n\n**a** å«ä½œå°¾æ•°ï¼Œ**n** å«ä½œé˜¶ç ã€‚è®¡ç®—æœºå­˜å‚¨çš„æµ®ç‚¹æ•°éƒ½æ˜¯è¿™ç§å½¢å¼çš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„ 110.101 å°±éœ€è¦å˜æˆ 1.10101x2^<sup>2</sup>ï¼Œè€Œ 0.1101 å°±éœ€è¦å˜æˆ 1.101x2^<sup>-1</sup>ï¼Œè¿™ä¸ªå˜æ¢çš„è¿‡ç¨‹å¾ˆç®€å•ã€‚\n\n\n\nå¯¹äºæµ®ç‚¹æ•° **Â±a\\*2^<sup>n</sup>**ï¼Œè®¡ç®—æœºå°†å…¶åˆ†æˆäº† 3 ä¸ªéƒ¨åˆ†æ¥è¿›è¡Œå­˜å‚¨ï¼Œå³å­˜å‚¨æ­£è´Ÿçš„**ç¬¦å·ä½**ã€å­˜å‚¨ n çš„**æŒ‡æ•°åŸŸ**å’Œå­˜å‚¨ a çš„**å°¾æ•°åŸŸ**ï¼Œæ˜¯çš„ï¼Œå­˜å‚¨ a çš„éƒ¨åˆ†å«åš**å°¾æ•°åŸŸ**ã€‚\n\n\n\nå¯¹äºé•¿åº¦ä¸º 32 ä½äºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°ï¼Œä»å·¦èµ·ï¼Œç¬¬ 1 ä½ç”¨æ¥è¡¨ç¤ºç¬¦å·ï¼Œ0 ä»£è¡¨æ­£æ•°ï¼Œ1 ä»£è¡¨è´Ÿæ•°ã€‚æ¥ä¸‹æ¥çš„ 8 ä½ï¼Œå³ç¬¬ 2 ä½åˆ°ç¬¬ 9 ä½ï¼Œç”¨æ¥è¡¨ç¤ºæŒ‡æ•°ã€‚è€Œä»ç¬¬ 10 ä½å¼€å§‹ä¸€ç›´åˆ°æœ€åçš„ 32 ä½ï¼Œéƒ½ç”¨æ¥è¡¨ç¤ºå°¾æ•°ï¼Œå¯¹äºç§‘å­¦è®¡æ•°æ³•ä¸‹çš„ aï¼Œå…¶æ•´æ•°éƒ¨åˆ†çš„å€¼æ°¸è¿œéƒ½æ˜¯ 1ï¼Œæ‰€ä»¥è¿™ä¸ª 1 å°±çœç•¥äº†ï¼Œå› æ­¤ 23 ä½å°¾æ•°äºŒè¿›åˆ¶åªå­˜å‚¨äº† a çš„å°æ•°éƒ¨åˆ†ï¼Œå³ 1.10101 çš„ 10101ï¼Œ1.101 çš„ 101ã€‚\n\n\n\nå’Œ 32 ä½ç±»ä¼¼ï¼Œé•¿åº¦ä¸º 64 ä½äºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°ï¼Œä»å·¦èµ·ï¼Œç¬¬ä¸€ä½å­˜å‚¨ç¬¦å·ï¼Œæ¥ä¸‹æ¥çš„ 11 ä½å­˜å‚¨æŒ‡æ•°ï¼Œå‰©ä¸‹çš„ 52 ä½å­˜å‚¨å°¾æ•°ï¼Œè€Œå°¾æ•°åŒæ ·çœç•¥äº† a çš„æ•´æ•°éƒ¨åˆ†ï¼Œåªå­˜å‚¨å°æ•°éƒ¨åˆ†ã€‚\n\n\n\n##### 4. é˜¶ç \n\nç¬¦å·ä½ï¼Œ0 æˆ– 1ï¼Œå°¾æ•°åŸŸï¼Œé‡‡ç”¨åŸç è¡¨ç¤ºï¼Œè¿™ä¸¤ç§æ¯”è¾ƒç®€å•æ˜äº†ï¼Œè¿™é‡Œè¦å•ç‹¬è¯´ä¸€è¯´é˜¶ç ã€‚\n\n\n\nåœ¨æ­¤ä¹‹å‰ï¼Œå…ˆå›å¿†ä¸€ä¸‹ç§»ç ã€‚æ‰€è°“ç§»ç ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠè´Ÿæ•°æ˜ å°„åˆ°æ­£è½´ä¸Šï¼Œé€šä¿—çš„è¯´å°±æ˜¯æ¶ˆç­è´Ÿæ•°ã€‚ä¾‹å¦‚ï¼Œ4 ä¸ªbitä½èƒ½è¡¨ç¤ºçš„èŒƒå›´ï¼Œ[-2^<sup>3</sup>, 2^<sup>3</sup> - 1]ï¼Œå³[-8, 7]ã€‚æ¯ä¸ªæ•°å­—åŠ ä¸Šåç§»é‡ 2^<sup>3</sup>ï¼Œå³ä¸ºç§»ç ã€‚\n\n\n\né˜¶ç åœ¨è®¡ç®—æœºä¸­ä¹Ÿæ˜¯ä»¥ç§»ç çš„å½¢å¼å­˜å‚¨çš„ï¼ŒåŒºåˆ«åœ¨äºè¿™ä¸ªåç§»é‡ã€‚**æ ¹æ® IEEE 754 æ ‡å‡†ï¼Œk ä½äºŒè¿›åˆ¶ä½çš„è§£ç ï¼Œåç§»é‡ bias ä¸º 2^<sup>k-1</sup> - 1**ï¼Œä¾‹å¦‚ 32 ä½å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œé˜¶ç ä¸º 8 ä½ï¼Œåˆ™åç§»é‡ä¸º 2^<sup>8-1</sup> - 1 = 127ã€‚\n\n\n\n**N = (-1)^<sup>S</sup> x 2^<sup>E-Bias</sup> x (1+M)**\n\nå…¶ä¸­ï¼Œ**Sä¸ºç¬¦å·ä½çš„å€¼ï¼ŒEä¸ºæŒ‡æ•°çš„å€¼ï¼ŒMä¸ºå°¾æ•°åŸŸçš„å€¼ï¼ŒBiasä¸ºç§»ç åç§»é‡**ã€‚\n\n\n\nä¸¾ä¸ªä¾‹å­ï¼Œ-6.75ï¼Œ**å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œè½¬åŒ–ä¸ºè§„èŒƒåŒ–äºŒè¿›åˆ¶ä¸ºï¼š**-110.11 = -1.1011 x 2^<sup>2</sup>\n\nç¬¦å·ä½ **S = 1**ï¼Œ\n\né˜¶ç  **E = 2 + Bias = 2 + 127 = 129**\n\nå°¾æ•° **M = 1.1011 - 1 = 1011** (çœå»å°æ•°ç‚¹)\n\n**1 10000001 10110000000000000000000** ï¼ˆå°¾æ•°åŸŸï¼š4 ä½ç²¾åº¦ + 19 ä¸ª 0ï¼Œå…± 23 ä½ï¼‰\n\n\n\nè‡³æ­¤ï¼Œæµ®ç‚¹æ•°å°±ä»‹ç»å®Œäº†ã€‚\n\n\n\n","tags":["ç¼–ç ","æµ®ç‚¹æ•°"],"categories":["ç¼–ç "]},{"title":"ã€ŒåŸç  åç  è¡¥ç  ç§»ç ã€ä¸€æ¢ç©¶ç«Ÿï¼ˆä¸‹ï¼‰","url":"/2019/01/0a1eac4519fc/","content":"\n> æŠ›å¼€å¤æ‚çš„ç†è®ºï¼Œç›´æ¢äº‹ç‰©çš„æœ¬è´¨ã€‚\n\nè¿™æ˜¯è¿™ä¸ªä¸»é¢˜çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œå‰ä¸¤ç¯‡ä»‹ç»äº†**è¿™å‡ ç§ç çš„åŸºæœ¬æ¦‚å¿µ**ï¼Œè¿™ç¯‡æ–‡ç« æ¥å…·ä½“è¯´è¯´ã€Œç§»ç ã€ã€‚\n<!--more-->\n**00. å›é¡¾**\n\nå…ˆæ¥å›é¡¾ä¸€ä¸‹ç§»ç æ˜¯ä»€ä¹ˆï¼Œç®€å•è¯´å®šä¹‰å°±ä¸€å¥è¯ï¼š**å°†è¡¥ç ç¬¦å·ä½å–åï¼Œå³ä¸ºç§»ç **ã€‚ä¹ä¸€çœ‹ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹æ‡µï¼Œè¿™åˆ°åº•åœ¨è¯´ä»€ä¹ˆå‘¢ï¼Ÿä»€ä¹ˆæ˜¯ç§»ç ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™ä¹ˆç®—ï¼Ÿå®ƒèƒ½å¹²å˜›ç”¨ï¼Ÿè«æ€¥ï¼Œè¿™äº›é—®é¢˜ä¸€ä¸ªä¸€ä¸ªéƒ½ä¼šè§£å†³ã€‚\n\nç›¸æ¯”äºç§»ç ï¼Œåº”è¯¥ä½¿ç”¨è¡¥ç çš„å‡ ç‡æ›´é«˜ä¸€äº›ã€‚å› ä¸ºç§»ç ä¸»è¦ç”¨åœ¨æµ®ç‚¹æ•°çš„é˜¶ç ä¸­ï¼Œç”¨çš„è¾ƒå°‘ã€‚æ³¨æ„ï¼Œè¿™é‡Œåˆå‡ºæ¥äº†ä¸€ä¸ªæ–°åè¯ï¼Œã€Œé˜¶ç ã€ï¼Œå…³äºè¿™å—çš„å†…å®¹æ¯”è¾ƒä¹±ï¼Œä¼šå•ç‹¬å†™ä¸€ç¯‡æ–‡ç« æ¥è¯´ã€‚è€Œç°åœ¨åªéœ€è¦è®°ä½ä¸€å¥è¯ï¼Œ**ç§»ç çš„å‡ºç°å°±æ˜¯ä¸ºäº†æ¶ˆç­è´Ÿæ•°**ã€‚\n\n<!--more--> \n\n**01. å¦‚ä½•ã€Œæ¶ˆç­ã€è´Ÿæ•°**\n\n\nå…ˆæ‹¿å¤§å®¶éƒ½ç†Ÿæ‚‰çš„æ•°è½´ä¸¾ä¸ªä¾‹å­ã€‚\n![](https://i.loli.net/2021/07/07/cdtpFeLJPyw9Txl.png)\n\nå¦‚å›¾ï¼Œæ•°è½´ä¸Šä¸€å…±æœ‰ 5 ä¸ªç‚¹ï¼Œåˆ†åˆ«ä¸º -2ã€-1ã€0ã€1ã€2ï¼Œå…¶ä¸­æœ‰ 2 ä¸ªè´Ÿæ•°ï¼Œæ‰€è°“æ¶ˆç­è´Ÿæ•°ï¼Œå°±æ˜¯ç”¨ 5 ä¸ªéè´Ÿæ•°æ¥è¡¨ç¤ºè¿™ 5 ä¸ªç‚¹ï¼Œæ–¹æ³•å°±æ˜¯**å°† 0 å‘å·¦ç§»åŠ¨ä¸¤ä¸ªä½ç½®**ï¼Œå¦‚ä¸‹ã€‚\n![](https://i.loli.net/2021/07/07/HwXenQjWztJC2rY.png)\n\nå¾ˆç®€å•å§ï¼Œè¿™æ ·ä¸€ç§»åŠ¨è´Ÿæ•°å°±è¢«æ¶ˆç­äº†ï¼Œè€Œã€Œ**ç§»ç **ã€çš„è®¡ç®—å°±æ˜¯è¿™ä¸ªé“ç†ï¼Œè€Œ**å°† 0 å‘å·¦ç§»åŠ¨ 2 ä¸ªä½ç½®å°±ç­‰åŒäºå°†æ‰€æœ‰æ•°å­—åŠ  2**ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚å¾ˆæ˜¾ç„¶ï¼Œ**ç§»åŠ¨çš„ä½æ•°å°±æ˜¯è¡¨ç¤ºèŒƒå›´å†…è´Ÿæ•°çš„ä¸ªæ•°ã€‚**\n\n**02. ä¸ºä»€ä¹ˆæ˜¯è¡¥ç ç¬¦å·ä½å–åï¼Ÿ**\n\nå…ˆæ˜ç¡®ä¸€ç‚¹ï¼š**å› ä¸ºç§»ç éƒ½æ˜¯éè´Ÿæ•°ï¼Œä¸éœ€è¦ç¬¦å·ä½ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰çš„äºŒè¿›åˆ¶ä½éƒ½æ˜¯ç”¨æ¥è¡¨ç¤ºæ•°æ®çš„ã€‚**\n\næ¥ä¸‹æ¥ï¼Œæ ¹æ®ä¸Šé¢å¾—å‡ºçš„ç»“è®ºï¼Œæˆ‘ä»¬äº²è‡ªæ¥ç®—ä¸€ç®—ç§»ç ã€‚ä¸ºäº†ä¾¿äºè®¡ç®—ï¼Œå°±æ‹¿ 4 ä½äºŒè¿›åˆ¶æ¥ä¸¾ä¾‹ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œ4 ä½äºŒè¿›åˆ¶èƒ½è¡¨ç¤ºçš„èŒƒå›´ä¸º **[-2^3, 2^3-1] = [-8, 7]**ï¼Œå…¶ä¸­è´Ÿæ•°çš„ä¸ªæ•°ä¸º -1 åˆ° -8ï¼Œå…± **2^3** ä¸ªï¼Œä¹Ÿå°±æ˜¯ 8 ä¸ªï¼Œæ‰€ä»¥éœ€è¦å°† 0 å‘å·¦ç§»åŠ¨ 8 ä¸ªä½ç½®ï¼Œ**å³ç»™æ¯ä¸ªæ•°åŠ ä¸Š 8**ï¼Œå¦‚ä¸‹ã€‚\n\n```\n     è¡¥ç    +8  ç§»ç \n-8  [1000]  0 [0000]\n-7  [1001]  1 [0001]\n-6  [1010]  2 [0010]\n-5  [1011]  3 [0011]\n-4  [1100]  4 [0100]\n-3  [1101]  5 [0101]\n-2  [1110]  6 [0110]\n-1  [1111]  7 [0111]\n 0  [0000]  8 [1000]\n 1  [0001]  9 [1001]\n 2  [0010] 10 [1010]\n 3  [0011] 11 [1011]\n 4  [0100] 12 [1100]\n 5  [0101] 13 [1101]\n 6  [0110] 14 [1110]\n 7  [0111] 15 [1111]\n```\n\nä¸Šé¢è¿™æ ·å¯¹æ¯”ç€çœ‹ï¼Œåº”è¯¥å¾ˆæ¸…æ™°äº†ã€‚ç»è¿‡è®¡ç®—å¾—å‡ºçš„ç§»ç ï¼Œåˆšå¥½ç­‰äºè¡¥ç ç¬¦å·ä½å–åï¼Œæ‰€ä»¥ç§»ç çš„å®šä¹‰å°±ç®€åŒ–æˆäº†ä¸€å¥è¯ï¼šå°†è¡¥ç ç¬¦å·ä½å–åï¼Œå³ä¸ºç§»ç ã€‚\n\nå†è¯´ä¸€ä¸ªæœ‰ç‚¹ä¸å¥½ç†è§£çš„æ–¹æ³•ï¼Œè§‰å¾—å•°å—¦ç•¥è¿‡å°±å¥½ã€‚é™¤å»é¦–ä½çš„ç¬¦å·ä½ä¸çœ‹ï¼Œå•çœ‹å‰©ä¸‹çš„  3 ä½äºŒè¿›åˆ¶ï¼Œ-8 åˆ° -1 æœ¬èº«å°±ç¬¦åˆä»å°åˆ°å¤§çš„è§„å¾‹ï¼Œè€Œ 0 åˆ° 7 ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½† [0,7] è¦å¤§äº  [-1,-8]ï¼Œå¼ºè½¬æˆæ— ç¬¦å·æ•°ï¼Œç”¨ç¬¦å·ä½çš„ 0 å’Œ 1 ä¸¤ä¸ªå€¼ä¾¿å¯ä»¥åŒºåˆ†åŸæœ¬çš„ 8 ä¸ªè´Ÿæ•°å’Œ 8 ä¸ªéè´Ÿæ•°ï¼Œ**æœ€ç»ˆå°±æ˜¯å°†è´Ÿæ•°è½¬åŒ–ä¸ºäº†æ­£æ•°ï¼Œå°†æ­£æ•°è½¬åŒ–ä¸ºäº†æ›´å¤§çš„æ­£æ•°**ã€‚\n\n**ç»“æŸ**\n\nè‡³æ­¤ï¼Œå…³äºã€Œ**åŸç  åç  è¡¥ç  ç§»ç **ã€ä¸»é¢˜çš„æ–‡ç« å°±å‘Šä¸€æ®µè½äº†ã€‚\n\næ®µé¦–å†™äº†è¿™ä¹ˆä¸€å¥è¯ï¼šã€Œ**æŠ›å¼€å¤æ‚çš„ç†è®ºï¼Œç›´æ¢äº‹ç‰©çš„æœ¬è´¨**ã€ã€‚æˆ‘æ˜¯è¿™ä¹ˆç†è§£è¿™å¥è¯çš„ï¼Œè®²ä¸€æ ·ä¸œè¥¿ï¼Œåªæœ‰æŠŠæ²¡ä»€ä¹ˆåŸºç¡€çš„äººéƒ½è¯´æ˜ç™½äº†ï¼Œè¯´æ‡‚äº†ï¼Œä¹Ÿä¸ç”¨è¿‡å¤šçš„æ‘†ç†è®ºã€å¥—å…¬å¼ï¼Œè¿™æ ·æ‰ç®—æ˜¯çœŸçš„è®²é€å½»äº†ï¼Œè¯è™½ä¿—ï¼Œç†ä¸ä¿—ã€‚\n","tags":["ç¼–ç "],"categories":["ç¼–ç "]},{"title":"ã€ŒåŸç  åç  è¡¥ç  ç§»ç ã€ä¸€æ¢ç©¶ç«Ÿï¼ˆä¸­ï¼‰","url":"/2019/01/76011953e8ea/","content":"---\nä¸Šæ–‡ã€ŒåŸç  åç  è¡¥ç  ç§»ç ã€ä¸€æ¢ç©¶ç«Ÿï¼ˆä¸Šï¼‰è¯´äº†åŸºæœ¬å®šä¹‰å’ŒåŸç ï¼Œå¯¹äºè¡¥ç ï¼Œæˆ‘ä»¬åªçŸ¥é“æ˜¯å¯¹åŸç ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä»–ä½ç½®å–åï¼Œæœ€åå†åŠ  1 å¾—æ¥çš„ï¼Œä¸ºä½•å¦‚æ­¤å‘¢ï¼Ÿæ¥ä¸‹æ¥å’±ä»¬æ¥æ­ä¸‹ã€Œè¡¥ç ã€çš„é¢å…·ï¼Œçœ‹çœ‹å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆã€‚\n\n<!--more--> \n\n**0. å…³äº 1 + (-1)**\n\né¦–å…ˆï¼Œå…ˆçœ‹ä¸€ä¸ªé—®é¢˜ã€‚\n\n1 çš„åŸç ä¸º[0000 0001]ï¼Œ-1 çš„åŸç ä¸º[1000 0001]ï¼Œæ‰€ä»¥è®¡ç®—è¿™ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š\n\n```\n1 + (-1) \n\n= [0000 0001]åŸ + [1000 0001]åŸ \n\n= [1000 0010]åŸ \n\n= -2\n```\n\nç»“æœç«Ÿç„¶æ˜¯ -2ï¼Œå¾ˆæ˜æ˜¾æ˜¯é”™çš„ï¼Œè¿™æ ·ç”¨åŸç è®¡ç®—å°±å‡ºé—®é¢˜äº†ã€‚å½“ç„¶ï¼ŒåŠ³åŠ¨äººæ°‘çš„æ™ºæ…§ä¸å¯ä¼°é‡ï¼Œæ€»èƒ½å‘ç°åˆé€‚çš„æ–¹å¼æ¥è§£å†³å„ç§é—®é¢˜ï¼Œäºæ˜¯ï¼Œè¡¥ç å°±è¯ç”Ÿäº†ï¼Œå†çœ‹ç”¨è¡¥ç è®¡ç®—çš„è¿‡ç¨‹ã€‚\n\n```\n1 + (-1) \n\n= [0000 0001]åŸ + [1000 0001]åŸ \n\n= [0000 00001]è¡¥ + [1111 1111]è¡¥ \n\n= [0000 0000]è¡¥ \n\n= [0000 0000]åŸ \n\n= 0\n```\n\nç»“æœæ­£ç¡®ï¼Œé—®é¢˜å¾—ä»¥è§£å†³ï¼Œè€Œè¿™ä¹Ÿæ˜¯è®¡ç®—æœºéƒ½æ˜¯ä»¥è¡¥ç çš„å½¢å¼æ¥å­˜å‚¨æ•´æ•°çš„åŸå› ã€‚\n\nä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆç”¨è¡¥ç è®¡ç®—å°±èƒ½å¾—åˆ°æ­£ç¡®ç»“æœå‘¢ï¼Ÿä¸ºä»€ä¹ˆè¡¥ç çš„è®¡ç®—æ–¹å¼æ˜¯åŸç å–åå†åŠ  1 å‘¢ï¼Ÿå¸¦ç€é—®é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚\n\n\n**1. é’Ÿè¡¨ä¸Šçš„å“²å­¦**\n\né’Ÿè¡¨ï¼Œæ¯ä¸ªäººåº”è¯¥éƒ½æ¸…æ¥šçš„ï¼Œä¸Šé¢çš„æ•°å­—èŒƒå›´[0,11]ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸º[1, 12]ï¼Œæ¯•ç«Ÿä¸Šé¢æ²¡æœ‰å†™ 0 è¿™ä¸ªæ•°å­—ï¼Œä½†æ˜¯ä¸å˜çš„æ˜¯ï¼Œéƒ½å¯ä»¥è¡¨ç¤º12ä¸ªå°æ—¶ã€‚\n\næ¯”æ–¹è¯´ï¼Œç°åœ¨æ˜¯  9:00ï¼Œæ—¶é’ˆæŒ‡å‘9ã€‚æˆ‘è¦æƒ³çŸ¥é“ 7 ä¸ªå°æ—¶ä¹‹å‰æ˜¯å‡ ç‚¹ï¼Œé‚£ä¹ˆæˆ‘åªéœ€è¦å°†æ—¶é’ˆå‘å›æ‹¨åŠ¨ 7 ä¸ªæ ¼å­å³å¯ï¼Œç»“æœå¾ˆæ˜¾ç„¶ï¼Œæ—¶é’ˆå°†ä¼šæŒ‡å‘ 2ï¼Œè¡¨ç¤º  2:00ï¼›ä½†æ˜¯ï¼Œæˆ‘è¦æƒ³çŸ¥é“ 5 ä¸ªå°æ—¶åæ˜¯å‡ ç‚¹å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œå°†æ—¶é’ˆå‘å‰æ‹¨åŠ¨ 5 ä¸ªæ ¼å­ï¼Œç»“æœä¹Ÿå¾ˆæ˜¾ç„¶ï¼Œæ—¶é’ˆä¹Ÿä¼šæŒ‡å‘ 2ï¼Œè¡¨ç¤º 2:00ã€‚\n\né€šè¿‡ä¸åŒæ–¹å¼ï¼Œæˆ‘ä»¬å¾—åˆ°äº†åŒæ ·çš„ç»“æœï¼Œ**ä¹Ÿå°±æ˜¯è¯´åœ¨é’Ÿè¡¨ä¸Šï¼Œ9 - 7 = 9 + 5 = 2**ã€‚ä¸ä»… 7 å’Œ 5 æœ‰è¿™æ ·çš„è§„å¾‹ï¼Œ8 å’Œ 4ã€9 å’Œ 3ç­‰éƒ½æœ‰è¿™æ ·çš„è§„å¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸åŠ ç­‰äº 12 çš„ä¸¤ä¸ªæ•°éƒ½ç¬¦åˆè¿™æ ·çš„è§„å¾‹ï¼Œå³ **X - Y = X + (12 -Y)**ï¼Œè€Œ 12 åœ¨è¿™é‡Œæœ‰ä¸ªåå­—ï¼Œå«åšè¿™ä¸ªé’Ÿè¡¨çš„**æ¨¡**ï¼Œ12 - Y å«åš Y çš„**è¡¥æ•°**ã€‚\n\n**å‡å»ä¸€ä¸ªæ•°ï¼Œç­‰äºåŠ ä¸Šè¿™ä¸ªæ•°çš„è¡¥æ•°ï¼Œåº”ç”¨è¿™ä¸ªè§„å¾‹å°±å¯ä»¥å°†å‡æ³•è½¬æ¢ä¸ºåŠ æ³•äº†ã€‚**\n\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ¨¡é•¿è¯¥æ€ä¹ˆæ±‚ï¼Ÿ\n\n\n**2. é€šä¿—çš„ã€Œæ¨¡ã€**\n\né€šä¿—çš„è®²ï¼Œå¾ˆç®€å•ã€‚è¿˜æ˜¯æ‹¿é’Ÿè¡¨ä¸¾ä¾‹ï¼Œä¸Šé¢èƒ½è¡¨ç¤ºçš„æ•°å­—çš„æ€»æ•°å°±æ˜¯å…¶æ¨¡é•¿ï¼Œæ‰€ä»¥ä¸ç®¡æ˜¯[0, 11]ï¼Œè¿˜æ˜¯[1, 12]ï¼Œéƒ½ä¸º12ã€‚\n\nå†æ¥çœ‹ 8 ä½äºŒè¿›åˆ¶ï¼Œå…¶åŸç èƒ½è¡¨ç¤ºçš„èŒƒå›´ (æ³¨æ„çœ‹ï¼Œè¿™é‡Œè¯´çš„æ˜¯åŸç )ï¼Œ**[1111 1111] ~ [0111 1111]**ï¼Œå³ **[-2^7 - 1, 2^7 - 1]** = **[-127, 127]**ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¦å°†å…¶å…¨éƒ¨è½¬å˜ä¸ºéè´Ÿæ•°ï¼Œå³èƒ½è¡¨ç¤ºçš„èŒƒå›´ä¸º[0, 127]ï¼Œæ‰€ä»¥æ¨¡é•¿ä¸º 128ã€‚\n\nè¯´å®Œäº†è¿™äº›ï¼Œæˆ‘ä»¬å†æ¥é‡æ–°çœ‹ä¸‹ -3 çš„è¡¥ç çš„è®¡ç®—è¿‡ç¨‹ã€‚-3 åŸç ä¸º **[1000 0011]**ï¼Œè€Œ**å–åçš„è¿‡ç¨‹å®é™…ä¸Šç­‰åŒäºç”¨[0111 1111]å‡å» -3 åŸç ä¸­çš„ç¬¦å·ä½ä¹‹å¤–çš„éƒ¨åˆ†**ï¼Œä¹‹åå†åŠ  1 å³å¾—åˆ°è¡¥ç ï¼Œæ‰€ä»¥ï¼š\n\n```\n-3 è¡¥ç (æœªæ·»åŠ ç¬¦å·ä½)\n\n= [1000 0011]åŸ å–å + [0000 0001]\n\n= [0111 1111] - [0000 0011] + [0000 0001]\n \n= [0111 1111] + [0000 0001] - [0000 0011]\n \n= [1000 0000] - [0000 0011]\n\n= 128 - [0000 0011]\n\n= æ¨¡  - [0000 0011] \n\n= æ¨¡  - 3\n```\n\nçœ‹åˆ°è¿™ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å°±æ˜ç™½äº†ï¼Ÿ**è¡¥ç å®é™…ä¸Šå°±æ˜¯æ¨¡å‡å»åŸç çš„å€¼ï¼Œå†åŠ ä¸Šä¸€ä¸ªç¬¦å·ä½ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„ï¼šç¬¦å·ä½ä¸å˜ï¼Œå–åå†åŠ 1**ã€‚\n\næ‰€ä»¥ï¼Œåœ¨è®¡ç®—æœºä¸­ï¼Œæ•´æ•°éƒ½æ˜¯ä»¥è¡¥ç çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ˜¯ä¸ºäº†ç»Ÿä¸€åŠ å‡æ³•è¿ç®—ã€‚å› ä¸ºè®¡ç®—æœºä¹‹ä¸­æ˜¯æ²¡æœ‰åšå‡æ³•çš„é€»è¾‘é—¨ï¼Œå‡æ³•éƒ½ä¼šè¢«è½¬åŒ–ä¸ºåŠ æ³•æ¥å®Œæˆè®¡ç®—ã€‚\n\nè€Œé€šè¿‡æº¢å‡ºï¼Œç¬¦å·ä½ä¹Ÿå¯ä»¥ç›´æ¥å‚ä¸è®¡ç®—ï¼Œå¤§å¤§ç®€åŒ–äº†è®¡ç®—è¿‡ç¨‹ï¼Œçœ‹ä¸ªä¾‹å­å°±æ˜ç™½äº†ã€‚\n\n```\n7 + ï¼ˆ-3ï¼‰\n\n= [0000 0111]åŸ + [1000 0011]åŸ \n\n= [0000 0111]è¡¥ + [1111 1101]è¡¥ \n\n= [0000 0100]è¡¥ (æº¢å‡ºéƒ¨åˆ†ä¸ç”¨å¤„ç†)\n\n= [0000 0100]åŸ \n\n= 4 \n\n2 + ï¼ˆ-3ï¼‰\n\n= [0000 0010]åŸ + [1000 0011]åŸ \n\n= [0000 0010]è¡¥ + [1111 1101]è¡¥ \n\n= [1111 1111]è¡¥ \n\n= [1000 0001]åŸ \n\n= -1\n```\n\nå†çœ‹ä¸ªç‰¹ä¾‹ã€‚\n\n```\n-1 + (-127) \n\n= [1000 0001]åŸ + [1111 1111]åŸ \n\n= [1111 1111]è¡¥ + [1000 0001]è¡¥ \n\n= [1000 0000]è¡¥ \n\n= -128\n```\n\nç”¨åŸç èƒ½è¡¨ç¤ºçš„æœ€å°è´Ÿæ•°ä¸º **-127**ï¼Œè¡¥ç å´èƒ½è¡¨ç¤ºçš„æœ€å°è´Ÿæ•°ä¸º **-128**ï¼Œä½†æ˜¯ **-128** æ²¡æœ‰åŸç å’Œåç è¡¨ç¤ºï¼Œç”±äºè®¡ç®—æœºä¸­ä½¿ç”¨è¡¥ç è¡¨ç¤ºæ•´æ•°ï¼Œæ‰€ä»¥è¿™æ²¡æœ‰å½±å“ï¼Œå› æ­¤ 8 ä½äºŒè¿›åˆ¶æ•°ï¼Œä¹Ÿå°±æ˜¯ **byte** ç±»å‹èƒ½è¡¨ç¤ºçš„èŒƒå›´æ˜¯ **[-128, 127]**ã€‚\n\nè¯´åˆ°è¿™ï¼Œå¯¹äºè¡¥ç ï¼Œåº”è¯¥è¶³å¤Ÿæ¸…æ™°äº†å§ï¼","tags":["ç¼–ç "],"categories":["ç¼–ç "]},{"title":"ã€ŒåŸç  åç  è¡¥ç  ç§»ç ã€ä¸€æ¢ç©¶ç«Ÿï¼ˆä¸Šï¼‰","url":"/2019/01/8ebb2c9120f0/","content":"\n> æŠ›å¼€å¤æ‚çš„ç†è®ºï¼Œç›´æ¢äº‹ç‰©çš„æœ¬è´¨ã€‚\n\n**0. äºŒè¿›åˆ¶**\n\nç›¸æ¯”äºäºŒè¿›åˆ¶ï¼Œåè¿›åˆ¶æ•°å­—å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰ã€‚ä»å³å¾€å·¦ä¾æ¬¡æ˜¯ä¸ªä½ã€åä½ã€ç™¾ä½ã€åƒä½ç­‰ï¼Œæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—èŒƒå›´ [0, 9]ã€‚ä¸ªä½ä¸Šçš„ 1 è¡¨ç¤º 1ï¼Œåä½ä¸Šçš„ 1 è¡¨ç¤º 10ï¼Œç™¾ä½ä¸Šçš„ 1 è¡¨ç¤º 100ï¼Œå³ä»å³å‘å·¦çš„ç¬¬ n ä½å°±ä»£è¡¨ 10^(n-1)ï¼š\n<!--more--> \n```\n761 = 7*100 + 6*10 + 1*1 = 7*10^2 + 6*10^1 + 1*10^0\n```\n\nè€ŒäºŒè¿›åˆ¶ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼ŒåŒºåˆ«å°±æ˜¯å°† 10 çš„ n-1 æ¬¡å¹‚å˜æˆäº† 2 çš„ n-1 æ¬¡å¹‚ï¼š\n\n```\n1101 = 1*2^3 + 1*2^2 + 0*2^1 + 1*2^0 = 8 + 4 + 0 + 1 = 13\n```\n\næœ‰äº†è¿™äº›åŸºç¡€æ¦‚å¿µï¼Œæ¥ç€å†æ¥çœ‹ä¸‹é¢çš„å†…å®¹ã€‚\n\n**1.** **è¿™äº›ã€Œç ã€éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ**\n\n**è®¡ç®—æœºä¸­çš„æ•°å­—ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼Œæœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°ã€‚**\n\n**åŸç **ï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºä¸­å¯¹æ•°å­—çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„æ–¹æ³•ã€‚\n\n**æœ‰ç¬¦å·æ•°**ï¼Œå³ç”¨æœ€é«˜ä½çš„äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºæ­£è´Ÿï¼Œå‰©ä¸‹çš„ä½æ¥å­˜å‚¨æ•°æ®ã€‚\n\n**æ— ç¬¦å·æ•°**ï¼Œå³æ‰€æœ‰çš„äºŒè¿›åˆ¶ä½éƒ½æ¥è¡¨ç¤ºæ•°æ®ï¼Œæ‰€ä»¥æ— ç¬¦å·æ•°å­—æ— æ³•è¡¨ç¤ºè´Ÿæ•°ï¼Œå…¨éƒ¨å¤§äºç­‰äº 0ã€‚\n\nå…‰çœ‹å®šä¹‰å¹²å·´å·´çš„ï¼Œç”¨é•¿åº¦ä¸º 8 ä½äºŒè¿›åˆ¶çš„ç±»å‹ä¸¾å‡ ä¸ªä¾‹å­ã€‚\n\næœ‰ç¬¦å·æ•°ï¼Œæœ€é«˜ä½è¡¨ç¤ºæ­£è´Ÿï¼Œ0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ã€‚\n\n```\n   7 : [0000 0111]åŸ\n  -3 : [1000 0011]åŸ\n-127 : [1111 1111]åŸ\n```\n\næ— ç¬¦å·æ•°ï¼Œæ²¡æœ‰ç¬¦å·ä½ï¼Œå…¨éƒ¨äºŒè¿›åˆ¶ä½ç”¨æ¥è¡¨ç¤ºæ•°æ®ã€‚\n\n```\n  7 : [0000 0111]åŸ \n 16 : [0001 0000]åŸ\n255 : [1111 1111]åŸ\n```\n\nä¸Šé¢å°±æ˜¯åŸç çš„å®šä¹‰ï¼Œè€Œåç ã€è¡¥ç ã€ç§»ç éƒ½æ˜¯åœ¨åŸç çš„åŸºç¡€ä¸Šåšäº†å¯¹åº”çš„å˜æ¢ã€‚\n\n**åç **ï¼šæ­£æ•°çš„åç å°±æ˜¯å…¶åŸç ï¼Œè´Ÿæ•°çš„åç ä¸ºï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™ä½å–åï¼Œå³ 0 å˜ 1ï¼Œ1 å˜ 0ã€‚\n\n**è¡¥ç **ï¼šæ­£æ•°çš„è¡¥ç å°±æ˜¯å…¶åŸç ï¼Œè´Ÿæ•°çš„è¡¥ç ä¸ºåœ¨å…¶åç çš„åŸºç¡€ä¸Šå†åŠ  1ï¼Œè€Œåœ¨è®¡ç®—æœºä¸­ï¼Œæ•´æ•°éƒ½æ˜¯ä»¥è¡¥ç çš„å½¢å¼å­˜å‚¨çš„ã€‚\n\n**ç§»ç **ï¼šå°†è¡¥ç ç¬¦å·ä½å–åï¼Œå³ä¸ºç§»ç ã€‚\n\n**è¿™å‡ ç§ç éƒ½æ˜¯é’ˆå¯¹æœ‰ç¬¦å·æ•°ï¼Œè€Œæ— ç¬¦å·æ•°ç”¨åŸç å°±è¶³å¤Ÿäº†**ï¼Œåé¢ä¼šå¯¹æ­¤è¯´æ˜åŸå› ã€‚åŒæ ·ï¼Œä¹Ÿä¸¾å‡ ä¸ªä¾‹å­è¯´æ˜ã€‚\n\n```\n 7 : [0000 0111]åŸ [0000 0111]å [0000 0111]è¡¥ [1000 0111]ç§»\n-3 : [1000 0011]åŸ [1111 1100]å [1111 1101]è¡¥ [0111 1101]ç§»\n```\n\nå…³äºå®šä¹‰ï¼Œå°±è¯´è¿™äº›ã€‚æ—¢ç„¶åŸç å°±èƒ½è¡¨ç¤ºæ•°å­—ï¼Œé‚£ä¸ºä»€ä¹ˆåˆä¼šæœ‰è¿™ä¹ˆå¤šç±»å‹çš„ç å‘¢ï¼Ÿè€Œè¿™äº›ä¸åŒçš„ç åˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿè®¡ç®—æœºä¸­ä¸ºä»€ä¹ˆè¦ä»¥è¡¥ç è€Œä¸æ˜¯å…¶ä»–ç æ¥å­˜å‚¨æ•´æ•°å‘¢ï¼Ÿç§»ç åˆæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿé‰´äºç¯‡å¹…è¿‡é•¿ï¼Œä¸‹ç¯‡æ–‡ç« ï¼Œä¼šå¯¹è¿™äº›é—®é¢˜ä¸€ä¸€è¯´æ˜ã€‚\n","tags":["ç¼–ç "],"categories":["ç¼–ç "]},{"title":"Golandè°ƒæ•´Terminalçª—å£å­—ä½“å¤§å°","url":"/2018/12/44fb710f68f6/","content":"\nGolandçš„Ternimalçª—å£æ ·å¼å’ŒConsoleçª—å£å…¬ç”¨åŒä¸€ä¸ªæ ·å¼ï¼Œä¿®æ”¹è·¯å¾„:\n> Setting->Editor->Color Scheme->Console Font\n\nè‹¥ä¸ç”Ÿæ•ˆï¼Œé‡å¯ä¸€ä¸‹IDEå³å¯ã€‚\n<!--more--> \n\n![](https://i.loli.net/2021/07/07/pkb8qoWm7RzV2ij.png)\n","tags":["GoLand"],"categories":["Golang"]},{"title":"Golang websocket clientè¯»å–æ•°æ®","url":"/2018/11/f0d738b44296/","content":"\nGolang æ—¢å¯ä»¥å†™ websocket çš„ server ç«¯ä¹Ÿå¯ä»¥å†™ websocket çš„ client ç«¯ï¼Œå‰è€…ç½‘ä¸Šçš„èµ„æ–™å¾ˆå¤šåè€…ç”šå°‘ï¼Œä»Šå¤©é‡åˆ°å†™ client çš„éœ€æ±‚ï¼Œåœ¨æ­¤åšä¸ªæ€»ç»“ã€‚\n\n- æµ‹è¯•åœ°å€ï¼šç«å¸ç½‘\n- websocketåŒ…ï¼šgolang.org/x/net/websocket\n<!--more--> \n### 1. å»ºç«‹è¿æ¥ã€‚\nè¿æ¥æˆåŠŸå»ºç«‹åï¼Œclient å’Œ server å‡å¯ä»¥éšæ—¶å¾€æ•°æ®é€šé“é‡Œå†™æ•°æ®åŒæ—¶ä¹Ÿå¯ä»¥ä»ä¸­è¯»å–æ•°æ®ã€‚\n\n```golang\nvar wsurl = \"wss://api.huobi.pro/ws\"\nvar origin = \"http://api.huobi.pro/\"\nws, err := websocket.Dial(wsurl, \"\", origin)\nif err != nil {\n    panic(err)\n}\n```\n### 2. å†™æ•°æ®ã€‚\nåœ¨é€šé“å·²å»ºç«‹çš„å‰æä¸‹ï¼Œå†™æ•°æ®æ“ä½œé€šè¿‡ä¸€è¡Œä»£ç å³å¯å®Œæˆï¼š\n\n```golang\nfunc sendMessage(data []bytes) {\n\tws.Write(msg)\n}\n```\n### 3.1 è¯»æ•°æ®ã€‚\næœ€ç®€å•çš„æ–¹æ³•æ˜¯è°ƒç”¨`func (ws *Conn) Read(msg []byte) (n int, err error)`æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ªç”¨æ¥æ¥æ”¶æ•°æ®çš„`[]byte`æ•°ç»„å½“ä½œå‚æ•°ä¼ å…¥ï¼Œä½†æ˜¯ç”±äºä¸çŸ¥é“serverå‘æ¥çš„æ•°æ®é•¿åº¦ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯å®šä¹‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å­—èŠ‚`[]byte`æ•°ç»„ï¼Œè¿™æ ·è¯»å–ä¸€æ¥æµªè´¹å†…å­˜äºŒæ¥å¤„ç†èµ·æ¥éº»çƒ¦ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼›\n\n```golang\nfunc readMessage(ws *websocket.Conn) {\n\tdata := make([]byte, 1024*10)\n\t_, err := ws.Read(data)\n\tif err != nil {\n\t\tlog.Println(err)\n\t}\n}\n```\n### 3.2 è¯»æ•°æ®ã€‚\nå¯¹äºéƒ½æ˜¯ä»¥jsonæ–¹å¼ä¼ è¾“çš„æ•°æ®ï¼ŒwebsocketåŒ…æä¾›äº†å°†æ¯æ¡messageè¯»å–åˆ°ä¸€ä¸ª`interface{}`ä¸­çš„æ–¹æ³•ï¼Œç­‰åŒäº`json.Unmarshal`ã€‚\n\n```golang\nfunc readJsonMessage(ws *websocket.Conn) {\n\tvar data interfact{} // dataçš„ç±»å‹ä¸ºæ¥æ”¶çš„JSONç±»å‹struct\n\terr := websocket.Message.Receive(ws, data)\n\tif err != nil {\n\t\tlog.Println(err)\n\t}\n}\n```\n### 3.3 è¯»æ•°æ®ã€‚\n3.2æ˜¯å°†æ¥æ”¶åˆ°çš„æ•°æ®ç›´æ¥unmarshalåˆ°structé‡Œäº†ï¼Œè€Œæˆ‘çš„éœ€æ±‚æ¯”è¿™ä¸ªè¦éº»çƒ¦ä¸€ç‚¹ï¼šserverå‘æ¥çš„æ•°æ®`[]byte`æ•°ç»„æ˜¯å‹ç¼©è¿‡çš„ï¼Œæ‰€ä»¥æ¥æ”¶åˆ°æ•°æ®åç¬¬ä¸€æ­¥åº”è¯¥è§£å‹ç¼©ç„¶åæ‰èƒ½unmarshalï¼Œæ‰€ä»¥ä¸èƒ½å†ç”¨3.2çš„æ–¹å¼ï¼Œå‚ç…§3.2çš„æºç ï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ã€‚\n\n```golang\nfunc readOriginMessage(ws *websocket.Conn) {\n\tagain:\n\t\tfr, err := ws.NewFrameReader()\n\t\tif err != nil {\n\t\t\tlog.Printf(\"new frame reader err %v\", err)\n\t\t\treturn\n\t\t}\n\t\tframe, err := ws.HandleFrame(fr)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"handle frame err %v\", err)\n\t\t\treturn\n\t\t}\n\t\tif frame == nil {\n\t\t\tgoto again\n\t\t}\n\t\t\n\t\tbytes, err := ioutil.ReadAll(frame)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"read frame data err %v\", err)\n\t\t}\n\t\tunzipData, err := utils.UnzipByte(bytes)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"unzip data err %v\", err)\n\t\t}\n\n\t\tvar message map[string]interface{}\n\t\te := json.Unmarshal(unzipData, &message)\n\t\tif e != nil {\n\t\t\tlog.Printf(\"unmarshal err %v\", e)\n\t\t}\n\t\t\n\t\tlog.Printf(\"message content= %+v\", message)\n}\n```","tags":["Goland","websocket"],"categories":["Golang"]},{"title":"Android WebViewåŠ è½½URLä¸æ˜¾ç¤ºå›¾ç‰‡","url":"/2018/10/ab916a013a16/","content":"---\nå¶ç„¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜\n<!--more--> \n```java\n        WebSettings settings = mWebView.getSettings();\n        settings.setJavaScriptEnabled(true);//å¯ç”¨js\n        settings.setBlockNetworkImage(false);//è§£å†³å›¾ç‰‡ä¸æ˜¾ç¤º\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n            settings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);\n        }\n```\n","tags":["Android","WebView"],"categories":["Android"]},{"title":"Program type already present: org.iq80.leveldb.CompressionType","url":"/2018/08/f07f2aa62201/","content":"---\næ·»åŠ æ–°ä¾èµ–æ—¶é‡åˆ°ä¸€ä¸ªæŠ¥é”™ã€‚\n<!--more--> \nä»Šå¤©åœ¨Android Studioæ·»åŠ äº†ä¸€ä¸ªæ–°çš„ä¾èµ–ï¼š\n```\nimplementation (\"org.ethereum:ethereumj-core:$ethereumj_version\")\n```\nç„¶å`Sync`å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯`Rebuild`æŠ¥é”™å¦‚æ ‡é¢˜ï¼Œå¾€ä¸Šæœäº†å‡ ä¸ªæ–¹æ³•éƒ½æœªå¥æ•ˆï¼Œæœ€ååªå¥½é¡ºç€é—®é¢˜æ‰¾ç­”æ¡ˆã€‚\n\næŠ¥é”™çš„å†…å®¹å°±æ˜¯è¯´`CompressionType`é‡å¤äº†ï¼Œæ¢å¥è¯è¯´ï¼Œæ·»åŠ çš„æ–°ä¾èµ–ä¸æ·»åŠ è¿™ä¸ªå³å¯ã€‚åŒå‡»`Shift`å…¨å±€æœç´¢`CompressionType`å®šä½ï¼Œå¦‚å›¾ï¼š\n![](https://i.loli.net/2021/07/07/nOSFvNhZ4BTgCmE.png)\n\næ·»åŠ ä¾èµ–æ—¶å¢åŠ ï¼š\n\n```\n implementation (\"org.ethereum:ethereumj-core:$ethereumj_version\") {\n        exclude group: 'org.iq80.leveldb', module: 'leveldb-api'\n    }\n```\n`Sync`é€šè¿‡ï¼Œ`Rebuild`åˆæŠ¥æ–°é”™è¯¯ï¼š\n\n```\nMore than one file was found with OS independent path 'META-INF/spring.tooling'\n```\nåœ¨`android`èŠ‚ç‚¹å¢åŠ é…ç½®ï¼š\n\n```\nandroid {\n\tpackagingOptions {\n        pickFirst 'META-INF/*'\n    }\n}\n```\nç»§ç»­`Sync`ï¼Œé€šè¿‡ï¼›`Rebuild`ï¼Œé€šè¿‡ã€‚\n\né—®é¢˜è§£å†³ã€‚","tags":["Android","Gradle"],"categories":["Android"]},{"title":"[ç¿»è¯‘]ç§å­è¯","url":"/2018/08/a8ab36581124/","content":"\n> åŸæ–‡åœ°å€ï¼šhttps://en.bitcoin.it/wiki/Seed_phrase\n\n### ç§å­çŸ­è¯­\nç§å­çŸ­è¯­ã€ç§å­æ¢å¤çŸ­è¯­æˆ–å¤‡ç”¨ç§å­çŸ­è¯­æ˜¯å­˜å‚¨æ¢å¤æ¯”ç‰¹å¸é’±åŒ…æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯çš„å•è¯åˆ—è¡¨ã€‚é’±åŒ…è½¯ä»¶é€šå¸¸ä¼šç”Ÿæˆä¸€ä¸ªç§å­çŸ­è¯­å¹¶æŒ‡ç¤ºç”¨æˆ·å°†å…¶å†™åœ¨çº¸ä¸Šã€‚å¦‚æœç”¨æˆ·çš„ç”µè„‘åäº†æˆ–è€…ä»–ä»¬çš„ç¡¬ç›˜åäº†ï¼Œä»–ä»¬å¯ä»¥å†æ¬¡ä¸‹è½½ç›¸åŒçš„é’±åŒ…è½¯ä»¶ï¼Œä½¿ç”¨çº¸è´¨å¤‡ä»½æ¥å–å›ä»–ä»¬çš„æ¯”ç‰¹å¸ã€‚\n<!--more--> \nä»»ä½•å‘ç°è¿™ä¸ªçŸ­è¯­çš„äººéƒ½å¯ä»¥å·æ¯”ç‰¹å¸ï¼Œæ‰€ä»¥æ¯”ç‰¹å¸å¿…é¡»ä¿å­˜çš„åƒç å®æˆ–ç°é‡‘ä¸€æ ·å®‰å…¨ã€‚ä¾‹å¦‚ï¼Œå®ƒä¸èƒ½è¢«é”®å…¥ä»»ä½•ç½‘ç«™ã€‚\n\nç§å­çŸ­è¯­æ˜¯å¤‡ä»½å’Œå­˜å‚¨æ¯”ç‰¹å¸çš„å¥½æ–¹æ³•ï¼Œå› æ­¤å‡ ä¹æ‰€æœ‰å—å¥½è¯„çš„é’±åŒ…éƒ½ä½¿ç”¨å®ƒä»¬\n\n#### ä¸¾ä¾‹\nç§å­çŸ­è¯­çš„ä¸€ä¸ªä¾‹å­æ˜¯:\n```\nwitch collapse practice feed shame open despair creek road again ice least\n```\nå•è¯çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„ã€‚\n\n#### è§£é‡Š\nå…³äºç§å­çŸ­è¯­å¦‚ä½•å·¥ä½œçš„ä¸€ä¸ªç®€å•çš„è§£é‡Šæ˜¯ï¼Œé’±åŒ…è½¯ä»¶æœ‰ä¸€ä¸ªä»å­—å…¸ä¸­æå–çš„å•è¯åˆ—è¡¨ï¼Œæ¯ä¸ªå•è¯è¢«åˆ†é…ç»™ä¸€ä¸ªæ•°å­—ã€‚ç§å­çŸ­è¯­å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œè¯¥æ•°å­—ç”¨ä½œç§å­æ•´æ•°ï¼Œä»¥ç”Ÿæˆé’±åŒ…ä¸­ä½¿ç”¨çš„æ‰€æœ‰å¯†é’¥å¯¹çš„ç¡®å®šæ€§é’±åŒ…ã€‚\n\nBIP39æ ‡å‡†2048å­—çš„è‹±æ–‡è¯åº“,å¦‚æœè¿™ä¸ªè¯åªåŒ…å«12ä¸ªéšæœºçš„å•è¯,å¯èƒ½çš„ç»„åˆçš„æ•°é‡å°†æ˜¯2048 ^ 12 = 2 ^ 132ï¼Œå¹¶ä¸”çŸ­è¯­æœ‰132ä½å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼ŒBIP39çŸ­è¯­ä¸­çš„ä¸€äº›æ•°æ®ä¸æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥12ä¸ªå•è¯çš„BIP39ç§å­çŸ­è¯­çš„å®é™…å®‰å…¨æ€§åªæœ‰128ä½ã€‚è¿™ä¸æ‰€æœ‰æ¯”ç‰¹å¸ç§é’¥çš„å¼ºåº¦å¤§è‡´ç›¸åŒï¼Œå› æ­¤å¤§å¤šæ•°ä¸“å®¶è®¤ä¸ºå®ƒè¶³å¤Ÿå®‰å…¨ã€‚\n\nå‘æ˜ä½ è‡ªå·±çš„ç§å­çŸ­è¯­å¹¶ä¸å®‰å…¨ï¼Œå› ä¸ºäººç±»ä¸å–„äºäº§ç”Ÿéšæœºæ€§ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯è®©é’±åŒ…è½¯ä»¶ç”Ÿæˆä½ å†™ä¸‹çš„çŸ­è¯­ã€‚\n\n#### åŒé‡ç§å­çŸ­è¯­\nç§å­çŸ­è¯­å’Œæ‰€æœ‰å¤‡ä»½ä¸€æ ·ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„æ•°é‡çš„æ¯”ç‰¹å¸ã€‚è¿™æ˜¯ä¸€ä¸ªä»¤äººæ‹…å¿§çš„æƒ³æ³•ï¼Œå¯èƒ½æœ‰è¶³å¤Ÿè´­ä¹°æ•´ä¸ªå»ºç­‘çš„é’±ï¼Œå´åªæ˜¯å†™åœ¨ä¸€å¼ çº¸ä¸Šè€Œæ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œè®¸å¤šé’±åŒ…ä½¿å¾—ç”¨å¯†ç åŠ å¯†ç§å­çŸ­è¯­æˆä¸ºå¯èƒ½ã€‚\n\nå¯†ç å¯ç”¨äºåˆ›å»ºä¸€ä¸ªåŒå› ç´ ç§å­çŸ­è¯­ï¼Œå…¶ä¸­éœ€è¦â€œä½ æ‹¥æœ‰çš„ä¸œè¥¿â€å’Œâ€œä½ çŸ¥é“çš„ä¸œè¥¿â€æ‰èƒ½è§£é”æ¯”ç‰¹å¸ã€‚\n\nå®ƒçš„å·¥ä½œåŸç†æ˜¯é’±åŒ…åˆ›å»ºä¸€ä¸ªç§å­çŸ­è¯­å¹¶å‘ç”¨æˆ·è¯¢é—®å¯†ç ã€‚ç„¶åéœ€è¦ç§å­çŸ­è¯­å’Œé¢å¤–çš„å•è¯ï¼Œæ‰èƒ½æ¢å¤é’±åŒ…ã€‚Electrumå’Œå…¶ä»–ä¸€äº›é’±åŒ…æŠŠå¯†ç çŸ­è¯­å«åšâ€œç§å­æ‰©å±•â€ï¼Œâ€œæ‰©å±•è¯â€æˆ–è€…â€œç¬¬13 /25ä¸ªå•è¯â€ã€‚BIP39æ ‡å‡†å®šä¹‰äº†ä¸€ç§ä¿æŠ¤ç§å­çŸ­è¯­çš„æ–¹æ³•ã€‚åœ¨Electrumæ ‡å‡†ä¸­ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„æ–¹æ¡ˆã€‚å¦‚æœæ²¡æœ‰å¯†ç ï¼Œåˆ™ä½¿ç”¨ç©ºå­—ç¬¦ä¸²â€œâ€ã€‚\n\nè­¦å‘Š:å¿˜è®°è¿™ä¸ªå¯†ç å°†å¯¼è‡´æ¯”ç‰¹å¸é’±åŒ…å’Œä»»ä½•é’±åŒ…é‡ŒåŒ…å«çš„é’±ä¸¢å¤±ã€‚ä¸è¦é«˜ä¼°ä½ è®°ä½å¯†ç çš„èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯å½“ä½ å¯èƒ½ä¸ç»å¸¸ä½¿ç”¨å¯†ç çš„æ—¶å€™ã€‚\n\nè­¦å‘Š:ç§å­çŸ­è¯­å¯†ç ä¸åº”è¯¥ä¸ç”¨äºåŠ å¯†ç£ç›˜ä¸Šé’±åŒ…æ–‡ä»¶çš„å¯†ç æ··æ·†ã€‚è¿™å¯èƒ½å°±æ˜¯ä¸ºä»€ä¹ˆè®¸å¤šé’±åŒ…ç§°å®ƒä¸ºæ‰©å±•è¯è€Œä¸æ˜¯å¯†ç ã€‚\n\n#### è¯±éª—çš„é’±åŒ…\nè¿™ä¸ªåŠŸèƒ½è¿˜æä¾›äº†è²Œä¼¼åˆç†çš„å¯å¦è®¤æ€§ï¼Œå› ä¸ºæ¯ä¸ªå¯†ç éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆçš„é’±åŒ…ï¼Œä½†åªæœ‰æ­£ç¡®çš„å¯†ç æ‰ä¼šè®©ä½ æƒ³è¦çš„é’±åŒ…å¯ç”¨ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰ç›¸åŒç§å­çŸ­è¯­ä½†ä¸åŒå¯†ç çš„è¯±éª—é’±åŒ…ï¼Œå¦‚æœèº«ä½“ä¸Šè¢«è¿«ï¼Œé‚£ä¹ˆåªæ˜¾ç¤ºç¬¬ä¸€ä¸ªå¯†ç ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå¯†ç ä¿å¯†ã€‚\n\nå¦ä¸€æ–¹é¢ï¼Œå¼ºè¿«ä½ çš„å®ä½“å¯èƒ½å·²ç»çŸ¥é“è¯±éª—é’±åŒ…çš„æ¦‚å¿µã€‚ä»–ä»¬å¯ä»¥ç»§ç»­æ‰“ä½ ï¼Œç›´åˆ°ä½ æ”¾å¼ƒä¸¤ä¸‰ä¸ªå¯†ç ã€‚\n\nå…³äºè¿™ä¸ªé—®é¢˜çš„æ›´é•¿çš„è®¨è®ºï¼Œè¯·å‚è§å­˜å‚¨æ¯”ç‰¹å¸# 5ç¾å…ƒæ‰³æ‰‹æ”»å‡»\n\n#### é•¿æœŸå‚¨å­˜ç§å­çŸ­è¯­\nå¤§å¤šæ•°äººåœ¨çº¸ä¸Šå†™ä¸‹çŸ­è¯­ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨è®¸å¤šå…¶ä»–çš„æ–¹å¼æ¥å­˜å‚¨ï¼Œæ¯”å¦‚è®°å¿†ã€é›•åˆ»é‡‘å±ã€åœ¨ä¹¦é¡µç©ºç™½å¤„å†™å­—ã€åˆ»çŸ³ç¢‘æˆ–ä»»ä½•å…¶ä»–æœ‰åˆ›æ„çš„æ–¹å¼ã€‚\n\nç”¨é“…ç¬”åœ¨çº¸ä¸Šä¹¦å†™è¦æ¯”ç”¨é’¢ç¬”ä¹¦å†™å¥½å¾—å¤šã€‚çº¸å¼ åº”æ— é…¸å‘³æˆ–æ¡£æ¡ˆçº¸ï¼Œå­˜æ”¾åœ¨é»‘æš—ä¸­ï¼Œé¿å…é«˜æ¸©å’Œæ½®æ¹¿ã€‚\n\næœ‰äº›äººæƒ³æŠŠä»–ä»¬çš„çŸ­è¯­åˆ†å¼€ã€‚åœ¨ä¸€ä¸ªåœ°æ–¹å‚¨å­˜6ä¸ªå•è¯ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹å‚¨å­˜6ä¸ªå•è¯ã€‚è¿™æ˜¯ä¸€ä¸ªç³Ÿç³•çš„æƒ³æ³•ï¼Œä¸åº”è¯¥è¿™æ ·åšï¼Œå› ä¸ºå¦‚æœä¸€ç»„6ä¸ªå•è¯è¢«å‘ç°ï¼Œé‚£ä¹ˆå°±æ›´å®¹æ˜“å¯¹å‰©ä¸‹çš„çŸ­è¯­è¿›è¡Œæš´åŠ›æ”»å‡»ã€‚åƒè¿™æ ·åœ¨å¤šä¸ªåœ°æ–¹å­˜å‚¨æ¯”ç‰¹å¸åº”è¯¥é€šè¿‡å¤šç­¾åé’±åŒ…æ¥å®ç°ã€‚\n\nå¦ä¸€ä¸ªåä¸»æ„æ˜¯æ·»åŠ ä¸€äº›å¯¹ä½ æœ‰æ„ä¹‰çš„éšæœºå‡è¯ï¼Œç„¶åæŠŠå®ƒä»¬åˆ é™¤ï¼Œåªç•™ä¸‹12ä¸ªå•è¯çŸ­è¯­ã€‚è¿™ä¸ªçŸ­è¯­æ¥è‡ªäºä¸€æœ¬å·²çŸ¥çš„å­—å…¸(è§ä¸‹ä¸€èŠ‚)ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥ç”¨é‚£æœ¬å­—å…¸æ¥é™¤å»å‡è¯ã€‚\n\nåœ¨åŒä¸€å¼ çº¸ä¸Šå†™ä¸€äº›è§£é‡Šçš„è¯ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ã€‚å¦‚æœé•¿æœŸå‚¨å­˜ï¼Œä½ å¯èƒ½ä¼šå¿˜è®°ä¸€ä¸ªçŸ­è¯­åº”è¯¥å¦‚ä½•å¤„ç†ã€‚å¯ä»¥åŠ ä»¥ä¿®æ”¹çš„ç¤ºä¾‹è§£é‡Šæ˜¯:\n\n    è¿™åäºŒä¸ªå­—æ§åˆ¶ç€æ¯”ç‰¹å¸ã€‚ä¿ç®¡å¥½è¿™å¼ çº¸ï¼Œåƒç°é‡‘æˆ–ç å®ä¸€æ ·ä¿å¯†ã€‚æœ¬æ–‡ä¸­çš„æ¯”ç‰¹å¸ä¿¡æ¯ç”¨å¯†ç åŠ å¯†ã€‚å®ƒæ˜¯ä¸€ä¸ªå¤š  ç­¾åé’±åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯åœ¨2012å¹´1æœˆ1æ—¥ç”±ç”µå­æ¯”ç‰¹å¸é’±åŒ…è½¯ä»¶åˆ¶ä½œçš„ã€‚\n\n#### å•è¯åˆ—è¡¨\nä¸€èˆ¬æ¥è¯´ï¼Œç§å­çŸ­è¯­åªé€‚ç”¨äºåˆ›å»ºå®ƒçš„ç›¸åŒçš„é’±åŒ…è½¯ä»¶ã€‚å¦‚æœå‚¨å­˜çš„æ—¶é—´å¾ˆé•¿ï¼Œæœ€å¥½ä¹Ÿå†™ä¸Šé’±åŒ…çš„åå­—ã€‚\n\nBIP39è‹±è¯­å•è¯è¡¨ä¸­ï¼Œæ¯ä¸ªå•è¯éƒ½ç”±å‰å››ä¸ªå­—æ¯å”¯ä¸€åœ°è¯†åˆ«å‡ºæ¥ï¼Œè¿™åœ¨ç©ºé—´æœ‰é™çš„æƒ…å†µä¸‹æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\n\n#### æ›¿ä»£çš„åå­—â€œåŠ©è®°è¯â€\nç§å­çŸ­è¯­æœ‰æ—¶è¢«ç§°ä¸ºâ€œåŠ©è®°çŸ­è¯­â€ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤è€çš„æ–‡å­¦ä½œå“ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªä¸å¥½çš„åå­—ï¼Œå› ä¸ºå•è¯åŠ©è®°æ„å‘³ç€è¿™ä¸ªçŸ­è¯­åº”è¯¥è¢«è®°ä½ã€‚æŠŠå®ƒä»¬å«åšç§å­çŸ­è¯­æ²¡æœ‰é‚£ä¹ˆè¯¯å¯¼äººã€‚","tags":["åŒºå—é“¾"],"categories":["åŒºå—é“¾"]},{"title":"[ç¿»è¯‘]æ¯”ç‰¹å¸ç¡®å®šæ€§é’±åŒ…","url":"/2018/08/97037d409735/","content":"\n> åŸæ–‡åœ°å€ï¼šhttps://en.bitcoin.it/wiki/Deterministic_wallet\n<!--more--> \n\n### ç¡®å®šæ€§é’±åŒ…\nç¡®å®šæ€§é’±åŒ…æ˜¯ä¸€ç§ç³»ç»Ÿï¼Œä»ä¸€ä¸ªè¢«ç§°ä¸ºç§å­çš„å•ä¸€èµ·ç‚¹è·å–å¯†é’¥ã€‚ç§å­å…è®¸ç”¨æˆ·åœ¨ä¸éœ€è¦ä»»ä½•å…¶ä»–ä¿¡æ¯çš„æƒ…å†µä¸‹è½»æ¾å¤‡ä»½å’Œæ¢å¤é’±åŒ…ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸çŸ¥é“ç§é’¥çš„æƒ…å†µä¸‹åˆ›å»ºå…¬å…±åœ°å€ã€‚ç§å­é€šå¸¸è¢«ä¸²è¡ŒåŒ–ä¸ºäººç±»å¯è¯»çš„å­—è¯ã€‚\n\n#### å¥½å¤„\næ—©æœŸçš„å®¢æˆ·ç«¯ï¼Œå¦‚Satoshiå®¢æˆ·ç«¯ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„éšæœºç§é’¥ç¼“å†²åŒºï¼Œåœ¨å°†æ¥ç”¨ä½œæ¥æ”¶å’Œæ›´æ”¹åœ°å€ã€‚åœ¨çŸ­æ—¶é—´å†…è€—å°½å¯†é’¥æ± ç¼“å†²åŒº(é€šå¸¸æ˜¯100ä¸ªåœ°å€)åï¼Œè¿™å°†ä½¿å¤‡ä»½å¤±æ•ˆã€‚ç¡®å®šæ€§é’±åŒ…å¯ä»¥åœ¨åŠ¨æ€ä¸­äº§ç”Ÿæ— é™æ•°é‡çš„åœ°å€ï¼Œå› æ­¤ä¸ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚ç”±äºåœ°å€æ˜¯ä»¥ä¸€ç§å·²çŸ¥çš„æ–¹å¼ç”Ÿæˆçš„ï¼Œè€Œä¸æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¸€äº›å®¢æˆ·ç«¯å¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡ä¸Šä½¿ç”¨ï¼Œè€Œä¸ä¼šé€ æˆèµ„é‡‘æŸå¤±ã€‚ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ä»¥äººç±»å¯è¯»çš„æ ¼å¼åˆ›å»ºç§å­çš„å•ä¸ªå¤‡ä»½ï¼Œè¿™ç§æ ¼å¼å°†æŒç»­é’±åŒ…çš„ä½¿ç”¨å¯¿å‘½ï¼Œè€Œä¸å¿…æ‹…å¿ƒè¿™ç§å¤‡ä»½ä¼šå˜å¾—è¿‡æ—¶ã€‚\nç‰¹å®šç±»å‹çš„ç¡®å®šæ€§é’±åŒ…(BIP0032, Armory, Coinkiteå’ŒCoinb)é¢å¤–å…è®¸å®Œå…¨åˆ†ç¦»ç§æœ‰å’Œå…¬å…±å¯†é’¥çš„åˆ›å»ºï¼Œä»¥è·å¾—æ›´å¤§çš„å®‰å…¨æ€§å’Œæ–¹ä¾¿æ€§ã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥è®¾ç½®ä¸ºåªçŸ¥é“ç‰¹å®šç¡®å®šæ€§é’±åŒ…çš„ä¸»å…¬é’¥ã€‚è¿™å…è®¸æœåŠ¡å™¨åˆ›å»ºå°½å¯èƒ½å¤šçš„å…¬é’¥æ¥æ¥æ”¶èµ„é‡‘ï¼Œä½†æ˜¯MPKåè®®ä¸ä¼šå…è®¸æ”»å‡»è€…ä»é’±åŒ…ä¸­èŠ±é’±ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥åœ¨Electrumå’ŒArmoryä¸­ä½¿ç”¨ï¼Œä»¥å®ç°å®Œå…¨ç¦»çº¿å­˜å‚¨å’ŒèŠ±è´¹ï¼Œç¦»çº¿è®¡ç®—æœºçŸ¥é“ç§é’¥ï¼Œè€Œåœ¨çº¿çš„è®¡ç®—æœºåªçŸ¥é“MPKã€‚é€šè¿‡USBå­˜å‚¨å™¨ï¼Œä¸¤ç§è®¡ç®—æœºä¹‹é—´å¯ä»¥é€šè¿‡USBå­˜å‚¨å™¨è¿›è¡Œäº¤æ˜“ï¼Œé¿å…å°†ç¦»çº¿è®¡ç®—æœºæš´éœ²ç»™åŸºäºç½‘ç»œçš„æ”»å‡»ã€‚\nç”±ç¡¬ä»¶é’±åŒ…(TREZOR)å®ç°çš„ç¡®å®šæ€§é’±åŒ…å°†ç”Ÿæˆçš„ç§é’¥ä¿æŒç¦»çº¿çŠ¶æ€ï¼Œå³ä½¿èŠ±é’±æ—¶ä¹Ÿä¸å°†å®ƒä»¬æš´éœ²ç»™è®¡ç®—æœºã€‚\n\n#### ç±»å‹\n#### ç±»å‹1 ç¡®å®šæ€§é’±åŒ…\nç±»å‹1ç¡®å®šæ€§é’±åŒ…æ˜¯ä¸€ç§ä»å·²çŸ¥çš„èµ·å§‹å­—ç¬¦ä¸²ç”Ÿæˆåœ°å€çš„ç®€å•æ–¹æ³•ï¼Œå› æ­¤å®ƒä¸å…è®¸é«˜çº§åŠŸèƒ½ï¼Œå¦‚ä¸»å…¬é’¥ã€‚è¦ç”Ÿæˆä¸€ä¸ªç§é’¥ï¼Œéœ€è¦ä½¿ç”¨SHA256(string + n)ï¼Œå…¶ä¸­næ˜¯ä¸€ä¸ªasciiç¼–ç çš„æ•°å­—ï¼Œå®ƒä»1å¼€å§‹ï¼Œå¹¶éšç€éœ€è¦é¢å¤–çš„é”®è€Œå¢åŠ ã€‚\nè¿™ç§ç±»å‹çš„é’±åŒ…å¯ä»¥ç”±Casasciusæ¯”ç‰¹å¸åœ°å€å®ç”¨ç¨‹åºåˆ›å»ºã€‚\n#### ç±»å‹2 åˆ†å±‚ç¡®å®šæ€§é’±åŒ…\nè¿™ç§é’±åŒ…ç±»å‹åœ¨bip0032ä¸­è¿›è¡Œäº†æè¿°ï¼Œå¹¶åœ¨TREZORã€Electrumå’ŒCarbonWalletä¸­å¾—åˆ°äº†å……åˆ†çš„å®ç°ã€‚ç§å­æ˜¯ä¸€ä¸ªéšæœºçš„128ä½å€¼ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å¸¸ç”¨çš„è‹±è¯­å•è¯ä½œä¸º12ä¸ªå•è¯çš„ç§å­çŸ­è¯­ã€‚è¯¥ç§å­åœ¨10ä¸‡è½®SHA256ä¹‹åä½¿ç”¨ï¼Œä»¥å‡ç¼“å¯¹å¼±ç”¨æˆ·é€‰æ‹©å­—ç¬¦ä¸²çš„æ”»å‡»ã€‚\nè¿™ç§é’±åŒ…ç±»å‹çš„æœ€åˆæè¿°å’Œå·¥ä½œåŸç†éƒ½å½’åŠŸäºæ ¼é›·æˆˆé‡ŒÂ·éº¦å…‹æ–¯éŸ¦ã€‚\n#### Armoryç¡®å®šæ€§é’±åŒ…\nArmoryæœ‰è‡ªå·±åŸºäºâ€œæ ¹é”®â€å’Œâ€œé“¾ç â€çš„2å‹ç¡®å®šæ€§é’±åŒ…æ ¼å¼ã€‚æ—©æœŸç‰ˆæœ¬çš„Armoryéœ€è¦å¤‡ä»½â€œæ ¹é”®â€å’Œâ€œé“¾ç â€ï¼Œè€Œè¾ƒæ–°çš„ç‰ˆæœ¬åˆ™ä»¥ä¸å¯é€†è½¬çš„æ–¹å¼ä»ç§é’¥æ´¾ç”Ÿé“¾ç ã€‚è¿™äº›æ–°çš„Armory(0.89+)åªéœ€è¦ä¸€ä¸ª256ä½çš„æ ¹é”®ã€‚è¿™ç§æ—§æ ¼å¼æ‰“ç®—é€æ­¥æ·˜æ±°ï¼Œä»¥æ”¯æŒæ ‡å‡†BIP0032æ ¼å¼ã€‚","tags":["åŒºå—é“¾","Bitcoin"],"categories":["åŒºå—é“¾"]},{"title":"[ç¿»è¯‘]Bitcoin Addressä»‹ç»","url":"/2018/08/6dcc04b57a51/","content":"\n> åŸæ–‡åœ°å€: https://en.bitcoin.it/wiki/Address\n<!--more--> \n## åœ°å€\n\nä¸€ä¸ªæ¯”ç‰¹å¸åœ°å€æˆ–æ˜¯ä¸€ä¸ªç®€å•åœ°å€ï¼Œæ˜¯ä¸€ä¸ª26-35ä¸ªå­—æ¯æˆ–æ•°å­—ç»„æˆçš„æ ‡è¯†ç¬¦ï¼Œä»¥æ•°å­—1æˆ–3å¼€å¤´ï¼Œè¿™ä»£è¡¨äº†æ¯”ç‰¹å¸æ”¯ä»˜çš„å¯èƒ½ç›®çš„åœ°ã€‚ä»»ä½•æ¯”ç‰¹å¸çš„ä½¿ç”¨è€…ä¸éœ€è¦ä»»ä½•è¯è´¹ä¾¿å¯ä»¥ç”Ÿæˆåœ°å€ã€‚ä¾‹å¦‚ä½¿ç”¨Bitcoin Coreå®¢æˆ·ç«¯ï¼Œç‚¹å‡»â€œNew Addressâ€œå°±ä¼šè¢«åˆ†é…ä¸€ä¸ªåœ°å€ã€‚é€šè¿‡ä¸€ä¸ªäº¤æ˜“æ‰€è´¦å·æˆ–è€…åœ¨çº¿é’±åŒ…æœåŠ¡æ¥è·å¾—æ¯”ç‰¹å¸åœ°å€ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚ç›®å‰æ­£è¢«ä½¿ç”¨ä¸­çš„åœ°å€æœ‰3ç§æ ¼å¼ï¼š\n 1. P2PKHç±»å‹ï¼Œä»¥æ•°å­—`1`å¼€å¤´ï¼Œä¾‹å¦‚ï¼š`1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2`.\n 2. P2SHç±»å‹ï¼Œä»¥æ•°å­—`3`å¼€å¤´ï¼Œä¾‹å¦‚ï¼š`3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLy`.\n 3. Bech32ç±»å‹ï¼Œä»¥`bc1`å¼€å¤´ï¼Œä¾‹å¦‚ï¼š`bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq`.\n\n\n#### æ¯”ç‰¹å¸åœ°å€æ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§çš„ä»¤ç‰Œ\nå°±åƒe-mailåœ°å€ï¼Œä½ å¯ä»¥é€šè¿‡å‘ä¸€ä¸ªäººæ¯”ç‰¹å¸åœ°å€ä¸­çš„ä¸€ä¸ªåœ°å€å‘é€æ¯”ç‰¹å¸æ¥å®ç°ç»™è¿™ä¸ªäººå‘é€æ¯”ç‰¹å¸ã€‚ç„¶è€Œï¼Œå’Œe-mailåœ°å€ä¸åŒçš„æ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥æ‹¥æœ‰å¾ˆå¤šæ¯”ç‰¹å¸åœ°å€ï¼Œæ¯ä¸€æ¬¡äº¤æ˜“åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ã€‚å¤§å¤šæ•°æ¯”ç‰¹å¸è½¯ä»¶å’Œç½‘ç«™éƒ½ä¼šå¸®åŠ©ä½ åœ¨æ¯æ¬¡åˆ›å»ºå‘ç¥¨æˆ–ä»˜æ¬¾è¯·æ±‚æ—¶ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„åœ°å€ã€‚\n\n#### åœ°å€å¯ä»¥ç¦»çº¿åˆ›å»º\nåˆ›å»ºåœ°å€æ— éœ€äº’è”ç½‘è¿æ¥ï¼Œä¹Ÿä¸éœ€è¦ä¸æ¯”ç‰¹å¸ç½‘ç»œè¿›è¡Œä»»ä½•è”ç³»æˆ–æ³¨å†Œã€‚å¯ä»¥ä½¿ç”¨å…è´¹çš„è½¯ä»¶å·¥å…·åˆ›å»ºå¤§é‡ç¦»çº¿åœ°å€ã€‚ç”Ÿæˆå¤§é‡åœ°å€åœ¨å‡ ä¸ªåœºæ™¯å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç”µå­å•†åŠ¡ç½‘ç«™ï¼Œä¸ºæ¯ä¸ªé€‰æ‹©â€œç”¨æ¯”ç‰¹å¸æ”¯ä»˜â€é€‰é¡¹çš„å®¢æˆ·æä¾›ä¸€ä¸ªå”¯ä¸€çš„é¢„å…ˆç”Ÿæˆçš„åœ°å€ã€‚è¾ƒæ–°çš„â€œHDé’±åŒ…â€å¯ä»¥ç”Ÿæˆä¸€ä¸ªâ€œç§å­â€ä»¤ç‰Œï¼Œå¯ä»¥ç”¨æ¥è®©ä¸å—ä¿¡ä»»çš„ç³»ç»Ÿ(å¦‚webservers)ç”Ÿæˆæ— é™æ•°é‡çš„åœ°å€ï¼Œè€Œæ— éœ€èŠ±è´¹æ¥æ”¶åˆ°çš„æ¯”ç‰¹å¸ã€‚\n\n#### åœ°å€é€šå¸¸æ˜¯åŒºåˆ†å¤§å°å†™å’Œå‡†ç¡®çš„\næ—§å¼çš„æ¯”ç‰¹å¸åœ°å€æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚æ¯”ç‰¹å¸çš„åœ°å€åº”è¯¥å°½å¯èƒ½åœ°ä½¿ç”¨ç”µè„‘çš„å‰ªè´´æ¿å¤åˆ¶å’Œç²˜è´´ã€‚å¦‚æœä½ æ‰‹å·¥é”®å…¥ä¸€ä¸ªæ¯”ç‰¹å¸åœ°å€ï¼Œè€Œæ¯ä¸ªå­—ç¬¦éƒ½æ²¡æœ‰è¢«å‡†ç¡®åœ°è½¬å½•(åŒ…æ‹¬å¤§å†™)ï¼Œé‚£ä¹ˆä¸æ­£ç¡®çš„åœ°å€å¾ˆå¯èƒ½ä¼šè¢«æ¯”ç‰¹å¸è½¯ä»¶æ‹’ç»ã€‚ä½ å¿…é¡»æ£€æŸ¥ä½ çš„æ¡ç›®ï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚ä¸€ä¸ªè¾“å…¥é”™è¯¯çš„åœ°å€è¢«æ¥å—ä¸ºæœ‰æ•ˆçš„æ¦‚ç‡æ˜¯1 / 232ï¼Œä¹Ÿå°±æ˜¯å¤§çº¦1 / 42.9äº¿ã€‚æ–°å‹bech32åœ°å€ä¸åŒºåˆ†å¤§å°å†™ã€‚\n\n#### è¯æ˜ä½ æ”¶åˆ°äº†ä¸€ä¸ªåœ°å€\nå¤§å¤šæ•°æ¯”ç‰¹å¸é’±åŒ…éƒ½æœ‰ä¸€ä¸ªâ€œç­¾åâ€ä¿¡æ¯çš„åŠŸèƒ½ï¼Œè¿™å¯ä»¥è¯æ˜æ¥æ”¶èµ„é‡‘çš„å®ä½“å·²ç»åŒæ„è¯¥ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ä»¥ç”¨äºåœ¨æ”¯ä»˜åˆåŒä¹‹å‰ï¼Œä»¥ä¸€ç§åŠ å¯†çš„å¯éªŒè¯çš„æ–¹å¼ç¡®å®šåˆåŒã€‚\næœ‰äº›æœåŠ¡è¿˜å°†åˆ©ç”¨è¿™ç§åŠŸèƒ½ï¼ŒåªæŒ‡å®šä¸€ä¸ªç‰¹å®šçš„åœ°å€è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥åœ°å€æ°¸è¿œä¸åº”è¯¥ç”¨äºå®é™…çš„æ¯”ç‰¹å¸äº¤æ˜“ã€‚å½“æ‚¨ç™»å½•æˆ–ä½¿ç”¨ä»–ä»¬çš„æœåŠ¡æ—¶ï¼Œæ‚¨å°†æä¾›ä¸€ä¸ªç­¾åï¼Œè¯æ˜æ‚¨ä¸é¢„å…ˆå•†å®šçš„åœ°å€ç›¸åŒã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›ç­¾åä»…ä»…è¯æ˜ä¸€ä¸ªäººæ”¶åˆ°äº†ä¸€ä¸ªåœ°å€ã€‚ç”±äºæ¯”ç‰¹å¸äº¤æ˜“æ²¡æœ‰â€œæ¥è‡ªâ€åœ°å€ï¼Œä½ æ— æ³•è¯æ˜ä½ æ˜¯èµ„é‡‘çš„å‘é€è€…ã€‚\nç›®å‰çš„æ¶ˆæ¯ç­¾åæ ‡å‡†ä»…ä¸â€œ0ç‰ˆæœ¬â€çš„æ¯”ç‰¹å¸åœ°å€(ä»¥æ•°å­—1å¼€å¤´)å…¼å®¹ã€‚\n\n#### åœ°å€éªŒè¯\nå¦‚æœå¸Œæœ›åœ¨åº”ç”¨ç¨‹åºä¸­éªŒè¯æ¯”ç‰¹å¸åœ°å€ï¼Œå»ºè®®ä½¿ç”¨[è¿™ä¸ªçº¿ç¨‹ä¸­](https://bitcointalk.org/index.php?topic=1026.0)çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯åªæ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦ã€å…è®¸çš„å­—ç¬¦ï¼Œæˆ–è€…åœ°å€ä»¥1æˆ–3å¼€å¤´ã€‚éªŒè¯è¿˜å¯ä»¥ä½¿ç”¨[å„ç§è¯­è¨€](http://rosettacode.org/wiki/Bitcoin/address_validation)çš„å¼€æ”¾æºä»£ç æˆ–ä½¿ç”¨[åœ¨çº¿éªŒè¯å·¥å…·](http://lenschulwitz.com/base58)è¿›è¡Œã€‚\n\n#### å¤šé‡ç­¾åçš„åœ°å€\nå¯ä»¥åˆ›å»ºéœ€è¦å¤šä¸ªç§é’¥ç»„åˆçš„åœ°å€ã€‚ç”±äºå®ƒä»¬åˆ©ç”¨äº†è¾ƒæ–°çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å®ƒä»¬ä»¥è¾ƒæ–°çš„å‰ç¼€3è€Œä¸æ˜¯æ—§çš„1å¼€å§‹ã€‚è¿™å¯ä»¥è¢«çœ‹ä½œæ˜¯å‘ä¸¤æ–¹å¼€å‡ºæ”¯ç¥¨â€”â€”â€œæ”¯ä»˜ç»™æŸäººå’Œå…¶ä»–äººçš„è®¢å•â€â€”â€”åŒæ–¹å¿…é¡»åœ¨æ”¯ç¥¨ä¸Šç­¾å­—ä»¥è·å¾—èµ„é‡‘ã€‚\nå¿…é¡»æ»¡è¶³çš„å®é™…éœ€æ±‚(æ‰€éœ€çš„ç§é’¥æ•°é‡ã€ç›¸åº”çš„å…¬é’¥ç­‰)æ˜¯ç”±ç”Ÿæˆæ­¤ç±»åœ°å€çš„äººé¢„å…ˆå†³å®šçš„ï¼Œä¸€æ—¦åˆ›å»ºäº†åœ°å€ï¼Œå°±ä¸èƒ½åœ¨ä¸ç”Ÿæˆæ–°åœ°å€çš„æƒ…å†µä¸‹æ›´æ”¹è¯¥éœ€æ±‚ã€‚\n\n#### ä¸€ä¸ªåœ°å€é‡Œæœ‰ä»€ä¹ˆ\nå¤§å¤šæ•°æ¯”ç‰¹å¸çš„åœ°å€æ˜¯34ä¸ªå­—ç¬¦ã€‚å®ƒä»¬ç”±éšæœºæ•°å­—ã€å¤§å†™å­—æ¯å’Œå°å†™å­—æ¯ç»„æˆï¼Œé™¤äº†å¤§å†™å­—æ¯â€œOâ€ã€å¤§å†™å­—æ¯â€œIâ€ã€å°å†™å­—æ¯â€œlâ€å’Œæ•°å­—â€œ0â€ä»æœªä½¿ç”¨æ¥é¿å…è§†è§‰ä¸Šçš„æ­§ä¹‰ã€‚\nä¸€äº›æ¯”ç‰¹å¸åœ°å€å¯ä»¥çŸ­äº34ä¸ªå­—ç¬¦(å°‘åˆ°26ä¸ªå­—ç¬¦)ï¼Œä½†ä»ç„¶æœ‰æ•ˆã€‚ç›¸å½“å¤§æ¯”ä¾‹çš„æ¯”ç‰¹å¸åœ°å€åªæœ‰33ä¸ªå­—ç¬¦ï¼Œæœ‰äº›ç”šè‡³å¯èƒ½æ›´çŸ­ã€‚æ¯ä¸ªæ¯”ç‰¹å¸åœ°å€ä»£è¡¨ä¸€ä¸ªæ•°å­—ã€‚è¿™äº›è¾ƒçŸ­çš„åœ°å€æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºå®ƒä»¬ä»£è¡¨çš„æ˜¯æ°å¥½ä»¥0å¼€å¤´çš„æ•°å­—ï¼Œå½“è¿™äº›0è¢«çœç•¥æ—¶ï¼Œç¼–ç çš„åœ°å€å°±ä¼šå˜çŸ­ã€‚\næ¯”ç‰¹å¸åœ°å€ä¸­æœ‰å‡ ä¸ªå­—ç¬¦è¢«ç”¨ä½œæ ¡éªŒå’Œï¼Œå› æ­¤å¯ä»¥è‡ªåŠ¨æŸ¥æ‰¾å’Œæ‹’ç»æ’ç‰ˆé”™è¯¯ã€‚æ ¡éªŒå’Œè¿˜å…è®¸æ¯”ç‰¹å¸è½¯ä»¶ç¡®è®¤ä¸€ä¸ª33ä¸ªå­—ç¬¦(æˆ–æ›´çŸ­)çš„åœ°å€å®é™…ä¸Šæ˜¯æœ‰æ•ˆçš„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç¼ºå°‘å­—ç¬¦çš„åœ°å€ã€‚\n\n#### æµ‹è¯•ç½‘ç»œ\næ¯”ç‰¹å¸Testnetä¸Šçš„åœ°å€æ˜¯ç”¨ä¸åŒçš„åœ°å€ç‰ˆæœ¬ç”Ÿæˆçš„ï¼Œè¿™ä¼šäº§ç”Ÿä¸åŒçš„å‰ç¼€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…åœ°å€å‰ç¼€å’ŒTestnetåˆ—è¡¨ã€‚\n\n### è¯¯è§£\n\n#### åœ°å€é‡ç”¨\nåœ°å€ä¸æ‰“ç®—è¢«ä½¿ç”¨å¤šæ¬¡ï¼Œè¿™æ ·åšæœ‰è®¸å¤šç›¸å…³çš„é—®é¢˜ã€‚æœ‰å…³åœ°å€é‡ç”¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸“é—¨çš„æ–‡ç« ã€‚\n\n#### åœ°å€ä½™é¢\nåœ°å€ä¸æ˜¯é’±åŒ…æˆ–è´¦æˆ·ï¼Œä¹Ÿæ²¡æœ‰ä½™é¢ã€‚ä»–ä»¬åªæ”¶é’±ï¼Œè€Œä½ åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸å‘é€â€œä»â€åœ°å€ã€‚å„ç§æ··ä¹±çš„æœåŠ¡å’Œè½¯ä»¶æ˜¾ç¤º'ç”¨ä¸€ä¸ªåœ°å€æ¥æ”¶æ¯”ç‰¹å¸',ä»éšæœºä¸ç›¸å…³çš„äº¤æ˜“ä¸­å‡å»å·²å‘é€çš„æ¯”ç‰¹å¸ä½œä¸ºä¸€ä¸ª'åœ°å€ä½™é¢',ä½†è¿™ä¸ªæ•°å­—æ˜¯æ²¡æœ‰æ„ä¹‰çš„:å®ƒå¹¶ä¸æ„å‘³ç€å‘è¿™ä¸ªåœ°å€å‘é€çš„æ¯”ç‰¹å¸çš„æ¥æ”¶è€…å·²ç»èŠ±æ‰äº†å®ƒä»¬ï¼Œä¹Ÿä¸æ„å‘³ç€ä»–ä»¬ä»ç„¶æŒæœ‰æ¥æ”¶çš„æ¯”ç‰¹å¸ã€‚\nè¿™ç§è¯¯è§£é€ æˆæ¯”ç‰¹å¸æŸå¤±çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œäººä»¬è®¤ä¸ºä»–ä»¬çš„åœ°å€åŒ…å«3btcã€‚ä»–ä»¬èŠ±äº†0.5æ¯”ç‰¹å¸ï¼Œè®¤ä¸ºåœ°å€ç°åœ¨åŒ…å«2.5æ¯”ç‰¹å¸ï¼Œè€Œå®é™…ä¸Šå®ƒåŒ…å«é›¶æ¯”ç‰¹å¸ã€‚å‰©ä½™çš„2.5æ¯”ç‰¹å¸è¢«è½¬ç§»åˆ°ä¸€ä¸ªæ²¡æœ‰å¤‡ä»½çš„æ›´æ”¹åœ°å€ï¼Œå› æ­¤ä¸¢å¤±ã€‚è¿™å‘ç”Ÿåœ¨ä¸€äº›ä½¿ç”¨çº¸è´¨é’±åŒ…çš„ç”¨æˆ·çš„åœºåˆã€‚\n\n#### â€œä»â€œåœ°å€\næ¯”ç‰¹å¸äº¤æ˜“æ²¡æœ‰ä»»ä½•æ¥æºâ€”â€”æ¥æºâ€”â€”æˆ–â€œæ¥è‡ªâ€åœ°å€ã€‚æœ‰å…³â€œæ¥è‡ªåœ°å€â€çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸“é—¨çš„æ–‡ç« ã€‚\n\n#### åœ°å€å›¾\n[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-S43U7xMP-1625627005514)(https://en.bitcoin.it/w/images/en/4/48/Address_map.jpg)]\n","tags":["åŒºå—é“¾","Bitcoin"],"categories":["åŒºå—é“¾"]},{"title":"LinuxæœåŠ¡å™¨å¸¸ç”¨å‘½ä»¤","url":"/2018/07/6e2872c17d01/","content":"æˆ‘å¸¸ç”¨åˆ°çš„æ˜¯è¿™å‡ ä¸ªï¼š\n<!--more--> \n### systemctl\n- systemctl status name.service\n   æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„çŠ¶æ€\n- systemctl | grep name-partern\n   è¿‡æ»¤æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡åç¬¦åˆname-parternçš„æœåŠ¡\n- systemctl enable name.service\n   è®¾ç½®å¼€æœºè‡ªå¯\n- systemctl restart name.service\n  é‡å¯æœåŠ¡\n\n### journalctl\n- journalctl -f -u unit-name\n  å®æ—¶æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„log\n- journalctl --since 18:34 --until 19:12 -u unit-name\n  æŸ¥çœ‹æŸä¸ªæœåŠ¡åœ¨è¯¥æ—¶é—´æ®µå†…çš„log\n- journactl --since '2018-07-29 19:00' --until now -u unit-name\n  æŸ¥çœ‹æ—¶é—´æ®µå†…çš„æ—¥å¿—\n\n### grep\n- grep -E 'regex'\n  æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤\n- grep -w 'wrod'\n  æ ¹æ®å•è¯wordè¿‡æ»¤\n- grep -c 'target'\n  æ˜¾ç¤ºè¿‡æ»¤åçš„è¡Œæ•°\n\n### tail\n- tail -n 2000 file.name\n  æ˜¾ç¤ºæ–‡ä»¶æœ«å°¾çš„2000è¡Œå†…å®¹\n- tail -f file.name\n  å®æ—¶æ˜¾ç¤ºæ–‡ä»¶æœ€æ–°è¿½åŠ çš„å†…å®¹\n- tail -s 1\n  æ˜¾ç¤ºå†…å®¹åˆ·æ–°æ—¶é—´é—´éš”ä¸º1ç§’\n\n### ls\n- ls -l\n  ä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤º\n- ls -a\n  æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶\n- ls -h\n  ä»¥ä¾¿äºé˜…è¯»çš„æ–¹å¼æ˜¾ç¤º\n- ls -S\n  æŒ‰ç…§æ–‡ä»¶å¤§å°æ’åº\n\n### vi\n- :set nu\n  æ˜¾ç¤ºè¡Œå·\n- :set nonu\n  éšè—è¡Œå·\n- 0\n  ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–\n- $\n  ç§»åŠ¨å…‰æ ‡åˆ°è¡Œå°¾\n- gg\n  ç§»åŠ¨å…‰æ ‡åˆ°å†…å®¹å¼€å¤´\n- G\n  ç§»åŠ¨å…‰æ ‡åˆ°å†…å®¹ç»“æŸ\n- dd\n  åˆ é™¤è¡Œ\n- x\n  åˆ é™¤ä¸€ä¸ªå­—ç¬¦\n- r\n  æ›¿æ¢ä¸€ä¸ªå­—ç¬¦\n- R\n  ä¸€ç›´æ›¿æ¢\n- u\n  æ’¤é”€ä¸Šæ¬¡æ“ä½œ\n- 10 j\n  å‘ä¸‹ç§»åŠ¨å…‰æ ‡10è¡Œ\n- /c[ok]\\\\{1\\\\}mplete\n  æŸ¥æ‰¾complete\n","tags":["Linux"],"categories":["Linux"]},{"title":"æŒç»­é›†æˆä¸è‡ªåŠ¨åŒ–æµ‹è¯• Continuous Integrationï¼ŒCI","url":"/2018/05/262671d24b2e/","content":"\n> æ‰€è°“æŒç»­é›†æˆä¸è‡ªåŠ¨åŒ–ï¼Œæ˜¯æŒ‡ç”¨æœºå™¨æ›¿ä»£äººå·¥æŒç»­ä¸é—´æ–­åœ°é›†æˆä»£ç ï¼Œè®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯ä»£ç è´¨é‡ã€‚ä¸€ä¸ªå®Œæ•´çš„æŒç»­é›†æˆç¯å¢ƒéœ€è¦Jenkinsä¸Gitã€Gerritä¸€èµ·é…åˆï¼Œæ‰èƒ½å‘æŒ¥å‡ºå®ƒæœ€å¼ºå¤§çš„åŠŸèƒ½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å¼€å‘è€…Pushä»£ç åä¼šé¦–å…ˆåˆ°Gerritè¿›è¡Œä»£ç Reviewã€‚Reviewåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ä½¿ç”¨ç¨‹åºçš„è‡ªåŠ¨åŒ–Reviewï¼Œä¸»è¦æ˜¯é€šè¿‡é™æ€ä»£ç æ£€æµ‹å·¥å…·æ¥è¿›è¡Œä»£ç è´¨é‡åˆ†æï¼ˆæ¯”å¦‚Sonarã€CheckStyleã€FindBugsç­‰ï¼‰ï¼›å¦ä¸€éƒ¨åˆ†æ˜¯äººå·¥Reviewï¼Œä¸»è¦æ£€æµ‹ä»£ç çš„è¿è¡Œé€»è¾‘ï¼Œå½“Reviewå®Œæ¯•åï¼Œé€šè¿‡Git hookã€Jenkinså®Œæˆä»£ç çš„è‡ªåŠ¨æ‹‰å–ã€ç¼–è¯‘å’Œéƒ¨ç½²ï¼Œæœ€åé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å®Œæˆæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„æµ‹è¯•æŠ¥è¡¨ã€‚è¿™æ ·ä¸€æ•´ä¸ªæµ‹è¯•æµç¨‹éœ€è¦äººå·¥æ¥åšçš„ä¹Ÿå°±æ˜¯äººå·¥ä»£ç Reviewéƒ¨åˆ†ï¼Œè€Œå…¶ä»–éƒ¨åˆ†å…¨éƒ¨é€šè¿‡è‡ªåŠ¨åŒ–æ¥å®ç°ï¼Œç”šè‡³å¯ä»¥åœ¨åŠå¤œå¯¹ç¨‹åºè¿›è¡Œä¸é—´æ–­Monkeyæµ‹è¯•ï¼Œæµ‹è¯•ç¨³å®šæ€§å’Œæ½œåœ¨é—®é¢˜ã€‚\n<!--more--> \n**æ‘˜è‡ªã€ŠAndroidç¾¤è‹±ä¼ ï¼šç¥å…µåˆ©å™¨ã€‹**","tags":["Android","CI"],"categories":["Android"]},{"title":"Javaç»§æ‰¿æœºåˆ¶çš„å¼Šç«¯","url":"/2018/05/d71d19b7fe7b/","content":"\nè½¬è½½ï¼ŒåŸæ–‡é“¾æ¥:http://www.sunxin.org/forum/thread/20672.html# \n\nä¸ºä»€ä¹ˆJavaä¸­ç»§æ‰¿å¤šæ•°æ˜¯æœ‰å®³çš„ \n<!--more--> \nå¤§å¤šæ•°å¥½çš„è®¾è®¡è€…è±¡èº²é¿ç˜Ÿç–«ä¸€æ ·æ¥é¿å…ä½¿ç”¨å®ç°ç»§æ‰¿(`extends` å…³ç³»)ã€‚å®é™…ä¸Š80%çš„ä»£ç åº”è¯¥å®Œå…¨ç”¨`interface`å†™,è€Œä¸æ˜¯é€šè¿‡`extends`ã€‚Javaè®¾è®¡æ¨¡å¼ä¸€ä¹¦è¯¦ç»†é˜è¿°äº†æ€æ ·ç”¨æ¥å£ç»§æ‰¿ä»£æ›¿å®ç°ç»§æ‰¿ã€‚è¿™ç¯‡æ–‡ç« æè¿°è®¾è®¡è€…ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆä½œã€‚ \n\n`Extends`æ˜¯æœ‰å®³çš„;ä¹Ÿè®¸å¯¹äº*Charles Manson*è¿™ä¸ªçº§åˆ«çš„ä¸æ˜¯,ä½†æ˜¯è¶³å¤Ÿç³Ÿç³•çš„å®ƒåº”è¯¥åœ¨ä»»ä½•å¯èƒ½çš„æ—¶å€™è¢«é¿å¼€ã€‚JAVAè®¾è®¡æ¨¡å¼ä¸€ä¹¦èŠ±äº†å¾ˆå¤§çš„éƒ¨åˆ†è®¨è®ºç”¨`interface`ç»§æ‰¿ä»£æ›¿å®ç°ç»§æ‰¿ã€‚ \n\nå¥½çš„è®¾è®¡è€…åœ¨ä»–çš„ä»£ç ä¸­,å¤§éƒ¨åˆ†ç”¨`interface`,è€Œä¸æ˜¯å…·ä½“çš„åŸºç±»ã€‚æœ¬æ–‡è®¨è®ºä¸ºä»€ä¹ˆè®¾è®¡è€…ä¼šè¿™æ ·é€‰æ‹©,å¹¶ä¸”ä¹Ÿä»‹ç»ä¸€äº›åŸºäº`interface`çš„ç¼–ç¨‹åŸºç¡€ã€‚ \n\n- æ¥å£(`Interface`)å’Œç±»(`Class`)? \n\nä¸€æ¬¡,æˆ‘å‚åŠ ä¸€ä¸ªJavaç”¨æˆ·ç»„çš„ä¼šè®®ã€‚åœ¨ä¼šè®®ä¸­,*Jams Gosling*(Javaä¹‹çˆ¶)åšå‘èµ·äººè®²è¯ã€‚åœ¨é‚£ä»¤äººéš¾å¿˜çš„Q&Aéƒ¨åˆ†ä¸­,æœ‰äººé—®ä»–:å¦‚æœä½ é‡æ–°æ„é€ Java,ä½ æƒ³æ”¹å˜ä»€ä¹ˆ?ã€‚æˆ‘æƒ³æŠ›å¼ƒclassesä»–å›ç­”ã€‚åœ¨ç¬‘å£°å¹³æ¯å,å®ƒè§£é‡Šè¯´,çœŸæ­£çš„é—®é¢˜ä¸æ˜¯ç”±äºclassæœ¬èº«,è€Œæ˜¯å®ç°ç»§æ‰¿(`extends`) å…³ç³»ã€‚æ¥å£ç»§æ‰¿(`implements`å…³ç³»)æ˜¯æ›´å¥½çš„ã€‚ä½ åº”è¯¥å°½å¯èƒ½çš„é¿å…å®ç°ç»§æ‰¿ã€‚ \n\n- å¤±å»äº†çµæ´»æ€§ \n\nä¸ºä»€ä¹ˆä½ åº”è¯¥é¿å…å®ç°ç»§æ‰¿å‘¢?ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯æ˜ç¡®çš„ä½¿ç”¨å…·ä½“ç±»åå°†ä½ å›ºå®šåˆ°ç‰¹å®šçš„å®ç°,ç»™åº•å±‚çš„æ”¹å˜å¢åŠ äº†ä¸å¿…è¦çš„å›°éš¾ã€‚ \n\nåœ¨å½“å‰çš„æ•æ·ç¼–ç¨‹æ–¹æ³•ä¸­,æ ¸å¿ƒæ˜¯å¹¶è¡Œçš„è®¾è®¡å’Œå¼€å‘çš„æ¦‚å¿µã€‚åœ¨ä½ è¯¦ç»†è®¾è®¡ç¨‹åºå‰,ä½ å¼€å§‹ç¼–ç¨‹ã€‚è¿™ä¸ªæŠ€æœ¯ä¸åŒäºä¼ ç»Ÿæ–¹æ³•çš„å½¢å¼----ä¼ ç»Ÿçš„æ–¹å¼æ˜¯è®¾è®¡åº”è¯¥åœ¨ç¼–ç å¼€å§‹å‰å®Œæˆ----ä½†æ˜¯è®¸å¤šæˆåŠŸçš„é¡¹ç›®å·²ç»è¯æ˜ä½ èƒ½å¤Ÿæ›´å¿«é€Ÿçš„å¼€å‘é«˜è´¨é‡ä»£ç ,ç›¸å¯¹äºä¼ ç»Ÿçš„æŒ‰éƒ¨å°±ç­çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å¹¶è¡Œå¼€å‘çš„æ ¸å¿ƒæ˜¯ä¸»å¼ çµæ´»æ€§ã€‚ä½ ä¸å¾—ä¸ä»¥æŸä¸€ç§æ–¹å¼å†™ä½ çš„ä»£ç ä»¥è‡³äºæœ€æ–°å‘ç°çš„éœ€æ±‚èƒ½å¤Ÿå°½å¯èƒ½æ²¡æœ‰ç—›è‹¦çš„åˆå¹¶åˆ°å·²æœ‰çš„ä»£ç ä¸­ã€‚ \n\nèƒœäºå®ç°ä½ ä¹Ÿè®¸éœ€è¦çš„ç‰¹å¾,ä½ åªéœ€å®ç°ä½ æ˜ç¡®éœ€è¦çš„ç‰¹å¾,è€Œä¸”é€‚åº¦çš„å¯¹å˜åŒ–çš„åŒ…å®¹ã€‚å¦‚æœä½ æ²¡æœ‰è¿™ç§çµæ´»,å¹¶è¡Œçš„å¼€å‘,é‚£ç®€ç›´ä¸å¯èƒ½ã€‚ \n\nå¯¹äº`Inteface`çš„ç¼–ç¨‹æ˜¯çµæ´»ç»“æ„çš„æ ¸å¿ƒã€‚ä¸ºäº†è¯´æ˜ä¸ºä»€ä¹ˆ,è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å½“ä½¿ç”¨å®ƒä»¬çš„æ—¶å€™,ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è€ƒè™‘ä¸‹é¢çš„ä»£ç : \n```Java\nf() { \n\tLinkedList list = new LinkedList(); \n\tg(list); \n} \ng(LinkedList list) { \n\tlist.add( ... ); \n\tg2(list) ;\n} \n```\nå‡è®¾ä¸€ä¸ªå¯¹äºå¿«é€ŸæŸ¥è¯¢çš„éœ€æ±‚è¢«æå‡º,ä»¥è‡³äºè¿™ä¸ª`LinkedList`ä¸èƒ½å¤Ÿè§£å†³ã€‚ä½ éœ€è¦ç”¨`HashSet`æ¥ä»£æ›¿å®ƒã€‚åœ¨å·²æœ‰ä»£ç ä¸­,å˜åŒ–ä¸èƒ½å¤Ÿå±€éƒ¨åŒ–,å› ä¸ºä½ ä¸ä»…ä»…éœ€è¦ä¿®æ”¹`f()`ä¹Ÿéœ€è¦ä¿®æ”¹`g()`(å®ƒå¸¦æœ‰`LinkedList`å‚æ•°),å¹¶ä¸”è¿˜æœ‰`g()`æŠŠåˆ—è¡¨ä¼ é€’ç»™çš„ä»»ä½•ä»£ç ã€‚åƒä¸‹é¢è¿™æ ·é‡å†™ä»£ç : \n```Java\nf() { \n\tCollection list = new LinkedList(); \n\tg(list); \n} \ng(Collection list) { \n\tlist.add(...); \n\tg2(list);\n} \n```\nè¿™æ ·ä¿®æ”¹Linked listæˆhash,å¯èƒ½åªæ˜¯ç®€å•çš„ç”¨new HashSet()ä»£æ›¿new LinkedList()ã€‚å°±è¿™æ ·ã€‚æ²¡æœ‰å…¶ä»–çš„éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ã€‚ \n\nä½œä¸ºå¦ä¸€ä¸ªä¾‹å­,æ¯”è¾ƒä¸‹é¢ä¸¤æ®µä»£ç : \n```Java\nf() { \n\tCollection c = new HashSet(); \n\t//... \n\tg( c ); \n} \ng(Collection c) { \n\tfor(Iterator i = c.iterator(); i.hasNext()) \n\t\tdo_something_with(i.next()); \n} \nf2() { \n\tCollection c = new HashSet(); \n\t//... \n\tg2( c.iterator() ); \n} \ng2(Iterator i) { \n\twhile(i.hasNext()) \n\t\tdo_something_with(i.next()); \n} \n```\n\n`g2()`æ–¹æ³•ç°åœ¨èƒ½å¤Ÿéå†`Collection`çš„æ´¾ç”Ÿ,å°±åƒä½ èƒ½å¤Ÿä»`Map`ä¸­å¾—åˆ°çš„é”®å€¼å¯¹ã€‚äº‹å®ä¸Š,ä½ èƒ½å¤Ÿå†™`iterator`,å®ƒäº§ç”Ÿæ•°æ®,ä»£æ›¿éå†ä¸€ä¸ª`Collection`ã€‚ä½ èƒ½å¤Ÿå†™`iterator`,å®ƒä»æµ‹è¯•çš„æ¡†æ¶æˆ–è€…æ–‡ä»¶ä¸­å¾—åˆ°ä¿¡æ¯ã€‚è¿™ä¼šæœ‰å·¨å¤§çš„çµæ´»æ€§ã€‚ \n\n- è€¦åˆ \n\nå¯¹äºå®ç°ç»§æ‰¿,ä¸€ä¸ªæ›´åŠ å…³é”®çš„é—®é¢˜æ˜¯è€¦åˆ---ä»¤äººçƒ¦èºçš„ä¾èµ–,å°±æ˜¯é‚£ç§ç¨‹åºçš„ä¸€éƒ¨åˆ†å¯¹äºå¦ä¸€éƒ¨åˆ†çš„ä¾èµ–ã€‚å…¨å±€å˜é‡æä¾›ç»å…¸çš„ä¾‹å­,è¯æ˜ä¸ºä»€ä¹ˆå¼ºè€¦åˆä¼šå¼•èµ·éº»çƒ¦ã€‚ä¾‹å¦‚,å¦‚æœä½ æ”¹å˜å…¨å±€å˜é‡çš„ç±»å‹,é‚£ä¹ˆæ‰€æœ‰ç”¨åˆ°è¿™ä¸ªå˜é‡çš„å‡½æ•°ä¹Ÿè®¸éƒ½è¢«å½±å“,æ‰€ä»¥æ‰€æœ‰è¿™äº›ä»£ç éƒ½è¦è¢«æ£€æŸ¥,å˜æ›´å’Œé‡æ–°æµ‹è¯•ã€‚è€Œä¸”,æ‰€æœ‰ç”¨åˆ°è¿™ä¸ªå˜é‡çš„å‡½æ•°é€šè¿‡è¿™ä¸ªå˜é‡ç›¸äº’è€¦åˆã€‚ä¹Ÿå°±æ˜¯,å¦‚æœä¸€ä¸ªå˜é‡å€¼åœ¨éš¾ä»¥ä½¿ç”¨çš„æ—¶å€™è¢«æ”¹å˜,ä¸€ä¸ªå‡½æ•°ä¹Ÿè®¸å°±ä¸æ­£ç¡®çš„å½±å“äº†å¦ä¸€ä¸ªå‡½æ•°çš„è¡Œä¸ºã€‚è¿™ä¸ªé—®é¢˜æ˜¾è‘—çš„éšè—äºå¤šçº¿ç¨‹çš„ç¨‹åºã€‚ \n\nä½œä¸ºä¸€ä¸ªè®¾è®¡è€…,ä½ åº”è¯¥åŠªåŠ›æœ€å°åŒ–è€¦åˆå…³ç³»ã€‚ä½ ä¸èƒ½ä¸€å¹¶æ¶ˆé™¤è€¦åˆ,å› ä¸ºä»ä¸€ä¸ªç±»çš„å¯¹è±¡åˆ°å¦ä¸€ä¸ªç±»çš„å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ˜¯ä¸€ä¸ªæ¾è€¦åˆçš„å½¢å¼ã€‚ä½ ä¸å¯èƒ½æœ‰ä¸€ä¸ªç¨‹åº,å®ƒæ²¡æœ‰ä»»ä½•çš„è€¦åˆã€‚ç„¶è€Œ,ä½ èƒ½å¤Ÿé€šè¿‡éµå®ˆOOè§„åˆ™,æœ€å°åŒ–ä¸€å®šçš„è€¦åˆ(æœ€é‡è¦çš„æ˜¯,ä¸€ä¸ªå¯¹è±¡çš„å®ç°åº”è¯¥å®Œå…¨éšè—äºä½¿ç”¨ä»–çš„å¯¹è±¡)ã€‚ä¾‹å¦‚,ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹å˜é‡(ä¸æ˜¯å¸¸é‡çš„æˆå‘˜åŸŸ),åº”è¯¥æ€»æ˜¯`private`ã€‚æˆ‘æ„æ€æ˜¯æŸæ®µæ—¶æœŸçš„,æ— ä¾‹å¤–çš„,ä¸æ–­çš„ã€‚(ä½ èƒ½å¤Ÿå¶å°”æœ‰æ•ˆåœ°ä½¿ç”¨`protected`æ–¹æ³•,ä½†æ˜¯`protected`å®ä¾‹å˜é‡æ˜¯å¯æ†çš„äº‹)åŒæ ·çš„åŸå› ä½ åº”è¯¥ä¸ç”¨get/setå‡½æ•°---ä»–ä»¬å¯¹äºæ˜¯ä¸€ä¸ªåŸŸå…¬ç”¨åªæ˜¯ä½¿äººæ„Ÿåˆ°è¿‡äºå¤æ‚çš„æ–¹å¼(å°½ç®¡è¿”å›ä¿®é¥°çš„å¯¹è±¡è€Œä¸æ˜¯åŸºæœ¬ç±»å‹å€¼çš„è®¿é—®å‡½æ•°æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ç”±åŸå› çš„,é‚£ç§æƒ…å†µä¸‹,è¿”å›çš„å¯¹è±¡ç±»æ˜¯ä¸€ä¸ªåœ¨è®¾è®¡æ—¶çš„å…³é”®æŠ½è±¡)ã€‚ \n\nè¿™é‡Œ,æˆ‘ä¸æ˜¯ä¹¦ç”Ÿæ°”ã€‚åœ¨æˆ‘è‡ªå·±çš„å·¥ä½œä¸­,æˆ‘å‘ç°ä¸€ä¸ªç›´æ¥çš„ç›¸äº’å…³ç³»åœ¨æˆ‘OOæ–¹æ³•çš„ä¸¥æ ¼ä¹‹é—´,å¿«é€Ÿä»£ç å¼€å‘å’Œå®¹æ˜“çš„ä»£ç å®ç°ã€‚æ— è®ºä»€ä¹ˆæ—¶å€™æˆ‘è¿åä¸­å¿ƒçš„OOåŸåˆ™,å¦‚å®ç°éšè—,æˆ‘ç»“æœé‡å†™é‚£ä¸ªä»£ç (ä¸€èˆ¬å› ä¸ºä»£ç æ˜¯ä¸å¯è°ƒè¯•çš„)ã€‚æˆ‘æ²¡æœ‰æ—¶é—´é‡å†™ä»£ç ,æ‰€ä»¥æˆ‘éµå¾ªé‚£äº›è§„åˆ™ã€‚æˆ‘å…³å¿ƒçš„å®Œå…¨å®ç”¨?æˆ‘å¯¹å¹²å‡€çš„åŸå› æ²¡æœ‰å…´è¶£ã€‚ \n\n- è„†å¼±çš„åŸºç±»é—®é¢˜ \n\nç°åœ¨,è®©æˆ‘ä»¬åº”ç”¨è€¦åˆçš„æ¦‚å¿µåˆ°ç»§æ‰¿ã€‚åœ¨ä¸€ä¸ªç”¨`extends`çš„ç»§æ‰¿å®ç°ç³»ç»Ÿä¸­,æ´¾ç”Ÿç±»æ˜¯éå¸¸ç´§å¯†çš„å’ŒåŸºç±»è€¦åˆ,å½“ä¸”è¿™ç§ç´§å¯†çš„è¿æ¥æ˜¯ä¸æœŸæœ›çš„ã€‚è®¾è®¡è€…å·²ç»åº”ç”¨äº†ç»°å·è„†å¼±çš„åŸºç±»é—®é¢˜å»æè¿°è¿™ä¸ªè¡Œä¸ºã€‚åŸºç¡€ç±»è¢«è®¤ä¸ºæ˜¯è„†å¼±çš„æ˜¯,å› ä¸ºä½ åœ¨çœ‹èµ·æ¥å®‰å…¨çš„æƒ…å†µä¸‹ä¿®æ”¹åŸºç±»,ä½†æ˜¯å½“ä»æ´¾ç”Ÿç±»ç»§æ‰¿æ—¶,æ–°çš„è¡Œä¸ºä¹Ÿè®¸å¼•èµ·æ´¾ç”Ÿç±»å‡ºç°åŠŸèƒ½ç´Šä¹±ã€‚ä½ ä¸èƒ½é€šè¿‡ç®€å•çš„åœ¨éš”ç¦»ä¸‹æ£€æŸ¥åŸºç±»çš„æ–¹æ³•æ¥åˆ†è¾¨åŸºç±»çš„å˜åŒ–æ˜¯å®‰å…¨çš„;è€Œæ˜¯ä½ ä¹Ÿå¿…é¡»çœ‹(å’Œæµ‹è¯•)æ‰€æœ‰æ´¾ç”Ÿç±»ã€‚è€Œä¸”,ä½ å¿…é¡»æ£€æŸ¥æ‰€æœ‰çš„ä»£ç ,å®ƒä»¬ä¹Ÿç”¨åœ¨åŸºç±»å’Œæ´¾ç”Ÿç±»å¯¹è±¡ä¸­,å› ä¸ºè¿™ä¸ªä»£ç ä¹Ÿè®¸è¢«æ–°çš„è¡Œä¸ºæ‰€æ‰“ç ´ã€‚ä¸€ä¸ªå¯¹äºåŸºç¡€ç±»çš„ç®€å•å˜åŒ–å¯èƒ½å¯¼è‡´æ•´ä¸ªç¨‹åºä¸å¯æ“ä½œã€‚ \n\nè®©æˆ‘ä»¬ä¸€èµ·æ£€æŸ¥è„†å¼±çš„åŸºç±»å’ŒåŸºç±»è€¦åˆçš„é—®é¢˜ã€‚ä¸‹é¢çš„ç±»`extends`äº†Javaçš„`ArrayList`ç±»å»ä½¿å®ƒåƒä¸€ä¸ª`stack`æ¥è¿è½¬: \n```Java\nclass Stack extends ArrayList { \n\tprivate int stack_pointer = 0; \n\tpublic void push( Object article ) { \n\t\tadd( stack_pointer++, article ); \n\t} \n\tpublic Object pop() { \n\t\treturn remove( --stack_pointer ); \n\t} \n\tpublic void push_many( Object[] articles ) { \n\t\tfor( int i = 0; i < articles.length; ++i ) \n\t\t\tpush( articles[i] ); \n\t} \n} \n```\nç”šè‡³ä¸€ä¸ªè±¡è¿™æ ·ç®€å•çš„ç±»ä¹Ÿæœ‰é—®é¢˜ã€‚æ€è€ƒå½“ä¸€ä¸ªç”¨æˆ·å¹³è¡¡ç»§æ‰¿å’Œç”¨`ArrayList`çš„`clear()`æ–¹æ³•å»å¼¹å‡ºå †æ ˆæ—¶: \n```java\nStack a_stack = new Stack(); \na_stack.push(\"1\"); \na_stack.push(\"2\"); \na_stack.clear(); \n```\nè¿™ä¸ªä»£ç æˆåŠŸç¼–è¯‘,ä½†æ˜¯å› ä¸ºåŸºç±»ä¸çŸ¥é“å…³äº`stack`æŒ‡é’ˆå †æ ˆçš„æƒ…å†µ,è¿™ä¸ª`stack`å¯¹è±¡å½“å‰åœ¨ä¸€ä¸ªæœªå®šä¹‰çš„çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªå¯¹äº`push()`è°ƒç”¨æŠŠæ–°çš„é¡¹æ”¾å…¥ç´¢å¼•2çš„ä½ç½®ã€‚(`stack_pointer`çš„å½“å‰å€¼),æ‰€ä»¥`stack`æœ‰æ•ˆåœ°æœ‰ä¸‰ä¸ªå…ƒç´ -ä¸‹è¾¹ä¸¤ä¸ªæ˜¯åƒåœ¾ã€‚(Javaçš„stackç±»æ­£æ˜¯æœ‰è¿™ä¸ªé—®é¢˜,ä¸è¦ç”¨å®ƒ). \n\nå¯¹è¿™ä¸ªä»¤äººè®¨åŒçš„ç»§æ‰¿çš„æ–¹æ³•é—®é¢˜çš„è§£å†³åŠæ³•æ˜¯ä¸º`Stack`è¦†ç›–æ‰€æœ‰çš„`ArrayList`æ–¹æ³•,é‚£èƒ½å¤Ÿä¿®æ”¹æ•°ç»„çš„çŠ¶æ€,æ‰€ä»¥è¦†ç›–æ­£ç¡®çš„æ“ä½œ`Stack`æŒ‡é’ˆæˆ–è€…æŠ›å‡ºä¸€ä¸ªä¾‹å¤–ã€‚(`removeRange()`æ–¹æ³•å¯¹äºæŠ›å‡ºä¸€ä¸ªä¾‹å¤–ä¸€ä¸ªå¥½çš„å€™é€‰æ–¹æ³•)ã€‚ \n\nè¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚ç¬¬ä¸€,å¦‚æœä½ è¦†ç›–äº†æ‰€æœ‰çš„ä¸œè¥¿,è¿™ä¸ªåŸºç±»åº”è¯¥çœŸæ­£çš„æ˜¯ä¸€ä¸ª`interface`,è€Œä¸æ˜¯ä¸€ä¸ª`class`ã€‚å¦‚æœä½ ä¸ç”¨ä»»ä½•ç»§æ‰¿æ–¹æ³•,åœ¨å®ç°ç»§æ‰¿ä¸­å°±æ²¡æœ‰è¿™ä¸€ç‚¹ã€‚ç¬¬äºŒ,æ›´é‡è¦çš„æ˜¯,ä½ ä¸èƒ½å¤Ÿè®©ä¸€ä¸ª`stack`æ”¯æŒæ‰€æœ‰çš„`ArrayList`æ–¹æ³•ã€‚ä¾‹å¦‚,ä»¤äººçƒ¦æ¼çš„`removeRange()`æ²¡æœ‰ä»€ä¹ˆä½œç”¨ã€‚å”¯ä¸€å®ç°æ— ç”¨æ–¹æ³•çš„åˆç†çš„é€”å¾„æ˜¯ä½¿å®ƒæŠ›å‡ºä¸€ä¸ªä¾‹å¤–,å› ä¸ºå®ƒåº”è¯¥æ°¸è¿œä¸è¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•æœ‰æ•ˆçš„æŠŠç¼–è¯‘é”™è¯¯æˆä¸ºè¿è¡Œé”™è¯¯ã€‚ä¸å¥½çš„æ–¹æ³•æ˜¯,å¦‚æœæ–¹æ³•åªæ˜¯ä¸è¢«å®šä¹‰,ç¼–è¯‘å™¨ä¼šè¾“å‡ºä¸€ä¸ªæ–¹æ³•æœªæ‰¾åˆ°çš„é”™è¯¯ã€‚å¦‚æœæ–¹æ³•å­˜åœ¨,ä½†æ˜¯æŠ›å‡ºä¸€ä¸ªä¾‹å¤–,ä½ åªæœ‰åœ¨ç¨‹åºçœŸæ­£çš„è¿è¡Œæ—¶,ä½ æ‰èƒ½å¤Ÿå‘ç°è°ƒç”¨é”™è¯¯ã€‚ \n\nå¯¹äºè¿™ä¸ªåŸºç±»é—®é¢˜çš„ä¸€ä¸ªæ›´å¥½çš„è§£å†³åŠæ³•æ˜¯å°è£…æ•°æ®ç»“æ„ä»£æ›¿ç”¨ç»§æ‰¿ã€‚è¿™æ˜¯æ–°çš„å’Œæ”¹è¿›çš„Stackçš„ç‰ˆæœ¬: \n```Java\nclass Stack { \n\tprivate int stack_pointer = 0; \n\tprivate ArrayList the_data = new ArrayList(); \n\tpublic void push( Object article ) { \n\t\tthe_data.add( stack_poniter++, article ); \n\t} \n\tpublic Object pop() { \n\t\treturn the_data.remove( --stack_pointer ); \n\t} \n\tpublic void push_many( Object[] articles ) { \n\t\tfor( int i = 0; i < o.length; ++i ) \n\t\t\tpush( articles[i] ); \n\t} \n} \n```\nåˆ°ç°åœ¨ä¸ºæ­¢,ä¸€ç›´éƒ½ä¸é”™,ä½†æ˜¯è€ƒè™‘è„†å¼±çš„åŸºç±»é—®é¢˜,æˆ‘ä»¬è¯´ä½ æƒ³è¦åœ¨`stack`åˆ›å»ºä¸€ä¸ªå˜é‡, ç”¨å®ƒåœ¨ä¸€æ®µå‘¨æœŸå†…è·Ÿè¸ªæœ€å¤§çš„å †æ ˆå°ºå¯¸ã€‚ä¸€ä¸ªå¯èƒ½çš„å®ç°ä¹Ÿè®¸è±¡ä¸‹é¢è¿™æ ·: \n```Java\nclass Monitorable_stack extends Stack { \n\tprivate int high_water_mark = 0; \n\tprivate int current_size; \n\tpublic void push( Object article ) { \n\t\tif( ++current_size > high_water_mark ) \n\t\t\thigh_water_mark = current_size; \n\t\tsuper.push( article ); \n\t} \n\tpublish Object pop() { \n\t\t--current_size; \n\t\treturn super.pop(); \n\t} \n\tpublic int maximum_size_so_far() { \n\t\treturn high_water_mark; \n\t} \n} \n```\nè¿™ä¸ªæ–°ç±»è¿è¡Œçš„å¾ˆå¥½,è‡³å°‘æ˜¯ä¸€æ®µæ—¶é—´ã€‚ä¸å¹¸çš„æ˜¯,è¿™ä¸ªä»£ç å‘æ˜äº†ä¸€ä¸ªäº‹å®,`push_many()`é€šè¿‡è°ƒç”¨`push()`æ¥è¿è¡Œã€‚é¦–å…ˆ,è¿™ä¸ªç»†èŠ‚çœ‹èµ·æ¥ä¸æ˜¯ä¸€ä¸ªåçš„é€‰æ‹©ã€‚å®ƒç®€åŒ–äº†ä»£ç ,å¹¶ä¸”ä½ èƒ½å¤Ÿå¾—åˆ°`push()`çš„æ´¾ç”Ÿç±»ç‰ˆæœ¬,ç”šè‡³å½“`Monitorable_stack`é€šè¿‡Stackçš„å‚è€ƒæ¥è®¿é—®çš„æ—¶å€™,ä»¥è‡³äº`high_water_mark`èƒ½å¤Ÿæ­£ç¡®çš„æ›´æ–°ã€‚ \n","tags":["Android","Java"],"categories":["Android"]},{"title":"Androidä½¿ç”¨nettyæ¡†æ¶é…ç½®SSLé€‚é…7.0ä»¥ä¸Šçš„ç³»ç»Ÿ","url":"/2018/05/5483a3584872/","content":"\næœ€è¿‘é¡¹ç›®åœ¨ä½¿ç”¨çš„nettyæ¡†æ¶åŠ ä¸Šäº†SSLå®‰å…¨è®¾ç½®ï¼ŒSSLå¯å•é¡¹éªŒè¯ä¹Ÿå¯åŒå‘éªŒè¯ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯åŒå‘éªŒè¯ï¼Œå³ClientéªŒè¯ServeråŒæ—¶Serverä¹ŸéªŒè¯Clientã€‚\nä»¥ä¸‹åªè¯´æ˜Clientï¼ˆAndroidï¼‰ç«¯çš„å®ç°æ–¹å¼ã€‚\n<!--more--> \n- é¦–å…ˆéœ€è¦ä¸¤ä¸ªæ–‡ä»¶ï¼Œ`client.p12`å’Œ`cacert.pem`ï¼Œç”±æœåŠ¡å™¨ç«¯æä¾›ã€‚\n- ä½¿ç”¨javaçš„`keytool`å·¥å…·å°†`cacert.pem`å¯¼å…¥åˆ°keystoreä¸­\n```shell\n$ keytool -import -trustcacerts -keystore /Users/xxx/server.bks -file /Users/xxx/cacert.pem -storetype BKS -provider org.bouncycastle.jce.provider.BouncyCastleProvider\n```\n\nè®°ä½è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåè¦æ±‚è¾“å…¥çš„å¯†ç ã€‚\n*ï¼ˆå…¶ä¸­çš„org.bouncycastle.jce.provider.BouncyCastleProviderå¦‚ä½•æ·»åŠ ä½¿ç”¨è‡ªè¡Œç™¾åº¦å³å¯ã€‚ï¼‰*\n\n- ç°åœ¨å·²ç»æœ‰äº†ä¸¤ä¸ªæ–‡ä»¶`client.p12`å’Œ`server.bks`\n- å‡†å¤‡å®Œæˆï¼Œä¸‹é¢è¿›è¡Œjavaå®ç°ã€‚\n```java\npublic SSLContext createSSLContext(Context context) {\n        SSLContext sslContext = null;\n        try {\n\t        // è¯¥å¯†ç ä¸ºç”Ÿæˆclient.p12æ—¶è®¾ç½®çš„å¯†ç \n            String keyPassword = \"\";\n            // è¯¥å¯†ç ä¸ºç”Ÿæˆserver.bksæ—¶è®¾ç½®çš„å¯†ç \n            String trustPassword = \"\";\n            \n            // key store manager\n            KeyStore keyStore = KeyStore.getInstance(\"PKCS12\");\n            InputStream keyInput = context.getResources().openRawResource(R.raw.client);\n            keyStore.load(keyInput, keyPassword.toCharArray());\n            KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());\n            keyManagerFactory.init(keyStore, keyPassword.toCharArray());\n            \n            // trust store manager\n            KeyStore trustStore = KeyStore.getInstance(\"BKS\");\n            InputStream trustInput = context.getResources().openRawResource(R.raw.server);\n            trustStore.load(trustInput, trustPassword.toCharArray());\n            TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());\n            trustManagerFactory.init(trustStore);\n            \n            // assemble\n            sslContext = SSLContext.getInstance(\"TLS\");\n            sslContext.init(keyManagerFactory.getKeyManagers(), trustManagerFactory.getTrustManagers(), null);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return sslContext;\n    }\n```\n\n- æ¥ä¸‹æ¥é…ç½®nettyä¸­çš„SSL\n```java\nclass ClientInitializer extends ChannelInitializer<SocketChannel> {\n\n        private SSLContext mSslContext;\n\n        public ClientInitializer(SSLContext sslContext) {\n            mSslContext = sslContext;\n        }\n        \n        @Override\n        protected void initChannel(SocketChannel ch) throws Exception {\n            ChannelPipeline pipeline = ch.pipeline();\n            SSLEngine sslEngine = mSslContext.createSSLEngine();\n            sslEngine.setUseClientMode(true);\n            pipeline.addFirst(\"ssl\", new SslHandler(sslEngine));\n            pipeline.addLast(\"decoder\", new ClientDecoder());\n            pipeline.addLast(\"encoder\", new ClientEncoder());\n            pipeline.addLast(\"handler\", new ClientHandler());\n\n        }\n    }\n```\n\n- è‡³æ­¤ï¼Œæ‰€æœ‰å·¥ä½œå°±å®Œæˆäº†ï¼Œä»¥ä¸Šæ ‡å‡†é…ç½®åœ¨android7.0ä»¥ä¸‹çš„æœºå™¨ä¸Šå‡å¯æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¸€æ—¦è¿è¡Œåˆ°7.0åŠä»¥ä¸Šçš„æœºå™¨ä¸Šå°±ä¼šæŠ¥é”™\n```java\njavax.net.ssl.SSLHandshakeException: java.security.cert.CertPathValidatorException: Trust anchor for certification path not found.\n        at org.apache.harmony.xnet.provider.jsse.OpenSSLSocketImpl.startHandshake(OpenSSLSocketImpl.java:374)\n        at libcore.net.http.HttpConnection.setupSecureSocket(HttpConnection.java:209)\n        at libcore.net.http.HttpsURLConnectionImpl$HttpsEngine.makeSslConnection(HttpsURLConnectionImpl.java:478)\n        at libcore.net.http.HttpsURLConnectionImpl$HttpsEngine.connect(HttpsURLConnectionImpl.java:433)\n        at libcore.net.http.HttpEngine.sendSocketRequest(HttpEngine.java:290)\n        at libcore.net.http.HttpEngine.sendRequest(HttpEngine.java:240)\n        at libcore.net.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:282)\n        at libcore.net.http.HttpURLConnectionImpl.getInputStream(HttpURLConnectionImpl.java:177)\n        at libcore.net.http.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:271)\n```\n\nç»è¿‡ä¸€ç•ªæŸ¥è¯¢éªŒè¯ï¼Œåœ¨å®˜ç½‘ä¸Šæ‰¾åˆ°äº†è§£å†³åŠæ³•ï¼Œ[åŸé“¾æ¥](https://developer.android.google.cn/training/articles/security-ssl#CommonProblems)-ä¸éœ€ç¿»å¢™å³å¯è®¿é—®ã€‚\n\n**è§£å†³æ–¹å¼å¦‚ä¸‹**\n\n- å’ŒæœåŠ¡å™¨ç«¯å†è¦ä¸€ä¸ªæ–‡ä»¶`server.crt`ã€‚\n- å‡†å¤‡å®Œæˆï¼Œä¸‹é¢ä¿®æ”¹javaå®ç°\n```java\npublic SSLContext createSSLContext(Context context) {\n        SSLContext sslContext = null;\n        try {\n            String keyPassword = \"\";\n\n             // key store manager\n            KeyStore keyStore = KeyStore.getInstance(\"PKCS12\");\n            InputStream keyInput = context.getResources().openRawResource(R.raw.client);\n            keyStore.load(keyInput, keyPassword.toCharArray());\n            KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());\n            keyManagerFactory.init(keyStore, keyPassword.toCharArray());\n            KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());\n            keyManagerFactory.init(keyStore, keyPassword.toCharArray());\n\n            // trust store manager\n            CertificateFactory cf = CertificateFactory.getInstance(\"X509\");\n            InputStream caInput = context.getResources().openRawResource(R.raw.server);\n            Certificate ca;\n            try {\n                ca = cf.generateCertificate(caInput);\n            } finally {\n                caInput.close();\n            }\n            KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());\n            trustStore.load(null, null);\n            trustStore.setCertificateEntry(\"CA\", ca);\n            TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());\n            trustManagerFactory.init(trustStore);\n\n            // assemble\n            sslContext = SSLContext.getInstance(\"TLS\");\n            sslContext.init(keyManagerFactory.getKeyManagers(), trustManagerFactory.getTrustManagers(), null);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return sslContext;\n    }\n```\n**åªéœ€è¦ä¿®æ”¹`trust store`çš„åˆ›å»ºæ–¹å¼ï¼Œå…¶ä»–ä¸éœ€è¦æ”¹åŠ¨ã€‚ç»è¿‡ä»¥ä¸Šä¿®æ”¹ï¼Œç¨‹åºåœ¨æ‰€æœ‰ç‰ˆæœ¬çš„æœºå™¨ä¸Šéƒ½å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼æ£’**\n","tags":["Android","Netty"],"categories":["Android"]},{"title":"MySqlçš„modifyå’ŒchangeåŒºåˆ«","url":"/2018/04/c9ea6aa5bbde/","content":"\n- ç›¸åŒç‚¹ï¼šéƒ½æ˜¯ç”¨æ¥æ”¹å˜columnçš„å±æ€§ï¼Œchangeå’Œmodifyæ‰§è¡ŒæˆåŠŸåéƒ½ä¼šç”¨æœ¬æ¬¡è®¾ç½®çš„å±æ€§æ›¿æ¢columnåŸå±æ€§ï¼Œè¯·æ³¨æ„æ˜¯ã€æ›¿æ¢ã€‘ï¼›\n- ä¸åŒç‚¹ï¼šé‡å‘½ååªèƒ½ä½¿ç”¨change\n<!--more--> \næ ¼å¼ï¼ˆmysqlé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼‰\n\n 1 change\n```\nalter table table_name change current_column_name new_column_name type extra;\n// for example.ï¼ˆå¦‚æœæ˜¯æ”¹åå­—éœ€è¦æŠŠcolumnåŸå±æ€§éƒ½æŒ‚ä¸Šï¼Œå› ä¸ºæ˜¯æ›¿æ¢ï¼‰\nalter table user change id userid int(11) not null auto_increment;\n```\n 2 modify\n \n\n```\nalter table table_name modify column_name type extra;\n// for example\nalter table user modify id int(11) not null auto_increment;\n```","tags":["MySql"],"categories":["MySql"]},{"title":"ã€Œå·§ç”¨Gradleæ„å»ºAndroidåº”ç”¨ã€è¯»ä¹¦æ•´ç†","url":"/2018/04/23aff262eba5/","content":"\nå‘¨æœ«çœ‹å®Œäº†ã€Œå·§ç”¨Gradleæ„å»ºAndroidåº”ç”¨ã€ï¼Œæ•…å°†æ–°è®¤çŸ¥æ•´ç†åœ¨æ­¤ä»¥ä¾¿ä»¥åä¾›è‡ªå·±ä»¥åŠæœ‰éœ€è¦çš„äººæŸ¥çœ‹ã€‚\n<!--more--> \nGradle\n\n- Gradleæ„å»ºè¿‡ç¨‹å®é™…ä¸Šæ˜¯æ‰§è¡ŒDAG(Directed Acyclic Graphï¼Œæœ‰å‘æ— ç¯å›¾)ï¼Œå…è®¸å®šä¹‰è‡ªå·±çš„taskå¹¶æ’å…¥åˆ°å…¶ä¸­ã€‚\n  build.gradleä¸­Androidå—æ—¶Android DSL()çš„å…¥å£ã€‚\n- ä¾èµ–çš„è¯­æ³•\n```groovy\n//å®Œæ•´è¯­æ³• (ç¦ç”¨ä¼ é€’ä¾èµ–)\ntestCompile group: 'junit', name: 'junit', version: '4.12'ï¼Œ transitive: false \n//æ’é™¤ä¾èµ–\nandroidTestCompile('org.splckframeword:spock-core:1.0-groovy-2.4') {\n\texclude group: 'org.codehaus.groovy'\n\texclude group: 'junit'\n}\n```\n\n- é…ç½®ä»“åº“\n```groovy\nrepositories {\n\tmaven {\n\t// å…¶ä¸­çš„usernameå€¼å’Œpasswordå€¼å¯ä»¥å†™åœ¨gradle.propertiesæˆ–è€…åœ¨æ‰§è¡Œgradlewå‘½ä»¤æ—¶ä»¥å‚æ•°è¾“å…¥\n\t// ./gradlew -Puser=user_from_pFlag -Ppass=pass_from_pFlag\n\t\tusername 'username'\n\t\tpassword 'password'\n\t}\n\turl 'http://repo.mycompany.com/maven2'\n}\n// è¿˜å¯ä»¥åœ¨extå—ä¸­é…ç½®\next {\n\tif (!project.hasProperty('user')) {\n\t\tdef username = 'alice'\n\t}\n\tif (!project.hasProperty('pass')) {\n\t\tdef password = 'passpass'\n\t}\n}\n```\n\n- å‡çº§Gradleç‰ˆæœ¬\n```groovy\n// æ–¹æ³•ä¸€\ntask wrapper(type: Wrapper) {\n\tgradleVersion = 2.12\n}\n./gradlew wrapper\n// æ–¹æ³•äºŒï¼šç›´æ¥ä¿®æ”¹gradle-wrapper.propertiesæ–‡ä»¶çš„distributionUrlå±æ€§ã€‚\n```\n\n- ç­¾å\n```groovy\nandroid {\n\t// ...other section...\n\tsigningConfigs {\n\t\trelease {\n\t\t\tkeyAlias 'my_alias'\n\t\t\tkeyPassword 'password'\n\t\t\tstoreFile file('/Users/kousen/keystores/myapp.ketstore')\n\t\t\tstorePassword 'password'\n\t\t}\n\t}\n}\n// åŒæ ·ï¼Œå¯†ç å¯ä»¥æ”¾åˆ°gradle.propertiesä¸­ï¼Œæˆ–è€…ä»¥gradlewçš„å‚æ•°è¾“å…¥\n```\n\n- æ„å»ºç±»å‹\n```groovy\nbuildTypes {\n// åŠ åç¼€åŒºåˆ†å¯åŒæ—¶å®‰è£…åœ¨åŒä¸€è®¾å¤‡ä¸Š\n\tdebug {\n\t\tapplicationIdSuffix '.debug'\n\t\tversionNameSuffix '-debug'\n\t}\n}\n```\n\n- äº§å“å®šåˆ¶&çº¬åº¦\n```groovy\nandroid {\n\tproductFlavors {\n\t\tarrogant {\n\t\t\tdimension 'attitude'\n\t\t\tapplicationId 'com.oreilly.helloword.arrg'\n\t\t}\n\t\tfriendly {\n\t\t\tdimension 'attitude'\n\t\t\tapplicationId 'com.oreilly.helloword.fund'\n\t\t}\n\t\tstark {\n\t\t\tdimension 'client'\n\t\t}\n\t}\n}\n```\n\n- è‡ªå®šä¹‰ä»»åŠ¡ã€‚Graleçš„DSL APIå·²ç»å­˜åœ¨å¾ˆå¤šä»»åŠ¡ï¼Œå¦‚Copyã€Wrapperå’ŒExecç­‰ï¼Œè¿™äº›ä»»åŠ¡å¯ä»¥ç®€å•åœ°è®¾ç½®å±æ€§ç„¶åä½¿ç”¨ã€‚æ¯”å¦‚Copyä»»åŠ¡æ‰€åŒ…å«çš„fromå’Œintoå±æ€§ã€‚\n```groovy\n// å¤åˆ¶ä»»åŠ¡\ntask copyApks(type: Copy) {\n\tfrom(\"$buildDir/outputs/apk\") {\n\t\texclude '**/*unsigned.apk', '**/*unaligned.apk'\n\t}\n\tinto '../apks'\n}\n// æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ä»»åŠ¡çš„å˜ç§ã€‚è¿™ä¸ªä»»åŠ¡ä¸­æ— è®ºåœ¨doLastä¹‹å‰è¿˜æ˜¯ä¹‹åçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯åœ¨é…ç½®é˜¶æ®µæ‰§è¡Œï¼Œ\n// doLastå—ä¸­çš„ä»£ç åœ¨è¿è¡Œé˜¶æ®µæ‰§è¡Œ\n// applicationVariantså±æ€§åªé’ˆå¯¹com.android.applicationæ’ä»¶æœ‰æ•ˆ\n// libraryVariantså±æ€§åªé’ˆå¯¹com.android.libraryæ’ä»¶æœ‰æ•ˆ\ntask printVariantNames() {\n\tdoLast {\n\t\tandroid.applicationVariants.all { variant ->\n\t\t\tprintln variant.name\n\t\t}\n\t}\n}\n// æ‰§è¡Œå®‰è£…æ‰€æœ‰åº”ç”¨çš„å˜ç§çš„ä»»åŠ¡\n// dependsOnå±æ€§æ˜¾ç¤ºè¿™æ˜¯é…ç½®é˜¶æ®µçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿è¡Œé˜¶æ®µã€‚æ¯ä¸€ä¸ªå˜ç§åå­—éƒ½è¢«é¦–å­—æ¯å¤§å†™äº†\n// å¹¶ä¸”ç›¸åº”çš„å®‰è£…ä»»åŠ¡ä¹Ÿè¢«æ·»åŠ åˆ°installDebugFlavorsä»»åŠ¡çš„ä¸€ä¸ªä¾èµ–\ntask installDebugFlavors() {\n\tandroid.applicationVariants.all { v ->\n\t\tif (v.name.endWiths('Debug')) {\n\t\t\tString name = v.name.capitalize()\n\t\t\tdependsOn \"install$name\"\n\t\t}\n\t}\n}\n```\n\n- å»¶é•¿ADBè¶…æ—¶æ—¶é•¿\n```groovy\n// 30ç§’\nandroid {\n\tadbOptions {\n\t\ttimeOutInMs = 30 * 1000\n\t}\n}\n```\n\n- æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡åˆ°æ„å»ºè¿‡ç¨‹\n```groovy\n// åŸºäºassembleDebugçš„ä¾èµ–æ„å‘³ç€åœ¨è¿è¡Œcopyä»»åŠ¡ä¹‹å‰æ‰€æœ‰è°ƒè¯•APKéƒ½ä¼šè¢«ç”Ÿæˆã€‚\ntask copyApks (type: Copy, dependsOn: assembleDebug) {\n\tfrom(\"$buildDir/outputs/apk\") {\n\t\texclude '**/*unsigned.apk', '**/*unsigned.apk'\n\t}\n\tinto '../apks'\n}\n// å¦‚æœæƒ³è¦åœ¨æ¯æ¬¡æ„å»ºçš„æ—¶å€™éƒ½è¿è¡ŒcopyApksä»»åŠ¡ï¼Œå°†å…¶ä½œä¸ºbuildä»»åŠ¡çš„ä¸€ä¸ªä¾èµ–\nbuild.dependsOn copyApks\n```\n\n- æ’é™¤ä»»åŠ¡\n```groovy\n> ./gradlw build -x lint\n// Gradleè¿è¡Œæ—¶ï¼Œå…¶ç»„è£…äº†ä¸€ä¸ªtask graphï¼Œé€šè¿‡gradleè·å¾—è¿™ä¸ªå›¾çš„é¥®ç”¨ï¼Œæ‰€æœ‰å¯¹è¿™ä¸ªå›¾çš„æ“çºµéƒ½éœ€è¦å‘ç”Ÿ\n// åœ¨å…¶æ„å»ºå‡ºæ¥ä¹‹åï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨whenReadyå±æ€§\ngradle.taskGraph.whenReady { graph ->\n\tif (project.hasProperty('nolint')) {\n\t\tgraph.allTask.findAll {\n\t\t\tit.name ==~/lint.*/}*.enabled = false\n\t\t}\n\t}\n}\n```\n\n- æ€§èƒ½\n```groovy\n// gradle.properties\n// å®ˆæŠ¤è¿›ç¨‹\norg.gradle.daemon=true\n// æŒ‰éœ€é…ç½®è®¾ç½®\norg.gradle.configureondemand=true\n// é€‰æ‹©JVMè®¾ç½® Xmxæœ€å¤§å†…å­˜ Xmsåˆå§‹å†…å­˜ XX:MaxPermSizeæ°¸ä»£ä¹…ç©ºé—´ \n// HeapDumpOnOutOfMemoryErrorå‘ç”Ÿæ—¶ï¼Œå°†å †ä¸­æƒ…å†µå¯¼å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­\norg.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError\n\n// ä½¿ç”¨dexé€‰é¡¹\ndexOptions {\n\tincremental true\n\tjavaMaxHeapSize '2g'\n\tjumboMode = true//è¿è½½dexæ–‡ä»¶ä¸­å‡ºç°çš„å¤§é‡å­—ç¬¦ä¸²ï¼Œå¯èƒ½éœ€è¦é…ç½®ProdGuard\n\tpreDexLibraries = true\n} \n```","tags":["Android","Gradle"],"categories":["è¯»ä¹¦ç¬”è®°"]},{"title":"gradleå„ä¸ªç‰ˆæœ¬èµ„æº","url":"/2017/12/22d73a690578/","content":"\ngradleå®˜ç½‘ä¸‹è½½åœ°å€:[ç‚¹å‡»è·³è½¬](http://services.gradle.org/distributions/)\n\nä½†æ˜¯è¿™ä¸ªç½‘ç«™æœ‰æ—¶éœ€è¦ç¿»å¢™æœ‰æ—¶ä¸‹è½½é€Ÿåº¦æ…¢ï¼Œè¶ç€ç°åœ¨ç¿»å¢™æ–¹ä¾¿ä¸€æ¬¡æ€§å°†ä¸Šé¢çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬ä¸‹äº†ä¸‹æ¥\n<!--more--> \né“¾æ¥: https://pan.baidu.com/s/1i4Fm9Q9 å¯†ç : cjfd\n\n**æœ€æ–°æ›´æ–°æ—¥æœŸ:2017-12-22 18:17:06**(å¦‚æœæƒ³çš„èµ·æ¥å°±æ›´æ–°)\n\nps: å¦‚æœ‰å°æ›´æ–°ç‰ˆæœ¬éœ€æ±‚, é‚®ç®±è”ç³» : oynix@foxmail.com\n\n\n---\n**å¦‚ä½•ä½¿ç”¨**\n\nå½“ç”¨AndroidStudioæ‰“å¼€ä¸€ä¸ªé¡¹ç›®é•¿æ—¶é—´å¡åœ¨buildé¡µé¢ï¼Œå¤šåŠæ˜¯é¡¹ç›®æ‰€éœ€è¦ç‰ˆæœ¬çš„gradleåœ¨æœ¬åœ°æ²¡æœ‰ï¼ŒASå»ä¸Šé¢é‚£ä¸ªç½‘å€ä¸‹å´åˆä¸‹ä¸æ¥ã€‚æ“ä½œå¦‚ä¸‹:\n\n1. å…³é—­AS, æ‰¾åˆ°é¡¹ç›®æ‰€ä½¿ç”¨gradleçš„ç‰ˆæœ¬, æ‰“å¼€**é¡¹ç›®æ ¹ç›®å½•/gradle/wrapper/gradle-wrapper.properties**æ–‡ä»¶, é‡Œé¢çš„**distributionUrl**å°±æ˜¯;\n2. å°†ä¸‹è½½å¥½çš„å¯¹åº”ç‰ˆæœ¬çš„gradleçš„zipå‹ç¼©åŒ…å¤åˆ¶åˆ°gradleæœ¬åœ°è·¯å¾„, Windowså’ŒMacç›¸åŒ, **~/.gradle/wrapper/dists/{é¡¹ç›®ä½¿ç”¨çš„ç‰ˆæœ¬}/{ä¸€ä¸²æ•°å­—å­—æ¯çš„åå­—}/**, å¦‚æœè¯¥ç›®å½•å­˜åœ¨åˆ™ç›´æ¥æ›¿æ¢, å¤åˆ¶å®Œç›´æ¥å°†zipè§£å‹åˆ°å½“å‰æ–‡ä»¶å¤¹, å³è§£å‹åˆ°**{ä¸€ä¸²æ•°å­—å­—æ¯çš„åå­—}**æ–‡ä»¶å¤¹ä¸‹, å®Œæˆåé‡æ–°æ‰“å¼€ASå³å¯.\n","tags":["Android","Gradle"],"categories":["Android"]},{"title":"HelloKotlin - Error:Gradle-failed to create directory","url":"/2017/12/11b68604d6b4/","content":"---\nä»Šå¤©åœ¨çœ‹Kotlin-Docsï¼Œäºæ˜¯éšæ‰‹å»ºäº†ä¸€ä¸ªHelloKotlinçš„é¡¹ç›®å‡†å¤‡ç»ƒç»ƒæ‰‹ï¼Œäºæ˜¯å¼•å‘äº†ä¸€è¿ä¸²çš„é—®é¢˜ã€‚åœ¨æ­¤è®°å½•è¿‡ç¨‹ã€‚\n\n<!--more-->\n\n**ç¯å¢ƒ**\n\n - Windows 7 64bit\n - AndroidStudio 3.0.1\n \n---\nä¸€èˆ¬çš„ï¼Œåƒä¸‹é¢è¿™æ ·ï¼Œç›´æ¥å†™ä¸€ä¸ªç¨‹åºå…¥å£mainå‡½æ•°ï¼Œè·‘ä¸€äº›ç®€å•ä»£ç æ—¶ä¸ç”¨æ„å»ºapkçœæ—¶çœåŠ›ï¼š\n![](https://i.loli.net/2021/07/07/5vgDVB4MTyKipoW.png)\n\nåŒæ ·çš„ï¼Œæˆ‘æƒ³åˆ›å»ºä¸€ä¸ªKotlinçš„ç¨‹åºå…¥å£ã€‚\nåˆ›å»ºé¡¹ç›®æ—¶å‹¾é€‰ä¸ŠKotlinï¼ŒAndroidStudioä¾¿è‡ªåŠ¨å¯¼å…¥Kotlinç¯å¢ƒï¼Œç„¶åç›´æ¥æ–°å»ºäº†ä¸€ä¸ªHello.ktçš„æ–‡ä»¶ï¼Œé‡Œé¢ä»£ç å¾ˆç®€å•ï¼Œåªæœ‰ä¸‰è¡Œï¼Œå¦‚ä¸‹ï¼š\n\n```kotlin\nfun main(args: Array<String>) {\n\tSystem.out.print(\"Hello Kotlin\")\n}\n```\n**fun**å•è¯å‰æœ‰ä¸ªå½©è‰²çš„Kotlin Logoï¼Œç›´æ¥ç‚¹å‡»å°±å¯ä»¥è¿è¡ŒHelloKotlinï¼ˆæŒ‰é“ç†è¿™æ ·å°±å¯ä»¥æ­£å¸¸è·‘èµ·æ¥äº†ï¼Œæˆ‘æ˜¯è¿™ä¹ˆä»¥ä¸ºçš„ï¼‰ï¼Œ**ä½†æ˜¯ï¼ŒæŠ¥äº†ä¸‹é¢è¿™ä¸ªé”™è¯¯**ï¼š\n![](https://i.loli.net/2021/07/07/g7Jp9tOwETl6diU.png)\n\nåœ¨ç½‘ä¸Šæœç´¢**Error:Gradle:failed to create directory**ä¸€ç•ªåï¼Œæ‰¾åˆ°äº†è§£å†³åŠæ³•ï¼ŒåŸæ¥æ˜¯æ–°ç‰ˆAndroidStudioè‡ªå¸¦çš„Aapt2å¼•èµ·çš„ï¼Œç›´æ¥ç¦ç”¨å°±å¥½ï¼šåœ¨**gradle.properties**æ·»åŠ å¦‚ä¸‹é…ç½®å³å¯ï¼š\n\n```\nandroid.enableAapt2=false\n```\n\nå†æ¬¡ç‚¹å‡»**fun**å‰é¢çš„å½©è‰²Kotlin Logoï¼Œæˆ‘ä»¥ä¸ºå¯ä»¥è¿è¡Œäº†ï¼Œ**ä½†æ˜¯ï¼ŒåˆæŠ¥äº†ä¸‹é¢è¿™ä¸ªé”™è¯¯**ï¼š\n![](https://i.loli.net/2021/07/07/uxXfnlNcjMZeOmP.png)\n\n**IDEè¯´æ‰¾ä¸åˆ°HelloKt.classï¼Œç„¶è€Œå‹¤åŠ³çš„æˆ‘å´å‡­å€ŸåŒæ‰‹æ‰¾åˆ°äº†ï¼Œæªä¸åŠé˜²**\n![](https://i.loli.net/2021/07/07/b4U69Lmts1A2qBn.png)\n<br>\nè¿™ä¸‹æˆ‘å°±æœ‰ç‚¹ä¸çŸ¥æ‰€æªäº†ã€‚ã€‚ã€‚\nç½‘ä¸Šä¹Ÿæ²¡æŸ¥å‡ºä»€ä¹ˆç›¸å…³å‚è€ƒï¼Œåˆè¯•äº†å‡ ç§ä¸åŒçš„å†™æ³•ï¼Œä¾ç„¶ä¸è¡Œï¼Œæœ€åä¸çŸ¥æ€ä¹ˆçªç„¶æƒ³åˆ°ä¿®æ”¹Gradleç‰ˆæœ¬è¯•è¯•çœ‹ï¼Œäº‹å®è¯æ˜æ­¤è·¯å¯è¡Œï¼\nAndroidStudio 3.0.1åˆ›å»ºæ–°é¡¹ç›®é»˜è®¤çš„Gradleç‰ˆæœ¬æ—¶4.1ï¼ŒAndroid Plugin Versionæ˜¯3.0.1ã€‚æˆ‘æŠŠHelloKotliné¡¹ç›®å‘ä¸‹é™äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå³Gradle-3.4ï¼ŒAndroid Plugin - 2.3.3ï¼Œå»æ‰DSL method google()\n![](https://i.loli.net/2021/07/07/7LJtogyjH4Od3GV.png)\n\nç›¸åº”çš„ï¼ŒModuleçš„build.gradleé‡Œä¸€äº›ç‰ˆæœ¬éƒ½è¦ä¸‹è°ƒã€‚\n\n```groovy\n// éƒ¨åˆ†å†…å®¹\nandroid {\n    compileSdkVersion 25\n    buildToolsVersion '25.0.3'\n    defaultConfig {\n        applicationId \"com.oy.hellokot\"\n        minSdkVersion 15\n        targetSdkVersion 25\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n    }\n    ...\n}\n\ndependencies {\n    compile fileTree(dir: 'libs', include: ['*.jar'])\n    compile\"org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version\"\n    compile 'com.android.support:appcompat-v7:25.3.1'\n    compile 'com.android.support.constraint:constraint-layout:1.0.2'\n    testCompile 'junit:junit:4.12'\n    androidTestCompile 'com.android.support.test.espresso:espresso-core:2.2.2'\n}\n```\n\nå¦‚ä¸Šé…ç½®ä»¥åï¼Œå†æ¬¡ç‚¹å‡»**fun**ä¹‹å‰çš„å½©è‰²Kotlin Logoï¼Œç¨‹åºä¾¿å¯ä»¥è·‘èµ·æ¥äº†ã€‚","tags":["AndroidStudio","Kotlin"],"categories":["Kotlin"]},{"title":"Windowsä¸‹ç¼–è¯‘OpenSSL","url":"/2017/11/0d432f214850/","content":"---\n\nä»Šå¤©ä¸ºäº†è·å–FBç§˜é’¥ï¼Œé‡Œé¢æœ‰ä¸ªå‘½ä»¤opensslï¼Œäºæ˜¯ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹æ•™ç¨‹ï¼Œä¼—è¯´çº·çº­ï¼Œæœ€åå¯ç®—æˆåŠŸäº†ï¼Œåœ¨æ­¤è®°å½•è¿‡ç¨‹ã€‚\n<!--more-->\n#### **ç¯å¢ƒ**\n - Windows 64ä½\n - å·²å®‰è£…Visual Studio 2017 ç¤¾åŒºç‰ˆï¼ˆå·²è¿‡æœŸä¸è¿‡æ²¡å½±å“ï¼‰\n - å·²å®‰è£…Active Perl v5.16.2\n\n#### **å‡†å¤‡æºç **\n - [OpenSSLå®˜ç½‘](https://www.openssl.org/)\n - æˆ–è€…ç›´æ¥ç”¨æ–‡ä¸­æ‰€ç”¨çš„ :  https://pan.baidu.com/s/1pL0vDhx å¯†ç : hndw\n\n---\n#### **è¿‡ç¨‹**\n1. åœ¨Microsoft Visual Studioç›®å½•ä¸‹æœç´¢**vcvarsall.bat**å¹¶è¿›å…¥æ‰€åœ¨ç›®å½•ã€‚\n![](https://i.loli.net/2021/07/07/hbDj3oUKWFLJfuq.png)\n2. åœ¨æ‰€åœ¨ç›®å½•ä¸‹æ‰“å¼€cmdï¼Œè¿è¡Œ`vcvarsall.bat x86_amd64`\n\n\t```sh\n\tC:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Community\\VC\\Auxiliary\\Build>vcvarsall.bat x86_amd64\n\t[vcvarsall.bat] Environment initialized for: 'x86_x64'\n\t```\n3.  cmdåˆ‡æ¢åˆ°è§£å‹å®Œçš„OpenSSLæºç ç›®å½•è¿è¡Œ\n\n\t```sh\nC:\\Users\\it\\Desktop\\openssl-1.0.2m>perl Configure VC-WIN64A\n\t```\n4. ç»§ç»­è¿è¡Œ\n\n\t```sh\nC:\\Users\\it\\Desktop\\openssl-1.0.2m>ms\\do_win64a\n\t```\n5. ç»§ç»­æ‰§è¡Œï¼Œè¿™æ­¥åœ¨æˆ‘çš„ç”µè„‘ä¸Šè·‘äº†å¥½å‡ åˆ†é’Ÿ\n\n\t```sh\nC:\\Users\\it\\Desktop\\openssl-1.0.2m>nmake -f ms\\nt.mak \n\t```\n6. ç»§ç»­æ‰§è¡Œã€‚æ‰§è¡Œå®Œç¬¬å…­æ­¥ä¹‹åï¼Œç¼–è¯‘å¥½çš„OpenSSLå°±å¤åˆ¶åˆ°äº†`\\usr\\local\\ssl\\lib`è·¯å¾„ä¸‹ï¼Œæˆ‘æ˜¯åœ¨æ¡Œé¢ç¼–è¯‘çš„ï¼Œæ‰€ä»¥åœ¨Cç›˜æ ¹ç›®å½•\n\n\t```sh\nC:\\Users\\it\\Desktop\\openssl-1.0.2m>nmake -f ms\\nt.mak install\n\t```\n\n7. å°†OpenSSLè·¯å¾„`C:\\usr\\local\\ssl\\bin`æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„pathé‡Œ\n\n8. æ‰“å¼€ä¸€ä¸ªæ–°çš„cmdçª—å£ï¼Œè¿è¡Œopensslå‘½ä»¤ï¼Œå¦‚å›¾è¡¨æ˜æˆåŠŸ\n![](https://i.loli.net/2021/07/07/UHcXsjCJErxna65.png)\n\n---\n#### **æ³¨æ„**\nç¬¬2æ­¥åˆ°ç¬¬3æ­¥è¦åœ¨åŒä¸€ä¸ªcmdçª—å£é‡Œè¿è¡Œã€‚å¼€å§‹è¿è¡Œç¬¬5æ­¥ä¸ç®¡ç”¨ï¼Œæ€»æç¤ºæ‰¾ä¸åˆ°nmakeå‘½ä»¤ï¼Œæˆ‘å°±ç›´æ¥æŠŠnmake.exeï¼ˆMicrosoft Visual Studioç›®å½•ä¸‹æœç´¢åˆ°çš„ï¼ŒåŒæ­¥éª¤1ï¼‰ç›´æ¥æ”¾åˆ°ç³»ç»Ÿè·¯å¾„é‡Œäº†ï¼Œå¯ä»¥è¿è¡Œï¼Œåæ¥å‘ç°2ã€ 3åªè¦åœ¨åŒä¸€ä¸ªcmdçª—å£å°±å¯ä»¥äº†ã€‚\n","tags":["Windows","OpenSSL"],"categories":["OpenSSL"]},{"title":"ã€ŒEffective Javaã€è¯»ä¹¦æ•´ç†","url":"/2017/11/29c00d69eefc/","content":"---\nä¹¦åœ°å€ ï¼šé“¾æ¥: https://pan.baidu.com/s/1kUAwYgv å¯†ç : ij4j\n<!--more-->\n###  - Chapter 3 é€‚ç”¨äºæ‰€æœ‰å¯¹è±¡\n#### **8. é‡å†™`equals`æ–¹æ³•**\n> ä¸‰ä¸ªåŸåˆ™ï¼šå¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§\n\n#### **9. é‡å†™`equals`æ–¹æ³•å¿…å®šè¦é‡å†™`hashCode`æ–¹æ³•**\n> ä¾‹å¦‚åœ¨HashMapä¸­å­˜å‚¨æ—¶ä¼šè°ƒç”¨è¯¥æ–¹æ³•\n\n#### **10. å§‹ç»ˆè¦é‡å†™`toString`æ–¹æ³•**\n> ä¾¿äºé˜…è¯»ï¼Œä½¿ç±»ç”¨èµ·æ¥æ›´åŠ èˆ’é€‚\n\n#### **11. è°¨æ…çš„è¦†ç›–`clone`æ–¹æ³•**\n> ç›¸å½“äºå¦ä¸€ä¸ªæ„é€ å™¨\n\n#### **12. è€ƒè™‘å®ç°Comparableæ¥å£**\n> ç”¨äºå¯¹è±¡æ¯”è¾ƒã€æ’åºï¼ˆåœ¨é›†åˆé‡Œsortï¼‰\n\n----\n\n### - Chapter 4 ç±»å’Œæ¥å£\n#### **13. ä½¿ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æœ€å°åŒ–(encapsulation)**\n```java\n// é”™è¯¯æ–¹å¼,å®‰å…¨æ¼æ´; \n// å½“åŸŸä¸ºåŸºæœ¬ç±»å‹æˆ–ä¸å¯å˜å¯¹è±¡æ—¶å®‰å…¨;\n// å½“ä¸ºå¯å˜å¯¹è±¡çš„å¼•ç”¨æ—¶å­˜åœ¨å®‰å…¨æ¼æ´, VALUEè™½ä¸å¯ä¿®æ”¹ä½†æ•°ç»„é‡Œçš„å¯¹è±¡å¯è¢«ä¿®æ”¹\npublic static final Thing[] VALUE = {....};\n// æ­£ç¡®æ–¹å¼\nprivate static final Thing[] PRIVATE_VALUES = {...};\npublic static final List<Thing> VALUES = Collections.unodifiableList(Arrays.asList(PRIVATE_VALUES));\n```\n#### **14. åœ¨å…¬æœ‰ç±»ä¸­ä½¿ç”¨è®¿é—®æ–¹æ³•è€Œéå…¬æœ‰åŸŸ**\n> æ€»æœ‰ç±»æ°¸è¿œä¸åº”è¯¥æš´éœ²å¯å˜åŸŸ\n\n#### **15. ä½¿å¯å˜æ€§æœ€å°åŒ–**\næˆä¸ºä¸å¯å˜ç±»çš„5æ¡è§„åˆ™ :\n\n 1. ä¸è¦æä¾›ä»»ä½•ä¼šä¿®æ”¹å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•;\n 2. ä¿è¯ç±»ä¸ä¼šè¢«æ‰©å±•(fina);\n 3. ä½¿æ‰€æœ‰åŸŸéƒ½æ˜¯finalçš„;\n 4. ä½¿æ‰€æœ‰åŸŸéƒ½æˆä¸ºç§æœ‰çš„;\n 5. ç¡®ä¿å¯¹äºä»»ä½•å¯å˜ç»„ä»¶çš„äº’æ–¥è®¿é—®.\n\n#### **16. å¤åˆä¼˜å…ˆäºç»§æ‰¿**\n> å½“Bå’ŒAçš„å…³ç³»ä¸º\"is-a\"æ—¶ï¼Œè®©Bç»§æ‰¿è‡ªAï¼›å¦åˆ™Bä¸­åº”åŒ…å«ä¸€ä¸ªAçš„å®ä¾‹ï¼ˆå¤åˆï¼‰ï¼Œè€Œä¸æ˜¯æ‰©å±•Aï¼ˆç»§æ‰¿ï¼‰ã€‚\n\n#### **17. è¦ä¹ˆä¸ºç»§æ‰¿è€Œè®¾è®¡ï¼Œå¹¶æä¾›æ–‡æ¡£è¯´æ˜ï¼Œ è¦ä¹ˆå°±ç¦æ­¢ç»§æ‰¿**\n> 1>. å…³äºç¨‹åºæ–‡æ¡£æœ‰å¥æ ¼è¨€ï¼š*å¥½çš„APIæ–‡æ¡£åº”è¯¥æè¿°ä¸€ä¸ªç»™å®šçš„æ–¹æ³•åšäº†ä»€ä¹ˆå·¥ä½œï¼Œè€Œä¸æ˜¯æè¿°å®ƒå¦‚ä½•åšåˆ°çš„ã€‚*\n\nä¸ºäº†å…è®¸ç»§æ‰¿ï¼Œç±»è¿˜å¿…é¡»éµå®ˆå…¶ä»–ä¸€äº›çº¦æŸï¼š\n\n - æ„é€ å™¨å†³ä¸èƒ½è°ƒç”¨å¯è¢«è¦†ç›–çš„æ–¹æ³•ï¼›\n - æ— è®ºæ˜¯cloneï¼ˆCloneableæ¥å£ï¼‰è¿˜æ˜¯readObjectï¼ˆSerializableæ¥å£ï¼‰ï¼Œéƒ½ä¸å¯è°ƒç”¨å¯è¦†ç›–çš„æ–¹æ³•ï¼Œä¸ç®¡æ˜¯ç›´æ¥è¿˜æ˜¯é—´æ¥çš„æ–¹å¼ã€‚\n\n#### **18. æ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»**\n> æŠ½è±¡ç±»çš„æ¼”å˜æ¯”æ¥å£å®¹æ˜“ï¼›\n> éª¨æ¶å®ç°ï¼Œå³æ¥å£çš„ç®€å•å®ç°\n\n#### **19. æ¥å£åªç”¨äºå®šä¹‰ç±»å‹**\n> é¿å…å¸¸é‡æ¥å£ï¼›\n> æ¥å£åº”è¯¥åªè¢«ç”¨æ¥å®šä¹‰ç±»å‹\n\n#### **20. ç±»å±‚æ¬¡ä¼˜å…ˆäºæ ‡ç­¾ç±»**\n> æ ‡ç­¾ç±»è¿‡äºå†—é•¿ã€å®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”æ•ˆç‡åº•ä¸‹\n\n\n#### **21. ç”¨å‡½æ•°å¯¹è±¡è¡¨ç¤ºç­–ç•¥**\n> æ¯”è¾ƒå™¨ï¼šString.CASE_INSENSITIVE_ORDER\n\n#### **22. ä¼˜å…ˆè€ƒè™‘é™æ€æˆå‘˜ç±»**\nåµŒå¥—ç±»ç§ç±»\n\n 1. é™æ€æˆå‘˜ç±»ï¼›\n 2. éé™æ€æˆå‘˜ç±»ï¼›\n 3. åŒ¿åç±»ï¼›\n 4. å±€éƒ¨ç±»ã€‚\n\nåä¸‰ç§éƒ½è¢«ç§°ä¸ºå†…éƒ¨ç±»ã€‚\n> å¦‚æœå£°æ˜æˆå‘˜ç±»ä¸è¦æ±‚è®¿é—®å¤–å›´å®ä¾‹ï¼Œå°±è¦å§‹ç»ˆæŠŠstaticä¿®é¥°ç¬¦æ”¾åœ¨å®ƒçš„å£°æ˜ä¸­ï¼Œä½¿å®ƒæˆä¸ºé™æ€æˆå‘˜ç±»ï¼Œè€Œä¸æ˜¯éé™æ€æˆå‘˜ç±»ã€‚å¦‚æœçœç•¥äº†staticä¿®é¥°ç¬¦ï¼Œåˆ™æ¯ä¸ªå®ä¾‹éƒ½å°†åŒ…å«ä¸€ä¸ªé¢å¤–çš„æŒ‡å‘å¤–å›´å¯¹è±¡çš„å¼•ç”¨ã€‚ä¾‹å¦‚ViewHolderã€‚\n\n---\n\n### - Chapter 5 æ³›å‹\n\n#### 23. è¯·ä¸è¦åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨åŸç”Ÿæ€ç±»å‹\n\n - `Set` : åŸç”Ÿæ€ç±»å‹ï¼Œ è„±ç¦»äº†æ³›å‹ç³»ç»Ÿï¼›\n - `Set<?>` : æ— é™é€šé…ç¬¦ç±»å‹ï¼Œåªèƒ½åŒ…å«æŸç§æœªçŸ¥å¯¹è±¡ç±»å‹ï¼›\n - `Set<Object>`: å‚æ•°åŒ–ç±»å‹ï¼Œå¯ä»¥åŒ…å«ä»»ä½•å¯¹è±¡ç±»å‹ã€‚\n\n```java\nif (o instanceof Set) {\n\tSet<?> m = (Set<?>) o;\n}\n```\n> åŸç”Ÿæ€ç±»å‹åªæ˜¯ä¸ºäº†ä¸å¼•å…¥æ³›å‹ä¹‹å‰çš„é—ç•™ä»£ç è¿›è¡Œå…¼å®¹å’Œäº’ç”¨è€Œæä¾›çš„ã€‚\n\næœ¯è¯­ | ç¤ºä¾‹\n-------| -------\nå‚æ•°åŒ–ç±»å‹ | `List<String>`\nå®é™…ç±»å‹å‚æ•° | `String`\næ³›å‹ | `List<E>`\nå½¢å¼ç±»å‹å‚æ•° | `E`\næ— é™åˆ¶é€šé…ç¬¦ç±»å‹ | `List<?>`\næœ‰é™åˆ¶ç±»å‹å‚æ•° | `<E extends Number>`\né€’å½’ç±»å‹é™åˆ¶ | `<T extends Comparable<T>>`\næœ‰é™åˆ¶é€šé…ç¬¦ç±»å‹ | `List<? extends Number>`\næ³›å‹æ–¹æ³• | `static <E>List<E> asList(E[] a)`\næ³›å‹ä»¤ç‰Œ | `String.class`\n\n#### **24. æ¶ˆé™¤éå—æ£€è­¦å‘Š**\n> @SuppressWarnings(\"unchecked\")è¦æ”¾åœ¨ä¸€ä¸ªå£°æ˜ä¸Šï¼Œè¦å°†ç¦æ­¢éå—æ£€è­¦å‘ŠèŒƒå›´ç¼©åˆ°æœ€å°ï¼›æ¯æ¬¡ä½¿ç”¨æ—¶éƒ½è¦æ·»åŠ ä¸€ä¸ªæ³¨é‡Šï¼Œè¯´æ˜ä¸ºä»€ä¹ˆè¿™ä¹ˆåšæ˜¯å®‰å…¨çš„ã€‚\n\n```java\n// ä¾‹å¦‚ArrayListä¸­çš„toArrayæ–¹æ³•, æ³¨è§£ä¸åŠ åœ¨æ–¹æ³•ä¸Šè€Œæ˜¯å•ç‹¬å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡\n// ä¸ºçš„å°±æ˜¯ç¼©å°éå—æ£€è­¦å‘ŠèŒƒå›´, è¿™ä¹ˆåšæ˜¯å€¼å¾—çš„.\npublic <T> T[] toArray(T[] a) {\n\tif (a.length < size) {\n\t\t// This cast is correct because the array we're creating \n\t\t// is of the same type as the one passed in, which is T[].\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tT[] result = (T[]) Arrays.copyOf(elements, size, a.getClass());\n\t\treturn result;\n\t}\n\tSystem.arrayCopy(elements, 0, a, 0, size);\n\tif (a.length > size)\n\t\ta[size] = null;\n\treturn a;\n}\n```\n\n#### **25. åˆ—è¡¨ä¼˜å…ˆäºæ•°ç»„**\n\n - ç¦æ­¢åˆ›å»ºæ³›å‹æ•°ç»„ï¼Œä¼˜å…ˆä½¿ç”¨é›†åˆï¼›\n - æ•°ç»„æ˜¯åå˜ä¸”å¯ä»¥å…·ä½“åŒ–çš„ï¼Œæ³›å‹æ˜¯ä¸å¯å˜çš„ä¸”å¯ä»¥è¢«æ“¦é™¤çš„ã€‚\n - æ··åˆä½¿ç”¨æ—¶å¦‚ä½•å¾—åˆ°ç¼–è¯‘æ—¶é”™è¯¯æˆ–è€…è­¦å‘Šæ—¶ï¼Œç”¨åˆ—è¡¨ä»£æ›¿æ•°ç»„ã€‚\n\n#### **26. ä¼˜å…ˆè€ƒè™‘æ³›å‹**\n> ä½¿ç”¨æ³›å‹æ¯”ä½¿ç”¨éœ€è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è¿›è¡Œè½¬æ¢çš„ç±»å‹æ¥çš„æ›´åŠ å®‰å…¨ï¼Œä¹Ÿæ›´åŠ å®¹æ˜“ã€‚åªè¦æ—¶é—´å…è®¸ï¼Œå°±æŠŠç°æœ‰çš„ç±»å‹éƒ½æ³›å‹åŒ–ã€‚\n\n#### **27. ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•**\n\n```java\n// é€’å½’æ³›å‹ ç±»å‹å‚æ•°\npublic static <T extends Comparable<T>> T max(List<T> list) {\n\tIterator<T> i = list.iterator();\n\tT result = i.next();\n\twhile (i.hasNext()) {\n\t\tT t = i.next();\n\t\tif (t.compare(result) > 0)\n\t\t\tresult = t;\n\t}\n\treturn result;\n}\n```\n\n#### **28. åˆ©ç”¨æœ‰é™åˆ¶é€šé…ç¬¦æ¥æå‡APIçš„çµæ´»æ€§**\n> ä¸ºäº†è·å¾—æœ€å¤§é™åº¦çš„çµæ´»æ€§ï¼Œè¦åœ¨è¡¨ç¤ºç”Ÿäº§è€…æˆ–è€…æ¶ˆè´¹è€…çš„è¾“å…¥å‚æ•°ä¸Šä½¿ç”¨é€šé…ç¬¦ç±»å‹ã€‚\n> **PECSè¡¨ç¤ºproducer-extendsï¼Œconsumer-super**\n> æ¢å¥è¯è¯´ï¼Œ å¦‚æœå‚æ•°åŒ–ç±»å‹è¡¨ç¤ºä¸€ä¸ªTç”Ÿäº§è€…ï¼Œå°±ä½¿ç”¨<? extends T>ï¼›å¦‚æœè¡¨ç¤ºä¸€ä¸ªTæ¶ˆè´¹è€…ï¼Œå°±ä½¿ç”¨<? super T>\n\n```java\n// ç”¨Stackç¤ºä¾‹\npublic void pushAll(Iterable<? extends E> src) {\n\tfor (E e : src)\n\t\tpush(e);\n}\npublic void popAll(Collection<? super E> dst) {\n\twhile (!isEmpty()) \n\t\tdst.add(pop());\n}\n```\nä¿®æ”¹è¿‡çš„ä½¿ç”¨é€šé…ç¬¦ç±»å‹çš„å£°æ˜ï¼šPECSè§„åˆ™ï¼Œlistç”Ÿäº§Tå®ä¾‹ï¼ŒTçš„comparableæ¶ˆè´¹Tå®ä¾‹å¹¶äº§ç”Ÿè¡¨ç¤ºé¡ºåºå…³ç³»çš„æ•´å€¼ã€‚comparableå§‹ç»ˆæ˜¯æ¶ˆè´¹è€…ï¼Œå› æ­¤ä½¿ç”¨æ—¶å§‹ç»ˆåº”è¯¥æ˜¯`Comparable<? super T>`ä¼˜å…ˆäº`Comparable<T>`ã€‚å¯¹äºcomparatorä¹Ÿä¸€æ ·ï¼Œå› æ­¤ä½¿ç”¨æ—¶å§‹ç»ˆåº”è¯¥æ˜¯`Comparator<? super T>` ä¼˜å…ˆäº`Comparator<T>`\n\n```java\npublic static <T extends Comparable<? super T>> T max(List<? extends T> list)  {\n\t// è¿™é‡Œåšäº†ä¿®æ”¹\n\tIterator<? extends T> i = list.iterator();\n\tT result = i.next();\n\twhile (i.hasNext()) {\n\t\tT t = i.next();\n\t\tif (t.compare(result) > 0)\n\t\t\tresult = t;\n\t}\n\treturn result;\n}\n```\n#### **29. ä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨**\n\n```java\npublic class Favorites {\n\tprivate Map<Class<?>, Object> favorites = new HashMap<Class<?>, Object>();\n\n\tpublic <T> void putFavorite(Class<T> type, T instance) {\n\t\tif (type == null) \n\t\t\tthrow new NullPointerException(\"type is null\");\n\t\tfavorites.put(type, instance);\n\t}\n\n\tpublic <T> T getFavorite(Class<T> type) {\n\t\treturn type.cast(favorites.get(type));\n\t}\n}\n```\nç¡®ä¿æ°¸è¿œä¸è¿èƒŒå®ƒçš„ç±»å‹çº¦æŸæ¡ä»¶ï¼š\n```java\nCollections.checkedXXX();\n```\nåˆ©ç”¨Class.asSubclassæ–¹æ³•è¿›è¡Œè½¬æ¢ï¼š\n\n```java\npublic <T extends Annotation> T getAnnotation(Class<T> annotationType);\nClass<?> typeOne = Class.forName(typeOneInstance);\ngetAnnotation(typeOne.asSubclass(Annotation.class));\n```\n\n### -Chapter 6 æšä¸¾å’Œæ³¨è§£\n#### **30. ç”¨enumä»£æ›¿intå¸¸é‡**\n> æšä¸¾ç±»å‹æœ‰ä¸€ä¸ªè‡ªåŠ¨äº§ç”ŸvalueOfï¼ˆStringï¼‰æ–¹æ³•ï¼Œå®ƒå°†å¸¸é‡çš„åå­—è½¬å˜æˆå¸¸é‡æœ¬èº«ï¼›\n> æšä¸¾ä¸­çš„switchè¯­å¥é€‚åˆäºç»™å¤–éƒ¨çš„æšä¸¾ç±»å‹å¢åŠ ç‰¹å®šäºå¸¸é‡çš„è¡Œä¸ºã€‚\n```java\npublic enum Operation {\n\tPLUS(\"+\") {double apply(double x, double y) {return x + y;} },\n\tMIMUS(\"-\") {double apply(double x, double y) {return x - y} },\n\tTIMES(\"*\") {double apply(double x, double y) {return x * y} },\n\tDIVEDES(\"/\") {double apply(double x, double y) {return x / y} };\n\n\tprivate String symbol;\n\tpublic Operation(String sym) {\n\t\tthis.symbol = sym;\n\t}\n\t@Override\n\tpublic void toString() {\n\t\treturn symbol;\n\t}\n\tabstract double apply(double x, double y);\n}\n```\n\n#### **31. ç”¨å®ä¾‹åŸŸä»£æ›¿åºæ•°**\n> æ‰€æœ‰çš„æšä¸¾éƒ½æœ‰ä¸€ä¸ª`ordinal`æ–¹æ³•ï¼Œ å®ƒè¿”å›æ¯ä¸ªæšä¸¾å¸¸é‡åœ¨ç±»å‹ä¸­çš„æ•°å­—ä½ç½®ã€‚æ°¸è¿œä¸è¦æ ¹æ®æšä¸¾çš„åºæ•°å¯¼å‡ºä¸å®ƒå…³è”çš„å€¼ï¼Œè€Œæ˜¯è¦å°†å®ƒä¿å­˜åœ¨ä¸€ä¸ªå®ä¾‹ä¸­\n\n```java\npublic enum Ensemble {\n\tSOLO(1), DUET(2), TRIO(3);\n\n\tprivate int numberOfMusicians;\n\tpublic Ensemble(int size) {\n\t\tthis.numberOfMusicians = size;\n\t}\n\tpublic int numberOfMusician() {\n\t\treturn numberOfMusicians;\n\t}\n}\n```\n\n#### **32. ç”¨EnumSetä»£æ›¿ä½åŸŸ**\n> æ­£æ˜¯å› ä¸ºæšä¸¾ç±»å‹è¦ç”¨åœ¨é›†åˆSetä¸­, æ‰€æœ‰æ²¡æœ‰ç†ç”±ç”¨ä½åŸŸæ¥è¡¨ç¤ºå®ƒ.EnumSetå…·æœ‰ç®€æ´å’Œæ€§èƒ½çš„ä¼˜åŠ¿.\n```java\npublic class Text {\n\tpublic enum Style {BOLD, ITALIC, UNDERLINE, STRIKETHROUGH}\n\t\n\t// æ‰€æœ‰çš„Setéƒ½å¯ä¼ å…¥, ä½†æ˜¯EnumSetæœ€å¥½\n\t// è€ƒè™‘åˆ°å¯èƒ½è¿˜æœ‰å…¶ä»–å®ç°,æ‰€ä»¥ä½¿ç”¨Set<Style>è€Œä¸æ˜¯EnumSet<Style>\n\tpublic void applyStyles(Set<Style> styles){...}\n}\n\n// ä¸‹é¢æ˜¯å°†EnumSetå®ä¾‹ä¼ é€’ç»™applyStylesæ–¹æ³•çš„å®¢æˆ·ç«¯ä»£ç ã€‚EnumSetæä¾›äº†ä¸°å¯Œçš„\n// é™æ€å·¥å‚æ¥è½»æ¾åˆ›å»ºé›†åˆ, å…¶ä¸­ä¸€ä¸ªå¦‚ä¸‹\ntext.applyStyles(EnumSet.of(Style.BOLD, Style.ITALIC));\n```\n\n#### **33. ç”¨EnumMapä»£æ›¿åºæ•°ç´¢å¼•**\n\n```java\nMap<Herb.Type, Set<Herb>> herbsByType = new EnumMap<Herb.Type, Set<Herb>>(Herb.Type.class);\nfor (Herb.Type t : Herb.Type.values()) {\n\therbsByType.put(t, new HashSet<Herb>);\n}\nfor (Herb b : garden) {\n\therbsByType.get(b.type).add(b);\n}\n```\n\n#### **34. ç”¨æ¥å£æ¨¡æ‹Ÿå¯ä¼¸ç¼©çš„æšä¸¾**\n> é¿å…æ‰©å±•æšä¸¾ç±»å‹(ç»§æ‰¿), é‡‡ç”¨ç”¨æšä¸¾ç±»å‹å®ç°æ¥å£(å®ç°)\n```java\n// å®šä¹‰ä¸€ä¸ªæ¥å£\npublic interface Operation{...}\n// ExtendOperationå®ç°äº†è¿™ä¸ªæ¥å£\npublic ExtendOperation implements Operation{...}\npublic static void main(String[] args) {\n\tdouble x = 3.3;\n\tdouble y = 3.4;\n\t// æ–¹æ³•ä¸€\n\ttest(ExtendOperation.class, x, y);\n\t// æ–¹æ³•äºŒ\n\ttest(Arrays.asList(ExtendOperation.values()), x, y);\n}\n// æ–¹æ³•ä¸€ : ç¡®ä¿Classå¯¹è±¡æ—¢è¡¨ç¤ºæšä¸¾åˆè¡¨ç¤ºOperationçš„å­ç±»å‹\nprivate static <T extends Enum<T> & Operation> void test(\n\tClass<T> opSet, double x, double y) {\n\tfor (Operation op : opSet.getEnumConstants()) {\n\t\t// do sth\n\t}\n}\n// æ–¹æ³•äºŒ \nprivate static void test(Collection<? extends Operation> opSet, double x, double y) {\n\tfor (Operation op : opSet) {\n\t\t// do sth\n\t}\n}\n```\n\n#### **35. æ³¨è§£ä¼˜å…ˆäºå‘½åæ¨¡å¼**\n\n```java\n// æ³¨è§£ç±», åªç”¨åœ¨æ— å‚æ•°çš„é™æ€æ–¹æ³•ä¸Š\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.METHOD)\npublic @interface Test {}\n\n// æµ‹è¯•\nClass testClass = Class.forName(agrs[0]);\nfor (Method m : testClass.getDeclaredMethods()) {\n\t// åˆ¤æ–­æŸä¸ªæ–¹æ³•æ˜¯å¦è¢«Testæ³¨è§£æ ‡æ³¨\n\tif (m.isAnnotationPresent(Test.class)) {\n\t\ttry {\n\t\t\t// å¯ç›´æ¥æ‰§è¡Œè¯´æ˜æ˜¯é™æ€æ–¹æ³•; ä¼ å…¥nullè¯´æ˜æ— å‚æ•°\n\t\t\tm.invoke(null);\n\t\t} catch(InvocationTargetException ite) {\n\t\t\t// 1. å®ä¾‹æ–¹æ³•\n\t\t\t// 2. ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°\n\t\t\t// 3. ä¸å¯è®¿é—®çš„æ–¹æ³•\n\t\t}\n\t}\n}\n\n// åªæœ‰æŠ›å‡ºå¼‚å¸¸æ‰ç®—æˆåŠŸçš„æ³¨è§£ç±»\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.METHOD)\npublic @interface ExceptionTest {\n\tClass<? extends Exception> value();\n}\n// å¾…æµ‹è¯•çš„æ–¹æ³•\n@ExceptionTest(ArithmeticException.class)\npublic static void method1() {\n\tint i = 0;\n\ti = i / i;\n}\n@ExceptionTest(ArithmeticException.class)\npublic static void method2() {\n\tint[] arr = new int[1];\n\tint i = arr[3];\n}\n@ExceptionTest(ArithmeticException.class)\npublic static void method3() {\n\t// do nothing\n}\n\n// æµ‹è¯•å·¥å…·ç±»\nif (m.isAnnotationPresent(ExceptionTest.class)) {\n\ttry {\n\t\tm.invoke(null);\n\t} catch (InvocationTargetExcetpion ite) {\n\t\t// å‡ºç°çš„å¼‚å¸¸ç±»å‹\n\t\tThrowable exception = ite.getCause();\n\t\t// æœŸå¾…çš„å¼‚å¸¸ç±»å‹\n\t\tClass<? extends Exception> ex = m.getAnnotation(ExceptionTest.class).value();\n\t\t// å‡ºç°çš„å¼‚å¸¸ä¸æœŸå¾…çš„å¼‚å¸¸æ—¶åŒä¸€ç§\n\t\tif (ex.instanceOf(exception)) {...}\n\t}\n}\n\n// å¤šç§ç±»å‹å¼‚å¸¸æ³¨è§£ç±»\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementTarget.METHOD)\npublic @interface ExceptionsTest {\n\tClass<? extends Exception>[] value();\n}\n// å¾…æµ‹è¯•æ–¹æ³•æ³¨è§£\n@ExceptionsTest({IndexOutOfBoundException.class, ArithmeticException.class})\npublic static void method4() {\n}\n```\n\n#### **36. åšæŒä½¿ç”¨Overrideæ³¨è§£**\n> IDEå¯æ£€æŸ¥\n\n#### **37. ç”¨æ ‡è®°æ¥å£å®šä¹‰ç±»å‹**\n**æ ‡è®°æ¥å£ï¼Œç±»ä¼¼äºSerializableæ¥å£ï¼Œæ²¡æœ‰æ–¹æ³•ï¼Œåªæ˜¯ä¸€ä¸ªç©ºæ¥å£ä½œä¸ºæ ‡è®°ï¼Œè¢«æ ‡è®°è¿‡çš„å®ä¾‹å¯ä»¥é€šè¿‡ObjectOutputStreamå¤„ç†ã€‚**\nä¸¤è€…æ¯”è¾ƒï¼šæ ‡è®°æ¥å£å’Œæ ‡è®°æ³¨è§£\n - æ ‡è®°æ¥å£å®šä¹‰çš„ç±»å‹æ˜¯ç”±è¢«æ ‡è®°ç±»çš„å®ä¾‹å®ç°çš„ï¼›æ ‡è®°æ³¨è§£åˆ™æ˜¯æ²¡æœ‰å®šä¹‰è¿™æ ·çš„ç±»å‹ã€‚è¿™ä¸ªç±»å‹å…è®¸ä½ åœ¨ç¼–è¯‘æ—¶æ•æ‰åœ¨ä½¿ç”¨æ ‡è®°æ³¨è§£çš„æƒ…å†µä¸‹è¦åˆ°è¿è¡Œæ—¶æ‰èƒ½æ•æ‰åˆ°çš„é”™è¯¯ï¼›\n - æ ‡è®°æ¥å£çš„å¦ä¸€ä¸ªä¼˜ç‚¹ï¼Œå¯ä»¥è¢«è·Ÿå®¶ç²¾ç¡®çš„é”å®šï¼›\n - æ ‡è®°æ³¨è§£èƒœè¿‡æ ‡è®°æ¥å£çš„æœ€å¤§ä¼˜ç‚¹åœ¨äºï¼Œå®ƒå¯ä»¥é€šè¿‡é»˜è®¤çš„æ–¹å¼æ·»åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ³¨è§£ç±»å‹å…ƒç´ ï¼Œç»™ä¸€å€ä½¿ç”¨è¿‡çš„æ³¨è§£ç±»å‹æ·»åŠ æ›´å¤šçš„ä¿¡æ¯ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç®€å•ç±»å‹çš„æ ‡è®°æ³¨è§£å¯ä»¥æ¼”å˜æˆä¸°å¯Œçš„æ ‡è®°æ³¨è§£ï¼Œ æ ‡è®°æ¥å£åˆ™ä¸èƒ½ã€‚\n - æ ‡è®°æ³¨è§£çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºï¼Œå®ƒä»¬æ˜¯æ›´å¤§çš„æ³¨è§£æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ ‡è®°æ³¨è§£åœ¨é‚£äº›æ”¯æŒæ³¨è§£ä½œä¸ºç¼–ç¨‹å…ƒç´ ä¹‹ä¸€çš„æ¡†æ¶ä¸­åŒæ ·å…·æœ‰ä¸€è‡´æ€§ã€‚\n\nåŒºåˆ†ä½¿ç”¨\n\n - åº”ç”¨åˆ°ä»»ä½•ç¨‹åºå…ƒç´ ï¼ˆæ–¹æ³•ï¼Œå­—æ®µç­‰ï¼‰è€Œä¸æ˜¯ç±»æˆ–è€…æ¥å£ï¼Œå¿…é¡»ç”¨æ ‡è®°æ³¨è§£ï¼›\n - æ ‡è®°ç±»å’Œæ¥å£ï¼Œ ä¼˜å…ˆä½¿ç”¨æ ‡è®°æ¥å£ï¼›\n - æ ‡è®°åªç”¨äºç‰¹æ®Šæ¥å£çš„å…ƒç´ ï¼Œå°†æ ‡è®°å®šä¹‰ä¸ºè¯¥æ¥å£çš„ä¸€ä¸ªå­æ¥å£ï¼›\n - å¦‚æœä»¥åéœ€è¦æ‰©å±•ï¼Œç”¨æ ‡è®°æ³¨è§£ï¼›\n - å½“ç›®æ ‡æ˜¯ElementType.TYPEæ—¶ï¼Œå¤šè€ƒè™‘æ ‡è®°æ¥å£ã€‚\n\n### -Chapter 7 æ–¹æ³•\n\n#### **38. æ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§**\n\n - åœ¨æ–¹æ³•ä½“çš„å¼€å¤´æ£€æŸ¥å‚æ•°ï¼›\n - ä½¿ç”¨æ–­è¨€assertï¼Œå¤±è´¥æ—¶æŠ›å‡ºAssertionErrorï¼›\n - æ£€æŸ¥æ„é€ å™¨çš„å‚æ•°å°¤ä¸ºé‡è¦\n\n#### **39. å¿…è¦æ—¶è¿›è¡Œä¿æŠ¤æ€§æ‹·è´**\n\n- ä¿æŠ¤æ€§æ‹·è´æ˜¯åœ¨æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§ä¹‹å‰è¿›è¡Œçš„ï¼Œå¹¶ä¸”æœ‰æ•ˆæ€§æ£€æŸ¥æ˜¯é’ˆå¯¹æ‹·è´ä¹‹åçš„å¯¹è±¡ï¼›\n- å¯¹äºå‚æ•°ç±»å‹å¯ä»¥è¢«ä¸å¯ä¿¡ä»»æ–¹å­ç±»åŒ–çš„å‚æ•°ï¼Œè¯·ä¸è¦ä½¿ç”¨cloneè¿›è¡Œä¿æŠ¤æ€§æ‹·è´\n\n#### **40. è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å**\n\n 1. è°¨æ…é€‰æ‹©æ–¹æ³•åç§°ã€‚\n 2. ä¸è¦è¿‡äºè¿½æ±‚æä¾›ä¾¿åˆ©çš„æ–¹æ³•ã€‚\n 3. é¿å…è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ï¼ˆå°äºç­‰äº4ï¼‰ã€‚\n 4. å¯¹äºå‚æ•°ç±»å‹ï¼Œä¼˜å…ˆä½¿ç”¨æ¥å£è€Œä¸æ˜¯ç±»ã€‚\n 5. å¯¹äºbooleanå‚æ•°ï¼Œ ä¼˜å…ˆä½¿ç”¨ä¸¤ä¸ªå…ƒç´ çš„æšä¸¾ç±»å‹ã€‚\n\n#### **41. æ…ç”¨é‡è½½**\n\n - å¯¹äºé‡è½½æ–¹æ³•ï¼ˆoverloaded methodï¼‰çš„é€‰æ‹©æ˜¯é™æ€çš„ï¼Œè€Œå¯¹äºè¢«è¦†ç›–çš„æ–¹æ³•ï¼ˆoverridden methodï¼‰çš„é€‰æ‹©æ˜¯åŠ¨æ€çš„ã€‚\n - é¿å…èƒ¡ä¹±ä½¿ç”¨é‡è½½æœºåˆ¶çš„å®‰å…¨è€Œä¿å®ˆçš„ç­–ç•¥æ˜¯ï¼Œæ°¸è¿œä¸è¦å¯¼å‡ºä¸¤ä¸ªå…·æœ‰ç›¸åŒå‚æ•°æ•°ç›®çš„é‡è½½æ–¹æ³•ã€‚å¦‚æœæ–¹æ³•æ˜¯å¯å˜å‚æ•°ï¼Œä¿å®ˆç­–ç•¥æ˜¯æ ¹æœ¬ä¸è¦é‡è½½å®ƒã€‚\n\n#### **42. æ…ç”¨å¯å˜å‚æ•°**\n#### **43. è¿”å›é›¶é•¿åº¦çš„æ•°ç»„æˆ–é›†åˆï¼Œè€Œä¸æ˜¯null**\n\n```java\nprivate final List<Cheese> cheeseInStock = ....;\nprivate final static Cheese[] EMPTY_CHEESE_ARRAY = new Cheese[0];\n\npublic Cheese[] getCheese() {\n\treturn cheeseInStock.toArray(EMPTY_CHEESE_ARRAY);\n}\n\n// é›†åˆå€¼çš„æ–¹æ³•\npublic List<Cheese> getCheeseList() {\n\tif (cheeseOfStock .isEmpty()) {\n\t\treturn Collections.emptyList();\n\t} else {\n\t\treturn new ArrayList<Cheese>(cheeseOfStock);\n\t}\n}\n```\n\n#### **44. ä¸ºæ‰€æœ‰åˆ°å¤„çš„APIå…ƒç´ ç¼–å†™æ–‡æ¡£æ³¨é‡Š**\n\n### -Chapter 8 é€šç”¨ç¨‹åºè®¾è®¡\n\n#### **45. å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–**\n\n - è¦æ˜¯å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–ï¼Œæœ€æœ‰åŠ›çš„æ–¹æ³•å°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒçš„åœ°æ–¹å£°æ˜ã€‚\n - å‡ ä¹æ¯ä¸ªå±€éƒ¨å˜é‡çš„å£°æ˜éƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™åº”æ¨è¿Ÿå£°æ˜ã€‚try-catchä¾‹å¤–ã€‚\n - å¦‚æœå¾ªç¯ç»ˆæ­¢ä¹‹åä¸å†éœ€è¦å¾ªç¯å˜é‡çš„å†…å®¹ï¼Œforå¾ªç¯ä¼˜äºwhileå¾ªç¯ã€‚\n\n```java\n// nçš„ä½œç”¨æ˜¯:é¿å…æ¯æ¬¡å¾ªç¯äº§ç”Ÿé¢å¤–è®¡ç®—çš„å¼€é”€\nfor (int i = 0 , n = getSize(); i < n; i++) {\n\tdoSomething(i);\n}\n```\n\n#### **46. for-eachå¾ªç¯ä¼˜äºä¼ ç»Ÿçš„forå¾ªç¯**\n\nä¸‰ç§æƒ…å†µæ— æ³•ä½¿ç”¨for-each\n 1. è¿‡æ»¤ï¼šå¦‚æœéœ€è¦éå†é›†åˆï¼Œå¹¶åˆ é™¤é€‰å®šçš„å…ƒç´ ï¼Œå°±éœ€è¦ä½¿ç”¨æ˜¾ç¤ºçš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿å¯ä»¥è°ƒç”¨å®ƒçš„removeæ–¹æ³•ã€‚\n 2. è½¬æ¢ï¼šå¦‚æœéœ€è¦éå†åˆ—è¡¨æˆ–è€…æ•°ç»„ï¼Œå¹¶å–ä»£å®ƒçš„éƒ¨åˆ†æˆ–è€…å…¨éƒ¨å…ƒç´ å€¼ï¼Œå°±éœ€è¦åˆ—è¡¨è¿­ä»£å™¨æˆ–è€…æ•°ç»„ç´¢å¼•ï¼Œä»¥ä¾¿è®¾å®šå…ƒç´ çš„å€¼ã€‚\n 3. å¹³è¡Œè¿­ä»£ï¼šå¦‚æœéœ€è¦å¹¶è¡Œçš„éå†å¤šä¸ªé›†åˆï¼Œå°±éœ€è¦æ˜¾ç¤ºçš„æ§åˆ¶è¿­ä»£å™¨æˆ–è€…ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–è€…ç´¢å¼•å˜é‡éƒ½å¯ä»¥å¾—åˆ°åŒæ­¥å‰ç§»ã€‚\n\n#### **47. äº†è§£å’Œä½¿ç”¨ç±»åº“**\n\n - ä½¿ç”¨æ ‡å‡†ç±»åº“è€Œä¸æ˜¯ä¸“é—¨çš„å®ç°ã€‚\n - Collections Framework\n - java.util.concurrentåŒ…å«é«˜çº§å¹¶å‘å·¥å…·æ¥ç®€åŒ–å¤šçº¿ç¨‹çš„ç¼–ç¨‹ä»»åŠ¡ï¼Œè¿˜åŒ…å«ä½çº§åˆ«çš„å¹¶å‘åŸºæœ¬ç±»å‹\n\n#### **48. å¦‚æœéœ€è¦ç²¾ç¡®çš„ç­”æ¡ˆï¼Œ è¯·é¿å…ä½¿ç”¨floatå’Œdouble**\n> ä½¿ç”¨intæˆ–è€…longæˆ–è€…BigDecimalæ›¿ä»£ã€‚\n\n#### **49. åŸºæœ¬ç±»å‹ä¼˜å…ˆäºè£…ç®±åŸºæœ¬ç±»å‹**\n\n#### **50. å¦‚æœå…¶ä»–ç±»å‹æ›´é€‚åˆï¼Œ åˆ™å°½é‡é¿å…ä½¿ç”¨å­—ç¬¦ä¸²**\n\n - å­—ç¬¦ä¸²ä¸åˆé€‚ä»£æ›¿å…¶ä»–çš„å€¼ç±»å‹ã€‚\n - å­—ç¬¦ä¸²ä¸åˆé€‚ä»£æ›¿æšä¸¾ç±»å‹ã€‚\n - å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿èšé›†ç±»å‹ã€‚\n - å­—ç¬¦ä¸²ä¹Ÿä¸é€‚åˆä»£æ›¿èƒ½åŠ›è¡¨ã€‚\n\n#### **51. å½“å¿ƒå­—ç¬¦ä¸²è¿æ¥çš„æ€§èƒ½**\n> ä½¿ç”¨StringBuilder\n\n#### **52. é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡**\n> å¦‚æœæœ‰åˆé€‚çš„æ¥å£ç±»å‹å­˜åœ¨ï¼Œé‚£ä¹ˆå¯¹äºå‚æ•°ã€è¿”å›å€¼ã€å˜é‡å’ŒåŸŸæ¥è¯´ï¼Œå°±éƒ½åº”è¯¥ä½¿ç”¨æ¥å£ç±»å‹è¿›è¡Œå£°æ˜ï¼Œå¦‚Listã€‚\n> å¦‚æœæ²¡å“Ÿåˆé€‚çš„æ¥å£å­˜åœ¨ï¼Œå®Œå…¨å¯ä»¥ç”¨ç±»è€Œä¸æ˜¯æ¥å£æ¥å¼•ç”¨å¯¹è±¡ï¼Œå¦‚å€¼ç±»Stringã€BigInteger\n\n#### **53. æ¥å£ä¼˜å…ˆäºåå°„æœºåˆ¶**\n\n#### **54. è°¨æ…åœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•**\n> ä½¿ç”¨æœ¬åœ°æ–¹æ³•æé«˜æ€§èƒ½çš„åšæ³•ä¸å€¼å¾—æå€¡\n\n#### **55. è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–**\n\n - åŠªåŠ›é¿å…é‚£äº›é™åˆ¶æ€§èƒ½çš„è®¾è®¡å†³ç­–ã€‚\n - ä¸ºè·å¾—æ›´å¥½çš„æ€§èƒ½è€Œå¯¹APIè¿›è¡ŒåŒ…è£…ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸ä¸å¥½çš„æƒ³æ³•ã€‚\n\n#### **56. éµå®ˆæ™®éæ¥å—çš„å‘½åæƒ¯ä¾‹**\n\n### -Chapter 9 å¼‚å¸¸\n\n#### **57. åªé’ˆå¯¹å¼‚å¸¸çš„æƒ…å†µæ‰ä½¿ç”¨å¼‚å¸¸**\n\n#### **58. å¯¹äºå¯æ¢å¤çš„æƒ…å†µä½¿ç”¨å—æ£€å¼‚å¸¸ï¼Œå¯¹ç¼–ç¨‹é”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸**\n\n#### **59. é¿å…ä¸å¿…è¦åœ°ä½¿ç”¨å—æ£€å¼‚å¸¸**\n\n#### **60. ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„å¼‚å¸¸**\n\n#### **61. æŠ›å‡ºä¸æŠ½è±¡ç›¸å¯¹åº”çš„å¼‚å¸¸**\n> åº•å±‚çš„å¼‚å¸¸è¢«ä¼ åˆ°é«˜å±‚çš„å¼‚å¸¸ï¼Œé«˜å±‚çš„å¼‚å¸¸æä¾›è®¿é—®æ–¹æ³•ï¼ˆThrowable.getCauseï¼‰æ¥è·å¾—åº•å±‚çš„å¼‚å¸¸\n\n#### **62. æ¯ä¸ªæ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éƒ½è¦æœ‰æ–‡æ¡£**\n\n#### **63. åœ¨ç»†èŠ‚æ¶ˆæ¯ä¸­åŒ…å«èƒ½æ•è·å¤±è´¥çš„ä¿¡æ¯**\n\n#### **64. åŠªåŠ›ä½¿å¤±è´¥ä¿æŒåŸå­æ€§**\n\n#### **65. ä¸è¦å¿½ç•¥å¼‚å¸¸**\n\n### -Chapter 10 å¹¶å‘\n\n#### **66. åŒæ­¥è®¿é—®å…±äº«çš„å¯å˜æ•°æ®**\n> å½“å¤šä¸ªçº¿ç¨‹å…±äº«å¯å˜æ•°æ®çš„æ—¶å€™ï¼Œæ¯ä¸ªè¯»æˆ–è€…å†™æ•°æ®çš„çº¿ç¨‹å¿…é¡»æ‰§è¡ŒåŒæ­¥ã€‚\n\n#### **67. é¿å…è¿‡åº¦åŒæ­¥**\n\n - ä¸ºäº†é¿å…æ´»æ€§å¤±è´¥å’Œå®‰å…¨æ€§å¤±è´¥ï¼Œåœ¨ä¸€ä¸ªè¢«åŒæ­¥çš„æ–¹æ³•æˆ–è€…ä»£ç å—ä¸­ï¼Œæ°¸è¿œä¸è¦æ”¾å¼ƒå¯¹å®¢æˆ·ç«¯çš„æ§åˆ¶ã€‚\n - åœ¨åŒæ­¥åŒºåŸŸå†…åšå°½å¯èƒ½å°‘çš„å·¥ä½œã€‚\n - ä¸ºäº†é¿å…æ­»é”å’Œæ•°æ®æŸåï¼Œåƒä¸‡ä¸è¦ä»åŒæ­¥åŒºåŸŸå†…éƒ¨è°ƒç”¨å¤–æ¥æ–¹æ³•ã€‚\n\n#### **68. executorå’Œtaskä¼˜å…ˆäºçº¿ç¨‹**\n\n#### **69. å¹¶å‘å·¥å…·ä¼˜å…ˆäºwaitå’Œnotify**\n\n - é™¤éè¿«ä¸å¾—å·²ï¼Œå¦åˆ™åº”è¯¥ä¼˜å…ˆä½¿ç”¨ConcurrentHashMapï¼Œè€Œä¸æ˜¯ä½¿ç”¨Collections.synchronizedMapæˆ–Hashtableã€‚åªè¦ç”¨å¹¶å‘Mapæ›¿ä»£è€å¼çš„åŒæ­¥Mapï¼Œå°±å¯ä»¥æå¤§åœ°æå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚æ›´ä¸€èˆ¬åœ°ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨å¹¶å‘é›†åˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤–éƒ¨çš„åŒæ­¥é›†åˆã€‚\n - å¯¹äºé—´æ­‡å¼çš„å®šæ—¶ï¼Œå§‹ç»ˆåº”è¯¥ä¼˜å…ˆä½¿ç”¨System.nanoTimeï¼Œè€Œä¸æ˜¯System.currentTimeMillsï¼Œå‰è€…æ›´åŠ å‡†ç¡®ä¹Ÿæ›´åŠ ç²¾ç¡®ï¼Œå®ƒä¸å—ç³»ç»Ÿçš„å®æ—¶å§‹ç»ˆçš„è°ƒæ•´å½±å“ã€‚\n - ä½¿ç”¨åº”è¯¥ä½¿ç”¨waitå¾ªç¯æ¨¡å¼æ¥è°ƒç”¨waitæ–¹æ³•ï¼›æ°¸è¿œä¸è¦åœ¨å¾ªç¯ä¹‹å¤–è°ƒç”¨waitæ–¹æ³•ã€‚å¾ªç¯ä¼šåœ¨ç­‰å¾…ä¹‹å‰å’Œä¹‹åæµ‹è¯•æ¡ä»¶ã€‚\n\n```java\nprivate static final ConcurrentMap<String, String> map = ConcurrentHashMap<>();\n\npublic static String intern(String s) {\n\tString result = map.get(s);\n\tif (result == null) {\n\t\t// åº”å¯¹å¹¶å‘æƒ…å†µ\n\t\tresult = map.putIfAbsent(s, s);\n\t\tif (result == null) {\n\t\t\tresult = s;\n\t\t}\n\t}\n\treturn result;\n}\n```\n\n#### **70. çº¿ç¨‹å®‰å…¨æ€§çš„æ–‡æ¡£åŒ–**\n\n - â€œå‡ºç°synchronizedå…³é”®å­—å°±è¶³ä»¥ç”¨æ–‡æ¡£è¯´æ˜çº¿ç¨‹å®‰å…¨æ€§â€çš„è¿™ç§è¯´æ³•éšå«äº†ä¸€ä¸ªé”™è¯¯çš„è§‚å¿µï¼Œå³è®¤ä¸ºçº¿ç¨‹å®‰å…¨æ€§æ˜¯ä¸€ç§â€œè¦ä¹ˆå…¨æœ‰è¦ä¹ˆå…¨æ— â€çš„å±æ€§ã€‚\n\nçº¿ç¨‹å®‰å…¨æ€§çš„å‡ ç§çº§åˆ«ï¼š\n\n 1. ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼šè¿™ä¸ªç±»çš„å®ä¾‹æ˜¯ä¸å˜çš„ã€‚æ‰€ä»¥ï¼Œä¸éœ€è¦å¤–éƒ¨çš„åŒæ­¥ã€‚è¿™æ ·çš„ä¾‹å­åŒ…æ‹¬Stringã€Longå’ŒBigIntegerã€‚\n 2. æ— æ¡ä»¶çš„çº¿ç¨‹å®‰å…¨ï¼ˆunconditionally thread-safeï¼‰ï¼šè¿™ä¸ªç±»çš„å®ä¾‹æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯è¿™ä¸ªç±»æœ‰ç€è¶³å¤Ÿçš„å†…éƒ¨åŒæ­¥ï¼Œæ‰€ä»¥ï¼Œå®ƒçš„å®ä¾‹å¯ä»¥è¢«å¹¶å‘ä½¿ç”¨ï¼Œæ— éœ€ä»»ä½•å¤–éƒ¨åŒæ­¥ã€‚å…¶ä¾‹å­åŒ…æ‹¬Randomå’ŒConcurrentHashMapã€‚\n 3. æœ‰æ¡ä»¶çš„çº¿ç¨‹å®‰å…¨ï¼ˆconditionally thread-safeï¼‰ï¼šé™¤äº†æœ‰äº›æ–¹æ³•ä¸ºè¿›è¡Œå®‰å…¨çš„å¹¶å‘ä½¿ç”¨è€Œéœ€è¦å¤–éƒ¨åŒæ­¥ä¹‹å¤–ï¼Œè¿™ç§çº¿ç¨‹å®‰å…¨çº§åˆ«ä¸æ— æ¡ä»¶çš„çº¿ç¨‹å®‰å…¨ç›¸åŒã€‚è¿™æ ·çš„ä¾‹å­åŒ…æ‹¬Collections.synchronizedåŒ…è£…è¿”å›çš„é›†åˆï¼Œå®ƒä»¬çš„è¿­ä»£å™¨ï¼ˆiteratorï¼‰è¦æ±‚å¤–éƒ¨åŒæ­¥ã€‚\n 4. éçº¿ç¨‹å®‰å…¨ï¼ˆnot thread-safeï¼‰ï¼šè¿™ä¸ªç±»çš„å®ä¾‹æ˜¯å¯å˜çš„ã€‚ä¸ºäº†å¹¶å‘åœ°ä½¿ç”¨å®ƒä»¬ï¼Œå®¢æˆ·å¿…é¡»åˆ©ç”¨è‡ªå·±é€‰æ‹©çš„å¤–éƒ¨åŒæ­¥åŒ…å›´æ¯ä¸ªæ–¹æ³•è°ƒç”¨ï¼ˆæˆ–è€…è°ƒç”¨åºåˆ—ï¼‰ã€‚è¿™æ ·çš„ä¾‹å­åŒ…æ‹¬é€šç”¨çš„é›†åˆå®ç°ï¼Œä¾‹å¦‚ArrayListå’ŒHashMapã€‚\n 5. çº¿ç¨‹å¯¹ç«‹çš„ï¼ˆthread-hostileï¼‰ï¼šè¿™ä¸ªç±»ä¸èƒ½å®‰å…¨åœ°è¢«å¤šä¸ªçº¿ç¨‹å¹¶å‘ä½¿ç”¨ï¼Œå³ä½¿æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨éƒ½è¢«å¤–éƒ¨åŒæ­¥åŒ…å›´ã€‚çº¿ç¨‹å¯¹ç«‹çš„æ ¹æºé€šå¸¸åœ¨äºï¼Œæ²¡æœ‰åŒæ­¥åœ°ä¿®æ”¹é™æ€æ•°æ®ã€‚æ²¡æœ‰äººä¼šæœ‰æ„ç¼–å†™ä¸€ä¸ªçº¿ç¨‹å¯¹ç«‹çš„ç±»ï¼›è¿™ç§ç±»æ˜¯å› ä¸ºæ²¡æœ‰è€ƒè™‘åˆ°å¹¶å‘æ€§å„¿äº§ç”Ÿçš„åæœã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨Javaå¹³å°ç±»åº“ä¸­ï¼Œçº¿ç¨‹å¯¹ç«‹çš„ç±»æˆ–è€…æ–¹æ³•éå¸¸å°‘ã€‚System.runFinalizersOnExitæ–¹æ³•æ˜¯çº¿ç¨‹å¯¹ç«‹çš„ï¼Œä½†å·²ç»è¢«åºŸé™¤äº†ã€‚\n\n#### **71. æ…ç”¨å»¶è¿Ÿåˆå§‹åŒ–**\n\n - åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ­£å¸¸åˆå§‹åŒ–è¦ä¼˜å…ˆäºå»¶è¿Ÿåˆå§‹åŒ–ã€‚å¦‚æœåŸŸåªåœ¨ç±»çš„å®ä¾‹éƒ¨åˆ†è¢«è®¿é—®ï¼Œå¹¶ä¸”åˆå§‹åŒ–è¿™ä¸ªåŸŸçš„å¼€é”€å¾ˆé«˜ï¼Œå¯èƒ½å°±å€¼å¾—è¿›è¡Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚\n\n```java\n// æ­£å¸¸åˆå§‹åŒ–\nprivate final FieldType field = computeFieldValue();\n\n// å»¶è¿Ÿåˆå§‹åŒ–ï¼Œè¦ä½¿ç”¨åŒæ­¥è®¿é—®æ–¹æ³•\nprivate FieldType field;\nsynchronized FieldType getField() {\n\tif (field == null)\n\t\tfield = computeFieldValue();\n\treturn field;\n}\n```\n\n - å¦‚æœå‡ºäºæ€§èƒ½çš„è€ƒè™‘è€Œéœ€è¦å¯¹**é™æ€åŸŸ**ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå°±æ˜¯ç”¨lazy initialization holder classæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¿è¯äº†ç±»è¦åˆ°ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚\n\n```java\nprivate static class FieldHolder {\n\tstatic final FieldType field = computeFieldValue();\n}\nstatic Field getField() {\n\treturn FieldHolder.field;\n}\n```\n\n - å¦‚æœå¤„äºæ€§èƒ½è€ƒè™‘è€Œéœ€è¦å¯¹**å®ä¾‹åŸŸ**ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå°±ä½¿ç”¨åŒé‡æ£€æŸ¥æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼é¿å…äº†åœ¨åŸŸè¢«åˆå§‹åŒ–ä¹‹åè®¿é—®è¿™ä¸ªåŸŸæ—¶çš„é”å®šå¼€é”€ã€‚\n\n```java\nprivate volatile FieldType field;\nFieldType getField() {\n\t// å±€éƒ¨å˜é‡resultçš„ä½œç”¨æ˜¯ç¡®ä¿fieldåªåœ¨å·²ç»è¢«åˆå§‹åŒ–çš„æƒ…å†µä¸‹è¯»å–ä¸€æ¬¡,æå‡æ€§èƒ½\n\tFieldType result = field;\n\tif (result == null) {\n\t\tsynchronized(this) {\n\t\t\tresult = field;\n\t\t\tif (result == null)\n\t\t\t\tfield = result = computeFieldValue();\n\t\t}\n\t}\n\treturn result;\n}\n```\n\n - å»¶è¿Ÿåˆå§‹åŒ–ä¸€ä¸ªå¯ä»¥æ¥å—é‡å¤åˆå§‹åŒ–çš„å®ä¾‹åŸŸï¼Œå¯ä½¿ç”¨å•é‡æ£€æŸ¥æ¨¡å¼ã€‚\n \n \n\n```java\nprivate volatile FieldType field;\nprivate FieldType getField() {\n\tFieldType result = field;\n\tif (result == null) \n\t\tfield = result = computeFieldValue();\n\treturn result;\n}\n```\n\n#### **72. ä¸è¦ä¾èµ–äºçº¿ç¨‹è°ƒåº¦å™¨**\n> ä¸è¦è®©ç¨‹åºçš„æ­£ç¡®æ€§ä¾èµ–äºçº¿ç¨‹è°ƒåº¦å™¨ï¼Œå¦åˆ™ç»“æœå¾—åˆ°çš„åº”ç”¨å°†æ—¢ä¸å¥å£®ä¹Ÿä¸å…·æœ‰å¯ç§»æ¤æ€§ã€‚ä½œä¸ºæ¨è®ºï¼Œä¸è¦ä¾èµ–Thread.yieldæˆ–è€…çº¿ç¨‹ä¼˜å…ˆçº§ã€‚\n\n#### **73. é¿å…ä½¿ç”¨çº¿ç¨‹ç»„**\n\n### -Chapter 11 åºåˆ—åŒ–\n\n#### **74. è°¨æ…åœ°å®ç°Serializableæ¥å£**\n> ä¸ºäº†ç»§æ‰¿è€Œè®¾è®¡çš„ç±»åº”è¯¥å°½å¯èƒ½å°‘åœ°å»å®ç°Serializableæ¥å£ï¼Œç”¨æˆ·çš„æ¥å£ä¹Ÿåº”è¯¥å°½å¯èƒ½å°‘åœ°ç»§æ‰¿Serializableæ¥å£ã€‚\n> å¦‚æœä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªæ¥å£å­˜åœ¨çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†å‚ä¸åˆ°æŸä¸ªæ¡†æ¶ä¸­ï¼Œè¯¥æ¡†æ¶è¦æ±‚æ‰€æœ‰çš„å‚ä¸è€…å¿…é¡»å®ç°Serializableæ¥å£ï¼Œè¿™ä¸ªæ—¶å€™å®ç°æˆ–è€…æ‰©å±•Serializableæ¥å£å°±å¾ˆæœ‰æ„ä¹‰ã€‚\n> å†…éƒ¨ç±»ä¸åº”è¯¥å®ç°Serializableï¼Œå†…éƒ¨ç±»çš„é»˜è®¤åºåˆ—åŒ–å½¢å¼æ˜¯å®šä¹‰ä¸æ¸…æ¥šçš„ï¼Œç„¶è€Œé™æ€æˆå‘˜ç±»å´å¯ä»¥å®ç°Serializableã€‚\n\n```java\npublic class Foo extends AbstractFoo implements Serializable {\n\tprivate void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException {\n\t\ts.defaultReadObject();\n\t\t// Manually deserialize and initialize superclass state\n\t\tint x = s.readInt();\n\t\tint y = s.readInt();\n\t\tinitialize(x, y);\n\t}\n\n\tprivate void writeObject(ObjectOutputStream s) throws IOException {\n\t\ts.defaultWriteObject();\n\t\t// Manually serialize superclass state\n\t\ts.writeInt(getX());\n\t\ts.writeInt(getY());\n\t}\n\t\n\tpublic Foo(int x, int y) {\n\t\tsuper(x, y);\n\t}\n\t\n\tprivate static final long serialVersionUID = 185683560954L;\n}\n```\n\n#### **75. è€ƒè™‘ä½¿ç”¨è‡ªåŠ¨ä»¥åºåˆ—åŒ–å½¢å¼**\n\n```java\npublic final class StringList implements Serializable {\n\tprivate int size = 0;\n\tprivate Entry head = null;\n\tprivate static class Entry implements Serializable {\n\t\tString data;\n\t\tEntry next;\n\t\tEntry previous;\n\t}\n\t// ...Remainder omitted\n}\n```\n\nå½“ä¸€ä¸ªå¯¹è±¡çš„ç‰©ç†è¡¨ç¤ºæ³•ä¸å®ƒçš„é€»è¾‘æ•°æ®å†…å®¹æœ‰å®è´¨æ€§çš„åŒºåˆ«æ—¶ï¼Œä½¿ç”¨é»˜è®¤åºåˆ—åŒ–å½¢å¼ä¼šæœ‰ä»¥ä¸‹4ä¸ªç¼ºç‚¹ï¼š\n\n 1. **å®ƒä½¿è¿™ä¸ªç±»çš„å¯¼å‡ºAPIæ°¸è¿œåœ°æŸç¼šåœ¨è¯¥ç±»çš„å†…éƒ¨è¡¨ç¤ºæ³•ä¸Šã€‚**åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç§æœ‰çš„StringList.Entryç±»å˜æˆäº†å…¬æœ‰APIçš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœåœ¨å°†æ¥é¢ç‰ˆæœ¬ä¸­ï¼Œå†…éƒ¨è¡¨ç¤ºæ³•å‘ç”Ÿäº†å˜åŒ–ï¼ŒStringListç±»ä»å°†éœ€è¦æ¥å—é“¾è¡¨å½¢å¼çš„è¾“å…¥ï¼Œå¹¶äº§ç”Ÿé“¾è¡¨å½¢å¼çš„è¾“å‡ºã€‚è¿™ä¸ªç±»æ°¸è¿œä¹Ÿæ‘†è„±ä¸äº†ç»´æŠ¤é“¾è¡¨é¡¹æ‰€éœ€è¦çš„æ‰€æœ‰ä»£ç ï¼Œå³ä½¿å®ƒä¸å†ä½¿ç”¨é“¾è¡¨ä½œä¸ºå†…éƒ¨ç»“æ„äº†ï¼Œä¹Ÿä»ç„¶éœ€è¦è¿™äº›ä»£ç ã€‚\n 2. **å®ƒä¼šæ¶ˆè€—è¿‡å¤šçš„ç©ºé—´ã€‚**åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåºåˆ—åŒ–å½¢å¼æ—¢è¡¨ç¤ºäº†é“¾è¡¨ä¸­çš„æ¯ä¸ªé¡¹ï¼Œä¹Ÿè¡¨ç¤ºäº†æ‰€æœ‰çš„é“¾æ¥å…³ç³»ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„ã€‚è¿™äº›é“¾è¡¨é¡¹ä»¥åŠé“¾è¡¨åªä¸è¿‡æ˜¯å®ç°ç»†èŠ‚ï¼Œä¸å€¼å¾—è®°å½•åœ¨åºåˆ—åŒ–å½¢å¼ä¸­ã€‚å› ä¸ºè¿™æ ·çš„åºåˆ—åŒ–å½¢å¼è¿‡äºåºå¤§ï¼Œæ‰€ä»¥æŠŠå®ƒå†™åˆ°ç¡¬ç›˜ä¸­ï¼Œæˆ–è€…åœ¨ç½‘ç»œä¸Šå‘é€éƒ½å°†éå¸¸æ…¢ã€‚\n 3. **å®ƒä¼šæ¶ˆè€—è¿‡å¤šçš„æ—¶é—´ã€‚**åºåˆ—åŒ–é€»è¾‘å¹¶ä¸äº†è§£å¯¹è±¡å›¾çš„æ‹“è¡¥å…³ç³»ï¼Œæ‰€ä»¥å®ƒå¿…é¡»è¦ç»è¿‡ä¸€ä¸ªæ˜‚è´µçš„å›¾éå†ï¼ˆtraversalï¼‰è¿‡ç¨‹ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¿ç€nextå¼•ç”¨è¿›è¡Œéå†æ˜¯éå¸¸ç®€å•çš„ã€‚\n 4. **å®ƒä¼šå¼•èµ·æ ˆæº¢å‡ºã€‚**é»˜è®¤çš„åºåˆ—åŒ–è¿‡ç¨‹è¦å¯¹å¯¹è±¡å›¾æ‰§è¡Œä¸€æ¬¡é€’å½’éå†ï¼Œå³ä½¿å¯¹äºä¸­ç­‰è§„æ¨¡çš„å¯¹è±¡å›¾ï¼Œè¿™æ ·çš„æ“ä½œä¹Ÿå¯èƒ½å¼•èµ·æ ˆæº¢å‡ºã€‚åˆ°åº•å¤šå°‘ä¸ªå…ƒç´ ä¼šå¼•å‘æ ˆæº¢å‡ºï¼Œè¿™è¦å–å†³äºJVMçš„å…·ä½“å®ç°ä»¥åŠJavaå¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œï¼ˆæ¯”å¦‚Heap Sizeçš„-Xmsä¸-Xmxçš„å€¼ï¼‰æœ‰äº›å®ç°å¯èƒ½æ ¹æœ¬ä¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜ã€‚\n\nä¿®è®¢ç‰ˆæœ¬ï¼Œtransientä¿®é¥°ç¬¦è¡¨æ˜è¿™ä¸ªå®ä¾‹åŸŸå°†ä»ä¸€ä¸ªç±»çš„é»˜è®¤åºåˆ—åŒ–å½¢å¼ä¸­çœç•¥æ‰ã€‚\n\n```java\npublic final class StringList implements Serializable {\n\tprivate transient int size = 0;\n\tprivate transient Entry head = null;\n\tprivate static class Entry {\n\t\tString data;\n\t\tEntry next;\n\t\tEntry previous;\n\t}\n\t// æ·»åŠ æŒ‡å®šçš„stringåˆ°è¿™ä¸ªé›†åˆ\n\tpublic final void add(String s) {...}\n\n\t// é‡å†™writeObjectæ–¹æ³•, ä¸ç‰©ç†è¡¨ç¤ºæ³•çš„ç»†èŠ‚è„±ç¦»\n\tprivate void writeObject(ObjectOutputStream s) throws IOException {\n\t\ts.defaultWriteObject();\n\t\ts.writeInt(size);\n\t\tfor (Entry e = head; e != null; e = e.next) {\n\t\t\ts.writeObject(e.data);\n\t\t}\n\t}\n\n\t// é‡å†™readObjectæ–¹æ³•,ä¸writeå¯¹åº”\n\tprivate void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException {\n\t\ts.defaultReadObject();\n\t\tint numElements = s.readInt();\n\t\tfor (int i = 0; i < numElements; i++) {\n\t\t\tadd((String) s.readObject());\n\t\t}\n\t}\n\t...// Remainder omitted\n}\n```\n> å°½ç®¡StringListçš„æ‰€æœ‰åŸŸéƒ½æ˜¯ç¬æ—¶çš„(transient)ï¼Œä½†wirteObjectæ–¹æ³•çš„é¦–è¦ä»»åŠ¡ä»æ˜¯è°ƒç”¨defaultWriteObjectï¼ŒreadObjectæ–¹æ³•çš„é¦–è¦ä»»åŠ¡åˆ™æ˜¯è°ƒç”¨defaultReadObjectã€‚å¦‚æœæ‰€æœ‰çš„å®ä¾‹åŸŸéƒ½æ˜¯ç¬æ—¶çš„ï¼Œä»æŠ€æœ¯è§’åº¦è€Œè¨€ï¼Œä¸è°ƒç”¨defaultWriteObjectå’ŒdefaultReadObjectä¹Ÿæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯ä¸æ¨èè¿™æ ·åšã€‚å³ä½¿æ‰€æœ‰çš„å®ä¾‹åŸŸéƒ½æ˜¯transientçš„ï¼Œè°ƒç”¨defaultWriteObjectä¹Ÿä¼šå½±å“è¯¥ç±»çš„åºåˆ—åŒ–å½¢å¼ï¼Œä»è€Œæå¤§åœ°å¢å¼ºçµæ´»æ€§ã€‚è¿™æ ·å¾—åˆ°çš„åºåˆ—åŒ–å½¢å¼å…è®¸åœ¨ä»¥åçš„å‘è¡Œç‰ˆä¸­å¢åŠ étransientå®ä¾‹åŸŸï¼Œå¹¶ä¸”è¿˜èƒ½ä¿æŒå‘å‰æˆ–è€…å‘åå…¼å®¹æ€§ã€‚å¦‚æœæŸä¸€ä¸ªå®ä¾‹å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«åºåˆ—åŒ–ï¼Œç„¶ååœ¨å‰ä¸€ä¸ªç‰ˆæœ¬ä¸­è¢«ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆï¼Œåå¢åŠ çš„åŸŸå°†è¢«å¿½ç•¥æ‰ã€‚å¦‚æœæ—§ç‰ˆæœ¬çš„readObjectæ–¹æ³•æ²¡æœ‰è°ƒç”¨defaultReadObjectï¼Œååºåˆ—åŒ–è¿‡ç¨‹å°†å¤±è´¥ï¼Œå¼•å‘StreamCorrupted Exceptionå¼‚å¸¸ã€‚\n> æ— è®ºæ˜¯å¦ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å½¢å¼ï¼Œå½“defaultWriteObjectæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªæœªè¢«æ ‡è®°ä¸ºtransientçš„å®ä¾‹åŸŸéƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚å› æ­¤æ¯ä¸€ä¸ªå¯ä»¥è¢«æ ‡è®°ä¸ºtransientçš„å®ä¾‹åŸŸéƒ½åº”è¯¥åšä¸Šè¿™æ ·çš„æ ‡è®°ã€‚è¿™åŒ…æ‹¬é‚£äº›å†—ä½™çš„åŸŸï¼Œå³å®ƒä»¬çš„å€¼å¯ä»¥æ ¹æ®å…¶ä»–â€œåŸºæœ¬æ•°æ®ç±»å‹â€è®¡ç®—è€Œå¾—åˆ°çš„åŸŸï¼Œæ¯”å¦‚ç¼“å­˜èµ·æ¥çš„æ•£åˆ—å€¼ã€‚**åœ¨å°†ä¸€ä¸ªåŸŸåšæˆétransientçš„ä¹‹å‰ï¼Œè¯·ä¸€å®šè¦ç¡®ä¿¡å®ƒçš„å€¼æ˜¯è¯¥å¯¹è±¡é€»è¾‘çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚**å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ç§è‡ªå®šä¹‰çš„åºåˆ—åŒ–å½¢å¼ï¼Œå¤§å¤šæ•°å®ä¾‹åŸŸï¼Œæˆ–è€…æ‰€æœ‰çš„å®ä¾‹åŸŸåˆ™éƒ½åº”è¯¥è¢«æ ‡è®°ä¸ºtransientï¼Œå°±åƒä¸Šé¢ä¾‹å­ä¸­çš„StringListé‚£æ ·ã€‚\n> å¦‚æœæ­£åœ¨ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å½¢å¼ï¼Œ å¹¶ä¸”æŠŠä¸€ä¸ªæˆ–è€…å¤šä¸ªåŸŸæ ‡è®°ä¸ºtransientï¼Œåˆ™è¦è®°ä½ï¼Œå½“ä¸€ä¸ªå®ä¾‹è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¿™äº›åŸŸå°†è¢«åˆå§‹åŒ–ä¸ºå®ƒä»¬çš„é»˜è®¤å€¼ã€‚\n> æ— è®ºæ˜¯å¦ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å½¢å¼ï¼Œå¦‚æœåœ¨è¯»å–æ•´ä¸ªå¯¹è±¡çŠ¶æ€çš„ä»»ä½•å…¶ä»–æ–¹æ³•ä¸Šå¼ºåˆ¶ä»»ä½•åŒæ­¥ï¼Œåˆ™å¿…é¡»åœ¨å¯¹è±¡åºåˆ—åŒ–ä¸Šå¼ºåˆ¶è¿™ç§åŒæ­¥ã€‚\n> ä¸ç®¡é€‰æ‹©äº†å“ªç§åºåˆ—åŒ–å½¢å¼ï¼Œéƒ½è¦ä¸ºè‡ªå·±ç¼–å†™çš„æ¯ä¸ªå¯åºåˆ—åŒ–çš„ç±»å£°æ˜ä¸€ä¸ªæ˜¾ç¤ºçš„åºåˆ—åŒ–ç‰ˆæœ¬UIDï¼ˆserial version UIDï¼‰ã€‚ç¬¬ä¸€é¿å…ä¸å…¼å®¹ï¼Œç¬¬äºŒå‡å°é¢å¤–è®¡ç®—çš„å¼€é”€ã€‚\n\n```java\npirvate static final long serialVersionUID = randomLongValue;\n```\n> åœ¨ç¼–å†™æ–°ç±»æ—¶ï¼Œä¸ºrandomLongValueé€‰æ‹©ä»€ä¹ˆå€¼å¹¶ä¸é‡è¦ã€‚é€šè¿‡åœ¨è¯¥ç±»ä¸Šè¿è¡Œserialverå·¥å…·ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™æ ·ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯ï¼Œå‡­ç©ºç¼–é€ ä¸€ä¸ªæ•°å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¦‚æœæƒ³ä¿®æ”¹ä¸€ä¸ªæ²¡æœ‰åºåˆ—ç‰ˆæœ¬UIDçš„ç°æœ‰çš„ç±»ï¼Œå¹¶å¸Œæœ›æ–°çš„ç‰ˆæœ¬èƒ½å¤Ÿæ¥å—ç°æœ‰çš„åºåˆ—åŒ–å®ä¾‹ï¼Œå°±å¿…é¡»ä½¿ç”¨serialverå·¥å…·ä¸ºæ—§ç‰ˆæœ¬ç”Ÿæˆå€¼ã€‚\n\n#### **76. ä¿æŠ¤æ€§åœ°ç¼–å†™readObjectæ–¹æ³•**\n> å½“ä¸€ä¸ªå¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå¯¹äºå®¢æˆ·ç«¯ä¸åº”è¯¥æ‹¥æœ‰çš„å¯¹è±¡å¼•ç”¨ï¼Œå¦‚æœå“ªä¸ªåŸŸåŒ…å«äº†è¿™æ ·çš„å¯¹è±¡å¼•ç”¨ï¼Œå°±å¿…é¡»è¦åšä¿æŠ¤æ€§æ‹·è´ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ã€‚\n\næŒ‡å¯¼æ–¹é’ˆï¼š\n\n - å¯¹äºå¯¹è±¡å¼•ç”¨åŸŸå¿…é¡»ä¿æŒä¸ºç§æœ‰çš„ç±»ï¼Œè¦ä¿æŠ¤æ€§çš„æ‹·è´è¿™äº›åŸŸä¸­çš„æ¯ä¸ªå¯¹è±¡ã€‚ä¸å¯å˜ç±»çš„å¯å˜ç»„ä»¶å°±å±äºè¿™ä¸€ç±»åˆ«ã€‚\n - å¯¹äºä»»ä½•çº¦æŸæ¡ä»¶ï¼Œå¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªInvalidObjectExceptionå¼‚å¸¸ã€‚è¿™äº›æ£€æŸ¥åŠ¨ä½œåº”è¯¥è·Ÿåœ¨æ‰€æœ‰çš„ä¿æŠ¤æ€§æ‹·è´ä¹‹åã€‚\n - å¦‚æœæ•´ä¸ªå¯¹è±¡å›¾åœ¨è¢«ååºåˆ—åŒ–ä¹‹åå¿…é¡»è¿›è¡ŒéªŒè¯ï¼Œå°±åº”è¯¥ä½¿ç”¨ObjectInputValidationæ¥å£ã€‚\n - æ— è®ºæ˜¯ç›´æ¥æ–¹å¼è¿˜æ˜¯é—´æ¥æ–¹å¼ï¼Œéƒ½ä¸è¦è°ƒç”¨ç±»ä¸­ä»»ä½•å¯è¢«è¦†ç›–çš„æ–¹æ³•ã€‚\n\n#### **77. å¯¹äºå®ä¾‹æ§åˆ¶ï¼Œæšä¸¾ç±»å‹ä¼˜å…ˆäºreadResolve**\n> readResolveç‰¹æ€§å…è®¸ä½ ç”¨readObjectåˆ›å»ºçš„å®ä¾‹ä»£æ›¿å¦ä¸€ä¸ªå®ä¾‹ã€‚å¯¹äºä¸€ä¸ªæ­£åœ¨è¢«ååºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå¦‚æœå®ƒçš„ç±»å®šä¹‰äº†ä¸€ä¸ªreadResolveæ–¹æ³•ï¼Œå¹¶ä¸”å…·å¤‡æ­£ç¡®çš„å£°æ˜ï¼Œé‚£ä¹ˆåœ¨ååºåˆ—åŒ–ä¹‹åï¼Œæ–°å»ºå¯¹è±¡ä¸Šçš„readResolveæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ç„¶åè¯¥æ–¹æ³•è¿”å›çš„å¯¹è±¡å¼•ç”¨å°†è¢«è¿”å›ï¼Œå–ä»£æ–°å»ºçš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªç‰¹æ€§çš„ç»å¤§å¤šæ•°ç”¨æ³•ä¸­ï¼ŒæŒ‡å‘æ–°å»ºå¯¹è±¡çš„å¼•ç”¨ä¸éœ€è¦å†è¢«ä¿ç•™ï¼Œå› æ­¤ç«‹å³æˆä¸ºåƒåœ¾å›æ”¶çš„å¯¹è±¡ã€‚\n\n> æ€»è€Œè¨€ä¹‹ï¼Œåº”è¯¥å°½å¯èƒ½åœ°ä½¿ç”¨æšä¸¾dangæ¥å®æ–½å®ä¾‹æ§åˆ¶çš„çº¦æŸæ¡ä»¶ã€‚å¦‚æœåšä¸åˆ°ï¼ŒåŒæ—¶åˆéœ€è¦ä¸€ä¸ªæ—¢å¯åºåˆ—åŒ–åˆæ˜¯å®ä¾‹å—æ§çš„ç±»ï¼Œå°±å¿…é¡»æä¾›ä¸€ä¸ªreadResolveæ–¹æ³•ï¼Œå¹¶ç¡®ä¿è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹åŸŸéƒ½ä¸ºåŸºæœ¬ç±»å‹ï¼Œæˆ–è€…æ—¶transientã€‚\n\n#### **78. è€ƒè™‘ç”¨åºåˆ—åŒ–ä»£ç†ä»£æ›¿åºåˆ—åŒ–å®ä¾‹**\nåºåˆ—åŒ–ä»£ç†æ¨¡å¼ç›¸å½“ç®€å•ï¼š\n\n 1. ä¸ºå¯åºåˆ—åŒ–çš„ç±»è®¾è®¡ä¸€ä¸ªç§æœ‰çš„é™æ€åµŒå¥—ç±»ï¼Œç²¾ç¡®åœ°è¡¨ç¤ºå¤–å›´ç±»çš„å®ä¾‹çš„é€»è¾‘çŠ¶æ€ã€‚è¿™ä¸ªåµŒå¥—ç±»è¢«ç§°ä½œåºåˆ—åŒ–ä»£ç†ï¼Œå®ƒåº”è¯¥æœ‰ä¸€ä¸ªå•ç‹¬çš„æ„é€ å™¨ï¼Œå…¶å‚æ•°ç±»å‹å°±æ˜¯é‚£ä¸ªå¤–å›´ç±»ã€‚è¿™ä¸ªæ„é€ å™¨åªä»å®ƒçš„å‚æ•°ä¸­å¤åˆ¶æ•°æ®ï¼šå®ƒä¸éœ€è¦è¿›è¡Œä»»ä½•ä¸€è‡´æ€§æ£€æŸ¥æˆ–è€…ä¿æŠ¤æ€§æ‹·è´ã€‚ä»è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œåºåˆ—åŒ–ä»£ç†çš„é»˜è®¤åºåˆ—åŒ–å½¢å¼æ˜¯å¤–å›´ç±»æœ€å¥½çš„åºåˆ—åŒ–å½¢å¼ã€‚å¤–å›´ç±»åŠå…¶åºåˆ—ä»£ç†éƒ½å¿…é¡»å£°æ˜å®ç°Serializableæ¥å£ã€‚\n\t \n\t```\n\tprivate static class SerializationProxy implements Serializable {\n\t\tprivate final Date start;\n\t\tprivate final Date end;\n\t\n\t\tSerializationProxy(Period p) {\n\t\t\tthis.start = p.start;\n\t\t\tthis.end = p.end;\n\t\t}\n\t\tprivate static final long serialVerionUID = 302480420480234L;\n\t}\n\t```\n\n 2.  æ¥ä¸‹æ¥ï¼Œå°†ä¸‹é¢çš„writeReplaceæ–¹æ³•æ·»åŠ åˆ°å¤–å›´ç±»ä¸­ã€‚é€šè¿‡åºåˆ—åŒ–ä»£ç†ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¢«é€å­—å¤åˆ¶åˆ°ä»»ä½•ç±»ä¸­ï¼š\n \n\t```\n\tprivate Object writeReplace() {\n\t\treturn new SerializationProxy(this);\n\t}\n\t```\nè¿™ä¸ªæ–¹æ³•çš„å­˜åœ¨å¯¼è‡´åºåˆ—åŒ–ç³»ç»Ÿäº§ç”Ÿä¸€ä¸ªSerializationProxyå®ä¾‹,ä»£æ›¿å¤–å›´ç±»çš„å®ä¾‹ã€‚æ¢å¥è¯è¯´ï¼ŒwriteReplaceæ–¹æ³•åœ¨åºåˆ—åŒ–ä¹‹å‰ï¼Œå°†å¤–å›´ç±»çš„å®ä¾‹è½¬å˜æˆäº†å®ƒçš„åºåˆ—åŒ–ä»£ç†ã€‚æ‰€ä»¥åºåˆ—åŒ–ç³»ç»Ÿæ°¸è¿œä¸ä¼šäº§ç”Ÿå¤–å›´ç±»çš„åºåˆ—åŒ–å®ä¾‹ï¼Œä¸ºäº†é¿å…æ”»å‡»è€…ä¼ªé€ ï¼Œåªè¦åœ¨å¤–å›´ç±»ä¸­æ·»åŠ è¿™ä¸ªreadObjectæ–¹æ³•å³å¯ï¼š\n\n\t```\n\tprivate void readObject(ObjectInputStream s) throws InvalidationException {\n\t\tthrow new InvalidationException(\"Proxy required\");\n\t}\n\t```\n\n 3. æœ€åï¼Œåœ¨SerializationProxyç±»ä¸­æä¾›ä¸€ä¸ªreadResolveæ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªé€»è¾‘ä¸Šç›¸å½“äºå¤–å›´ç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•ä½¿åºåˆ—åŒ–ç³»ç»Ÿåœ¨ååºåˆ—åŒ–æ—¶å°†åºåˆ—åŒ–ä»£ç†è½¬å˜å›å¤–å›´ç±»çš„å®ä¾‹ã€‚\nè¿™ä¸ªreadResolveæ–¹æ³•ä»…ä»…åˆ©ç”¨å®ƒçš„å…¬æœ‰APIåˆ›å»ºå¤–å›´ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ­£æ˜¯è¯¥æ¨¡å¼çš„é­…åŠ›ä¹‹æ‰€åœ¨ã€‚å®ƒæå¤§åœ°æ¶ˆé™¤äº†åºåˆ—åŒ–æœºåˆ¶ä¸­è¯­è¨€æœ¬èº«ä¹‹å¤–çš„ç‰¹å¾ï¼Œå› ä¸ºååºåˆ—åŒ–å®ä¾‹æ˜¯åˆ©ç”¨ä¸ä»»ä½•å…¶ä»–å®ä¾‹ç›¸åŒçš„æ„é€ å™¨ã€é™æ€å·¥å‚å’Œæ–¹æ³•è€Œåˆ›å»ºçš„ã€‚è¿™æ ·å°±ä¸å¿…å•ç‹¬ç¡®ä¿è¢«ååºåˆ—åŒ–çš„å®ä¾‹ä¸€å®šè¦éµå®ˆç±»çš„çº¦æŸæ¡ä»¶ã€‚å¦‚æœè¯¥ç±»çš„é™æ€å·¥å‚æˆ–è€…æ„é€ å™¨å»ºç«‹äº†è¿™äº›çº¦æŸæ¡ä»¶ï¼Œå¹¶ä¸”å®ƒçš„å®ä¾‹æ–¹æ³•åœ¨ç»´æŒç€è¿™äº›çº¦æŸæ¡ä»¶ï¼Œä½ å°±å¯ä»¥ç¡®ä¿¡åºåˆ—åŒ–ä¹Ÿä¼šç»´æŒè¿™äº›çº¦æŸæ¡ä»¶ã€‚\nä¸Šè¿°Period.SerializationProxyçš„readResolveæ–¹æ³•ï¼š\n\n\t```\n\tprivate Object readResolve() {\n\t\treturn new Period(start, end);\n\t}\n\t```\n\n---\n- ä¸¤ä¸ªå±€é™æ€§ï¼šå®ƒä¸èƒ½ä¸å¯ä»¥è¢«å®¢æˆ·ç«¯æ‰©å±•çš„ç±»å…¼å®¹ï¼Œå®ƒä¹Ÿä¸èƒ½ä¸å¯¹è±¡å›¾ä¸­åŒ…å«å¾ªç¯çš„æŸäº›ç±»å…¼å®¹ï¼šå¦‚æœä¼å›¾ä»ä¸€ä¸ªå¯¹è±¡çš„åºåˆ—åŒ–ä»£ç†çš„readResolveæ–¹æ³•å†…éƒ¨è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªClassCastExceptionå¼‚å¸¸ï¼Œå› ä¸ºè¿˜æ²¡æœ‰è¿™ä¸ªå¯¹è±¡ï¼Œåªæœ‰å®ƒçš„åºåˆ—åŒ–ä»£ç†ã€‚\n-  ä»£ä»·ï¼šæ¯”ä¿æŠ¤æ€§æ‹·è´è¿›è¡Œçš„å¼€é”€å¤§ã€‚\n- å½“å¿…é¡»åœ¨ä¸€ä¸ªä¸èƒ½è¢«å®¢æˆ·ç«¯æ‰©å±•çš„ç±»ï¼ˆfinalï¼‰ä¸Šç¼–å†™readObjectæˆ–è€…writeObjectæ–¹æ³•çš„æ—¶å€™ï¼Œå°±åº”è¯¥è€ƒè™‘ä½¿ç”¨åºåˆ—åŒ–ä»£ç†æ¨¡å¼ã€‚","tags":["Java"],"categories":["è¯»ä¹¦ç¬”è®°"]},{"title":"Android YuvImageç›´æ¥æ—‹è½¬","url":"/2017/10/5fec38fe91ba/","content":"---\næ“ä½œç›¸æœºçš„`Preview`å¯é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ·»åŠ å›è°ƒæ¥å£ï¼š\n<!--more--> \n```java\nCamera.setPreviewCallbackBuffer(PreviewCallback);\nCamera.setOneShotPreviewCallback(PreviewCallback);\nCamera.setPreviewCallback(PreviewCallback);\n```\n**PreviewCallback**æ¥å£é‡Œé¢åªæœ‰ä¸€ä¸ªå›è°ƒæ–¹æ³•:\n`void onPreviewFrame(byte[] data, Camera camera);`\n\nå…¶ä¸­çš„`byte[] data`å°±æ˜¯`Preview`çš„å›¾åƒæ•°æ®ï¼Œæ ¼å¼ä¸º`YuvImage`ï¼Œè€Œè¿™ä¸ªå›¾åƒå¤©ç”Ÿæ˜¯æ¨ªç€çš„ï¼Œä¸€èˆ¬çš„æ—‹è½¬æ“ä½œæ˜¯:\nYuvImageçš„byte[] --> Bitmapçš„byte[] --> ç”ŸæˆBitmap --> æ—‹è½¬Bitmap\n---\n<!--more-->\n**ç¤ºä¾‹ä»£ç **\n\n```java\npublic void onPreviewFrame(byte[] data, Camera camera) {\n        final int width = camera.getParameters().getPreviewSize().width;\n        final int height = camera.getParameters().getPreviewSize().height;\n        // é€šè¿‡YuvImageå¾—åˆ°Bitmapæ ¼å¼çš„byte[]\n        YuvImage yuvImage = new YuvImage(data, ImageFormat.NV21, width, height, null);\n        ByteArrayOutputStream out = new ByteArrayOutputStream();\n        yuvImage.compressToJpeg(new Rect(0, 0, width, height), 100, out);\n        byte[] dataBmp = out.toByteArray();\n        // ç”ŸæˆBitmap\n        Bitmap bitmap = BitmapFactory.decodeByteArray(data, 0, dataBmp.length);\n        // æ—‹è½¬\n        Matrix matrix = new Matrix();\n        matrix.setRotate(90);\n        Bitmap bmp = Bitmap.createBitmap(bitmap, 0, 0, width, height, matrix, false);\n        // ä¿å­˜åˆ°æœ¬åœ°\n        File file = new File(\"/storage/emulated/0/\" + System.currentTimeMillis() + \".jpg\");\n        try {\n            FileOutputStream fos = new FileOutputStream(file);\n            bmp.compress(Bitmap.CompressFormat.JPEG, 100, fos);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n```\n\n## åŸç†\n---\nå®é™…ä¸Šï¼Œå¯ä»¥ç›´æ¥æ—‹è½¬YuvImageã€‚Cameraè¿”å›çš„æ•°æ®æ ¼å¼é»˜è®¤æ˜¯`NV21`ï¼Œå³YUV420çš„YV12ï¼Œæ¯4ä¸ªYå…±ç”¨ä¸€ç»„UVåˆ†é‡ã€‚æ¢å¥è¯è¯´å°±æ˜¯å‡è®¾ä¸€å¼ å®½ä¸º`width`é«˜ä¸º`height`çš„å›¾åƒï¼Œå…±`sum = width * height`ä¸ªåƒç´ ç‚¹ï¼Œé‚£ä¹ˆYåˆ†é‡ä¸€å…±`sum`ä¸ªï¼ŒUåˆ†é‡ä¸€å…±`sum/4`,Våˆ†é‡ä¸€å…±`sum/4`ï¼ŒYUVåŒRGBç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥è¡¨ç¤ºå›¾åƒå±æ€§ï¼ŒYUVå„å 1ä¸ªbyteï¼Œæ‰€ä»¥å­˜å‚¨è¯¥å›¾åƒçš„byte[] çš„é•¿åº¦ä¸ºYUVçš„æ•°é‡ä¹‹å’Œï¼Œ3/2*sumã€‚\nä¾‹å¦‚ï¼Œä¸€å¼ 4åƒç´ x4åƒç´ çš„å›¾ç‰‡ï¼Œå­˜å‚¨æ ¼å¼ä¸º\n![](https://i.loli.net/2021/07/06/kEtbGrWgdw7qY14.png)\n**æ¯ä¸ªåƒç´ ç‚¹éƒ½æœ‰YUV3ä¸ªåˆ†é‡**ï¼Œä¸€ä¸ªæ–¹æ ¼ä»£è¡¨1byteï¼ŒYåˆ†é‡é¡ºåºæ’åˆ—ï¼Œä¹‹åVUåˆ†é‡äº¤å‰æ’åˆ—ï¼ŒY1ã€Y2ã€Y5ã€Y6å…±ç”¨V1U1åˆ†é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬1ä¸ªåƒç´ ç‚¹ä¸º[Y1 V1 U1]ï¼Œç¬¬2ä¸ªåƒç´ ç‚¹ä¸º[Y2 V1 U1]ï¼Œç¬¬5ä¸ªåƒç´ ç‚¹[Y5 V1 U1]ï¼Œç¬¬6ä¸ªåƒç´ ç‚¹[Y6 V1 U1]ï¼ŒåŒç†é¢œè‰²ç›¸åŒéƒ½å…±ç”¨ã€‚æœ‰äº†ä¸Šé¢çš„åŸºç¡€å†æ¥è¯´æ—‹è½¬ï¼Œå›¾åƒæ—‹è½¬å°±æ˜¯æ”¹å˜æ•°ç»„ä¸­YUVå„ä¸ªåˆ†é‡çš„ä½ç½®ï¼Œå˜æ¢ä¹‹åè¦ä¿è¯å…±ç”¨å…³ç³»ä¸èƒ½å˜ï¼Œå³Y1ã€Y2ã€Y5ã€Y6è¿˜è¦å…±ç”¨V1ã€U1åˆ†é‡ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬90åº¦åå¦‚ä¸‹\n![](https://i.loli.net/2021/07/06/v1AquyOJP5bhQfL.png)\nç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œ**ç®€å•è¯´å°±æ˜¯Yåˆ†é‡éƒ¨åˆ†å’ŒVUåˆ†é‡éƒ¨åˆ†åˆ†åˆ«æ—‹è½¬**\næœ‰äº†ä»¥ä¸Šçš„åŸºç¡€ï¼Œå†æ¥æ€»ç»“ä¸€ä¸‹é¡ºæ—¶é’ˆæ—‹è½¬90åè§’æ ‡å¯¹åº”å…³ç³»ï¼š\næ—‹è½¬å‰çš„å›¾ï¼šsrcWidthã€srcHeight\næ—‹è½¬åçš„å›¾ï¼šdstWidthã€dstHeightï¼ˆæ—‹è½¬å‰åå®½é«˜å¯¹è°ƒï¼Œå³sW=dHã€sH=dWï¼‰\nå…ˆçœ‹Yåˆ†é‡ï¼Œå‡è®¾æ—‹è½¬åçš„å›¾ä¸­ç¬¬iè¡Œï¼Œç¬¬jåˆ—çš„ä¸€ä¸ªåƒç´ ï¼Œå®ƒçš„Yåˆ†é‡ä¸º(i, j)ï¼Œå®ƒåœ¨æ—‹è½¬(é¡ºæ—¶é’ˆæ—‹è½¬90åº¦)å‰çš„ä½ç½®ä¸º(srcHeight-1-j, i)ï¼›\nå†çœ‹VUåˆ†é‡ï¼Œå› ä¸º`NV21`æ ¼å¼æ¯ç»„UVåˆ†é‡æœ‰4ä¸ªYåˆ†é‡å…±ç”¨ï¼Œæ‰€ä»¥åªè¦éšç€4ä¸ªä¸­çš„ä¸€ä¸ªæ”¹å˜ä¸€æ¬¡å°±å¯ä»¥äº†ï¼Œæˆ‘é€‰æ‹©è®©VUåˆ†é‡è·Ÿç€å·¦ä¸Šè§’çš„Yåˆ†é‡ä¸€èµ·å˜æ¢ï¼ˆä¾‹å¦‚ï¼ŒV1U1è·Ÿç€æ—‹è½¬åçš„Y5å˜æ¢ï¼‰å³ï¼Œå½“(i, j)ä¸ºå·¦ä¸Šè§’çš„Yæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å®ƒå¯¹åº”æ—‹è½¬å‰çš„4ä¸ªåˆ†é‡ä¸­å·¦ä¸‹è§’çš„Yï¼ˆåY5å’Œå‰Y5ï¼‰ï¼Œå‰Y5çš„VUåˆ†é‡ï¼Œæ”¾åˆ°åY5VUåˆ†é‡çš„ä½ç½®å³å¯ï¼Œå½“è¿›è¡Œåˆ°æ—‹è½¬åçš„å›¾4ä¸ªYåˆ†é‡ä¸­çš„å…¶ä»–3ä¸ªåˆ†é‡æ—¶ä¸å†è¿›è¡ŒVUåˆ†é‡çš„æ“ä½œï¼›\nYåˆ†é‡ä¸å…¶å¯¹åº”çš„VUåˆ†é‡çš„è¡Œè§’æ ‡å¯¹åº”å…³ç³»ä¸ºï¼šç›®æ ‡VUè¡Œè§’æ ‡ = Yè¡Œè§’æ ‡ + å›¾åƒçš„é«˜ã€‚\n## å®è·µï¼ˆä¸Šé¢ä¸æ‡‚ä¸é‡è¦ï¼Œä»£ç å¯ä»¥ç›´æ¥ç”¨~ï¼‰\n---\n\n```java\n  public void onPreviewFrame(final byte[] data, Camera camera) {\n\t\t// å°†ç³»ç»Ÿå›è°ƒçš„æ•°ç»„æ‹·è´ä¸€ä»½,æ“ä½œæ‹·è´çš„æ•°æ®\n        byte[] dataCopy = new byte[data.length];\n        System.arraycopy(srcData, 0, dataCopy , 0, data.length);\n        Camera.Size size = camera.getParameters().getPreviewSize();\n        final int srcWidth = size.width;\n        final int srcHeight = size.height;\n        final int dstWidth = size.height;\n        final int dstHeight = size.width;\n        // 1.5å€çš„æ€»æ•°,å¤šå‡ºæ¥çš„éƒ¨åˆ†è£…VUåˆ†é‡\n        byte[] buf = new byte[dstWidth * dstHeight * 3 / 2];\n\n        for (int i = 0; i < dstHeight; i++) {\n            for (int j = 0; j < dstWidth; j++) {\n                // æ–°æ•°ç»„ä¸­æ‘†æ”¾Yå€¼ æ—‹è½¬å(i,j) --> æ—‹è½¬å‰(srcHeight-1-j, i)\n                buf[i * dstWidth + j] = dataCopy[(srcHeight - 1 - j) * srcWidth + i];\n                // ç¡®è®¤æ˜¯å·¦ä¸Šè§’çš„ç‚¹\n                if (i % 2 == 0 && j % 2 == 0) {\n                    // æ‘†æ”¾Vå€¼ ç›®æ ‡è¡Œå·= è¡Œå·/2 + é«˜\n                    buf[(i / 2 + srcWidth) * dstWidth + j] = dataCopy[((srcHeight - 1 - j) / 2 + srcHeight) * srcWidth + j];\n                    // æ‘†æ”¾Uå€¼\n                    buf[(i / 2 + srcWidth) * dstWidth + j + 1] = dataCopy[((srcHeight - 1 - j) / 2 + srcHeight) * srcWidth + j + 1];\n                }\n            }\n        }\n        \n        YuvImage yuvImage = new YuvImage(buf, ImageFormat.NV21, dstWidth, dstHeight, null);\n\n        File file = new File(\"/storage/emulated/0/\" + System.currentTimeMillis() + \".jpg\");\n        try {\n            FileOutputStream fos = new FileOutputStream(file);\n            yuvImage.compressToJpeg(new Rect(0, 0, dstWidth, dstHeight), 100, fos);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n}\n```","tags":["Android","Yuv"],"categories":["Android"]},{"title":"ScrollViewåœ¨SlidingUpPanelLayoutä¸­ä¸‹æ»‘æ— æ•ˆé—®é¢˜","url":"/2017/10/208c39b1bdad/","content":"\nå½“åœ¨`ScrollableView`(å³, å¯ä¸Šä¸‹æ»‘åŠ¨çš„ViewGroup)ä¸­å«æœ‰`ScrollView`æ—¶ï¼Œå‘ä¸Šæ»‘åŠ¨`ScrollableView`è‡³å…¶å…¨éƒ¨ä¸Šç§»å±•ç¤ºå‡ºæ¥æ—¶ï¼Œç»§ç»­å‘ä¸Šæ»‘åŠ¨æ—¶`ScrollView`ä¼šå“åº”æ»‘åŠ¨äº‹ä»¶å‘ä¸Šæ»‘åŠ¨ï¼Œä½†æ˜¯æ­¤æ—¶æŠ¬èµ·æ‰‹åå†å‘ä¸‹æ»‘åŠ¨æ—¶ï¼Œé¦–å…ˆå“åº”æ»‘åŠ¨äº‹ä»¶çš„æ˜¯`ScrollabldView`ï¼Œè¿™å°±å¯¼è‡´`ScrollView`æ— æ³•ä¸‹æ»‘ï¼Œè§£å†³è¯¥é—®é¢˜ä¸€ç§ç®€å•æœ‰æ•ˆçš„å®è·µï¼š\n<!--more--> \n```java\nSlidingUpPanelLayout.setScrollableView(ScrollView)\n```\n\n**ç”¨`ScrollView`æ›¿æ¢æ•´ä¸ªæ»‘åŠ¨çš„ViewGroup**\n","tags":["Android","SlidingUpPanelLayout"],"categories":["Android"]},{"title":"æ‰‹æŠŠæ‰‹æ•™ä½ å®ç°RecyclerViewçš„ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤š","url":"/2017/10/a9bb97b2a678/","content":"---\n\nçºµè§‚å¤šæ•°Appï¼Œä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šæ˜¯å¾ˆå¸¸è§çš„åŠŸèƒ½ï¼Œä½†æ˜¯è°·æ­Œå®˜æ–¹åªæœ‰ä¸€ä¸ªSwipeRefreshLayoutç”¨æ¥ä¸‹æ‹‰åˆ·æ–°ï¼Œä¸Šæ‹‰åŠ è½½æ›´å¤šè¿˜è¦è‡ªå·±åšã€‚\n\nåŸºäºRecyclerViewç®€å•å°è£…äº†è¿™ä¸¤ä¸ªæ“ä½œï¼Œä¸‹æ‹‰åˆ·æ–°æ”¯æŒLinearLayoutManagerã€GridLayoutManagerå’ŒStaggeredGridLayoutManager;ä¸Šæ‹‰åŠ è½½æ›´å¤šåªæ”¯æŒå‰ä¸¤è€…ã€‚\n\n<!--more-->\n----------\n\n\n#### è¯ä¸å¤šè¯´å…ˆä¸Šæ•ˆæœå›¾ æ•°æ®æ¥è‡ª[**å¹²è´§é›†ä¸­è¥**](http://gank.io/api)\n\n![](https://i.loli.net/2021/07/03/O6JtWNRBz7n1udD.gif)\n(ä¸‹æ‹‰åˆ·æ–°ï¼‰\n\n![](https://i.loli.net/2021/07/03/Rygwk9KZPBGaNnv.gif)\nï¼ˆä¸Šæ‹‰åŠ è½½æ›´å¤š -- LinearLayoutManagerï¼‰\n\n![](https://i.loli.net/2021/07/03/j7mqzU3PDXOYFpE.gif)\nï¼ˆä¸Šæ‹‰åŠ è½½æ›´å¤š -- GridLayoutManagerï¼‰\n\n\n----------\n\n\n### (ä¸€) ä½¿ç”¨æ–¹å¼ï¼Œå¾ˆç®€å• å¦‚ä¸‹ï¼š\n\n* **1. ä¸‹æ‹‰åˆ·æ–° 3æ­¥èµ°**\n\n**1.1 å¸ƒå±€æ–‡ä»¶**\n\t\n```xml\n// ç”¨SwipeRefreshLayoutåŒ…è£¹RecyclerView\n<android.support.v4.widget.SwipeRefreshLayout\n\t        android:id=\"@+id/gank_swipe_refresh_layout\"\n\t        android:layout_width=\"match_parent\"\n\t        android:layout_height=\"match_parent\">\n\t\n<android.support.v7.widget.RecyclerView\n\t         android:id=\"@+id/gank_recycler_view\"\n\t            android:layout_width=\"match_parent\"\n\t            android:layout_height=\"match_parent\"\n\t            android:overScrollMode=\"never\"/>\n</android.support.v4.widget.SwipeRefreshLayout>\n```\n\t\n\n\n**1.2 ç»™`SwipeRefreshLayout` æ·»åŠ ç›‘å¬ å¢åŠ è§¦å‘åˆ·æ–°æ—¶çš„æ“ä½œ(æ¯”å¦‚é‡æ–°è¯·æ±‚æ•°æ®)**\n\n```java\nSwipeRefreshLayout swipeRefreshLayout = findViewById();\nswipeRefreshLayout.setOnRefreshListener(new swipeRefreshLayout.OnRefreshListener() {\n            @Override\n            public void onRefresh() {\n\t            // do something, such as re-request from server or other\n            }\n        });\n```\n\n**1.3 åˆ·æ–°æ“ä½œ(é‡æ–°è¯·æ±‚æ•°æ®)å®Œæˆåè¦å›è°ƒæ¥åœæ­¢éšè—åˆ·æ–°åŠ¨ç”»(ä¸­ä¸Šæ–¹åœ†å½¢æ‚¬æµ®è¿›åº¦æ¡æ—‹è½¬åŠ¨ç”»)**\n\n```java\nswipeRefreshLayout.setRefreshing(false);\n```\n\t\n**è‡³æ­¤ä¸‹æ‹‰åˆ·æ–°å®Œæˆ**\n<br/>\n\n* **2.ä¸Šæ‹‰åŠ è½½3æ­¥èµ°**\n\n**2.1 åˆå§‹åŒ–`AdapterWrapper`å’Œ`SwipeToLoadHelper`**\n```java\n// adapteræ˜¯ä½ è‡ªå·±ä¸ºRecyclerViewå†™çš„Adapter\nRecyclerView.Adapter adapter = new YourOwnAdapter();\nAdapterWrapper adapterWrapper = new AdapterWrapper(adapter);\nRecyclerView recyclerView = findViewById();\n// å°†RecyclerViewå’Œåˆšåˆ›å»ºçš„adapterWrapperä¼ å…¥\nSwipeToLoadHelper helper = new SwipeToLoadHelper(recyclerView, adapterWrapper);\n```\n**2.2 è®¾ç½®åŠ è½½åŠ¨ä½œè§¦å‘åçš„ç›‘å¬**\n```java\nhelper.setLoadMoreListener(new SwipeToLoadHelper.LoadMoreListener() {\n            @Override\n            public void onLoad() {\n            // do something, such as request more data from server or other.\n            }\n        })\n```\n**2.3 åŠ è½½æ›´å¤šå†…å®¹å®Œæˆåè¦å›è°ƒæ–¹æ³•åœæ­¢åŠ¨ç”»**\n```java\nhelper.setLoadMoreFinish()\n```\n**è‡³æ­¤ä¸Šæ‹‰åŠ è½½å®Œæˆ (æ³¨æ„æ›´æ–°æ•°æ®æ—¶è¦è°ƒç”¨`AdapterWrapper.notifyDataSetChanged`)**\n\n---\n\n### (äºŒ) ç®€æ˜æ‰¼è¦çš„å®ç°æ€è·¯(ä¸Šæ‹‰åŠ è½½æ“ä½œ)\n\n> `RecyclerView`çš„`itemView`çš„æ˜¾ç¤ºæƒ…å†µåˆ†ä¸ºå››ç§ï¼š\n> \n> 1. ç¬¬1ä¸ªå¯è§çš„ï¼ˆéƒ¨åˆ†æ˜¾ç¤ºæˆ–è€…å®Œå…¨æ˜¾ç¤ºéƒ½ç®—å¯è§ï¼‰\n> 2. ç¬¬1ä¸ªå¯è§çš„ä¸”æ˜¯å®Œæ•´çš„ï¼ˆå®Œå…¨æ˜¾ç¤ºç®—ä½œå®Œæ•´çš„ï¼‰\n> 3. æœ€å1ä¸ªå¯è§çš„\n> 4. æœ€å1ä¸ªå¯è§çš„ä¸”æ˜¯å®Œæ•´çš„\n\n* **1. å›å¼¹æ•ˆæœ**\nå³æ‰‹æŒ‡æŠ¬èµ·æ»‘åŠ¨åœæ­¢ï¼Œ`ä¸Šæ‹‰åŠ è½½æ›´å¤š`éƒ¨åˆ†æ˜¾ç¤ºæ—¶ï¼Œå°†`ä¸Šæ‹‰åŠ è½½æ›´å¤š`æ»šåŠ¨åˆ°ä¸æ˜¾ç¤ºï¼Œä½¿ä¸Šé¢æŒ¨ç€å®ƒçš„`itemView`ä¸ºæœ€å1ä¸ªå¯è§ä¸”æ˜¯æœ€å1ä¸ªå®Œæ•´å¯è§ã€‚<br/>\nç›‘å¬`RecyclerView`çš„æ»šåŠ¨ï¼Œå½“`RecyclerView`å¤„äº`SCROLL_STATE_IDLE` çŠ¶æ€æ—¶ï¼Œè·å–æœ€å1ä¸ªå®Œæ•´å¯è§çš„`itemView`ï¼šå¦‚æœæ˜¯å€’æ•°ç¬¬2ä¸ª`item`åˆ™è®¡ç®—è¯¥`item`çš„ä¸‹è¾¹è·åˆ°`RecyclerView`åº•éƒ¨çš„è·ç¦»`deltaY`ï¼Œç„¶åå°†`RecyclerView`å‘ä¸‹æ»šåŠ¨`deltaY`ï¼›å¦‚æœæ˜¯`ä¸Šæ‹‰åŠ è½½æ›´å¤š`åˆ™è§¦å‘åŠ è½½æ“ä½œï¼›å…¶ä»–æƒ…å†µä¸ç”¨å¤„ç†ã€‚\n\n```java\n// å…³é”®ä»£ç  rv : recyclerView\nint lcp = layoutManager.findLastCompletelyVisibleItemPosition();\nif (lcp == layoutManager.getItemCount() - 2) {\n\t// å€’æ•°ç¬¬2é¡¹\n\tint fcp = layoutManager.findFirstCompletelyVisibleItemPosition();\n    View child = layoutManager.findViewByPosition(lcp);\n    int deltaY = rv.getBottom() - rv.getPaddingBottom() - \n\t\t\t\t    child.getBottom();\n\t// fcpä¸º0æ—¶è¯´æ˜åˆ—è¡¨æ»šåŠ¨åˆ°äº†é¡¶éƒ¨, ä¸å†æ»šåŠ¨\n    if (deltaY > 0 && fcp != 0) {\n\t      rv.smoothScrollBy(0, -deltaY);\n    }\n} else if (lcp == layoutManager.getItemCount() - 1) {\n    // æœ€åä¸€é¡¹å®Œå…¨æ˜¾ç¤º, è§¦å‘æ“ä½œ, æ‰§è¡ŒåŠ è½½æ›´å¤šæ“ä½œ\n    if (listener != null) {\n\t    listener.onLoad();\n    }\n}\n```\n<br/>\n\n* **2. æ·»åŠ åº•éƒ¨`åŠ è½½æ›´å¤š`itemView**\n\n2.1 `AdapterWrapper`é‡å†™äº†`getItemCount`æ–¹æ³•ï¼Œä¿è¯å¾—åˆ°`itemView`çš„æ•°é‡åŒ…æ‹¬`åŠ è½½æ›´å¤š`ã€‚å½“æ˜¯`LinearLayoutManager`ç±»å‹æ—¶ç›´æ¥åŠ 1ï¼›å½“æ˜¯`GridLayoutManager`ç±»å‹æ—¶ï¼Œå¦‚æœéœ€è¦åˆ™å…ˆå°†åˆ—è¡¨æœ€åä¸€è¡Œå¡«æ»¡ï¼Œå†åŠ 1ã€‚æ¯”å¦‚ï¼šåˆ—è¡¨æ¯è¡Œæœ‰3ä¸ª`itemView`ï¼Œæœ€åä¸€è¡Œåªæœ‰1ä¸ªï¼Œè¿™æ—¶å°±éœ€è¦å…ˆåŠ 2ï¼Œå†åŠ 1ï¼Œæ¥ä¿è¯`åŠ è½½æ›´å¤š`å æ®å®Œæ•´çš„ä¸€è¡Œã€‚\n\n```java\n// å…³é”®ä»£ç  å…¶ä¸­çš„adapterä¸ºæ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„åŸç”ŸRecyclerView.Adapter\nif (adapterType == ADAPTER_TYPE_LINEAR) {\n\t// çº¿æ€§å¸ƒå±€\n\treturn adapter.getItemCount() + 1;\n} else {\n\t// ç½‘æ ¼å¸ƒå±€ spanCountä¸ºæ¯è¡ŒitemViewçš„ä¸ªæ•°\n    int remain = adapter.getItemCount() % spanCount; // ä½™æ•°\n    if (remain == 0) {\n\t    return adapter.getItemCount() + 1;\n    }\n    // ä½™æ•°ä¸ä¸º0æ—¶,å…ˆå‡‘æ»¡å†åŠ 1\n    return adapter.getItemCount() + 1 + (spanCount - remain);\n}\n```\n\n2.2 `AdapterWrapper`é‡å†™äº†`getItemViewType`æ–¹æ³•ï¼Œå½“æ˜¯æœ€åä¸€ä¸ªä½ç½®æ—¶è¿”å›`ITEM_TYPE_LOAD`\n\n```java\n// å…³é”®ä»£ç \npublic int getItemViewType(int position) {\n    // ä½ç½®æ˜¯æœ€åä¸€ä¸ªæ—¶, wrapperè¿›è¡Œæ‹¦æˆª\n    if (osition == getItemCount() - 1) {\n        return ITEM_TYPE_LOAD;// è¦é¿å…å’ŒåŸç”Ÿadapterè¿”å›å€¼å¯èƒ½é‡å¤\n    }\n    // å…¶ä»–æƒ…å†µäº¤ç»™åŸç”Ÿadapterå¤„ç†\n    return adapter.getItemViewType(position);\n}\n```\n\n2.3 `AdapterWrapper`é‡å†™äº†`onCreateViewHolder`æ–¹æ³•ï¼Œå½“ç±»å‹ä¸º`ITEM_TYPE_LOAD`æ—¶è¿”å›`åŠ è½½æ›´å¤š`çš„`ViewHolder`ï¼Œå…¶ä»–æƒ…å†µäº¤ç»™åŸç”Ÿçš„`adapter`å¤„ç†ã€‚\n\n```java\n// å…³é”®ä»£ç \npublic RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {\n    if (viewType == ITEM_TYPE_LOAD) {\n        return new LoadMoreHolder();\n    } else {\n        return adapter.onCreateViewHolder(parent, viewType);\n    }\n}\n```\n\n2.4 `AdapterWrapper`é‡å†™äº†`onBindViewHolder`ï¼Œè¿™é‡Œæœ‰ä¸‰ç§å¯èƒ½çš„æƒ…å†µï¼š1. æ­£å¸¸çš„æ•°æ®é¡¹`itemView`ï¼Œäº¤ç»™`adapter`å¤„ç†ï¼›2. `GridView`çš„ç©ºç™½`itemView`ï¼Œéšè—å¤„ç†ï¼›3. åº•éƒ¨çš„`åŠ è½½æ›´å¤š`ï¼Œç›®å‰ä¸éœ€è¦åšä»€ä¹ˆå¤„ç†ã€‚\n\n```java\n// å…³é”®ä»£ç \npublic void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {\n    if (position == getItemCount() - 1) {\n    } else if (position < adapter.getItemCount()){\n        adapter.onBindViewHolder(holder, position);\n    } else {\n        holder.itemView.setVisibility(View.INVISIBLE);\n    }\n }\n```\n----\n### (ä¸‰) é¢å¤–çš„ä¸¤ä¸ªè¯´æ˜\n* `SwipeFreshLayout`æœ‰ä¸ª`setEnable(boolean)`æ–¹æ³•ï¼Œè®¾ç½®ä¸º`false`çš„æ—¶å€™å°±ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½å°±æ²¡æœ‰äº†ï¼Œç­‰åŒäºæ™®é€šçš„`RecyclerView`\n* åŒæ ·`SwipeToLoadHelper`æœ‰ä¸ª`setSwipeToLoadEnabled(boolean)`æ–¹æ³•ï¼Œè®¾ç½®ä¸º`false`çš„æ—¶å€™ä¸Šæ‹‰åŠ è½½åŠŸèƒ½å°±æ²¡æœ‰äº†ï¼Œ ç­‰åŒäºæ™®é€šçš„`RecyclerView`\n\n---\n#### **å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£~**\n\né™„[é¡¹ç›®ä»“åº“åœ°å€](https://github.com/oynix/wraprecyclerview)ï¼Œå¦‚æœ‰éœ€è¦è¯·è‡ªå–~\n","tags":["Android","RecyclerView","è‡ªå®šä¹‰æ§ä»¶"],"categories":["Android"]},{"title":"å‡ åˆ†é’Ÿå®Œæˆå‘å¸ƒå¼€æºåº“åˆ°jCenter","url":"/2017/10/31c771f65733/","content":"---\n\nåœ¨AndroidStudioä¸­å¯¼å…¥å¼€æºåº“ä¸€èˆ¬å°±æ˜¯ä¸€å¥è¯çš„äº‹ï¼š`compile 'xxx.xx.xx:xx'`ã€‚ å®é™…ä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å¯¼å…¥è‡ªå·±çš„å¼€æºåº“ï¼Œæ–¹ä¾¿è‡ªå·±çš„ä½¿ç”¨ã€‚AndroidStudioæ‰§è¡Œ`compile 'xxx.xxx.xx:xx'` ä¼šå…ˆåˆ°jCenterä¸ŠæŸ¥æ‰¾è¯¥å¼€æºåº“ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æŠŠè‡ªå·±çš„å¼€æºåº“åº“å‘å¸ƒåˆ°jCenterä¸Šã€‚æ— æ³•ç›´æ¥åœ¨jCenterä¸Šå‘å¸ƒå¼€æºåº“ï¼Œè¦é€šè¿‡å®ƒçš„æ‰˜ç®¡å•†--Bintrayï¼ˆBintrayæ‰˜ç®¡ç€å¾ˆå¤šä»“åº“ï¼ŒjCenteråªæ˜¯å…¶ä¸­ä¸€ä¸ªï¼‰æ¥å®Œæˆã€‚\n\næŠŠè‡ªå·±å¹³æ—¶ç»å¸¸ç”¨åˆ°çš„ä¸€äº›ä»£ç å†™åˆ°ä¸€èµ·ä¸Šä¼ åˆ°jCenterï¼Œä»¥åä¸ç®¡åšä»€ä¹ˆé¡¹ç›®ä¸€å¥è¯å°±èƒ½å¯¼å…¥ï¼Œç®—æ¥è¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®ç”¨çš„åŠŸèƒ½ã€‚\n<!--more-->\n#### æ€»ä½“æ­¥éª¤æ¦‚è§ˆ\n\n >  [1. æ³¨å†ŒBintrayè´¦å·å¹¶åˆ›å»ºä»“åº“](#step1)\n    [2. å‡†å¤‡å¼€æºåº“](#step2)\n    [3. ä¿®æ”¹gradleæ–‡ä»¶](#step3)\n    [4. ç¼–è¯‘å¹¶ä¸Šä¼ è‡³Bintray](#step4)\n    [5. linked to jCenter](#step5)\n\n\n----------\n<h3 id=\"step1\"> 1. æ³¨å†ŒBintrayè´¦å·å¹¶åˆ›å»ºä»“åº“</h3>\n\nä½¿ç”¨Bintrayå½“ç„¶è¦å…ˆæ³¨å†Œä¸ªè´¦å·ï¼Œ[æ³¨å†Œåœ°å€](https://bintray.com/signup/oss)\n\n![æ³¨å†Œç•Œé¢](https://i.loli.net/2021/07/02/nDrYj29khgLP3HQ.png)\næˆ‘é€‰çš„æ˜¯`Sign up with Github`ã€‚\næ³¨å†Œç™»å½•ä¹‹ååº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼Œ ç‚¹å‡»`Add New Repository`\n\n![](https://i.loli.net/2021/07/02/lSWt5zHh7qaBY1r.png)\n![](https://i.loli.net/2021/07/02/7gemVscRGIrH2MQ.png)\n\n* Nameï¼šä»“åº“çš„åå­—ï¼Œå†™äº†ä¹‹åä¸èƒ½å†æ”¹ï¼Œè®°ä½è¯¥åå­—ï¼Œåé¢ä¸Šä¼ æ—¶ä¼šç”¨åˆ°ï¼›\n* Typeï¼šä»“åº“ç±»å‹ï¼Œé€‰æ‹©`Maven`ï¼›\n* Licenseï¼šå¼€æºåè®®ï¼Œéšä¾¿é€‰ä¸€ä¸ªå°±å¥½ï¼›\n* Descriptionï¼šä»“åº“æè¿°ï¼Œéšä¾¿å†™ï¼›\n\n**ç‚¹å‡»`Create` å®Œæˆä»“åº“åˆ›å»ºï¼Œåˆ°æ­¤ç¬¬ä¸€æ­¥å®Œæˆã€‚**\n\n\n----------\n<h3 id=\"step2\"> 2. å‡†å¤‡å¼€æºåº“</h3>\n\nå¤‡å¥½ä½ æƒ³è¦ä¸Šä¼ çš„å¼€æºåº“ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š\n1. AndroidStudioä¸­newä¸€ä¸ªprojectï¼Œç„¶ååœ¨projectä¸­newä¸€ä¸ªModuleï¼Œç±»å‹é€‰æ‹©`Android Library`.\n2. ç›´æ¥ä¿®æ”¹å½“å‰Moduleçš„build.gradleï¼ˆ**æ³¨æ„åŒºåˆ†projectçš„build.gradleæ–‡ä»¶å’ŒModuleçš„build.gradleæ–‡ä»¶ï¼Œå‰è€…åœ¨projectæ ¹ç›®å½•ä¸‹ï¼Œåè€…åœ¨å¯¹åº”çš„Moduleç›®å½•ä¸‹**ï¼‰æ–‡ä»¶ï¼Œå°†ç¬¬ä¸€è¡Œçš„`apply plugin: 'com.android.application` æ”¹ä¸º `apply plugin: com.android.library` ï¼Œå†æŠŠä¸‹é¢çš„`applicationId \"ä½ çš„åŒ…å\"` è¿™ä¸€è¡Œåˆ é™¤(libraryæ˜¯ä¸å…è®¸æœ‰applicationIdçš„).\n\nä¸¤ç§æ–¹å¼æœ€ç»ˆç»“æœéƒ½æ˜¯å¾—åˆ°äº†ä¸€ä¸ª`Android Library` ç±»å‹çš„Moduleï¼Œåœ¨Moduleé‡Œæ·»åŠ ä½ æƒ³è¦ä¸Šä¼ çš„å¼€æºåº“ä»£ç ï¼ˆæˆ‘éšä¾¿å¼„äº†ä¸€ä¸ªï¼Œé‡Œé¢æœ‰ä¸ªæˆ‘å¸¸ç”¨åˆ°çš„åŠ è½½App Iconçš„æ–¹æ³•ï¼‰ã€‚\n\n**åˆ°æ­¤ç¬¬äºŒæ­¥å‡†å¤‡å¼€æºåº“å®Œæˆ**\n\n\n----------\n<h3 id=\"step3\"> 3. ä¿®æ”¹gradleæ–‡ä»¶</h3>\n\n**è¿˜æ˜¯é‚£å¥è¯ï¼Œæ³¨æ„åŒºåˆ†projectçš„build.gradleæ–‡ä»¶å’ŒModuleçš„build.gradleæ–‡ä»¶ï¼Œå‰è€…åœ¨projectæ ¹ç›®å½•ä¸‹ï¼Œåè€…åœ¨å¯¹åº”çš„Moduleç›®å½•ä¸‹**\n\n* ä¿®æ”¹projectçš„build.gradleæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢è¿™ä¸¤å¥è¯\n![](https://i.loli.net/2021/07/02/3xVtoCEBzNfD6KT.png)\n[*Maven Githubåœ°å€*](https://github.com/dcendents/android-maven-gradle-plugin)ï¼šå¯¹åº”é‡Œé¢çš„è¯´æ˜é€‰æ‹©ä½¿ç”¨çš„ç‰ˆæœ¬å·\n[*Bintray Githubåœ°å€*](https://github.com/bintray/gradle-bintray-plugin)ï¼šå¯¹åº”é‡Œé¢çš„è¯´æ˜é€‰æ‹©ä½¿ç”¨çš„ç‰ˆæœ¬å·\n\n* ä¿®æ”¹Moduleçš„build.gradleæ–‡ä»¶ï¼ˆè¿™æ­¥æœ‰ç‚¹ä¹±ï¼Œè®¤çœŸçœ‹ï¼‰\néœ€è¦é…ç½®3ä¸ªä¿¡æ¯ï¼š\n1. Bintrayè´¦å·é…ç½®å’ŒDeveloperä¿¡æ¯ï¼Œå‘Šè¯‰AndroidStudioä¼ åˆ°å“ªåŠå¼€å‘è€…ä»‹ç»ï¼›\n2. Projectä¿¡æ¯ï¼Œå¼€æºåº“çš„ä»‹ç»ï¼›\n3. ä¸Šä¼ é…ç½®ï¼Œå¯¹ä»¥ä¸Š3ä¸ªä¿¡æ¯çš„è°ƒç”¨ä»¥åŠå…¶ä»–ä¸€äº›é…ç½®ï¼›\n\nä¸ºäº†çœ‹èµ·æ¥æ¡ç†æ¸…æ™°ï¼Œæˆ‘æŠŠèƒ½ç‹¬ç«‹çš„éƒ¨åˆ†éƒ½ç‹¬ç«‹åˆ°å•ç‹¬æ–‡ä»¶é‡Œäº†ï¼Œä¾¿äºé˜…è¯»ï¼Œä»¥ä¸‹åˆ†åˆ«è¯´æ˜ã€‚\n\n**1. Bintrayè´¦å·ä¿¡æ¯å’ŒDeveloperä¿¡æ¯**\n`AndroidStudio`åˆ›å»ºé¡¹ç›®æ—¶é»˜è®¤ä¼šåœ¨projectæ ¹ç›®å½•ä¸‹åˆ›å»º`local.properties` æ–‡ä»¶å¹¶æ·»åŠ åˆ°äº†`.gitignore` æ–‡ä»¶ä¸­ï¼ˆå¦‚æœæ²¡æœ‰è¯·è‡ªè¡Œåˆ›å»ºå¹¶æ·»åŠ è‡³`.gitignore` ä¸­ï¼‰ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n\n![](https://i.loli.net/2021/07/02/NevJYK8bCSkWUV5.png)\n\n * bintray.userï¼šBintrayæ³¨å†Œçš„ç”¨æˆ·å\n * bintray.apikeyï¼šBintrayçš„API key\n * developer.idï¼šå¼€æºç¤¾åŒºçš„æ˜µç§°ï¼ˆä¸€èˆ¬æŒ‡githubï¼Œæˆ–æ˜¯ä½¿ç”¨çš„å…¶ä»–å¼€æºç¤¾åŒºï¼‰\n * developer.nameï¼šå§“å\n * developer.emailï¼šé‚®ç®±åœ°å€\n\n*æŸ¥çœ‹API keyæ–¹æ³•ï¼š*\n![](https://i.loli.net/2021/07/02/cPX6dYtHeijrZbl.png)\n![](https://i.loli.net/2021/07/02/78qtx2wumGjSy1d.png)\n\n\n**2. Projectä¿¡æ¯é…ç½®**\n\nåœ¨***å¼€æºåº“Moduleç›®å½•***ä¸‹æ–°å»º`project.properties`æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n\n![](https://i.loli.net/2021/07/02/ho8iIzSP3tBxJK4.png)\n\n* project.nameï¼šå¼€æºåº“åå­—\n* project.groupIdï¼šé¡¹ç›®ç»„IDï¼Œå†™åŒ…å\n* project.artifaceIdï¼šé¡¹ç›®IDï¼Œå†™Moduleå\n* project.packagingï¼šæ‰“åŒ…æ–¹å¼ï¼Œå†™aar\n* project.siteUrlï¼šé¡¹ç›®ä¸»é¡µï¼Œæ²¡æœ‰å°±å†™githubåœ°å€\n* project.gitUrlï¼šé¡¹ç›®ä»“åº“åœ°å€\n* javadoc.nameï¼šjavadocä¸»é¡µæ˜¾ç¤ºçš„åç§°ï¼Œå†™é¡¹ç›®åå­—å°±å¥½\n\n**3. ä¸Šä¼ é…ç½®**\n\nåœ¨***å¼€æºåº“Moduleç›®å½•***ä¸‹æ–°å»º`bintrayUpload.gradle`æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š(å†…å®¹è¾ƒå¤šï¼Œç›´æ¥è´´æºç äº†ï¼Œé˜…è¯»å¯èƒ½ä¸å¤ªç¾è§‚ï¼‰\n\n```groovy\napply plugin: 'com.github.dcendents.android-maven'\napply plugin: 'com.jfrog.bintray'\n\n// load properties\nProperties properties = new Properties()\n\nFile projectPropertiesFile = project.file(\"project.properties\")\nif(projectPropertiesFile.exists()){\n    properties.load(projectPropertiesFile.newDataInputStream())\n}\n\n// read properties\ndef projectName = properties.getProperty(\"project.name\")\ndef projectGroupId = properties.getProperty(\"project.groupId\")\ndef projectArtifactId = properties.getProperty(\"project.artifactId\")\ndef projectVersionName = android.defaultConfig.versionName\ndef projectPackaging = properties.getProperty(\"project.packaging\")\ndef projectSiteUrl = properties.getProperty(\"project.siteUrl\")\ndef projectGitUrl = properties.getProperty(\"project.gitUrl\")\ndef javadocName = properties.getProperty(\"javadoc.name\")\n\n\nFile localPropertiesFile = project.rootProject.file(\"local.properties\")\nif(localPropertiesFile.exists()){\n    properties.load(localPropertiesFile.newDataInputStream())\n}\ndef developerId = properties.getProperty(\"developer.id\")\ndef developerName = properties.getProperty(\"developer.name\")\ndef developerEmail = properties.getProperty(\"developer.email\")\n\ndef bintrayUser = properties.getProperty(\"bintray.user\")\ndef bintrayApikey = properties.getProperty(\"bintray.apikey\")\n\n\ngroup = projectGroupId\n\n// This generates POM.xml with proper parameters\ninstall {\n    repositories.mavenInstaller {\n        pom {\n            project {\n                name projectName\n                groupId projectGroupId\n                artifactId projectArtifactId\n                version projectVersionName\n                packaging projectPackaging\n                url projectSiteUrl\n                licenses {\n                    license {\n                        name 'The Apache Software License, Version 2.0'\n                        url 'http://www.apache.org/licenses/LICENSE-2.0.txt'\n                    }\n                }\n                developers {\n                    developer {\n                        id developerId\n                        name developerName\n                        email developerEmail\n                    }\n                }\n                scm {\n                    connection projectGitUrl\n                    developerConnection projectGitUrl\n                    url projectSiteUrl\n                }\n            }\n        }\n    }\n}\n\n// This generates sources.jar\ntask sourcesJar(type: Jar) {\n    from android.sourceSets.main.java.srcDirs\n    classifier = 'sources'\n}\n\ntask javadoc(type: Javadoc) {\n    source = android.sourceSets.main.java.srcDirs\n    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))\n}\n\n// This generates javadoc.jar\ntask javadocJar(type: Jar, dependsOn: javadoc) {\n    classifier = 'javadoc'\n    from javadoc.destinationDir\n}\n\nartifacts {\n    archives javadocJar\n    archives sourcesJar\n}\n\n// javadoc configuration\njavadoc {\n    options{\n        encoding \"UTF-8\"\n        charSet 'UTF-8'\n        author true\n        version projectVersionName\n        links \"http://docs.oracle.com/javase/7/docs/api\"\n        title javadocName\n    }\n}\n\n// bintray configuration\nbintray {\n    user = bintrayUser\n    key = bintrayApikey\n    configurations = ['archives']\n    pkg {\n        repo = \"maven\"\n        name = projectName\n        websiteUrl = projectSiteUrl\n        vcsUrl = projectGitUrl\n        licenses = [\"Apache-2.0\"]\n        publish = true\n    }\n}\n```\n\nä¸Šä¼ å¼€æºåº“çš„é…ç½®åŸºæœ¬éƒ½æ˜¯è¿™æ ·ï¼Œä¸ç”¨æ”¹åŠ¨ä»€ä¹ˆï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯`bintray` èŠ‚ç‚¹çš„`repo` æŒ‡çš„æ˜¯ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„Mavenä»“åº“çš„åå­—ï¼Œè¿™ä¸¤ä¸ªåå­—è¦ä¸€è‡´ï¼›æ­¤å¤–å¼€æºåº“çš„ç‰ˆæœ¬å·é»˜è®¤å–çš„æ˜¯projectçš„ç‰ˆæœ¬å·`def projectVersionName = android.defaultConfig.versionName`ï¼Œå¦‚æœæœ‰éœ€è¦ä¹Ÿå¯æŠŠè¿™ä¸¤ä¸ªå±æ€§æŠ½å–åˆ°`project.properties` æ–‡ä»¶ä¸­ï¼Œä¾¿äºç®¡ç†ã€‚\n\næœ€åä¸€ä¸ªæ“ä½œï¼Œåœ¨***å¼€æºåº“Module***çš„`build.gradle` æ–‡ä»¶æœ«å°¾ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç `apply from: 'bintrayUpload.gradle'` æ¥è°ƒç”¨é…ç½®æ–‡ä»¶ã€‚\n\n**è‡³æ­¤ç¬¬3æ­¥é…ç½®gradleæ–‡ä»¶å®Œæˆã€‚**\n\n\n----------\n<h3 id=\"step4\"> 4. ç¼–è¯‘å¹¶ä¸Šä¼ è‡³Bintray</h3>\n\n* ç¼–è¯‘ï¼šæ‰“å¼€AndroidStudioçš„Terminalçª—å£ï¼ˆä¸€èˆ¬åœ¨åº•éƒ¨ï¼Œæ²¡æœ‰çš„è¯ç‚¹å‡»`é¡¶éƒ¨å·¥å…·æ `->`View`->`Tools Windows`-> `Terminal`ï¼‰ï¼Œè¾“å…¥å‘½ä»¤å¹¶å›è½¦ï¼š\n\n> gradlew install\n\nç­‰å¾…ä¸€æ®µæ—¶é—´åæç¤º`BUILD SUCCESSFUL`ï¼Œè¡¨ç¤ºæˆåŠŸã€‚\n\n* ä¸Šä¼ ï¼ŒåŒæ ·åœ¨Terminalä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¹¶å›è½¦ï¼š\n\n> gradlew bintrayUpload\n\n\nç­‰å¾…ä¸€æ®µæ—¶é—´åæç¤º`BUILD SUCCESSFUL`ï¼Œè¡¨ç¤ºæˆåŠŸã€‚\n\n**è‡³æ­¤ç¬¬4æ­¥ç¼–è¯‘å¹¶ä¸Šä¼ å®Œæˆã€‚**\n\n\n----------\n<h3 id=\"step5\"> 5. Linked to jCenter</h3>\n\n![](https://i.loli.net/2021/07/02/LZm2MYtP8XJ1RjU.png)\n\n![](https://i.loli.net/2021/07/02/HKzyexF9aZscOdW.png)\n\n![](https://i.loli.net/2021/07/02/CNPLzhVtXdxnRI8.png)\n\n![](https://i.loli.net/2021/07/02/Ed6kULb9QNpMDAa.png)\n\n**æŒ‰ç…§ä¸Šé¢4æ­¥ï¼Œå‘é€include requestä¹‹åç­‰å¾…Bintrayå›¢é˜Ÿå®¡æ ¸ï¼Œå®¡æ ¸å®Œæˆåä¼šæ”¶åˆ°é‚®ä»¶å’Œç«™å†…ä¿¡ã€‚**\n\n![](https://i.loli.net/2021/07/02/bdaZXRcOkflTy96.png)\n\n**è‡³æ­¤ç¬¬5æ­¥Linked to jCenterå®Œæˆã€‚**\n\n\n----------\n\n### å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« \n\n1. [Android é¡¹ç›®æ‰“åŒ…åˆ° JCenter çš„å‘](http://www.jianshu.com/p/c721f9297b2f?utm_campaign=hugo&utm_medium=reader_share&utm_content=note)\n2. [Android å‘å¸ƒé¡¹ç›®åˆ° JCenter é‡åˆ°çš„å„ç§å‘](http://www.jianshu.com/p/c518a10fdaed)\n\n\n#### **å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£~**","tags":["Android","jCenter"],"categories":["Android"]},{"title":"Android Drawable å’Œ xmlæ–‡ä»¶è½¬åŒ–å…³ç³»","url":"/2017/09/8b0716318a1c/","content":"---\nDrawableç±»æ—¢å¯ä»¥åœ¨ä»£ç ä¸­åˆ›å»ºä¹Ÿå¯ä»¥åœ¨xmlæ–‡ä»¶ä¸­è®¾ç½®ï¼Œä»¥ä¸‹æ˜¯å„ç±»å‹çš„å¯¹åº”å…³ç³»ã€‚\n<!--more-->\n`<selector />`---------`StateListDrawable`  \n`<level-list />`---------`LevelListDrawable`  \n`<layer-list />`---------`LayerDrawable`  \n`<transition />`---------`TransitionDrawable`  \n`<color />`---------`ColorDrawable`  \n`<shape />`---------`GradientDrawable`  \n`<scale />`---------`ScaleDrawable`  \n`<clip />`---------`ClipDrawable`  \n`<rotate/>`---------`RotateDrawable`  \n`<animation-list />`---------`AnimationDrawable`  \n`<inset />`---------`InsetDrawable`  \n`<bitmap/>`---------`BitmapDrawable`  \n`<nine-patch />`---------`NinePatchDrawable`  \n`<stupid-tag />`---------`Resources.NotFoundException`  ","tags":["Android","Drawable"],"categories":["Android"]},{"title":"Androidæ”¹å˜å›¾ç‰‡å±æ€§ä¹‹é¥±å’Œåº¦","url":"/2017/09/992c82f9c39e/","content":"---\nç®€å•å®ç°æ”¹å˜å›¾ç‰‡é¥±å’Œåº¦\n<!--more-->\n```\n ImageView image = (ImageView) findViewById(R.id.image);\n ColorMatrix matrix = new ColorMatrix();\n matrix.setSaturation(0f);\n image.setColorFilter(new ColorMatrixColorFilter(matrix));\n```\n\n**é€šè¿‡è®¾ç½®Matrixçš„å‚æ•°æ¥å®ç°.**","tags":["Android","å›¾ç‰‡é¥±å’Œåº¦"],"categories":["Android"]},{"title":"Android è‡ªå®šä¹‰æ ·å¼é€šçŸ¥æ çš„å‘RemoteServiceException","url":"/2017/07/373186e06a55/","content":"---\nAndroid è‡ªå®šä¹‰æ ·å¼é€šçŸ¥æ çš„å‘RemoteServiceException\n```\nAndroid.app.RemoteServiceException: Bad notification posted from packagecom.my.package:\n\n```\n\næ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¸ªå¼‚å¸¸ã€‚\n\n<!--more-->\n----------\næ²¡æœ‰ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ä¸‰ä¸ªæ–¹æ³•\n\n```\nsetContentTextï¼ˆï¼‰\nsetContentTitleï¼ˆï¼‰\nsetSmallIconï¼ˆï¼‰\n```\nè€Œç”¨çš„æ˜¯`RemoteViews`ï¼Œç„¶åå°±æ‰å‘é‡Œäº†ã€‚\n\n**åŸå› æ˜¯è¿™æ ·çš„ï¼Œè¯·å¾€ä¸‹çœ‹~**\n\n1. å¸ƒå±€ä¸­çš„æ§ä»¶åªæœ‰**7ç§**ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå‡ä¼šæŠ¥é”™ï¼\n```\nAnalogClockï¼ŒButtonï¼ŒChronometerï¼ŒImageButtonï¼ŒmageViewï¼ŒProgressBarï¼ŒTextView\n```\n\n2. å¦å¤–è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ§ä»¶é•¿å®½çš„è®¾å®šï¼Œå¿…é¡»ä¸º`0dp`ï¼Œ`wrap_content`æˆ–è€…`match_parent`ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå‡ä¼šæŠ¥é”™ï¼\n\n```\nif (layoutWidth != 0 && layoutWidth != ViewGroup.LayoutParams.MATCH_PARENT\n            && layoutWidth != ViewGroup.LayoutParams.WRAP_CONTENT) {\n        throw new IllegalArgumentException(\"Only supports 0, WRAP_CONTENT and MATCH_PARENT\");\n    }\n```\n**è¿™å°±æ˜¯åŸå› ï¼Œå†…éƒ¨ä¼šæ£€æµ‹ã€‚ä½†ä¸çŸ¥ä¸ºä½•ï¼Œæˆ‘æ¥æ”¶åˆ°çš„éƒ½æ˜¯æ–‡ç« å¼€å¤´æåˆ°çš„é‚£ä¸ªå¼‚å¸¸ï¼Œè®©äººè‹¦æ¼ã€‚**\n","tags":["Android","RemoteServiceException"],"categories":["Android"]},{"title":"Androidè·å–ç³»ç»Ÿç›¸å†Œæ‰€æœ‰å›¾ç‰‡","url":"/2017/06/eccdf08dbb5b/","content":"---\n\n### ç›´æ¥è·å–æ‰€æœ‰ç…§ç‰‡çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ‰“å¼€ç…§ç‰‡é€‰æ‹©é¡µé¢\n<!--more-->\n```java\n  private ArrayList<CategoryFile> queryCategoryFilesSync(FileType type) {\n    ArrayList<CategoryFile> files = new ArrayList<>();\n    Uri uri = MediaStore.Images.Media.getContentUri(\"external\");\n    if (uri != null) {\n        String[] projection = new String[]{FileColumns._ID, // id\n                FileColumns.DATA, // æ–‡ä»¶è·¯å¾„\n                FileColumns.SIZE, // æ–‡ä»¶å¤§å°\n                FileColumns.DATE_MODIFIED}; // ä¿®æ”¹æ—¥æœŸ\n        Cursor cursor = getContentResolver().query(uri, projection, null, null, null);\n        if (cursor != null) {\n            try {\n                if (cursor.moveToFirst()) {\n                    final int pathIdx = cursor\n                            .getColumnIndex(FileColumns.DATA);\n                    final int sizeIdx = cursor\n                            .getColumnIndex(FileColumns.SIZE);\n                    final int modifyIdx = cursor\n                            .getColumnIndex(FileColumns.DATE_MODIFIED);\n                    do {\n                        String path = cursor.getString(pathIdx);\n                        CategoryFile file = new CategoryFile();\n                        file.mType = type;\n                        file.mPath = path;\n                        file.mParent = FileUtil.getPathFromFilepath(file.mPath);\n                        file.mName = FileUtil.getNameFromFilepath(file.mPath);\n                        file.mSize = cursor.getLong(sizeIdx);\n                        file.mLastModifyTime = cursor.getLong(modifyIdx);\n                        files.add(file);\n                    } while (cursor.moveToNext());\n                }\n            } catch (Exception e) {\n                e.printStackTrace();\n            } finally {\n                cursor.close();\n            }\n        }\n    }\n    return files;\n }\n```\n\nå…¶ä¸­`CategoryFile`ä¸ºå­˜å‚¨ç…§ç‰‡ä¿¡æ¯çš„Beanç±»\n### FileUtilç±»\n```java\npublic class FileUtil {\n\n    private static final char UNIX_SEPARATOR = '/';\n\n    public static String getPathFromFilepath(String filepath) {\n        if (!TextUtils.isEmpty(filepath)) {\n            int pos = filepath.lastIndexOf(UNIX_SEPARATOR);\n            if (pos != -1) {\n                return filepath.substring(0, pos);\n            }\n        }\n        return \"\";\n    }\n\n    public static String getNameFromFilepath(String filepath) {\n        if (!TextUtils.isEmpty(filepath)) {\n            int pos = filepath.lastIndexOf(UNIX_SEPARATOR);\n            if (pos != -1) {\n                return filepath.substring(pos + 1);\n            }\n        }\n        return \"\";\n    }\n}\n```","tags":["Android"],"categories":["Android"]},{"title":"æ­£åˆ™è¡¨è¾¾å¼(Regular Expression)","url":"/2017/05/cbfcda6ce2f5/","content":"---\n\n***æ•´ç†å‚è€ƒäº** : http://www.runoob.com/regexp/regexp-tutorial.html*\n<!--more-->\n\n## **ä¸€. ç®€ä»‹**\n\n\n#### ^[0-9]+abc$\n - `^` ä¸ºåŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ã€‚\n - `[0-9]+` åŒ¹é…å¤šä¸ªæ•°å­— `[0-9]` åŒ¹é…å•ä¸ªæ•°å­— `+` åŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ª\n - `abc$`åŒ¹é…å­—æ¯ `abc` å¹¶ä»¥ `abc` ç»“å°¾ï¼Œ`$` ä¸ºåŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚\n\n\n## **äºŒ. è¯­æ³•**\n\næ­£åˆ™è¡¨è¾¾å¼(regular expression)æè¿°äº†ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼ï¼ˆpatternï¼‰ï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªä¸²æ˜¯å¦å«æœ‰æŸç§å­ä¸²ã€å°†åŒ¹é…çš„å­ä¸²æ›¿æ¢æˆ–è€…ä»æŸä¸ªä¸²ä¸­å–å‡ºç¬¦åˆæŸä¸ªæ¡ä»¶çš„å­ä¸²ç­‰ã€‚\nä¾‹å¦‚ï¼š\n\n - runoo+bï¼Œå¯ä»¥åŒ¹é… runoobã€runooobã€runoooooob ç­‰ï¼Œ**`+` å·ä»£è¡¨å‰é¢çš„å­—ç¬¦å¿…é¡»è‡³å°‘å‡ºç°ä¸€æ¬¡ï¼ˆ1æ¬¡æˆ–å¤šæ¬¡ï¼‰**ã€‚\n - runoo*bï¼Œå¯ä»¥åŒ¹é… runobã€runoobã€runoooooob ç­‰ï¼Œ**`*` å·ä»£è¡¨å‰é¢çš„å­—ç¬¦å¯ä»¥ä¸å‡ºç°ï¼Œä¹Ÿå¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ï¼ˆ0æ¬¡ã€æˆ–1æ¬¡ã€æˆ–å¤šæ¬¡ï¼‰**ã€‚\n - colou?r å¯ä»¥åŒ¹é… color æˆ–è€… colourï¼Œ**`?` é—®å·ä»£è¡¨å‰é¢çš„å­—ç¬¦æœ€å¤šåªå¯ä»¥å‡ºç°ä¸€æ¬¡ï¼ˆ0æ¬¡ã€æˆ–1æ¬¡ï¼‰**ã€‚\n\n\n## **ä¸‰. å­—ç¬¦åˆ†ç±»**\n\n### 1. æ™®é€šå­—ç¬¦\næ™®é€šå­—ç¬¦åŒ…æ‹¬æ²¡æœ‰æ˜¾å¼æŒ‡å®šä¸ºå…ƒå­—ç¬¦çš„æ‰€æœ‰å¯æ‰“å°å’Œä¸å¯æ‰“å°å­—ç¬¦ã€‚è¿™åŒ…æ‹¬æ‰€æœ‰å¤§å†™å’Œå°å†™å­—æ¯ã€æ‰€æœ‰æ•°å­—ã€æ‰€æœ‰æ ‡ç‚¹ç¬¦å·å’Œä¸€äº›å…¶ä»–ç¬¦å·ã€‚\n\n\n### 2. éæ‰“å°å­—ç¬¦\néæ‰“å°å­—ç¬¦ä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ç»„æˆéƒ¨åˆ†ã€‚ä¸‹è¡¨åˆ—å‡ºäº†è¡¨ç¤ºéæ‰“å°å­—ç¬¦çš„è½¬ä¹‰åºåˆ—ï¼š\n   å­—ç¬¦ | æè¿°    \n  :: | \n\\cx\t|åŒ¹é…ç”±xæŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \\cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„ 'c' å­—ç¬¦ã€‚\n\\f\t|åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº \\x0c å’Œ \\cLã€‚\n\\n\t|åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº \\x0a å’Œ \\cJã€‚\n\\r\t|åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº \\x0d å’Œ \\cMã€‚\n\\s\t|åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \\f\\n\\r\\t\\v]ã€‚\n\\S\t|åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [^ \\f\\n\\r\\t\\v]ã€‚\n\\t\t|åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x09 å’Œ \\cIã€‚\n\\v\t|åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x0b å’Œ \\cKã€‚\n\n\n### 3. ç‰¹æ®Šå­—ç¬¦\næ‰€è°“ç‰¹æ®Šå­—ç¬¦ï¼Œå°±æ˜¯ä¸€äº›æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼Œå¦‚ä¸Šé¢è¯´çš„ `runoo*b` ä¸­çš„` *`ï¼Œç®€å•çš„è¯´å°±æ˜¯è¡¨ç¤ºä»»ä½•å­—ç¬¦ä¸²çš„æ„æ€ã€‚å¦‚æœè¦æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„` *` ç¬¦å·ï¼Œåˆ™éœ€è¦å¯¹` *` è¿›è¡Œè½¬ä¹‰ï¼Œå³åœ¨å…¶å‰åŠ ä¸€ä¸ª` \\: runo\\*ob` åŒ¹é… `runo*ob`ã€‚\nè®¸å¤šå…ƒå­—ç¬¦è¦æ±‚åœ¨è¯•å›¾åŒ¹é…å®ƒä»¬æ—¶ç‰¹åˆ«å¯¹å¾…ã€‚è‹¥è¦åŒ¹é…è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»é¦–å…ˆä½¿å­—ç¬¦\"è½¬ä¹‰\"ï¼Œå³ï¼Œå°†åæ–œæ å­—ç¬¦\\ æ”¾åœ¨å®ƒä»¬å‰é¢ã€‚ä¸‹è¡¨åˆ—å‡ºäº†æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼š\n\n  ç‰¹åˆ«å­—ç¬¦ | æè¿°\n  :-----:|-----\n \\$ | åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“å°¾ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œåˆ™ $ ä¹ŸåŒ¹é… '\\n' æˆ– '\\r'ã€‚è¦åŒ¹é… $ å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨ \\$ã€‚\n( )\t|æ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚å­è¡¨è¾¾å¼å¯ä»¥è·å–ä¾›ä»¥åä½¿ç”¨ã€‚è¦åŒ¹é…è¿™äº›å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ \\( å’Œ \\)ã€‚\n\\*\t| åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é… `*` å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ `\\*`ã€‚\n\\+\t|  åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é… `+` å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ `\\+`ã€‚\n\\.\t| åŒ¹é…é™¤æ¢è¡Œç¬¦ \\n ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚è¦åŒ¹é… `.` ï¼Œè¯·ä½¿ç”¨ `\\.` ã€‚\n\\[\t| æ ‡è®°ä¸€ä¸ªä¸­æ‹¬å·è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é… `[`ï¼Œè¯·ä½¿ç”¨ `\\[`ã€‚\n?\t| åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚è¦åŒ¹é… `?` å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ `\\?`ã€‚\n\\\t| å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŸä¹‰å­—ç¬¦ã€æˆ–å‘åå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ `'n'` åŒ¹é…å­—ç¬¦ `'n'`ã€‚`'\\n'` åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— `'\\\\'` åŒ¹é… `\"\\\"`ï¼Œè€Œ `'\\('` åˆ™åŒ¹é… `\"(\"`ã€‚\n^\t| åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œé™¤éåœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œæ­¤æ—¶å®ƒè¡¨ç¤ºä¸æ¥å—è¯¥å­—ç¬¦é›†åˆã€‚è¦åŒ¹é… `^` å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨ `\\^`ã€‚\n{\t| æ ‡è®°é™å®šç¬¦è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é… `{`ï¼Œè¯·ä½¿ç”¨ `\\{`ã€‚\n\\|\t| æŒ‡æ˜ä¸¤é¡¹ä¹‹é—´çš„ä¸€ä¸ªé€‰æ‹©ã€‚è¦åŒ¹é… `|`ï¼Œè¯·ä½¿ç”¨ `\\|`ã€‚\n\n### 4. é™å®šç¬¦\né™å®šç¬¦ç”¨æ¥æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç»™å®šç»„ä»¶å¿…é¡»è¦å‡ºç°å¤šå°‘æ¬¡æ‰èƒ½æ»¡è¶³åŒ¹é…ã€‚æœ‰ * æˆ– + æˆ– ? æˆ– {n} æˆ– {n,} æˆ– {n,m} å…±6ç§ã€‚\næ­£åˆ™è¡¨è¾¾å¼çš„é™å®šç¬¦æœ‰ï¼š\n\nå­—ç¬¦ | \tæè¿°\n:-----:|-----\n\\*|\tåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ`zo*` èƒ½åŒ¹é… `\"z\"` ä»¥åŠ `\"zoo\"`ã€‚`*` ç­‰ä»·äº`{0,}`ã€‚\n\\+|åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ`'zo+'` èƒ½åŒ¹é… `\"zo\"` ä»¥åŠ `\"zoo\"`ï¼Œä½†ä¸èƒ½åŒ¹é… `\"z\"`ã€‚`+` ç­‰ä»·äº `{1,}`ã€‚\n?|\tåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œ`\"do(es)?\"` å¯ä»¥åŒ¹é… `\"do\"` æˆ– `\"does\"` ä¸­çš„`\"do\"` ã€‚`?` ç­‰ä»·äº `{0,1}`ã€‚\n{n}\t|`n`æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ `n` æ¬¡ã€‚ä¾‹å¦‚ï¼Œ`'o{2}'` ä¸èƒ½åŒ¹é… `\"Bob\"` ä¸­çš„ `'o'`ï¼Œä½†æ˜¯èƒ½åŒ¹é… `\"food\"` ä¸­çš„ä¸¤ä¸ª `o`ã€‚\n{n,}|`n` æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é…`n` æ¬¡ã€‚ä¾‹å¦‚ï¼Œ`'o{2,}'` ä¸èƒ½åŒ¹é… `\"Bob\"` ä¸­çš„ `'o'`ï¼Œä½†èƒ½åŒ¹é… `\"foooood\"` ä¸­çš„æ‰€æœ‰ `o`ã€‚`'o{1,}'` ç­‰ä»·äº `'o+'`ã€‚`'o{0,}'` åˆ™ç­‰ä»·äº `'o*'`ã€‚\n{n,m}|`m` å’Œ `n` å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­`n <= m`ã€‚æœ€å°‘åŒ¹é… `n` æ¬¡ä¸”æœ€å¤šåŒ¹é… `m` æ¬¡ã€‚ä¾‹å¦‚ï¼Œ`\"o{1,3}\"` å°†åŒ¹é… `\"fooooood\"` ä¸­çš„å‰ä¸‰ä¸ª `o`ã€‚`'o{0,1}'` ç­‰ä»·äº `'o?'`ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚\n\n ç”±äºç« èŠ‚ç¼–å·åœ¨å¤§çš„è¾“å…¥æ–‡æ¡£ä¸­ä¼šå¾ˆå¯èƒ½è¶…è¿‡ä¹ï¼Œæ‰€ä»¥æ‚¨éœ€è¦ä¸€ç§æ–¹å¼æ¥å¤„ç†ä¸¤ä½æˆ–ä¸‰ä½ç« èŠ‚ç¼–å·ã€‚é™å®šç¬¦ç»™æ‚¨è¿™ç§èƒ½åŠ›ã€‚ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç¼–å·ä¸ºä»»ä½•ä½æ•°çš„ç« èŠ‚æ ‡é¢˜ï¼š\n`/Chapter [1-9][0-9]*/`\n\nè¯·æ³¨æ„ï¼Œé™å®šç¬¦å‡ºç°åœ¨èŒƒå›´è¡¨è¾¾å¼ä¹‹åã€‚å› æ­¤ï¼Œå®ƒåº”ç”¨äºæ•´ä¸ªèŒƒå›´è¡¨è¾¾å¼ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼ŒåªæŒ‡å®šä» 0 åˆ° 9 çš„æ•°å­—ï¼ˆåŒ…æ‹¬ 0 å’Œ 9ï¼‰ã€‚\nè¿™é‡Œä¸ä½¿ç”¨ `+` é™å®šç¬¦ï¼Œå› ä¸ºåœ¨ç¬¬äºŒä¸ªä½ç½®æˆ–åé¢çš„ä½ç½®ä¸ä¸€å®šéœ€è¦æœ‰ä¸€ä¸ªæ•°å­—ã€‚ä¹Ÿä¸ä½¿ç”¨`ï¼Ÿ`å­—ç¬¦ï¼Œå› ä¸ºå®ƒå°†ç« èŠ‚ç¼–å·é™åˆ¶åˆ°åªæœ‰ä¸¤ä½æ•°ã€‚æ‚¨éœ€è¦è‡³å°‘åŒ¹é… Chapter å’Œç©ºæ ¼å­—ç¬¦åé¢çš„ä¸€ä¸ªæ•°å­—ã€‚\nå¦‚æœæ‚¨çŸ¥é“ç« èŠ‚ç¼–å·è¢«é™åˆ¶ä¸ºåªæœ‰ 99 ç« ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¡¨è¾¾å¼æ¥è‡³å°‘æŒ‡å®šä¸€ä½ä½†è‡³å¤šä¸¤ä½æ•°å­—ã€‚\n`/Chapter [0-9]{1,2}/`\n\nä¸Šé¢çš„è¡¨è¾¾å¼çš„ç¼ºç‚¹æ˜¯ï¼Œå¤§äº 99 çš„ç« èŠ‚ç¼–å·ä»åªåŒ¹é…å¼€å¤´ä¸¤ä½æ•°å­—ã€‚å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ Chapter 0 ä¹Ÿå°†åŒ¹é…ã€‚åªåŒ¹é…ä¸¤ä½æ•°å­—çš„æ›´å¥½çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š\n`/Chapter [1-9][0-9]?/`\n\næˆ–\n`/Chapter [1-9][0-9]{0,1}/`\n\n`*`ã€`+`å’Œ`?`é™å®šç¬¦éƒ½æ˜¯è´ªå©ªçš„ï¼Œå› ä¸ºå®ƒä»¬ä¼šå°½å¯èƒ½å¤šçš„åŒ¹é…æ–‡å­—ï¼Œåªæœ‰åœ¨å®ƒä»¬çš„åé¢åŠ ä¸Šä¸€ä¸ª?å°±å¯ä»¥å®ç°éè´ªå©ªæˆ–æœ€å°åŒ¹é…ã€‚\nä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æœç´¢ HTML æ–‡æ¡£ï¼Œä»¥æŸ¥æ‰¾æ‹¬åœ¨ H1 æ ‡è®°å†…çš„ç« èŠ‚æ ‡é¢˜ã€‚è¯¥æ–‡æœ¬åœ¨æ‚¨çš„æ–‡æ¡£ä¸­å¦‚ä¸‹ï¼š\n>```<H1>Chapter 1 - ä»‹ç»æ­£åˆ™è¡¨è¾¾å¼</H1>```\n\n**è´ªå©ª**ï¼šä¸‹é¢çš„è¡¨è¾¾å¼åŒ¹é…ä»å¼€å§‹å°äºç¬¦å· (<) åˆ°å…³é—­ H1 æ ‡è®°çš„å¤§äºç¬¦å· (>) ä¹‹é—´çš„æ‰€æœ‰å†…å®¹ã€‚\n`/<.*>/`\n\n**éè´ªå©ª**ï¼šå¦‚æœæ‚¨åªéœ€è¦åŒ¹é…å¼€å§‹å’Œä»‹ç» H1 æ ‡è®°ï¼Œä¸‹é¢çš„éè´ªå©ªè¡¨è¾¾å¼åªåŒ¹é… `<H1>`ã€‚\n`/<.*?>/`\n\nå¦‚æœåªæƒ³åŒ¹é…å¼€å§‹çš„ H1 æ ‡ç­¾ï¼Œè¡¨è¾¾å¼åˆ™æ˜¯ï¼š\n`/<\\w+?>/`\n\né€šè¿‡åœ¨`*`ã€`+` æˆ– `?` é™å®šç¬¦ä¹‹åæ”¾ç½® `?`ï¼Œè¯¥è¡¨è¾¾å¼ä»\"è´ªå¿ƒ\"è¡¨è¾¾å¼è½¬æ¢ä¸º\"éè´ªå¿ƒ\"è¡¨è¾¾å¼æˆ–è€…æœ€å°åŒ¹é…ã€‚\n\n### 5. å®šä½ç¬¦\nå®šä½ç¬¦ä½¿æ‚¨èƒ½å¤Ÿå°†æ­£åˆ™è¡¨è¾¾å¼å›ºå®šåˆ°è¡Œé¦–æˆ–è¡Œå°¾ã€‚å®ƒä»¬è¿˜ä½¿æ‚¨èƒ½å¤Ÿåˆ›å»ºè¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™äº›æ­£åˆ™è¡¨è¾¾å¼å‡ºç°åœ¨ä¸€ä¸ªå•è¯å†…ã€åœ¨ä¸€ä¸ªå•è¯çš„å¼€å¤´æˆ–è€…ä¸€ä¸ªå•è¯çš„ç»“å°¾ã€‚\nå®šä½ç¬¦ç”¨æ¥æè¿°å­—ç¬¦ä¸²æˆ–å•è¯çš„è¾¹ç•Œï¼Œ`^` å’Œ`$` åˆ†åˆ«æŒ‡å­—ç¬¦ä¸²çš„å¼€å§‹ä¸ç»“æŸï¼Œ`span class=\"marked\">\\b` æè¿°å•è¯çš„å‰æˆ–åè¾¹ç•Œï¼Œ`span class=\"marked\">\\B` è¡¨ç¤ºéå•è¯è¾¹ç•Œã€‚\næ­£åˆ™è¡¨è¾¾å¼çš„é™å®šç¬¦æœ‰ï¼š\n\nå­—ç¬¦ |\tæè¿°\n:-----:|-----\n^\t|åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ è¿˜ä¼šä¸ \\n æˆ– \\r ä¹‹åçš„ä½ç½®åŒ¹é…ã€‚\n\\$\t|åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ç»“å°¾çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ è¿˜ä¼šä¸ \\n æˆ– \\r ä¹‹å‰çš„ä½ç½®åŒ¹é…ã€‚\n\\b\t|åŒ¹é…ä¸€ä¸ªå­—è¾¹ç•Œï¼Œå³å­—ä¸ç©ºæ ¼é—´çš„ä½ç½®ã€‚\n\\B\t|éå­—è¾¹ç•ŒåŒ¹é…ã€‚\n\n**æ³¨æ„**ï¼šä¸èƒ½å°†é™å®šç¬¦ä¸å®šä½ç‚¹ä¸€èµ·ä½¿ç”¨ã€‚ç”±äºåœ¨ç´§é æ¢è¡Œæˆ–è€…å­—è¾¹ç•Œçš„å‰é¢æˆ–åé¢ä¸èƒ½æœ‰ä¸€ä¸ªä»¥ä¸Šä½ç½®ï¼Œå› æ­¤ä¸å…è®¸è¯¸å¦‚ `^*` ä¹‹ç±»çš„è¡¨è¾¾å¼ã€‚\nè‹¥è¦åŒ¹é…ä¸€è¡Œæ–‡æœ¬å¼€å§‹å¤„çš„æ–‡æœ¬ï¼Œè¯·åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹ä½¿ç”¨ `^` å­—ç¬¦ã€‚ä¸è¦å°† `^` çš„è¿™ç§ç”¨æ³•ä¸ä¸­æ‹¬å·è¡¨è¾¾å¼å†…çš„ç”¨æ³•æ··æ·†ã€‚\nè‹¥è¦åŒ¹é…ä¸€è¡Œæ–‡æœ¬çš„ç»“æŸå¤„çš„æ–‡æœ¬ï¼Œè¯·åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æŸå¤„ä½¿ç”¨ `$` å­—ç¬¦ã€‚\nè‹¥è¦åœ¨æœç´¢ç« èŠ‚æ ‡é¢˜æ—¶ä½¿ç”¨å®šä½ç‚¹ï¼Œä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸€ä¸ªç« èŠ‚æ ‡é¢˜ï¼Œè¯¥æ ‡é¢˜åªåŒ…å«ä¸¤ä¸ªå°¾éšæ•°å­—ï¼Œå¹¶ä¸”å‡ºç°åœ¨è¡Œé¦–ï¼š\n`/^Chapter [1-9][0-9]{0,1}/`\n\nçœŸæ­£çš„ç« èŠ‚æ ‡é¢˜ä¸ä»…å‡ºç°è¡Œçš„å¼€å§‹å¤„ï¼Œè€Œä¸”å®ƒè¿˜æ˜¯è¯¥è¡Œä¸­ä»…æœ‰çš„æ–‡æœ¬ã€‚å®ƒå³å‡ºç°åœ¨è¡Œé¦–åˆå‡ºç°åœ¨åŒä¸€è¡Œçš„ç»“å°¾ã€‚ä¸‹é¢çš„è¡¨è¾¾å¼èƒ½ç¡®ä¿æŒ‡å®šçš„åŒ¹é…åªåŒ¹é…ç« èŠ‚è€Œä¸åŒ¹é…äº¤å‰å¼•ç”¨ã€‚é€šè¿‡åˆ›å»ºåªåŒ¹é…ä¸€è¡Œæ–‡æœ¬çš„å¼€å§‹å’Œç»“å°¾çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±å¯åšåˆ°è¿™ä¸€ç‚¹ã€‚\n`/^Chapter [1-9][0-9]{0,1}$/`\n\nåŒ¹é…å­—è¾¹ç•Œç¨æœ‰ä¸åŒï¼Œä½†å‘æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†å¾ˆé‡è¦çš„èƒ½åŠ›ã€‚å­—è¾¹ç•Œæ˜¯å•è¯å’Œç©ºæ ¼ä¹‹é—´çš„ä½ç½®ã€‚éå­—è¾¹ç•Œæ˜¯ä»»ä½•å…¶ä»–ä½ç½®ã€‚ä¸‹é¢çš„è¡¨è¾¾å¼åŒ¹é…å•è¯ Chapter çš„å¼€å¤´ä¸‰ä¸ªå­—ç¬¦ï¼Œå› ä¸ºè¿™ä¸‰ä¸ªå­—ç¬¦å‡ºç°å­—è¾¹ç•Œåé¢ï¼š\n`/\\bCha/`\n\n`\\b` å­—ç¬¦çš„ä½ç½®æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœå®ƒä½äºè¦åŒ¹é…çš„å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œå®ƒåœ¨å•è¯çš„å¼€å§‹å¤„æŸ¥æ‰¾åŒ¹é…é¡¹ã€‚å¦‚æœå®ƒä½äºå­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œå®ƒåœ¨å•è¯çš„ç»“å°¾å¤„æŸ¥æ‰¾åŒ¹é…é¡¹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¡¨è¾¾å¼åŒ¹é…å•è¯ Chapter ä¸­çš„å­—ç¬¦ä¸² terï¼Œå› ä¸ºå®ƒå‡ºç°åœ¨å­—è¾¹ç•Œçš„å‰é¢ï¼š\n`/ter\\b/`\n\nä¸‹é¢çš„è¡¨è¾¾å¼åŒ¹é… Chapter ä¸­çš„å­—ç¬¦ä¸² aptï¼Œä½†ä¸åŒ¹é… aptitude ä¸­çš„å­—ç¬¦ä¸² aptï¼š\n`/\\Bapt/`\n\nå­—ç¬¦ä¸² apt å‡ºç°åœ¨å•è¯ Chapter ä¸­çš„éå­—è¾¹ç•Œå¤„ï¼Œä½†å‡ºç°åœ¨å•è¯ aptitude ä¸­çš„å­—è¾¹ç•Œå¤„ã€‚å¯¹äº \\B éå­—è¾¹ç•Œè¿ç®—ç¬¦ï¼Œä½ç½®å¹¶ä¸é‡è¦ï¼Œå› ä¸ºåŒ¹é…ä¸å…³å¿ƒç©¶ç«Ÿæ˜¯å•è¯çš„å¼€å¤´è¿˜æ˜¯ç»“å°¾ã€‚\n\n### 6. é€‰æ‹©\nç”¨åœ†æ‹¬å·å°†æ‰€æœ‰é€‰æ‹©é¡¹æ‹¬èµ·æ¥ï¼Œç›¸é‚»çš„é€‰æ‹©é¡¹ä¹‹é—´ç”¨|åˆ†éš”ã€‚ä½†ç”¨åœ†æ‹¬å·ä¼šæœ‰ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œæ˜¯ç›¸å…³çš„åŒ¹é…ä¼šè¢«ç¼“å­˜ï¼Œæ­¤æ—¶å¯ç”¨?:æ”¾åœ¨ç¬¬ä¸€ä¸ªé€‰é¡¹å‰æ¥æ¶ˆé™¤è¿™ç§å‰¯ä½œç”¨ã€‚\n\nå…¶ä¸­ `?:` æ˜¯éæ•è·å…ƒä¹‹ä¸€ï¼Œè¿˜æœ‰ä¸¤ä¸ªéæ•è·å…ƒæ˜¯ `?=` å’Œ `?!`ï¼Œè¿™ä¸¤ä¸ªè¿˜æœ‰æ›´å¤šçš„å«ä¹‰ï¼Œå‰è€…ä¸ºæ­£å‘é¢„æŸ¥ï¼Œåœ¨ä»»ä½•å¼€å§‹åŒ¹é…åœ†æ‹¬å·å†…çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„ä½ç½®æ¥åŒ¹é…æœç´¢å­—ç¬¦ä¸²ï¼Œåè€…ä¸ºè´Ÿå‘é¢„æŸ¥ï¼Œåœ¨ä»»ä½•å¼€å§‹ä¸åŒ¹é…è¯¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„ä½ç½®æ¥åŒ¹é…æœç´¢å­—ç¬¦ä¸²ã€‚\n\n### 7. åå‘å¼•ç”¨\nå¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·å°†å¯¼è‡´ç›¸å…³åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä» 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ `\\n` è®¿é—®ï¼Œå…¶ä¸­ `n` ä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚\nå¯ä»¥ä½¿ç”¨éæ•è·å…ƒå­—ç¬¦ `?:`ã€`?=` æˆ– `?!` æ¥é‡å†™æ•è·ï¼Œå¿½ç•¥å¯¹ç›¸å…³åŒ¹é…çš„ä¿å­˜ã€‚\n\nåå‘å¼•ç”¨çš„æœ€ç®€å•çš„ã€æœ€æœ‰ç”¨çš„åº”ç”¨ä¹‹ä¸€ï¼Œæ˜¯æä¾›æŸ¥æ‰¾æ–‡æœ¬ä¸­ä¸¤ä¸ªç›¸åŒçš„ç›¸é‚»å•è¯çš„åŒ¹é…é¡¹çš„èƒ½åŠ›ã€‚ä»¥ä¸‹é¢çš„å¥å­ä¸ºä¾‹ï¼š\n`Is is the cost of of gasoline going up up?`\n\nä¸Šé¢çš„å¥å­å¾ˆæ˜¾ç„¶æœ‰å¤šä¸ªé‡å¤çš„å•è¯ã€‚å¦‚æœèƒ½è®¾è®¡ä¸€ç§æ–¹æ³•å®šä½è¯¥å¥å­ï¼Œè€Œä¸å¿…æŸ¥æ‰¾æ¯ä¸ªå•è¯çš„é‡å¤å‡ºç°ï¼Œé‚£è¯¥æœ‰å¤šå¥½ã€‚\n\n\n## **å››. å…ƒå­—ç¬¦**\n\nä¸‹è¡¨åŒ…å«äº†å…ƒå­—ç¬¦çš„å®Œæ•´åˆ—è¡¨ä»¥åŠå®ƒä»¬åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­çš„è¡Œä¸ºï¼š\n\nå­—ç¬¦ |\tæè¿°\n:-: | ----\n\\\t|å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ã€æˆ–ä¸€ä¸ªåŸä¹‰å­—ç¬¦ã€æˆ–ä¸€ä¸ª å‘åå¼•ç”¨ã€æˆ–ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ'n' åŒ¹é…å­—ç¬¦ \"n\"ã€‚'\\n' åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚åºåˆ— '\\\\' åŒ¹é… \"\\\" è€Œ \"\\(\" åˆ™åŒ¹é… \"(\"ã€‚\n^\t|é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ ä¹ŸåŒ¹é… '\\n' æˆ– '\\r' ä¹‹åçš„ä½ç½®ã€‚\n\\$\t|åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚å¦‚æœè®¾ç½®äº†RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ ä¹ŸåŒ¹é… '\\n' æˆ– '\\r' ä¹‹å‰çš„ä½ç½®ã€‚\n\\*|åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzo* èƒ½åŒ¹é… \"z\" ä»¥åŠ \"zoo\"ã€‚* ç­‰ä»·äº{0,}ã€‚\n+|åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ'zo+' èƒ½åŒ¹é… \"zo\" ä»¥åŠ \"zoo\"ï¼Œä½†ä¸èƒ½åŒ¹é… \"z\"ã€‚+ ç­‰ä»·äº {1,}ã€‚\n?\t|åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œ\"do(es)?\" å¯ä»¥åŒ¹é… \"do\" æˆ– \"does\" ä¸­çš„\"do\" ã€‚? ç­‰ä»·äº {0,1}ã€‚\n{n}\t|n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ä¾‹å¦‚ï¼Œ'o{2}' ä¸èƒ½åŒ¹é… \"Bob\" ä¸­çš„ 'o'ï¼Œä½†æ˜¯èƒ½åŒ¹é… \"food\" ä¸­çš„ä¸¤ä¸ª oã€‚\n{n,}\t|n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é…n æ¬¡ã€‚ä¾‹å¦‚ï¼Œ'o{2,}' ä¸èƒ½åŒ¹é… \"Bob\" ä¸­çš„ 'o'ï¼Œä½†èƒ½åŒ¹é… \"foooood\" ä¸­çš„æ‰€æœ‰ oã€‚'o{1,}' ç­‰ä»·äº 'o+'ã€‚'o{0,}' åˆ™ç­‰ä»·äº 'o*'ã€‚\n{n,m}\t|m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­n <= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ä¾‹å¦‚ï¼Œ\"o{1,3}\" å°†åŒ¹é… \"fooooood\" ä¸­çš„å‰ä¸‰ä¸ª oã€‚'o{0,1}' ç­‰ä»·äº 'o?'ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚\n?\t|å½“è¯¥å­—ç¬¦ç´§è·Ÿåœ¨ä»»ä½•ä¸€ä¸ªå…¶ä»–é™åˆ¶ç¬¦ (*, +, ?, {n}, {n,}, {n,m}) åé¢æ—¶ï¼ŒåŒ¹é…æ¨¡å¼æ˜¯éè´ªå©ªçš„ã€‚éè´ªå©ªæ¨¡å¼å°½å¯èƒ½å°‘çš„åŒ¹é…æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œè€Œé»˜è®¤çš„è´ªå©ªæ¨¡å¼åˆ™å°½å¯èƒ½å¤šçš„åŒ¹é…æ‰€æœç´¢çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸² \"oooo\"ï¼Œ'o+?' å°†åŒ¹é…å•ä¸ª \"o\"ï¼Œè€Œ 'o+' å°†åŒ¹é…æ‰€æœ‰ 'o'ã€‚\n.\t|åŒ¹é…é™¤ \"\\n\" ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚è¦åŒ¹é…åŒ…æ‹¬ '\\n' åœ¨å†…çš„ä»»ä½•å­—ç¬¦ï¼Œè¯·ä½¿ç”¨åƒ\"(.|\\n)\"çš„æ¨¡å¼ã€‚\n(pattern)|åŒ¹é… pattern å¹¶è·å–è¿™ä¸€åŒ¹é…ã€‚æ‰€è·å–çš„åŒ¹é…å¯ä»¥ä»äº§ç”Ÿçš„ Matches é›†åˆå¾—åˆ°ï¼Œåœ¨VBScript ä¸­ä½¿ç”¨ SubMatches é›†åˆï¼Œåœ¨JScript ä¸­åˆ™ä½¿ç”¨ $0â€¦$9 å±æ€§ã€‚è¦åŒ¹é…åœ†æ‹¬å·å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ '\\(' æˆ– '\\)'ã€‚\n(?:pattern)|åŒ¹é… pattern ä½†ä¸è·å–åŒ¹é…ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¸è¿›è¡Œå­˜å‚¨ä¾›ä»¥åä½¿ç”¨ã€‚è¿™åœ¨ä½¿ç”¨ \"æˆ–\" å­—ç¬¦ (|) æ¥ç»„åˆä¸€ä¸ªæ¨¡å¼çš„å„ä¸ªéƒ¨åˆ†æ˜¯å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ 'industr(?:y|ies) å°±æ˜¯ä¸€ä¸ªæ¯” 'industry|industries' æ›´ç®€ç•¥çš„è¡¨è¾¾å¼ã€‚\n(?=pattern)\t|æ­£å‘é¢„æŸ¥ï¼Œåœ¨ä»»ä½•åŒ¹é… pattern çš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œ'Windows (?=95|98|NT|2000)' èƒ½åŒ¹é… \"Windows 2000\" ä¸­çš„ \"Windows\" ï¼Œä½†ä¸èƒ½åŒ¹é… \"Windows 3.1\" ä¸­çš„ \"Windows\"ã€‚é¢„æŸ¥ä¸æ¶ˆè€—å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªåŒ¹é…å‘ç”Ÿåï¼Œåœ¨æœ€åä¸€æ¬¡åŒ¹é…ä¹‹åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡åŒ¹é…çš„æœç´¢ï¼Œè€Œä¸æ˜¯ä»åŒ…å«é¢„æŸ¥çš„å­—ç¬¦ä¹‹åå¼€å§‹ã€‚\n(?!pattern)\t|è´Ÿå‘é¢„æŸ¥ï¼Œåœ¨ä»»ä½•ä¸åŒ¹é… pattern çš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚'Windows (?!95|98|NT|2000)' èƒ½åŒ¹é… \"Windows 3.1\" ä¸­çš„ \"Windows\"ï¼Œä½†ä¸èƒ½åŒ¹é… \"Windows 2000\" ä¸­çš„ \"Windows\"ã€‚é¢„æŸ¥ä¸æ¶ˆè€—å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªåŒ¹é…å‘ç”Ÿåï¼Œåœ¨æœ€åä¸€æ¬¡åŒ¹é…ä¹‹åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡åŒ¹é…çš„æœç´¢ï¼Œè€Œä¸æ˜¯ä»åŒ…å«é¢„æŸ¥çš„å­—ç¬¦ä¹‹åå¼€å§‹ã€‚\nx\\|y|åŒ¹é… x æˆ– yã€‚ä¾‹å¦‚ï¼Œ'z|food' èƒ½åŒ¹é… \"z\" æˆ– \"food\"ã€‚'(z|f)ood' åˆ™åŒ¹é… \"zood\" æˆ– \"food\"ã€‚\n[xyz]\t|å­—ç¬¦é›†åˆã€‚åŒ¹é…æ‰€åŒ…å«çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ '[abc]' å¯ä»¥åŒ¹é… \"plain\" ä¸­çš„ 'a'ã€‚\n[^xyz]\t|è´Ÿå€¼å­—ç¬¦é›†åˆã€‚åŒ¹é…æœªåŒ…å«çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ '[^abc]' å¯ä»¥åŒ¹é… \"plain\" ä¸­çš„'p'ã€'l'ã€'i'ã€'n'ã€‚\n[a-z]\t|å­—ç¬¦èŒƒå›´ã€‚åŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ'[a-z]' å¯ä»¥åŒ¹é… 'a' åˆ° 'z' èŒƒå›´å†…çš„ä»»æ„å°å†™å­—æ¯å­—ç¬¦ã€‚\n[^a-z]\t|è´Ÿå€¼å­—ç¬¦èŒƒå›´ã€‚åŒ¹é…ä»»ä½•ä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ'[^a-z]' å¯ä»¥åŒ¹é…ä»»ä½•ä¸åœ¨ 'a' åˆ° 'z' èŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚\n\\b\t|åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯æŒ‡å•è¯å’Œç©ºæ ¼é—´çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œ 'er\\b' å¯ä»¥åŒ¹é…\"never\" ä¸­çš„ 'er'ï¼Œä½†ä¸èƒ½åŒ¹é… \"verb\" ä¸­çš„ 'er'ã€‚\n\\B\t|åŒ¹é…éå•è¯è¾¹ç•Œã€‚'er\\B' èƒ½åŒ¹é… \"verb\" ä¸­çš„ 'er'ï¼Œä½†ä¸èƒ½åŒ¹é… \"never\" ä¸­çš„ 'er'ã€‚\n\\cx\t|åŒ¹é…ç”± x æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \\cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„ 'c' å­—ç¬¦ã€‚\n\\d\t|åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [0-9]ã€‚\n\\D\t|åŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [^0-9]ã€‚\n\\f\t|åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº \\x0c å’Œ \\cLã€‚\n\\n\t|åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº \\x0a å’Œ \\cJã€‚\n\\r\t|åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº \\x0d å’Œ \\cMã€‚\n\\s\t|åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \\f\\n\\r\\t\\v]ã€‚\n\\S\t|åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [^ \\f\\n\\r\\t\\v]ã€‚\n\\t\t|åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x09 å’Œ \\cIã€‚\n\\v\t|åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x0b å’Œ \\cKã€‚\n\\w\t|åŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ã€‚ç­‰ä»·äº'[A-Za-z0-9_]'ã€‚\n\\W\t|åŒ¹é…ä»»ä½•éå•è¯å­—ç¬¦ã€‚ç­‰ä»·äº '[^A-Za-z0-9_]'ã€‚\n\\xn\t|åŒ¹é… nï¼Œå…¶ä¸­ n ä¸ºåå…­è¿›åˆ¶è½¬ä¹‰å€¼ã€‚åå…­è¿›åˆ¶è½¬ä¹‰å€¼å¿…é¡»ä¸ºç¡®å®šçš„ä¸¤ä¸ªæ•°å­—é•¿ã€‚ä¾‹å¦‚ï¼Œ'\\x41' åŒ¹é… \"A\"ã€‚'\\x041' åˆ™ç­‰ä»·äº '\\x04' & \"1\"ã€‚æ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥ä½¿ç”¨ ASCII ç¼–ç ã€‚\n\\num|åŒ¹é… numï¼Œå…¶ä¸­ num æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚å¯¹æ‰€è·å–çš„åŒ¹é…çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œ'(.)\\1' åŒ¹é…ä¸¤ä¸ªè¿ç»­çš„ç›¸åŒå­—ç¬¦ã€‚\n\\n\t|æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ã€‚å¦‚æœ \\n ä¹‹å‰è‡³å°‘ n ä¸ªè·å–çš„å­è¡¨è¾¾å¼ï¼Œåˆ™ n ä¸ºå‘åå¼•ç”¨ã€‚å¦åˆ™ï¼Œå¦‚æœ n ä¸ºå…«è¿›åˆ¶æ•°å­— (0-7)ï¼Œåˆ™ n ä¸ºä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼ã€‚\n\\nm\t|æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ã€‚å¦‚æœ \\nm ä¹‹å‰è‡³å°‘æœ‰ nm ä¸ªè·å¾—å­è¡¨è¾¾å¼ï¼Œåˆ™ nm ä¸ºå‘åå¼•ç”¨ã€‚å¦‚æœ \\nm ä¹‹å‰è‡³å°‘æœ‰ n ä¸ªè·å–ï¼Œåˆ™ n ä¸ºä¸€ä¸ªåè·Ÿæ–‡å­— m çš„å‘åå¼•ç”¨ã€‚å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œè‹¥ n å’Œ m å‡ä¸ºå…«è¿›åˆ¶æ•°å­— (0-7)ï¼Œåˆ™ \\nm å°†åŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰å€¼ nmã€‚\n\\nml|å¦‚æœ n ä¸ºå…«è¿›åˆ¶æ•°å­— (0-3)ï¼Œä¸” m å’Œ l å‡ä¸ºå…«è¿›åˆ¶æ•°å­— (0-7)ï¼Œåˆ™åŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰å€¼ nmlã€‚\n\\un\t|åŒ¹é… nï¼Œå…¶ä¸­ n æ˜¯ä¸€ä¸ªç”¨å››ä¸ªåå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºçš„ Unicode å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \\u00A9 åŒ¹é…ç‰ˆæƒç¬¦å· (?)ã€‚\n\n## **äº”. è¿ç®—ç¬¦ä¼˜å…ˆçº§**\n\næ­£åˆ™è¡¨è¾¾å¼ä»å·¦åˆ°å³è¿›è¡Œè®¡ç®—ï¼Œå¹¶éµå¾ªä¼˜å…ˆçº§é¡ºåºï¼Œè¿™ä¸ç®—æœ¯è¡¨è¾¾å¼éå¸¸ç±»ä¼¼ã€‚\nç›¸åŒä¼˜å…ˆçº§çš„ä»å·¦åˆ°å³è¿›è¡Œè¿ç®—ï¼Œä¸åŒä¼˜å…ˆçº§çš„è¿ç®—å…ˆé«˜åä½ã€‚ä¸‹è¡¨ä»æœ€é«˜åˆ°æœ€ä½è¯´æ˜äº†å„ç§æ­£åˆ™è¡¨è¾¾å¼è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é¡ºåºï¼š\n\nè¿ç®—ç¬¦|\tæè¿°\n:-| ---\n\\\t|è½¬ä¹‰ç¬¦\n(), (?:), (?=), []\t|åœ†æ‹¬å·å’Œæ–¹æ‹¬å·\n*, +, ?, {n}, {n,}, {n,m}\t|é™å®šç¬¦\n^, $, \\ä»»ä½•å…ƒå­—ç¬¦ã€ä»»ä½•å­—ç¬¦\t|å®šä½ç‚¹å’Œåºåˆ—ï¼ˆå³ï¼šä½ç½®å’Œé¡ºåºï¼‰\n\\||æ›¿æ¢ï¼Œ\"æˆ–\"æ“ä½œå­—ç¬¦å…·æœ‰é«˜äºæ›¿æ¢è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—\"m\\|food\"åŒ¹é…\"m\"æˆ–\"food\"ã€‚è‹¥è¦åŒ¹é…\"mood\"æˆ–\"food\"ï¼Œè¯·ä½¿ç”¨æ‹¬å·åˆ›å»ºå­è¡¨è¾¾å¼ï¼Œä»è€Œäº§ç”Ÿ\"(m\\|f)ood\"ã€‚\n\n\n## **å…­. åŒ¹é…è§„åˆ™**\n\n#### **1. åŸºæœ¬æ¨¡å¼åŒ¹é…**\nä¸€åˆ‡ä»æœ€åŸºæœ¬çš„å¼€å§‹ã€‚æ¨¡å¼ï¼Œæ˜¯æ­£è§„è¡¨è¾¾å¼æœ€åŸºæœ¬çš„å…ƒç´ ï¼Œå®ƒä»¬æ˜¯ä¸€ç»„æè¿°å­—ç¬¦ä¸²ç‰¹å¾çš„å­—ç¬¦ã€‚æ¨¡å¼å¯ä»¥å¾ˆç®€å•ï¼Œç”±æ™®é€šçš„å­—ç¬¦ä¸²ç»„æˆï¼Œä¹Ÿå¯ä»¥éå¸¸å¤æ‚ï¼Œå¾€å¾€ç”¨ç‰¹æ®Šçš„å­—ç¬¦è¡¨ç¤ºä¸€ä¸ªèŒƒå›´å†…çš„å­—ç¬¦ã€é‡å¤å‡ºç°ï¼Œæˆ–è¡¨ç¤ºä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼š\n`^once`\n\nè¿™ä¸ªæ¨¡å¼åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦^ï¼Œè¡¨ç¤ºè¯¥æ¨¡å¼åªåŒ¹é…é‚£äº›ä»¥onceå¼€å¤´çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚è¯¥æ¨¡å¼ä¸å­—ç¬¦ä¸²\"once upon a time\"åŒ¹é…ï¼Œä¸\"There once was a man from NewYork\"ä¸åŒ¹é…ã€‚æ­£å¦‚å¦‚^ç¬¦å·è¡¨ç¤ºå¼€å¤´ä¸€æ ·ï¼Œ$ç¬¦å·ç”¨æ¥åŒ¹é…é‚£äº›ä»¥ç»™å®šæ¨¡å¼ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚\n`bucket$`\n\nè¿™ä¸ªæ¨¡å¼ä¸\"Who kept all of this cash in a bucket\"åŒ¹é…ï¼Œä¸\"buckets\"ä¸åŒ¹é…ã€‚å­—ç¬¦^å’Œ$åŒæ—¶ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼ˆå­—ç¬¦ä¸²ä¸æ¨¡å¼ä¸€æ ·ï¼‰ã€‚ä¾‹å¦‚ï¼š\n`^bucket$`\n\nåªåŒ¹é…å­—ç¬¦ä¸²\"bucket\"ã€‚å¦‚æœä¸€ä¸ªæ¨¡å¼ä¸åŒ…æ‹¬^å’Œ$ï¼Œé‚£ä¹ˆå®ƒä¸ä»»ä½•åŒ…å«è¯¥æ¨¡å¼çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚ä¾‹å¦‚ï¼šæ¨¡å¼\n> once\n\nä¸å­—ç¬¦ä¸²\n> There once was a man from NewYork\nWho kept all of his cash in a bucket.\n\næ˜¯åŒ¹é…çš„ã€‚\nåœ¨è¯¥æ¨¡å¼ä¸­çš„å­—æ¯(o-n-c-e)æ˜¯å­—é¢çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬è¡¨ç¤ºè¯¥å­—æ¯æœ¬èº«ï¼Œæ•°å­—ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å…¶ä»–ä¸€äº›ç¨å¾®å¤æ‚çš„å­—ç¬¦ï¼Œå¦‚æ ‡ç‚¹ç¬¦å·å’Œç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰ï¼Œè¦ç”¨åˆ°è½¬ä¹‰åºåˆ—ã€‚æ‰€æœ‰çš„è½¬ä¹‰åºåˆ—éƒ½ç”¨åæ–œæ (\\)æ‰“å¤´ã€‚åˆ¶è¡¨ç¬¦çš„è½¬ä¹‰åºåˆ—æ˜¯ï¼š\\tã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦æ£€æµ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä»¥åˆ¶è¡¨ç¬¦å¼€å¤´ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¨¡å¼ï¼š\n> ^\\t \n\nç±»ä¼¼çš„ï¼Œç”¨\\nè¡¨ç¤º\"æ–°è¡Œ\"ï¼Œ\\rè¡¨ç¤ºå›è½¦ã€‚å…¶ä»–çš„ç‰¹æ®Šç¬¦å·ï¼Œå¯ä»¥ç”¨åœ¨å‰é¢åŠ ä¸Šåæ–œæ ï¼Œå¦‚åæ–œæ æœ¬èº«ç”¨\\\\è¡¨ç¤ºï¼Œå¥å·.ç”¨\\.è¡¨ç¤ºï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\n#### **2. å­—ç¬¦ç°‡**\nå­—ç¬¦ç°‡\nåœ¨INTERNETçš„ç¨‹åºä¸­ï¼Œæ­£è§„è¡¨è¾¾å¼é€šå¸¸ç”¨æ¥éªŒè¯ç”¨æˆ·çš„è¾“å…¥ã€‚å½“ç”¨æˆ·æäº¤ä¸€ä¸ªFORMä»¥åï¼Œè¦åˆ¤æ–­è¾“å…¥çš„ç”µè¯å·ç ã€åœ°å€ã€EMAILåœ°å€ã€ä¿¡ç”¨å¡å·ç ç­‰æ˜¯å¦æœ‰æ•ˆï¼Œç”¨æ™®é€šçš„åŸºäºå­—é¢çš„å­—ç¬¦æ˜¯ä¸å¤Ÿçš„ã€‚\næ‰€ä»¥è¦ç”¨ä¸€ç§æ›´è‡ªç”±çš„æè¿°æˆ‘ä»¬è¦çš„æ¨¡å¼çš„åŠæ³•ï¼Œå®ƒå°±æ˜¯å­—ç¬¦ç°‡ã€‚è¦å»ºç«‹ä¸€ä¸ªè¡¨ç¤ºæ‰€æœ‰å…ƒéŸ³å­—ç¬¦çš„å­—ç¬¦ç°‡ï¼Œå°±æŠŠæ‰€æœ‰çš„å…ƒéŸ³å­—ç¬¦æ”¾åœ¨ä¸€ä¸ªæ–¹æ‹¬å·é‡Œï¼š\n> [AaEeIiOoUu]\n\nè¿™ä¸ªæ¨¡å¼ä¸ä»»ä½•å…ƒéŸ³å­—ç¬¦åŒ¹é…ï¼Œä½†åªèƒ½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚ç”¨è¿å­—å·å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦çš„èŒƒå›´ï¼Œå¦‚ï¼š\n>[a-z] //åŒ¹é…æ‰€æœ‰çš„å°å†™å­—æ¯ \n[A-Z] //åŒ¹é…æ‰€æœ‰çš„å¤§å†™å­—æ¯ \n[a-zA-Z] //åŒ¹é…æ‰€æœ‰çš„å­—æ¯ \n[0-9] //åŒ¹é…æ‰€æœ‰çš„æ•°å­— \n[0-9\\.\\-] //åŒ¹é…æ‰€æœ‰çš„æ•°å­—ï¼Œå¥å·å’Œå‡å· \n[ \\f\\r\\t\\n] //åŒ¹é…æ‰€æœ‰çš„ç™½å­—ç¬¦\n\nåŒæ ·çš„ï¼Œè¿™äº›ä¹Ÿåªè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ã€‚å¦‚æœè¦åŒ¹é…ä¸€ä¸ªç”±ä¸€ä¸ªå°å†™å­—æ¯å’Œä¸€ä½æ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚\"z2\"ã€\"t6\"æˆ–\"g7\"ï¼Œä½†ä¸æ˜¯\"ab2\"ã€\"r2d3\" æˆ–\"b52\"çš„è¯ï¼Œç”¨è¿™ä¸ªæ¨¡å¼ï¼š\n> ^[a-z][0-9]$\n\nå°½ç®¡[a-z]ä»£è¡¨26ä¸ªå­—æ¯çš„èŒƒå›´ï¼Œä½†åœ¨è¿™é‡Œå®ƒåªèƒ½ä¸ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å°å†™å­—æ¯çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚\nå‰é¢æ›¾ç»æåˆ°^è¡¨ç¤ºå­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œä½†å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªå«ä¹‰ã€‚å½“åœ¨ä¸€ç»„æ–¹æ‹¬å·é‡Œä½¿ç”¨^æ˜¯ï¼Œå®ƒè¡¨ç¤º\"é\"æˆ–\"æ’é™¤\"çš„æ„æ€ï¼Œå¸¸å¸¸ç”¨æ¥å‰”é™¤æŸä¸ªå­—ç¬¦ã€‚è¿˜ç”¨å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¦æ±‚ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸èƒ½æ˜¯æ•°å­—ï¼š\n> ^[^0-9][0-9]$\n\nè¿™ä¸ªæ¨¡å¼ä¸\"&5\"ã€\"g7\"åŠ\"-2\"æ˜¯åŒ¹é…çš„ï¼Œä½†ä¸\"12\"ã€\"66\"æ˜¯ä¸åŒ¹é…çš„ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªæ’é™¤ç‰¹å®šå­—ç¬¦çš„ä¾‹å­ï¼š\n>[^a-z] //é™¤äº†å°å†™å­—æ¯ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦ \n[^\\\\\\/\\^] //é™¤äº†(\\)(/)(^)ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ \n[^\\\"\\'] //é™¤äº†åŒå¼•å·(\")å’Œå•å¼•å·(')ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦\n\nç‰¹æ®Šå­—ç¬¦\".\" (ç‚¹ï¼Œå¥å·)åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ç”¨æ¥è¡¨ç¤ºé™¤äº†\"æ–°è¡Œ\"ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ã€‚æ‰€ä»¥æ¨¡å¼\"^.5$\"ä¸ä»»ä½•ä¸¤ä¸ªå­—ç¬¦çš„ã€ä»¥æ•°å­—5ç»“å°¾å’Œä»¥å…¶ä»–é\"æ–°è¡Œ\"å­—ç¬¦å¼€å¤´çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚æ¨¡å¼\".\"å¯ä»¥åŒ¹é…ä»»ä½•å­—ç¬¦ä¸²ï¼Œé™¤äº†ç©ºä¸²å’ŒåªåŒ…æ‹¬ä¸€ä¸ª\"æ–°è¡Œ\"çš„å­—ç¬¦ä¸²ã€‚\nPHPçš„æ­£è§„è¡¨è¾¾å¼æœ‰ä¸€äº›å†…ç½®çš„é€šç”¨å­—ç¬¦ç°‡ï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š\n\nå­—ç¬¦ç°‡|\tæè¿°\n-|-\n[[:alpha:]]\t|ä»»ä½•å­—æ¯\n[[:digit:]]\t|ä»»ä½•æ•°å­—\n[[:alnum:]]\t|ä»»ä½•å­—æ¯å’Œæ•°å­—\n[[:space:]]\t|ä»»ä½•ç©ºç™½å­—ç¬¦\n[[:upper:]]\t|ä»»ä½•å¤§å†™å­—æ¯\n[[:lower:]]\t|ä»»ä½•å°å†™å­—æ¯\n[[:punct:]]\t|ä»»ä½•æ ‡ç‚¹ç¬¦å·\n[[:xdigit:]]\t|ä»»ä½•16è¿›åˆ¶çš„æ•°å­—ï¼Œç›¸å½“äº[0-9a-fA-F]\n\n#### **4. ç¡®å®šé‡å¤å‡ºç°**\nåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œä½ å·²ç»çŸ¥é“å¦‚ä½•å»åŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–æ•°å­—ï¼Œä½†æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½è¦åŒ¹é…ä¸€ä¸ªå•è¯æˆ–ä¸€ç»„æ•°å­—ã€‚ä¸€ä¸ªå•è¯æœ‰è‹¥å¹²ä¸ªå­—æ¯ç»„æˆï¼Œä¸€ç»„æ•°å­—æœ‰è‹¥å¹²ä¸ªå•æ•°ç»„æˆã€‚è·Ÿåœ¨å­—ç¬¦æˆ–å­—ç¬¦ç°‡åé¢çš„èŠ±æ‹¬å·({})ç”¨æ¥ç¡®å®šå‰é¢çš„å†…å®¹çš„é‡å¤å‡ºç°çš„æ¬¡æ•°ã€‚\n\nå­—ç¬¦ç°‡\t|æè¿°\n-|-\n^[a-zA-Z_]$\t|æ‰€æœ‰çš„å­—æ¯å’Œä¸‹åˆ’çº¿\n^[[:alpha:]]{3}$|\tæ‰€æœ‰çš„3ä¸ªå­—æ¯çš„å•è¯\n^a$\t|å­—æ¯a\n^a{4}$|\taaaa\n^a{2,4}$\t|aa,aaaæˆ–aaaa\n^a{1,3}$\t|a,aaæˆ–aaa\n^a{2,}$\t|åŒ…å«å¤šäºä¸¤ä¸ªaçš„å­—ç¬¦ä¸²\n^a{2,}\t|å¦‚ï¼šaardvarkå’Œaaabï¼Œä½†appleä¸è¡Œ\na{2,}\t|å¦‚ï¼šbaadå’Œaaaï¼Œä½†Nantucketä¸è¡Œ\n\\t{2}\t|ä¸¤ä¸ªåˆ¶è¡¨ç¬¦\n.{2}\t|æ‰€æœ‰çš„ä¸¤ä¸ªå­—ç¬¦\n\nè¿™äº›ä¾‹å­æè¿°äº†èŠ±æ‹¬å·çš„ä¸‰ç§ä¸åŒçš„ç”¨æ³•ã€‚ä¸€ä¸ªæ•°å­— {x} çš„æ„æ€**æ˜¯å‰é¢çš„å­—ç¬¦æˆ–å­—ç¬¦ç°‡åªå‡ºç°xæ¬¡** ï¼›ä¸€ä¸ªæ•°å­—åŠ é€—å·** {x,}** çš„æ„æ€æ˜¯**å‰é¢çš„å†…å®¹å‡ºç°xæˆ–æ›´å¤šçš„æ¬¡æ•°** ï¼›ä¸¤ä¸ªæ•°å­—ç”¨é€—å·åˆ†éš”çš„æ•°å­—** {x,y}** è¡¨ç¤º **å‰é¢çš„å†…å®¹è‡³å°‘å‡ºç°xæ¬¡ï¼Œä½†ä¸è¶…è¿‡yæ¬¡**ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ¨¡å¼æ‰©å±•åˆ°æ›´å¤šçš„å•è¯æˆ–æ•°å­—ï¼š\n>^[a-zA-Z0-9_]{1,}$      // æ‰€æœ‰åŒ…å«ä¸€ä¸ªä»¥ä¸Šçš„å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿çš„å­—ç¬¦ä¸² \n^[1-9][0-9]{0,}$        // æ‰€æœ‰çš„æ­£æ•´æ•° \n^\\-{0,1}[0-9]{1,}$      // æ‰€æœ‰çš„æ•´æ•° \n^[-]?[0-9]+\\.?[0-9]+$   // æ‰€æœ‰çš„æµ®ç‚¹æ•°\n\næœ€åä¸€ä¸ªä¾‹å­ä¸å¤ªå¥½ç†è§£ï¼Œæ˜¯å—ï¼Ÿè¿™ä¹ˆçœ‹å§ï¼šä»¥ä¸€ä¸ªå¯é€‰çš„è´Ÿå· (**[-]?**) å¼€å¤´ (^)ã€è·Ÿç€1ä¸ªæˆ–æ›´å¤šçš„æ•°å­—(**[0-9]+**)ã€å’Œä¸€ä¸ªå°æ•°ç‚¹(\\.)å†è·Ÿä¸Š1ä¸ªæˆ–å¤šä¸ªæ•°å­—(**[0-9]+**)ï¼Œå¹¶ä¸”åé¢æ²¡æœ‰å…¶ä»–ä»»ä½•ä¸œè¥¿(**$**)ã€‚ä¸‹é¢ä½ å°†çŸ¥é“èƒ½å¤Ÿä½¿ç”¨çš„æ›´ä¸ºç®€å•çš„æ–¹æ³•ã€‚\n\nç‰¹æ®Šå­—ç¬¦** ?** ä¸ **{0,1}** æ˜¯ç›¸ç­‰çš„ï¼Œå®ƒä»¬éƒ½ä»£è¡¨ç€ï¼š **0ä¸ªæˆ–1ä¸ªå‰é¢çš„å†…å®¹** æˆ– **å‰é¢çš„å†…å®¹æ˜¯å¯é€‰çš„** ã€‚æ‰€ä»¥åˆšæ‰çš„ä¾‹å­å¯ä»¥ç®€åŒ–ä¸ºï¼š\n>^\\-?[0-9]{1,}\\.?[0-9]{1,}$\n\nç‰¹æ®Šå­—ç¬¦ ***** ä¸ **{0,}** æ˜¯ç›¸ç­‰çš„ï¼Œå®ƒä»¬éƒ½ä»£è¡¨ç€ **0 ä¸ªæˆ–å¤šä¸ªå‰é¢çš„å†…å®¹** ã€‚æœ€åï¼Œå­—ç¬¦ **+** ä¸ **{1,}** æ˜¯ç›¸ç­‰çš„ï¼Œè¡¨ç¤º **1 ä¸ªæˆ–å¤šä¸ªå‰é¢çš„å†…å®¹** ï¼Œæ‰€ä»¥ä¸Šé¢çš„4ä¸ªä¾‹å­å¯ä»¥å†™æˆï¼š\n>^[a-zA-Z0-9_]+\\$      // æ‰€æœ‰åŒ…å«ä¸€ä¸ªä»¥ä¸Šçš„å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿çš„å­—ç¬¦ä¸² \n^[1-9][0-9]*\\$        // æ‰€æœ‰çš„æ­£æ•´æ•° \n^\\-?[0-9]+\\$          // æ‰€æœ‰çš„æ•´æ•° \n^\\-?[0-9]+\\.?[0-9]*\\$ // æ‰€æœ‰çš„æµ®ç‚¹æ•°\n\nå½“ç„¶è¿™å¹¶ä¸èƒ½ä»æŠ€æœ¯ä¸Šé™ä½æ­£è§„è¡¨è¾¾å¼çš„å¤æ‚æ€§ï¼Œä½†å¯ä»¥ä½¿å®ƒä»¬æ›´å®¹æ˜“é˜…è¯»ã€‚\n\n## **ä¸ƒ. ç¤ºä¾‹**\n\n#### **1. ç®€å•è¡¨è¾¾å¼**\næ­£åˆ™è¡¨è¾¾å¼çš„æœ€ç®€å•å½¢å¼æ˜¯åœ¨æœç´¢å­—ç¬¦ä¸²ä¸­åŒ¹é…å…¶æœ¬èº«çš„å•ä¸ªæ™®é€šå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå•å­—ç¬¦æ¨¡å¼ï¼Œå¦‚ Aï¼Œä¸è®ºå‡ºç°åœ¨æœç´¢å­—ç¬¦ä¸²ä¸­çš„ä½•å¤„ï¼Œå®ƒæ€»æ˜¯åŒ¹é…å­—æ¯ Aã€‚ä¸‹é¢æ˜¯ä¸€äº›å•å­—ç¬¦æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„ç¤ºä¾‹ï¼š\n>/a/\n/7/\n/M/\n\nå¯ä»¥å°†è®¸å¤šå•å­—ç¬¦ç»„åˆèµ·æ¥ä»¥å½¢æˆå¤§çš„è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ç»„åˆäº†å•å­—ç¬¦è¡¨è¾¾å¼ï¼šaã€7 å’Œ Mã€‚\n> /a7M/\n\nè¯·æ³¨æ„ï¼Œæ²¡æœ‰ä¸²è”è¿ç®—ç¬¦ã€‚åªé¡»åœ¨ä¸€ä¸ªå­—ç¬¦åé¢é”®å…¥å¦ä¸€ä¸ªå­—ç¬¦ã€‚\n\n#### **2. å­—ç¬¦åŒ¹é…**\n\nå¥ç‚¹ (.) åŒ¹é…å­—ç¬¦ä¸²ä¸­çš„å„ç§æ‰“å°æˆ–éæ‰“å°å­—ç¬¦ï¼Œåªæœ‰ä¸€ä¸ªå­—ç¬¦ä¾‹å¤–ã€‚è¿™ä¸ªä¾‹å¤–å°±æ˜¯æ¢è¡Œç¬¦ (\\n)ã€‚ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… aacã€abcã€accã€adc ç­‰ç­‰ï¼Œä»¥åŠ a1cã€a2cã€a-c å’Œ a#cï¼š\n> /a.c/\n\nè‹¥è¦åŒ¹é…åŒ…å«æ–‡ä»¶åçš„å­—ç¬¦ä¸²ï¼Œè€Œå¥ç‚¹ (.) æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„ç»„æˆéƒ¨åˆ†ï¼Œè¯·åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å¥ç‚¹å‰é¢åŠ åæ–œæ‰› (\\) å­—ç¬¦ã€‚ä¸¾ä¾‹æ¥è¯´æ˜ï¼Œä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… filename.extï¼š\n> /filename\\.ext/\n\nè¿™äº›è¡¨è¾¾å¼åªè®©æ‚¨åŒ¹é…\"ä»»ä½•\"å•ä¸ªå­—ç¬¦ã€‚å¯èƒ½éœ€è¦åŒ¹é…åˆ—è¡¨ä¸­çš„ç‰¹å®šå­—ç¬¦ç»„ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½éœ€è¦æŸ¥æ‰¾ç”¨æ•°å­—è¡¨ç¤ºçš„ç« èŠ‚æ ‡é¢˜ï¼ˆChapter 1ã€Chapter 2 ç­‰ç­‰ï¼‰ã€‚\n\n#### **3. ä¸­æ‹¬å·è¡¨è¾¾å¼**\n\nè‹¥è¦åˆ›å»ºåŒ¹é…å­—ç¬¦ç»„çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯·åœ¨æ–¹æ‹¬å·ï¼ˆ[ å’Œ ]ï¼‰å†…æ”¾ç½®ä¸€ä¸ªæˆ–æ›´å¤šå•ä¸ªå­—ç¬¦ã€‚å½“å­—ç¬¦æ‹¬åœ¨ä¸­æ‹¬å·å†…æ—¶ï¼Œè¯¥åˆ—è¡¨ç§°ä¸º\"ä¸­æ‹¬å·è¡¨è¾¾å¼\"ã€‚ä¸åœ¨ä»»ä½•åˆ«çš„ä½ç½®ä¸€æ ·ï¼Œæ™®é€šå­—ç¬¦åœ¨ä¸­æ‹¬å·å†…è¡¨ç¤ºå…¶æœ¬èº«ï¼Œå³ï¼Œå®ƒåœ¨è¾“å…¥æ–‡æœ¬ä¸­åŒ¹é…ä¸€æ¬¡å…¶æœ¬èº«ã€‚å¤§å¤šæ•°ç‰¹æ®Šå­—ç¬¦åœ¨ä¸­æ‹¬å·è¡¨è¾¾å¼å†…å‡ºç°æ—¶å¤±å»å®ƒä»¬çš„æ„ä¹‰ã€‚ä¸è¿‡ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼Œå¦‚ï¼š\n\n - å¦‚æœ ] å­—ç¬¦ä¸æ˜¯ç¬¬ä¸€é¡¹ï¼Œå®ƒç»“æŸä¸€ä¸ªåˆ—è¡¨ã€‚è‹¥è¦åŒ¹é…åˆ—è¡¨ä¸­çš„ ] å­—ç¬¦ï¼Œè¯·å°†å®ƒæ”¾åœ¨ç¬¬ä¸€ä½ï¼Œç´§è·Ÿåœ¨å¼€å§‹ [ åé¢ã€‚\n - \\ å­—ç¬¦ç»§ç»­ä½œä¸ºè½¬ä¹‰ç¬¦ã€‚è‹¥è¦åŒ¹é… \\ å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ \\\\\\ã€‚\n\næ‹¬åœ¨ä¸­æ‹¬å·è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦åªåŒ¹é…å¤„äºæ­£åˆ™è¡¨è¾¾å¼ä¸­è¯¥ä½ç½®çš„å•ä¸ªå­—ç¬¦ã€‚ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… Chapter 1ã€Chapter 2ã€Chapter 3ã€Chapter 4 å’Œ Chapter 5ï¼š\n>/Chapter [12345]/\n\nè¯·æ³¨æ„ï¼Œå•è¯ Chapter å’Œåé¢çš„ç©ºæ ¼çš„ä½ç½®ç›¸å¯¹äºä¸­æ‹¬å·å†…çš„å­—ç¬¦æ˜¯å›ºå®šçš„ã€‚ä¸­æ‹¬å·è¡¨è¾¾å¼æŒ‡å®šçš„åªæ˜¯åŒ¹é…ç´§è·Ÿåœ¨å•è¯ Chapter å’Œç©ºæ ¼åé¢çš„å•ä¸ªå­—ç¬¦ä½ç½®çš„å­—ç¬¦é›†ã€‚è¿™æ˜¯ç¬¬ä¹ä¸ªå­—ç¬¦ä½ç½®ã€‚\nè‹¥è¦ä½¿ç”¨èŒƒå›´ä»£æ›¿å­—ç¬¦æœ¬èº«æ¥è¡¨ç¤ºåŒ¹é…å­—ç¬¦ç»„ï¼Œè¯·ä½¿ç”¨è¿å­—ç¬¦ (-) å°†èŒƒå›´ä¸­çš„å¼€å§‹å­—ç¬¦å’Œç»“æŸå­—ç¬¦åˆ†å¼€ã€‚å•ä¸ªå­—ç¬¦çš„å­—ç¬¦å€¼ç¡®å®šèŒƒå›´å†…çš„ç›¸å¯¹é¡ºåºã€‚ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ…å«èŒƒå›´è¡¨è¾¾å¼ï¼Œè¯¥èŒƒå›´è¡¨è¾¾å¼ç­‰æ•ˆäºä¸Šé¢æ˜¾ç¤ºçš„ä¸­æ‹¬å·ä¸­çš„åˆ—è¡¨ã€‚\n> /Chapter [1-5]/\n\nå½“ä»¥è¿™ç§æ–¹å¼æŒ‡å®šèŒƒå›´æ—¶ï¼Œå¼€å§‹å€¼å’Œç»“æŸå€¼ä¸¤è€…éƒ½åŒ…æ‹¬åœ¨èŒƒå›´å†…ã€‚æ³¨æ„ï¼Œè¿˜æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼ŒæŒ‰ Unicode æ’åºé¡ºåºï¼Œå¼€å§‹å€¼å¿…é¡»åœ¨ç»“æŸå€¼çš„å‰é¢ã€‚\nè‹¥è¦åœ¨ä¸­æ‹¬å·è¡¨è¾¾å¼ä¸­åŒ…æ‹¬è¿å­—ç¬¦ï¼Œè¯·é‡‡ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€ï¼š\n\n - ç”¨åæ–œæ‰›å°†å®ƒè½¬ä¹‰ï¼š\n>[\\-]\n \n - å°†è¿å­—ç¬¦æ”¾åœ¨ä¸­æ‹¬å·åˆ—è¡¨çš„å¼€å§‹æˆ–ç»“å°¾ã€‚ä¸‹é¢çš„è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰å°å†™å­—æ¯å’Œè¿å­—ç¬¦ï¼š\n>[-a-z]\n[a-z-]\n \n - åˆ›å»ºä¸€ä¸ªèŒƒå›´ï¼Œåœ¨è¯¥èŒƒå›´ä¸­ï¼Œå¼€å§‹å­—ç¬¦å€¼å°äºè¿å­—ç¬¦ï¼Œè€Œç»“æŸå­—ç¬¦å€¼ç­‰äºæˆ–å¤§äºè¿å­—ç¬¦ã€‚ä¸‹é¢çš„ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æ»¡è¶³è¿™ä¸€è¦æ±‚ï¼š\n>[!--]\n[!-~]\n\nè‹¥è¦æŸ¥æ‰¾ä¸åœ¨åˆ—è¡¨æˆ–èŒƒå›´å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œè¯·å°†æ’å…¥ç¬¦å· (^) æ”¾åœ¨åˆ—è¡¨çš„å¼€å¤´ã€‚å¦‚æœæ’å…¥å­—ç¬¦å‡ºç°åœ¨åˆ—è¡¨ä¸­çš„å…¶ä»–ä»»ä½•ä½ç½®ï¼Œåˆ™å®ƒåŒ¹é…å…¶æœ¬èº«ã€‚ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…1ã€2ã€3ã€4 æˆ– 5 ä¹‹å¤–çš„ä»»ä½•æ•°å­—å’Œå­—ç¬¦ï¼š\n\n> /Chapter [^12345]/\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¡¨è¾¾å¼åœ¨ç¬¬ä¹ä¸ªä½ç½®åŒ¹é… 1ã€2ã€3ã€4 æˆ– 5 ä¹‹å¤–çš„ä»»ä½•æ•°å­—å’Œå­—ç¬¦ã€‚è¿™æ ·ï¼Œä¾‹å¦‚ï¼ŒChapter 7 å°±æ˜¯ä¸€ä¸ªåŒ¹é…é¡¹ï¼ŒChapter 9 ä¹Ÿæ˜¯ä¸€ä¸ªåŒ¹é…é¡¹ã€‚\nä¸Šé¢çš„è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨è¿å­—ç¬¦ (-) æ¥è¡¨ç¤ºï¼š\n> /Chapter [^1-5]/\n\nä¸­æ‹¬å·è¡¨è¾¾å¼çš„å…¸å‹ç”¨é€”æ˜¯æŒ‡å®šä»»ä½•å¤§å†™æˆ–å°å†™å­—æ¯æˆ–ä»»ä½•æ•°å­—çš„åŒ¹é…ã€‚ä¸‹é¢çš„è¡¨è¾¾å¼æŒ‡å®šè¿™æ ·çš„åŒ¹é…ï¼š\n> /[A-Za-z0-9]/\n\n#### **4. æ›¿æ¢å’Œåˆ†ç»„**\n\næ›¿æ¢ä½¿ç”¨ | å­—ç¬¦æ¥å…è®¸åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªæ›¿æ¢é€‰é¡¹ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ‰©å±•ç« èŠ‚æ ‡é¢˜æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥è¿”å›æ¯”ç« æ ‡é¢˜èŒƒå›´æ›´å¹¿çš„åŒ¹é…é¡¹ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸è±¡æ‚¨å¯èƒ½è®¤ä¸ºçš„é‚£æ ·ç®€å•ã€‚æ›¿æ¢åŒ¹é… | å­—ç¬¦ä»»ä¸€ä¾§æœ€å¤§çš„è¡¨è¾¾å¼ã€‚\næ‚¨å¯èƒ½è®¤ä¸ºï¼Œä¸‹é¢çš„è¡¨è¾¾å¼åŒ¹é…å‡ºç°åœ¨è¡Œé¦–å’Œè¡Œå°¾ã€åé¢è·Ÿä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å­—çš„ Chapter æˆ– Sectionï¼š\n> /^Chapter|Section [1-9][0-9]{0,1}$/\n\nå¾ˆé—æ†¾ï¼Œä¸Šé¢çš„æ­£åˆ™è¡¨è¾¾å¼è¦ä¹ˆåŒ¹é…è¡Œé¦–çš„å•è¯ Chapterï¼Œè¦ä¹ˆåŒ¹é…è¡Œå°¾çš„å•è¯ Section åŠè·Ÿåœ¨å…¶åçš„ä»»ä½•æ•°å­—ã€‚å¦‚æœè¾“å…¥å­—ç¬¦ä¸²æ˜¯ Chapter 22ï¼Œé‚£ä¹ˆä¸Šé¢çš„è¡¨è¾¾å¼åªåŒ¹é…å•è¯ Chapterã€‚å¦‚æœè¾“å…¥å­—ç¬¦ä¸²æ˜¯ Section 22ï¼Œé‚£ä¹ˆè¯¥è¡¨è¾¾å¼åŒ¹é… Section 22ã€‚\nè‹¥è¦ä½¿æ­£åˆ™è¡¨è¾¾å¼æ›´æ˜“äºæ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨æ‹¬å·æ¥é™åˆ¶æ›¿æ¢çš„èŒƒå›´ï¼Œå³ï¼Œç¡®ä¿å®ƒåªåº”ç”¨äºä¸¤ä¸ªå•è¯ Chapter å’Œ Sectionã€‚ä½†æ˜¯ï¼Œæ‹¬å·ä¹Ÿç”¨äºåˆ›å»ºå­è¡¨è¾¾å¼ï¼Œå¹¶å¯èƒ½æ•è·å®ƒä»¬ä»¥ä¾›ä»¥åä½¿ç”¨ï¼Œè¿™ä¸€ç‚¹åœ¨æœ‰å…³åå‘å¼•ç”¨çš„é‚£ä¸€èŠ‚è®²è¿°ã€‚é€šè¿‡åœ¨ä¸Šé¢çš„æ­£åˆ™è¡¨è¾¾å¼çš„é€‚å½“ä½ç½®æ·»åŠ æ‹¬å·ï¼Œå°±å¯ä»¥ä½¿è¯¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… Chapter 1 æˆ– Section 3ã€‚\nä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨æ‹¬å·æ¥ç»„åˆ Chapter å’Œ Sectionï¼Œä»¥ä¾¿è¡¨è¾¾å¼æ­£ç¡®åœ°èµ·ä½œç”¨ï¼š\n> /^(Chapter|Section) [1-9][0-9]{0,1}$/\n\nå°½ç®¡è¿™äº›è¡¨è¾¾å¼æ­£å¸¸å·¥ä½œï¼Œä½† Chapter|Section å‘¨å›´çš„æ‹¬å·è¿˜å°†æ•è·ä¸¤ä¸ªåŒ¹é…å­—ä¸­çš„ä»»ä¸€ä¸ªä¾›ä»¥åä½¿ç”¨ã€‚ç”±äºåœ¨ä¸Šé¢çš„è¡¨è¾¾å¼ä¸­åªæœ‰ä¸€ç»„æ‹¬å·ï¼Œå› æ­¤ï¼Œåªæœ‰ä¸€ä¸ªè¢«æ•è·çš„\"å­åŒ¹é…é¡¹\"ã€‚\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨åªéœ€è¦ä½¿ç”¨æ‹¬å·æ¥ç»„åˆå•è¯ Chapter å’Œ Section ä¹‹é—´çš„é€‰æ‹©ã€‚è‹¥è¦é˜²æ­¢åŒ¹é…è¢«ä¿å­˜ä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼Œè¯·åœ¨æ‹¬å·å†…æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¹‹å‰æ”¾ç½® ?:ã€‚ä¸‹é¢çš„ä¿®æ”¹æä¾›ç›¸åŒçš„èƒ½åŠ›è€Œä¸ä¿å­˜å­åŒ¹é…é¡¹ï¼š\n> /^(?:Chapter|Section) [1-9][0-9]{0,1}$/\n\né™¤ ?: å…ƒå­—ç¬¦å¤–ï¼Œä¸¤ä¸ªå…¶ä»–éæ•è·å…ƒå­—ç¬¦åˆ›å»ºè¢«ç§°ä¸º\"é¢„æµ‹å…ˆè¡Œ\"åŒ¹é…çš„æŸäº›å†…å®¹ã€‚æ­£å‘é¢„æµ‹å…ˆè¡Œä½¿ç”¨ ?= æŒ‡å®šï¼Œå®ƒåŒ¹é…å¤„äºæ‹¬å·ä¸­åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼çš„èµ·å§‹ç‚¹çš„æœç´¢å­—ç¬¦ä¸²ã€‚åå‘é¢„æµ‹å…ˆè¡Œä½¿ç”¨ ?! æŒ‡å®šï¼Œå®ƒåŒ¹é…å¤„äºä¸æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸åŒ¹é…çš„å­—ç¬¦ä¸²çš„èµ·å§‹ç‚¹çš„æœç´¢å­—ç¬¦ä¸²ã€‚\n<br>\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªæ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£åŒ…å«æŒ‡å‘ Windows 3.1ã€Windows 95ã€Windows 98 å’Œ Windows NT çš„å¼•ç”¨ã€‚å†è¿›ä¸€æ­¥å‡è®¾ï¼Œæ‚¨éœ€è¦æ›´æ–°è¯¥æ–‡æ¡£ï¼Œå°†æŒ‡å‘ Windows 95ã€Windows 98 å’Œ Windows NT çš„æ‰€æœ‰å¼•ç”¨æ›´æ”¹ä¸º Windows 2000ã€‚ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ­£å‘é¢„æµ‹å…ˆè¡Œçš„ç¤ºä¾‹ï¼‰åŒ¹é… Windows 95ã€Windows 98 å’Œ Windows NTï¼š\n> /Windows(?=95 |98 |NT )/\n\næ‰¾åˆ°ä¸€å¤„åŒ¹é…åï¼Œç´§æ¥ç€å°±åœ¨åŒ¹é…çš„æ–‡æœ¬ï¼ˆä¸åŒ…æ‹¬é¢„æµ‹å…ˆè¡Œä¸­çš„å­—ç¬¦ï¼‰ä¹‹åæœç´¢ä¸‹ä¸€å¤„åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸Šé¢çš„è¡¨è¾¾å¼åŒ¹é… Windows 98ï¼Œå°†åœ¨ Windows ä¹‹åè€Œä¸æ˜¯åœ¨ 98 ä¹‹åç»§ç»­æœç´¢ã€‚\n\n#### **5. å…¶ä»–ç¤ºä¾‹**\n\nä¸‹é¢åˆ—å‡ºä¸€äº›æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹ï¼š\n\næ­£åˆ™è¡¨è¾¾å¼\t|æè¿°\n-| -\n/\\b([a-z]+) \\1\\b/gi\t|ä¸€ä¸ªå•è¯è¿ç»­å‡ºç°çš„ä½ç½®ã€‚\n/(\\w+):\\/\\/([^/:]+)(:\\d*)?([^# ]*)/\t|å°†ä¸€ä¸ªURLè§£æä¸ºåè®®ã€åŸŸã€ç«¯å£åŠç›¸å¯¹è·¯å¾„ã€‚\n/^(?:Chapter\\|Section) [1-9][0-9]{0,1}\\$/\t|å®šä½ç« èŠ‚çš„ä½ç½®ã€‚\n/[-a-z]/\t|aè‡³zå…±26ä¸ªå­—æ¯å†åŠ ä¸€ä¸ª-å·ã€‚\n/ter\\b/\t|å¯åŒ¹é…chapterï¼Œè€Œä¸èƒ½åŒ¹é…terminalã€‚\n/\\Bapt/\t|å¯åŒ¹é…chapterï¼Œè€Œä¸èƒ½åŒ¹é…aptitudeã€‚\n/Windows(?=95 \\|98 \\|NT )/\t|å¯åŒ¹é…Windows95æˆ–Windows98æˆ–WindowsNTï¼Œå½“æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…åï¼Œä»Windowsåé¢å¼€å§‹è¿›è¡Œä¸‹ä¸€æ¬¡çš„æ£€ç´¢åŒ¹é…ã€‚\n/^\\s*$/\t|åŒ¹é…ç©ºè¡Œã€‚\n/\\d{2}-\\d{5}/\t|éªŒè¯ç”±ä¸¤ä½æ•°å­—ã€ä¸€ä¸ªè¿å­—ç¬¦å†åŠ  5 ä½æ•°å­—ç»„æˆçš„ ID å·ã€‚\n/<\\s*(\\S+)(\\s[^>]*)?>[\\s\\S]*<\\s*\\/\\1\\s*>/\t|åŒ¹é… HTML æ ‡è®°ã€‚","tags":["æ­£åˆ™è¡¨è¾¾å¼"],"categories":["æ­£åˆ™"]}]