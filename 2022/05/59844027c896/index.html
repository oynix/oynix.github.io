<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"oynix.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gittabl","storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="上篇文章简单说了OkHttp的使用，这篇来说Retrofit。同样，Retrofit也是Square公司出品。">
<meta property="og:type" content="article">
<meta property="og:title" content="Retrofit使用">
<meta property="og:url" content="https://oynix.github.io/2022/05/59844027c896/index.html">
<meta property="og:site_name" content="oynix">
<meta property="og:description" content="上篇文章简单说了OkHttp的使用，这篇来说Retrofit。同样，Retrofit也是Square公司出品。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-05-02T05:12:43.000Z">
<meta property="article:modified_time" content="2022-07-21T12:11:29.930Z">
<meta property="article:author" content="oynix">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Retrofit">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://oynix.github.io/2022/05/59844027c896/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Retrofit使用 | oynix</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDBNTK34GB"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDBNTK34GB');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="oynix" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">oynix</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">人生需要一些摸鱼时刻，做什么都可以，不做什么也可以</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">96</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">28</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">126</span></a>

  </li>
        <li class="menu-item menu-item-message">

    <a href="/message/" rel="section"><i class="fas fa-envelope-open-text fa-fw"></i>留言板</a>

  </li>
        <li class="menu-item menu-item-articles">

    <a href="/articles/" rel="section"><i class="fa fa-blog fa-fw"></i>技术博客</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL295bml4" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://oynix.github.io/2022/05/59844027c896/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fbb.jpg">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Retrofit使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-02 13:12:43" itemprop="dateCreated datePublished" datetime="2022-05-02T13:12:43+08:00">2022-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>上篇文章简单说了OkHttp的使用，这篇来说Retrofit。同样，Retrofit也是Square公司出品。</p>
<span id="more"></span>

<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NxdWFyZS9yZXRyb2ZpdA==">Retrofit Github地址<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>在OkHttp的封装下，我们发送网络请求方便了很多，省去了很多重复性的样板代码。而Retrofit的作用，是进一步减少样板代码量，比如发送POST请求时，每次都需要将参数转化成JSON格式，添加到Body中，发送到服务器。接收回应时，每次也是需要先将Response里的Body解析成类，然后从中读取需要的参数。Retrofit通过注解的形式，将这些重复性的工作也省去了。</p>
<p>Retrofit中使用了大量的注解，请求方式、请求参数等均使用注解来标明，记住这些注解，基本就掌握了用法。</p>
<h3 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h3><p>是用Retrofit大致分为4个步骤</p>
<ul>
<li>创建Retrofit实例<br>Retrofit支持配置一些选项，比如CallAdapter、Converter等</li>
<li>创建请求API的接口<br>这里只需要写接口，而不需要写具体实现，Retrofit使用动态代理的方式，来满足调用者</li>
<li>生成请求API的实例<br>通过第一步中生成的Retrofit实例，来生成上一步中接口的实例</li>
<li>通过请求API的实例发送请求<br>使用上一步中的实例，就可以发送网络请求了</li>
</ul>
<h3 id="3-示例"><a href="#3-示例" class="headerlink" title="3. 示例"></a>3. 示例</h3><p>看了上面的步骤会觉得很抽象，下面举个简单的例子，就会很具体了。比如，通过GET获取用户信息，通过POST更新用户名称。</p>
<p>这是一个用来描述用户的类，只有两个字段，一个是id，一个用户名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 描述用户的信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一步，创建一个Retrofit的实例，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">                        .baseUrl(<span class="string">&quot;https://useinfo.hostname.com/&quot;</span>)</span><br><span class="line">                        .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以手动增加一些配置，这里添加了一个Gson的转换器，和一个RxJava的CallAdapter，后面介绍</span></span><br><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">                        .baseUrl(<span class="string">&quot;https://useinfo.hostname.com/&quot;</span>)</span><br><span class="line">                        .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                        .addCallAdapterFactory(RxJavaCallAdapterFactory.create())</span><br><span class="line">                        .build();</span><br></pre></td></tr></table></figure>
<p>第二步，创建请求API的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserApi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GET(&quot;user/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;UserInfo&gt; <span class="title">getInfo</span><span class="params">(<span class="meta">@Path(&quot;userId&quot;)</span> <span class="keyword">int</span> userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST(&quot;user&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;String&gt; <span class="title">updateUser</span><span class="params">(<span class="meta">@Body</span> UserInfo user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三步，生成请求API的实例，因为上面的请求API还只是接口，并不能直接用，要先生成实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserApi api = retrofit.create(UserApi.class);</span><br></pre></td></tr></table></figure>
<p>最后一步，用实例发送请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line">UserInfo user = api.getInfo(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更改用户名字</span></span><br><span class="line">user.name = <span class="string">&quot;new Name&quot;</span>;</span><br><span class="line">String message = api.updateUser(user);</span><br></pre></td></tr></table></figure>

<p>以上，便是一个简单的调用，可以看到的是，确实都是注解堆起来的，所以，下面看看都有哪些注解，每个注解的用法。</p>
<h3 id="4-注解"><a href="#4-注解" class="headerlink" title="4. 注解"></a>4. 注解</h3><p>注解可以分为3类：网络请求方法类、标记类和网络请求参数类。</p>
<ul>
<li>网络请求方法<br>可以说Retrofit是RESTful风格请求的封装，注解和请求方式一一对应<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@PUT</span></span><br><span class="line"><span class="meta">@DELETE</span></span><br><span class="line"><span class="meta">@PATCH</span></span><br><span class="line"><span class="meta">@HEAD</span></span><br><span class="line"><span class="meta">@OPTIONS</span></span><br><span class="line"><span class="meta">@HTTP</span>：自定义HTTP请求 <span class="meta">@HTTP(method = &quot;DELETE&quot;, path = &quot;remove/&quot;, hasBody = true)</span></span><br></pre></td></tr></table></figure>
使用这些注解，便可以标明一个方法的网络请求方法，注解接收一个参数，表明请求的路径，就像上面例子中的那样。Retrofit将URL分成了两部分，第一部分是主机地址，在创建Retrofit时配置的baseUrl，另一部分就是每个请求的具体路径，最终的请求URL就是base后面接上请求方法里的路径，后面会单独说这里要注意的地方</li>
<li>标记类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FormUrlEncoded</span>：表明是Form表单，需要和<span class="meta">@Field</span>搭配使用，参数使用<span class="meta">@Field</span>修饰</span><br><span class="line"><span class="meta">@Multipart</span>：表明body是multi-part，需要和<span class="meta">@Part</span>搭配使用，参数使用<span class="meta">@Part</span>修饰</span><br><span class="line"><span class="meta">@Streaming</span>：表示数据以流的形式返回，适用于返回数据较大的场景，如果不标记，默认把数据全部载入内存，取数据是从内存取</span><br></pre></td></tr></table></figure>
这几个注解是用来标记方法的。</li>
<li>网络请求参数<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Header</span>：<span class="function">Call&lt;ResponseBody&gt; <span class="title">foo</span><span class="params">(<span class="meta">@Header(&quot;Accept-Language&quot;)</span> String lang)</span></span></span><br><span class="line"><span class="function">@Headers：与上面不同，这个注解标记方法</span></span><br><span class="line"><span class="function">@Url：使用这个注解将忽略baseUrl配置  Call&lt;ResponseBody&gt; <span class="title">list</span><span class="params">(<span class="meta">@Url</span> String url)</span></span>;</span><br><span class="line"><span class="meta">@Body</span>：是用Converter将参数写入到请求body中</span><br><span class="line"><span class="meta">@Path</span>：请求路径的中的参数    <span class="meta">@GET(&quot;/image/&#123;id&#125;&quot;)</span> <span class="function">Call&lt;ResponseBody&gt; <span class="title">example</span><span class="params">(<span class="meta">@Path(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>;</span><br><span class="line"><span class="meta">@Field</span>：form表单的参数 <span class="meta">@FormUrlEncoded</span>  <span class="meta">@POST(&quot;/&quot;)</span> <span class="function">Call&lt;ResponseBody&gt; <span class="title">example</span><span class="params">(<span class="meta">@Field(&quot;name&quot;)</span> String name, <span class="meta">@Field(&quot;occupation&quot;)</span> String occupation)</span></span>;</span><br><span class="line"><span class="meta">@FieldMap</span>：同上，多个参数，修饰<span class="function">Map Call&lt;ResponseBody&gt; <span class="title">things</span><span class="params">(<span class="meta">@FieldMap</span> Map&lt;String, String&gt; fields)</span></span>;</span><br><span class="line"><span class="meta">@Part</span>：这个我很少用，看看Retrofit自己的解释</span><br><span class="line">Denotes a single part of a multi-part request.</span><br><span class="line">The parameter type on which <span class="keyword">this</span> annotation exists will be processed in one of three ways:</span><br><span class="line">If the type is okhttp3.MultipartBody.Part the contents will be used directly. <span class="function">Omit the name from the <span class="title">annotation</span> <span class="params">(i.e., <span class="meta">@Part</span> MultipartBody.Part part)</span>.</span></span><br><span class="line"><span class="function">If the type is RequestBody the value will be used directly with its content type. Supply the part name in the <span class="title">annotation</span> <span class="params">(e.g., <span class="meta">@Part(&quot;foo&quot;)</span> RequestBody foo)</span>.</span></span><br><span class="line"><span class="function">Other object types will be converted to an appropriate representation by using a converter. Supply the part name in the <span class="title">annotation</span> <span class="params">(e.g., <span class="meta">@Part(&quot;foo&quot;)</span> Image photo)</span>.</span></span><br><span class="line"><span class="function">Values may be <span class="keyword">null</span> which will omit them from the request body.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">   @Multipart</span></span><br><span class="line"><span class="function">   @<span class="title">POST</span><span class="params">(<span class="string">&quot;/&quot;</span>)</span></span></span><br><span class="line"><span class="function">   Call&lt;ResponseBody&gt; <span class="title">example</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">       <span class="meta">@Part(&quot;description&quot;)</span> String description,</span></span></span><br><span class="line"><span class="params"><span class="function">       <span class="meta">@Part(value = &quot;image&quot;, encoding = &quot;8-bit&quot;)</span> RequestBody image)</span></span>;</span><br><span class="line">   </span><br><span class="line">Part parameters may not be <span class="keyword">null</span>.</span><br><span class="line"><span class="meta">@PartMap</span>：同上，修饰Map</span><br><span class="line"><span class="meta">@Query</span>：添加GET请求URL中的参数 例如：user?id=<span class="number">23</span>&amp;name=John  <span class="meta">@GET(&quot;/friends&quot;)</span> <span class="function">Call&lt;ResponseBody&gt; <span class="title">friends</span><span class="params">(<span class="meta">@Query(&quot;page&quot;)</span> <span class="keyword">int</span> page)</span></span>;</span><br><span class="line"><span class="meta">@QueryMap</span>：同上，修饰Map</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-请求的最终URL"><a href="#5-请求的最终URL" class="headerlink" title="5. 请求的最终URL"></a>5. 请求的最终URL</h3><p>Retrofit会根据请求方法注解(@GET, @POST等)里面的路径参数动态生成最终的URL，对于Retrofit的baseUrl配置项，有两种形式，当以斜杠<code>/</code>结尾时是目录形式，当以非斜杠结尾时是文件形式，这两种形式是不同的，对于请求方法注解中写的路径，以斜杠<code>/</code>开头表示绝对路径和不以斜杠开头表示相对路径，这两种形式也是不同的。</p>
<p>所以在生成最终的请求URL时就会有多种情况：</p>
<ul>
<li>情况一，请求方法中写的是https/http开头的完整URL，这时Retrofit不会使用配置的baseUrl，而是直接使用请求方法注解里的值，当所有请求都写的完整请求URL，那么这时候可以不配置baseUrl</li>
<li>情况二，路径使用的绝对路径，也就是以斜杠<code>/</code>开头，那么这时不管baseUrl是哪种形式，这个路径会直接接到主机和端口后，形成最终的URL<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baseUrl = <span class="string">&quot;https://host:port/a/b&quot;</span></span><br><span class="line">path = <span class="string">&quot;/user&quot;</span></span><br><span class="line">URL = <span class="string">&quot;https://host:port/user&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>情况三，路径是相对路径，baseUrl是目录形式，那么这时候会直接拼接，形成最终URL<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baseUrl = <span class="string">&quot;https://host:port/a/&quot;</span> <span class="comment">// 这里是斜杠结尾，是目录形式</span></span><br><span class="line">path = <span class="string">&quot;user&quot;</span></span><br><span class="line">URL = <span class="string">&quot;https://host:prot/a/user&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>情况四，路径是相对路径，但baseUrl是文件形式，那么这时候路径会接到最后一个文件后，形成最终URL。可以这么理解，因为文件下不能有文件，目录下才能有文件，所以user不能接在a的后面。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baseUrl = <span class="string">&quot;https://host:port/a&quot;</span> <span class="comment">// 注意这里没有斜杠结尾，所以是文件形式</span></span><br><span class="line">path = <span class="string">&quot;user&quot;</span></span><br><span class="line">URL = <span class="string">&quot;https://host:port/user&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>按照RESTful的风格来说，一般常用的是，baseUrl是用目录形式，也就是以斜杠<code>/</code>结尾，路径使用相对路径。</p>
<h3 id="6-CallAdapter"><a href="#6-CallAdapter" class="headerlink" title="6. CallAdapter"></a>6. CallAdapter</h3><p>CallAdapter和Converter是Retrofit中最精妙的设计了，这就好比OkHttp中的责任链，所以，接下来分别看看这两个。</p>
<p>先看CallAdapter，那么它是在适配什么呢？顾名思义，请求适配器，在适配请求的返回值类型。先看下这两个请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Call&lt;User&gt; <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Response&lt;User&gt; <span class="title">getUser</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>都是网络请求，但是返回类型不同，一个是Call，一个是Response，这两种形式Retrofit都是支持的，那么它是怎么做到的呢？没错，就是通过CallAdapter，每个返回类型，都有一个对应的CallAdapter，来将服务器返回的数据转换的成目标类型。目前支持的有Guava、Java8、RxJava，也可以自定义，在创建Retrofit实例时添加进去，即可。上面的例子中便是添加了一个RxJava的CallAdapter，可以直接将结果转换成Observers，可以方便的进行链式调用。</p>
<p>说完它的作用，那么就要看看Retrofit是如何实现的了。</p>
<p>我们写的是请求API接口，并没有具体的实现，调用Retrofit的create(Class)方法时，它实际上生成并返回了一个动态代理，我们调用API实例的方法时，真实调用的代理里的invoke方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service)</span> </span>&#123;</span><br><span class="line">  validateServiceInterface(service);</span><br><span class="line">  <span class="keyword">return</span> (T)</span><br><span class="line">      Proxy.newProxyInstance(service.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[] &#123;service&#125;,</span><br><span class="line">          <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> Platform platform = Platform.get();</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> Object[] emptyArgs = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="meta">@Nullable</span> <span class="function">Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, <span class="meta">@Nullable</span> Object[] args)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">              <span class="comment">// If the method is a method from Object then defer to normal invocation.</span></span><br><span class="line">              <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">                <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">              &#125;</span><br><span class="line">              args = args != <span class="keyword">null</span> ? args : emptyArgs;</span><br><span class="line">              <span class="keyword">return</span> platform.isDefaultMethod(method) ? platform.invokeDefaultMethod(method, service, proxy, args) : loadServiceMethod(method).invoke(args);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>invoke方法很短，就这么几行，看过<code>platform.isDefaultMethod(method)</code>这个方法就知道，如果接口里的方法有默认实现，返回true，否则返回false，这是Java8才开始支持的，之前版本接口方法是不允许有方法体的。我们声明的API接口没有方法体，所有最终都会调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadServiceMethod(method).invoke(args)</span><br></pre></td></tr></table></figure>
<p>所以，只需要看这个方法是如何处理返回值，就知道Retrofit是怎么使用CallAdapter的了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ServiceMethod&lt;?&gt; loadServiceMethod(Method method) &#123;</span><br><span class="line">  ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);</span><br><span class="line">  <span class="keyword">if</span> (result != <span class="keyword">null</span>) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">synchronized</span> (serviceMethodCache) &#123;</span><br><span class="line">    result = serviceMethodCache.get(method);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">      result = ServiceMethod.parseAnnotations(<span class="keyword">this</span>, method);</span><br><span class="line">      serviceMethodCache.put(method, result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofit将接口里的方法，抽象成了一个ServiceMethod类型，这里是做了一个缓存，为接口里的每个方法生成一个ServiceMethod实例，且只生成一个实例，节约资源提高性能。获取到ServiceMethod后，就会调用它的invoke方法，invoke是个抽象方法，它只有在HttpServiceMethod中有实现，而invoke中又调用了另一个抽象方法adopt，adapt里调用的是callAdapter的adapt方法。</p>
<p>总的来说就是，invoke方法调用的是callAdapter的adapt方法，而callAdapter是在构造函数的时候传进去的，意思就是说，在构造好ServiceMethod实例的时候，它所使用的CallAdapter就确定了。那么，看看在构造的时候如何选取的CallAdapter，看上面的代码就知道，ServiceMethod是通过静态方法parseAnnotations创建的，这个方法里又调用了HttpServiceMethod的parseAnnotations方法，也就是说，最终创建的ServiceMethod的是HttpServiceMethod的parseAnnotations方法。</p>
<p>来看HttpServiceMethod的parseAnnotations，这个方法中的CallAdapter，是通过这个方法创建的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;ResponseT, ReturnT&gt; <span class="function">CallAdapter&lt;ResponseT, ReturnT&gt; <span class="title">createCallAdapter</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    Retrofit retrofit, Method method, Type returnType, Annotation[] annotations)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//noinspection unchecked</span></span><br><span class="line">    <span class="keyword">return</span> (CallAdapter&lt;ResponseT, ReturnT&gt;) retrofit.callAdapter(returnType, annotations);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (RuntimeException e) &#123; <span class="comment">// Wide exception range because factories are user code.</span></span><br><span class="line">    <span class="keyword">throw</span> methodError(method, e, <span class="string">&quot;Unable to create call adapter for %s&quot;</span>, returnType);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是调用了retrofit的callAdapter方法，retrofit中最终创建CallAdapter的方法是这个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CallAdapter&lt;?, ?&gt; nextCallAdapter(</span><br><span class="line">    <span class="meta">@Nullable</span> CallAdapter.Factory skipPast, Type returnType, Annotation[] annotations) &#123;</span><br><span class="line">  <span class="keyword">int</span> start = callAdapterFactories.indexOf(skipPast) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = callAdapterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">    CallAdapter&lt;?, ?&gt; adapter = callAdapterFactories.get(i).get(returnType, annotations, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (adapter != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(builder.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到了吧，这里Retrofit就是在遍历自己的CallAdapterFactory，然后调用get方法，将返回值类型returnType和annotations传入，如果返回不为空，则返回。CallAdapterFactory的这个get方法的作用是，如果对应的CallAdapter能把数据转化成returnType类型，那么就生成出一个CallAdapter出来，如果不能则返回null，如果Retrofit中所带的CallAdapter没有一个符合条件的，那么就会来到最后一行，抛出一个Exception。</p>
<p>如果我们在创建Retrofit时，不手动添加CallAdapter，它也能用，是因为Retrofit里有个缺省的CallAdapter，叫DefaultCallAdapterFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultCallAdapterFactory</span> <span class="keyword">extends</span> <span class="title">CallAdapter</span>.<span class="title">Factory</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> Executor callbackExecutor;</span><br><span class="line"></span><br><span class="line">  DefaultCallAdapterFactory(<span class="meta">@Nullable</span> Executor callbackExecutor) &#123;</span><br><span class="line">    <span class="keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="meta">@Nullable</span> CallAdapter&lt;?, ?&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">    <span class="keyword">if</span> (getRawType(returnType) != Call.class) &#123; <span class="keyword">return</span> <span class="keyword">null</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(returnType <span class="keyword">instanceof</span> ParameterizedType)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Call return type must be parameterized as Call&lt;Foo&gt; or Call&lt;? extends Foo&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> Type responseType = Utils.getParameterUpperBound(<span class="number">0</span>, (ParameterizedType) returnType);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Executor executor = Utils.isAnnotationPresent(annotations, SkipCallbackExecutor.class) ? <span class="keyword">null</span> : callbackExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CallAdapter&lt;Object, Call&lt;?&gt;&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Type <span class="title">responseType</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> responseType; &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Call&lt;Object&gt; <span class="title">adapt</span><span class="params">(Call&lt;Object&gt; call)</span> </span>&#123; <span class="keyword">return</span> executor == <span class="keyword">null</span> ? call : <span class="keyword">new</span> ExecutorCallbackCall&lt;&gt;(executor, call); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法里第一行是这么写的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (getRawType(returnType) != Call.class) &#123; <span class="keyword">return</span> <span class="keyword">null</span>; &#125;</span><br></pre></td></tr></table></figure>
<p>意思就是，如果returnType不是Call，那么就返回null，换句话说，这个CallAdapter只能处理<code>Call&lt;T&gt;</code>类型的方法，也就是我们常写的那种，responseType是Call的范型T，方法最后直接new了一个CallAdapter返回了，在adapt方法中，因为Call就是最基本的形式，需要的也是Call类型，所以不需要额外的处理，就直接返回了，ExecutorCallbackCall是切换线程的，就不多说了。</p>
<p>总结一下就是，Retrofit里保存了自带的和我们手动添加的所有CallAdapterFactory，我们调用API实例的方法时，实际上是在调用动态代理的invoke方法，这方法里为每个API接口方法生成了一个ServiceMethod，在生成ServiceMethod时会从Retrofit的CallAdapterFactory中查找，看是否有CallAdapter可以将Call转换成目标类型，有则使用，无则抛异常。这样，在我们调用API实例的方法时，就可以得到结果了。</p>
<p>如果需要自定义CallAdapter，则需要实现CallAdapterFactory和CallAdapter。</p>
<h3 id="7-Converter"><a href="#7-Converter" class="headerlink" title="7. Converter"></a>7. Converter</h3><p>说完CallAdapter，再来看看Converter，说实话，我都有点敲累了，本着一鼓作气的精神，还是坚持敲完吧。</p>
<p>有了上面的经验，这个就容易一些了。同样，Retrofit中也是保存了所有的ConverterFactory，所有需要Converter的地方，都是从这里提供的。ConvertFactory是提供Converter的工厂，它里面主要有3个方法，也就是可以提供三个维度的Converter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@Nullable</span></span><br><span class="line">  <span class="function">T <span class="title">convert</span><span class="params">(F value)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Creates &#123;<span class="doctag">@link</span> Converter&#125; instances based on a type and target usage. */</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@link</span> Converter&#125; for converting an HTTP response body to &#123;<span class="doctag">@code</span> type&#125;, or null if</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> type&#125; cannot be handled by this factory. This is used to create converters for</span></span><br><span class="line"><span class="comment">     * response types such as &#123;<span class="doctag">@code</span> SimpleResponse&#125; from a &#123;<span class="doctag">@code</span> Call&lt;SimpleResponse&gt;&#125;</span></span><br><span class="line"><span class="comment">     * declaration.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@Nullable</span> Converter&lt;ResponseBody, ?&gt; responseBodyConverter(</span><br><span class="line">        Type type, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@link</span> Converter&#125; for converting &#123;<span class="doctag">@code</span> type&#125; to an HTTP request body, or null if</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> type&#125; cannot be handled by this factory. This is used to create converters for types</span></span><br><span class="line"><span class="comment">     * specified by &#123;<span class="doctag">@link</span> Body <span class="doctag">@Body</span>&#125;, &#123;<span class="doctag">@link</span> Part <span class="doctag">@Part</span>&#125;, and &#123;<span class="doctag">@link</span> PartMap <span class="doctag">@PartMap</span>&#125; values.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@Nullable</span> Converter&lt;?, RequestBody&gt; requestBodyConverter(</span><br><span class="line">        Type type,</span><br><span class="line">        Annotation[] parameterAnnotations,</span><br><span class="line">        Annotation[] methodAnnotations,</span><br><span class="line">        Retrofit retrofit) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a &#123;<span class="doctag">@link</span> Converter&#125; for converting &#123;<span class="doctag">@code</span> type&#125; to a &#123;<span class="doctag">@link</span> String&#125;, or null if</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> type&#125; cannot be handled by this factory. This is used to create converters for types</span></span><br><span class="line"><span class="comment">     * specified by &#123;<span class="doctag">@link</span> Field <span class="doctag">@Field</span>&#125;, &#123;<span class="doctag">@link</span> FieldMap <span class="doctag">@FieldMap</span>&#125; values, &#123;<span class="doctag">@link</span> Header <span class="doctag">@Header</span>&#125;,</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> HeaderMap <span class="doctag">@HeaderMap</span>&#125;, &#123;<span class="doctag">@link</span> Path <span class="doctag">@Path</span>&#125;, &#123;<span class="doctag">@link</span> Query <span class="doctag">@Query</span>&#125;, and &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment">     * QueryMap <span class="doctag">@QueryMap</span>&#125; values.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@Nullable</span> Converter&lt;?, String&gt; stringConverter(</span><br><span class="line">        Type type, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这三个维度分别是requestBodyConverter、responseBodyConverter和stringConverter。</p>
<p>下面我们来看看发起请求过程中的一些细节。</p>
<p>我们在声明请求时用注解标记了很多信息，比如请求Method，请求Path，这些最终都需要转换成网络请求认识的形式才可以，转化注解这件事，是在RequestFactory中做的，而RequestFactory是在ServiceMethod创建时一起创建的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServiceMethod.parseAnnotations(this, method);</span></span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">ServiceMethod&lt;T&gt; <span class="title">parseAnnotations</span><span class="params">(Retrofit retrofit, Method method)</span> </span>&#123;</span><br><span class="line">    RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RequestFactory通过静态方法创建了实例，在创建时，对所有注解进行了解析，在这个解析过程中，便是使用了Retrofit的ConverterFactory的stringConvterer和requestBodyConverter，解析参数时用stringConverter，解析RequestBody时用requestBodyConverter。</p>
<p>Converter的获取方式和CallAdapter类似，同样是传入一个类型，如果能转化，则返回一个Converter，不能就返回null，解析Body时，多是将起转化成JSON格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Converter&lt;T, RequestBody&gt; <span class="title">nextRequestBodyConverter</span><span class="params">(<span class="meta">@Nullable</span> Converter.Factory skipPast, Type type, Annotation[] parameterAnnotations, Annotation[] methodAnnotations)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> start = converterFactories.indexOf(skipPast) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = converterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">    Converter.Factory factory = converterFactories.get(i);</span><br><span class="line">    Converter&lt;?, RequestBody&gt; converter = factory.requestBodyConverter(type, parameterAnnotations, methodAnnotations, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (converter != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">//noinspection unchecked</span></span><br><span class="line">      <span class="keyword">return</span> (Converter&lt;T, RequestBody&gt;) converter;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(builder.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成ServiceMethod后，便会调用其invoke方法，这个方法会将请求包装成一个叫做OkHttpCall的类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HttpServiceMethod.java</span></span><br><span class="line">  <span class="keyword">final</span> <span class="meta">@Nullable</span> <span class="function">ReturnT <span class="title">invoke</span><span class="params">(Object[] args)</span> </span>&#123;</span><br><span class="line">    Call&lt;ResponseT&gt; call = <span class="keyword">new</span> OkHttpCall&lt;&gt;(requestFactory, args, callFactory, responseConverter);</span><br><span class="line">    <span class="keyword">return</span> adapt(call, args);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>将刚刚生成的requestFactory作为参数传了进去，同时还传入了responseConveter，用来解析服务器返回的数据，同样，responseConverter也是由Retrofit提供，如果有能处理type的Converter，则返回，无则返回null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Converter&lt;ResponseBody, T&gt; <span class="title">nextResponseBodyConverter</span><span class="params">(<span class="meta">@Nullable</span> Converter.Factory skipPast, Type type, Annotation[] annotations)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> start = converterFactories.indexOf(skipPast) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = converterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">    Converter&lt;ResponseBody, ?&gt; converter = converterFactories.get(i).responseBodyConverter(type, annotations, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (converter != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">//noinspection unchecked</span></span><br><span class="line">      <span class="keyword">return</span> (Converter&lt;ResponseBody, T&gt;) converter;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(builder.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再来看看GsonConverterFactory的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GsonConverterFactory</span> <span class="keyword">extends</span> <span class="title">Converter</span>.<span class="title">Factory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GsonConverterFactory <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> create(<span class="keyword">new</span> Gson());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GsonConverterFactory <span class="title">create</span><span class="params">(Gson gson)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (gson == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;gson == null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GsonConverterFactory(gson);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Gson gson;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">GsonConverterFactory</span><span class="params">(Gson gson)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.gson = gson;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Converter&lt;ResponseBody, ?&gt; responseBodyConverter(Type type, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">    TypeAdapter&lt;?&gt; adapter = gson.getAdapter(TypeToken.get(type));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GsonResponseBodyConverter&lt;&gt;(gson, adapter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Converter&lt;?, RequestBody&gt; requestBodyConverter(Type type, Annotation[] parameterAnnotations, Annotation[] methodAnnotations, Retrofit retrofit) &#123;</span><br><span class="line">    TypeAdapter&lt;?&gt; adapter = gson.getAdapter(TypeToken.get(type));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GsonRequestBodyConverter&lt;&gt;(gson, adapter);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，它只重写了两个维度，requestBody和responseBody的Converter，GsonResponseBodyConverter的作用是把JSON串转化成对象，而GsonRequestBodyConverter的作用是把对象转化成JSON串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GsonRequestBodyConverter.java</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RequestBody <span class="title">convert</span><span class="params">(T value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Buffer buffer = <span class="keyword">new</span> Buffer();</span><br><span class="line">    Writer writer = <span class="keyword">new</span> OutputStreamWriter(buffer.outputStream(), UTF_8);</span><br><span class="line">    JsonWriter jsonWriter = gson.newJsonWriter(writer);</span><br><span class="line">    adapter.write(jsonWriter, value);</span><br><span class="line">    jsonWriter.close();</span><br><span class="line">    <span class="keyword">return</span> RequestBody.create(MEDIA_TYPE, buffer.readByteString());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GsonResponseBodyConverter.java</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">convert</span><span class="params">(ResponseBody value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    JsonReader jsonReader = gson.newJsonReader(value.charStream());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      T result = adapter.read(jsonReader);</span><br><span class="line">      <span class="keyword">if</span> (jsonReader.peek() != JsonToken.END_DOCUMENT) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> JsonIOException(<span class="string">&quot;JSON document was not fully consumed.&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      value.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>同样，若自定义Converter，实现Converter.Factory和Converter，即可。</p>
<h3 id="8-写在最后"><a href="#8-写在最后" class="headerlink" title="8. 写在最后"></a>8. 写在最后</h3><p>直观来看，依赖框架帮助我们省去了不少重复性的工作。但是，省去不等于是不做。从宏观角度来看，发送一个网络请求的需要做的事情有构建请求，连接服务器，发送请求，接收回应。这些必须的步骤，每次请求都是必不可缺的，这里的省去只是简化了我们的工作，但这些事并没有省去，只是这些依赖库在背后用复杂的逻辑默默的帮我们在做。从这个角度看，依赖库确实可以提升开发效率，但也不能过分依赖，框架背后的不少内容，还是需要我们熟知的，就像是网络请求，如果只知道通过这些框架发送请求、处理回应，那么在遇到一些涉及基础知识的问题时，可以就会有些不知所措。</p>

    </div>

    
    
    
    <div>
       
       <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">------------- (完) -------------</div>
    
</div>
       
      </div>
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpeg" alt="oynix 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpeg" alt="oynix 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>oynix
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://oynix.github.io/2022/05/59844027c896/" title="Retrofit使用">https://oynix.github.io/2022/05/59844027c896/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/Retrofit/" rel="tag"># Retrofit</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/bd9c9a5395ee/" rel="prev" title="OkHttp使用">
      <i class="fa fa-chevron-left"></i> OkHttp使用
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/05/54728a7f7b90/" rel="next" title="Kotlin Flow">
      Kotlin Flow <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="nav-text">1. 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8"><span class="nav-text">2. 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%A4%BA%E4%BE%8B"><span class="nav-text">3. 示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B3%A8%E8%A7%A3"><span class="nav-text">4. 注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E8%AF%B7%E6%B1%82%E7%9A%84%E6%9C%80%E7%BB%88URL"><span class="nav-text">5. 请求的最终URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-CallAdapter"><span class="nav-text">6. CallAdapter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Converter"><span class="nav-text">7. Converter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="nav-text">8. 写在最后</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="oynix"
      src="/images/fbb.jpg">
  <p class="site-author-name" itemprop="name">oynix</p>
  <div class="site-description" itemprop="description">避免没有计划的行动</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">96</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL295bml4" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;oynix"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOm95bml4QGZveG1haWwuY29t" title="E-Mail → mailto:oynix@foxmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fas fa-basketball-ball"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">oynix</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">408k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:11</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '70fea9109cf120e422df',
      clientSecret: 'f988e3db3d5c32bf420ceff04fa7de68ce924020',
      repo        : 'oynix.github.io',
      owner       : 'oynix',
      admin       : ['oynix'],
      id          : '96c285ee7861482706f2043f5b58a6cf',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
